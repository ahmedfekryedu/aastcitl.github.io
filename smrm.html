<!doctype html>
<html lang="ar" dir="rtl">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ø°ÙƒÙŠ Ù„Ø¥Ø¯Ø§Ø±Ø© Ù‚Ø§Ø¹Ø© Ø§Ø¬ØªÙ…Ø§Ø¹Ø§Øª Ù…Ø¬Ù„Ø³ Ø§Ù„ÙƒÙ„ÙŠØ©</title>
  <meta name="description" content="Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ø°ÙƒÙŠ Ø§Ù„Ù…ÙˆØ­Ø¯ Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£ØµÙˆÙ„ Ø§Ù„ØªØ¹Ù„ÙŠÙ…ÙŠØ© ÙˆÙ…Ø±ÙƒØ² Ø§ØªØ®Ø§Ø° Ø§Ù„Ù‚Ø±Ø§Ø± Ø¨ÙƒÙ„ÙŠØ© Ø§Ù„Ù†Ù‚Ù„ Ø§Ù„Ø¯ÙˆÙ„ÙŠ ÙˆØ§Ù„Ù„ÙˆØ¬Ø³ØªÙŠØ§Øª.">
  <meta name="keywords" content="CITL, ÙƒÙ„ÙŠØ© Ø§Ù„Ù†Ù‚Ù„ Ø§Ù„Ø¯ÙˆÙ„ÙŠ ÙˆØ§Ù„Ù„ÙˆØ¬Ø³ØªÙŠØ§Øª, Ø§Ø¯Ø§Ø±Ø© Ø§Ù„Ù‚Ø§Ø¹Ø§Øª, Ø¬Ø¯Ø§ÙˆÙ„ Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø§Øª, Ù…Ø±ÙƒØ² Ø§ØªØ®Ø§Ø° Ø§Ù„Ù‚Ø±Ø§Ø±, Ø§Ù„Ø£ÙƒØ§Ø¯ÙŠÙ…ÙŠØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©">
  <meta name="language" content="Arabic">
  <meta name="theme-color" content="#2A3475">
  <link rel="manifest" href="manifest.json">
  <link rel="shortcut icon" type="image/gif" href="CITL_Logo.gif">
  <link rel="icon" type="image/gif" href="CITL_Logo.gif">
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@200..1000&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
  <style>
body {
            box-sizing: border-box;
            font-family: 'Cairo', sans-serif; /* Ù‡Ù†Ø§ Ø§Ù„ØªØºÙŠÙŠØ± */
            background-color: #f9fafb;
        }

        /* Ù„Ø¶Ù…Ø§Ù† ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø®Ø· Ø¹Ù„Ù‰ Ø§Ù„Ø¹Ù†Ø§ÙˆÙŠÙ† Ø£ÙŠØ¶Ø§Ù‹ */
        h1, h2, h3, h4, h5, h6, input, select, button, textarea {
            font-family: 'Cairo', sans-serif;
        }
        
.calendar-grid {
            display: grid;
            grid-template-columns: 80px repeat(7, 1fr); /* ØªØµØºÙŠØ± Ø¹Ù…ÙˆØ¯ Ø§Ù„ÙˆÙ‚Øª Ù‚Ù„ÙŠÙ„Ø§Ù‹ Ù„Ø¥Ø¹Ø·Ø§Ø¡ Ù…Ø³Ø§Ø­Ø© Ø£ÙƒØ¨Ø± Ù„Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯ */
            gap: 0; /* Ø¥Ø²Ø§Ù„Ø© Ø§Ù„ÙØ±Ø§ØºØ§Øª Ø§Ù„Ø³Ù…ÙŠÙƒØ© */
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            overflow: hidden; /* Ù„Ù‚Øµ Ø§Ù„Ø­ÙˆØ§Ù Ø§Ù„Ø²Ø§Ø¦Ø¯Ø© */
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1); /* Ø¥Ø¶Ø§ÙØ© Ø¸Ù„ Ù„Ù„Ø¬Ø¯ÙˆÙ„ Ø¨Ø§Ù„ÙƒØ§Ù…Ù„ */
        }
        
.time-slot {
            background: white;
            padding: 4px; /* ØªÙ‚Ù„ÙŠÙ„ Ø§Ù„Ø­Ø´Ùˆ Ù‚Ù„ÙŠÙ„Ø§Ù‹ */
            min-height: 70px; /* Ø²ÙŠØ§Ø¯Ø© Ø§Ù„Ø§Ø±ØªÙØ§Ø¹ Ù‚Ù„ÙŠÙ„Ø§Ù‹ Ù„Ø±Ø§Ø­Ø© Ø§Ù„Ø¹ÙŠÙ† */
            position: relative;
        }
        
        .meeting-block {
            position: absolute;
            top: 2px;
            left: 2px;
            right: 2px;
            bottom: 2px;
            border-radius: 4px;
            padding: 4px;
            font-size: 12px;
            color: white;
            cursor: pointer;
            overflow: hidden;
        }
        
        .dean-priority { background: #dc2626; }
        .vice-dean-priority { background: #2563eb; }
        .department-priority { background: #16a34a; }
        .assistant-priority { background: #ca8a04; }
        
/* ---------- Notification: ÙÙŠ Ù…Ù†ØªØµÙ Ø§Ù„Ø´Ø§Ø´Ø© ---------- */
.notification-toast {
    position: fixed;
    top: -120px;
    left: 50%;                  /* Ù…Ø±ÙƒØ² Ø§Ù„Ø´Ø§Ø´Ø© Ø£ÙÙ‚ÙŠØ§Ù‹ */
    transform: translateX(-50%); /* ØªÙˆØ³ÙŠØ· Ø§Ù„Ø¹Ù†ØµØ± Ù†ÙØ³Ù‡ */
    right: auto;                /* Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ù…Ø­Ø§Ø°Ø§Ø© Ù„Ù„ÙŠÙ…ÙŠÙ† */
    
    min-width: 320px;
    max-width: 90%;             /* Ù„Ø¶Ù…Ø§Ù† Ø¹Ø¯Ù… Ø§Ù„Ø®Ø±ÙˆØ¬ Ù…Ù† Ø´Ø§Ø´Ø§Øª Ø§Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„ */
    padding: 14px 24px;
    color: #fff;
    border-radius: 50px;        /* Ø­ÙˆØ§Ù Ø¯Ø§Ø¦Ø±ÙŠØ© Ø¨Ø§Ù„ÙƒØ§Ù…Ù„ Ù„Ø´ÙƒÙ„ Ø¹ØµØ±ÙŠ */
    z-index: 10000;
    transition: top 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275), opacity 0.3s ease;
    box-shadow: 0 10px 40px rgba(0,0,0,0.2);
    pointer-events: none;
    
    /* ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠ */
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 12px;
    direction: rtl;
    font-family: 'Cairo', sans-serif;
    backdrop-filter: blur(8px); /* ØªØ£Ø«ÙŠØ± Ø¶Ø¨Ø§Ø¨ÙŠ Ù„Ù„Ø®Ù„ÙÙŠØ© */
}

/* Ø­Ø§Ù„Ø© Ø§Ù„Ø¸Ù‡ÙˆØ± */
.notification-toast.show {
    top: 30px;
    pointer-events: auto;
    opacity: 1;
}

/* Ø§Ù„Ø£Ù„ÙˆØ§Ù† */
.notification-toast.bg-success { background: linear-gradient(135deg, #10b981, #059669) !important; }
.notification-toast.bg-error   { background: linear-gradient(135deg, #ef4444, #dc2626) !important; }
.notification-toast.bg-info    { background: linear-gradient(135deg, #3b82f6, #2563eb) !important; }

/* Ø§Ù„Ù†Øµ */
.notification-text {
    font-size: 14px;
    font-weight: 700;
}


        
.ai-suggestion {
            background: #2A3475; /* ØªÙ… Ø§Ù„ØªØºÙŠÙŠØ± Ù…Ù† Ø§Ù„ØªØ¯Ø±Ø¬ Ø§Ù„Ø¨Ù†ÙØ³Ø¬ÙŠ Ù„Ù„Ø£Ø²Ø±Ù‚ Ø§Ù„ÙƒØ­Ù„ÙŠ */
            border-right: 4px solid #F3A628; /* Ø¥Ø¶Ø§ÙØ© Ø®Ø· Ø°Ù‡Ø¨ÙŠ Ø¬Ù…Ø§Ù„ÙŠ */
            border-radius: 8px;
            padding: 12px;
            margin: 8px 0;
            color: white;
        }
        
.stats-card {
            background: #2A3475; /* ØªÙ… Ø§Ù„ØªØºÙŠÙŠØ± Ù…Ù† Ø§Ù„ØªØ¯Ø±Ø¬ Ø§Ù„ÙˆØ±Ø¯ÙŠ Ù„Ù„Ø£Ø²Ø±Ù‚ Ø§Ù„ÙƒØ­Ù„ÙŠ */
            border-bottom: 4px solid #F3A628; /* Ø¥Ø¶Ø§ÙØ© Ø®Ø· Ø°Ù‡Ø¨ÙŠ ÙÙŠ Ø§Ù„Ø£Ø³ÙÙ„ */
            border-radius: 12px;
            padding: 20px;
            color: white;
            text-align: center;
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
        }
        
        .modal.show {
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .modal-content {
            background: white;
            border-radius: 12px;
            padding: 24px;
            max-width: 500px;
            width: 90%;
            max-height: 90%;
            overflow-y: auto;
        }

        @keyframes pulse-ring {
            0% { transform: scale(0.33); }
            80%, 100% { opacity: 0; }
        }
        @keyframes pulse-dot {
            0% { transform: scale(0.8); }
            50% { transform: scale(1); }
            100% { transform: scale(0.8); }
        }
        .live-indicator {
            position: relative;
            display: flex;
            align-items: center;
        }
        .live-indicator::before {
            content: '';
            position: absolute;
            left: -4px;
            top: -4px;
            width: 16px;
            height: 16px;
            background-color: currentColor;
            border-radius: 50%;
            opacity: 0.4;
            animation: pulse-ring 1.25s cubic-bezier(0.215, 0.61, 0.355, 1) infinite;
        }
        .live-indicator::after {
            content: '';
            position: relative;
            width: 8px;
            height: 8px;
            background-color: currentColor;
            border-radius: 50%;
            box-shadow: 0 0 8px currentColor;
            animation: pulse-dot 1.25s cubic-bezier(0.455, 0.03, 0.515, 0.955) -0.4s infinite;
        }

        /* ØªØµÙ…ÙŠÙ… Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù†Ø³Ø¯Ù„Ø© Ø§Ù„Ø§Ø­ØªØ±Ø§ÙÙŠØ© */
        .custom-dropdown { position: relative; width: 100%; }
        .custom-dropdown-display { 
            width: 100%; 
            padding: 10px 16px; 
            background-color: white; 
            border: 1px solid #d1d5db; 
            border-radius: 0.5rem; 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            cursor: pointer; 
            transition: all 0.2s;
        }
        .custom-dropdown-display:hover { border-color: #2A3475; }
        .custom-dropdown-options { 
            position: absolute; 
            top: 100%; 
            left: 0; 
            width: 100%; 
            background-color: white; 
            border: 1px solid #e5e7eb; 
            border-radius: 0.5rem; 
            margin-top: 4px; 
            max-height: 250px; 
            overflow-y: auto; 
            z-index: 50; 
            display: none; 
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1); 
        }
        .custom-dropdown-options.show { display: block; }
        .custom-option { 
            padding: 10px 16px; 
            cursor: pointer; 
            font-size: 0.875rem; 
            color: #374151; 
            border-bottom: 1px solid #f3f4f6;
            transition: background-color 0.2s;
        }
        .custom-option:last-child { border-bottom: none; }
        .custom-option:hover { background-color: #f0fdf4; color: #2A3475; font-weight: bold; }
        .custom-option.selected { background-color: #2A3475; color: white; }

        /* ÙƒÙˆØ¯ ØªØ®ØµÙŠØµ Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ…Ø±ÙŠØ± (Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ù…ÙˆØ­Ø¯Ø©) */
::-webkit-scrollbar { width: 8px; }
::-webkit-scrollbar-track { background: #f1f1f1; }
::-webkit-scrollbar-thumb { background: #2A3475; border-radius: 4px; }

        /* ========================================= */
/* ğŸ”¥ Ø£Ù†ÙŠÙ…ÙŠØ´Ù† Ø´Ø§Ø´Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„ (Unified Loader) ğŸ”¥ */
/* ========================================= */
@keyframes logo-pulse {
    0% { transform: scale(1); }
    50% { transform: scale(1.05); }
    100% { transform: scale(1); }
}
@keyframes spin-slow {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}
.loader-logo { animation: logo-pulse 2s infinite ease-in-out; }
.loader-ring { animation: spin-slow 4s linear infinite; }
/* -------------------------------------- */
/* ğŸ”¥ Ø£Ù†Ù…Ø§Ø· Ø§Ù„Ø®Ù„ÙÙŠØ© Ø§Ù„Ù…ØªØ§Ø­Ø© (Ù„Ù„ØªØ¬Ø±Ø¨Ø©: 15 Ù†Ù…Ø·Ø§Ù‹ Ø¥Ø¶Ø§ÙÙŠØ§Ù‹) */
/* -------------------------------------- */
/* A. Ø£Ù†Ù…Ø§Ø· Ø§Ù„Ø¹Ù…Ù‚ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© (Ù„Ø§ ØªØªØºÙŠØ±) */
.metallic-finish {
    background: linear-gradient(to bottom, #2A3475, #1e255a);
    box-shadow: inset 0px -2px 5px rgba(0, 0, 0, 0.4), 
                inset 0px 1px 1px rgba(255, 255, 255, 0.15); 
    position: relative;
    overflow: hidden;
}
.metallic-finish-footer {
    background: linear-gradient(to top, #2A3475, #1e255a);
    box-shadow: inset 0px 2px 5px rgba(0, 0, 0, 0.4), 
                inset 0px -1px 1px rgba(255, 255, 255, 0.15); 
    position: relative;
    overflow: hidden;
}
/* ---------------------------------- */
/* B. Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„Ø£Ù†Ù…Ø§Ø· Ø§Ù„Ø¥Ø¶Ø§ÙÙŠØ© ÙˆØ§Ù„Ø¨Ø¯ÙŠÙ„Ø© (Ø§Ø®ØªØ± ÙƒÙ„Ø§Ø³ ÙˆØ§Ø­Ø¯ Ù„Ù„ØªØ·Ø¨ÙŠÙ‚) */
/* ---------------------------------- */

/* 16. ğŸŒ«ï¸ Ù†Ù…Ø· Ø§Ù„Ø­Ø¨ÙŠØ¨Ø§Øª/Ø§Ù„ØªØ´ÙˆÙŠØ´ Ø§Ù„Ù†Ø§Ø¹Ù… (Subtle Grain/Noise) - ÙŠØ¹Ø·ÙŠ Ø¹Ù…Ù‚Ø§Ù‹ ÙƒØ§Ù„Ø®Ø§Ù…Ø© */
.soft-grain-pattern::before {
    content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 0; pointer-events: none;
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 2 2'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)' opacity='0.08' fill='white'/%3E%3C/svg%3E");
    background-size: 100% 100%;
    opacity: 1; 
}

/* 17. ğŸŒ‘ Ù†Ù…Ø· Ø§Ù„ØªØ¹ØªÙŠÙ… Ø§Ù„Ù…Ø±ÙƒØ²ÙŠ (Vignette Effect) - ÙŠØ±ÙƒØ² Ø§Ù„Ø¶ÙˆØ¡ Ø¹Ù„Ù‰ Ø§Ù„Ù…Ù†ØªØµÙ */
.vignette-effect::before {
    content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 0; pointer-events: none;
    background: radial-gradient(ellipse at center, transparent 30%, rgba(0, 0, 0, 0.2) 100%);
    opacity: 1; 
}

/* 18. ğŸŸ¡ Ù†Ù…Ø· Ø§Ù„Ø¯ÙˆØ§Ø¦Ø± Ø§Ù„ÙØ§ØªØ­Ø© Ø§Ù„Ø¹Ø´ÙˆØ§Ø¦ÙŠØ© (Random Light Circles) - ÙŠÙˆØ­ÙŠ Ø¨Ø§Ù„Ø¥Ø¶Ø§Ø¡Ø© Ø§Ù„Ù…Ø¨Ø¹Ø«Ø±Ø© */
.random-light-circles::before {
    content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 0; pointer-events: none;
    background: radial-gradient(circle at 10% 20%, rgba(255, 255, 255, 0.05) 5%, transparent 6%),
                radial-gradient(circle at 70% 80%, rgba(255, 255, 255, 0.08) 3%, transparent 4%),
                radial-gradient(circle at 40% 50%, rgba(255, 255, 255, 0.06) 4%, transparent 5%);
    background-size: 100% 100%;
    opacity: 1; 
}

/* 19. ğŸ§± Ù†Ù…Ø· Ø§Ù„Ø·ÙˆØ¨ Ø§Ù„Ø£ÙÙ‚ÙŠ (Faint Brickwork) - ÙŠÙˆØ­ÙŠ Ø¨Ø§Ù„Ø¨Ù†ÙŠØ© Ø§Ù„ØªØ­ØªÙŠØ© ÙˆØ§Ù„Ù…Ø¨Ø§Ù†ÙŠ */
.brickwork-pattern::before {
    content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 0; pointer-events: none;
    background-image: linear-gradient(90deg, #fff 1px, transparent 1px), linear-gradient(#fff 1px, transparent 1px), linear-gradient(90deg, transparent 50%, #fff 50%), linear-gradient(#fff 1px, transparent 1px);
    background-size: 40px 20px;
    background-color: transparent;
    opacity: 0.02; 
}

/* 20. âš¡ï¸ Ù†Ù…Ø· Ø§Ù„Ø®Ø·ÙˆØ· Ø§Ù„Ù…ØªØ¹Ø±Ø¬Ø© (ZigZag Lines) */
.zigzag-pattern::before {
    content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 0; pointer-events: none;
    background: repeating-linear-gradient(135deg, rgba(255, 255, 255, 0.08), rgba(255, 255, 255, 0.08) 5px, transparent 5px, transparent 10px),
                repeating-linear-gradient(-135deg, rgba(255, 255, 255, 0.08), rgba(255, 255, 255, 0.08) 5px, transparent 5px, transparent 10px);
    background-size: 20px 20px;
    opacity: 1; 
}

/* 21. ğŸŸ  Ù†Ù…Ø· Ø§Ù„Ù‡Ù„Ø§Ù„ Ø§Ù„Ù…ØªÙƒØ±Ø± (Crescent Pattern) */
.crescent-pattern::before {
    content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 0; pointer-events: none;
    background: radial-gradient(circle at 0% 100%, transparent 10px, rgba(255, 255, 255, 0.05) 10px, rgba(255, 255, 255, 0.05) 12px, transparent 12px);
    background-size: 50px 50px;
    opacity: 1; 
}

/* 22. â• Ù†Ù…Ø· Ø§Ù„Ø®Ø·ÙˆØ· Ø§Ù„Ù…Ø±ÙƒØ²ÙŠØ© (Crosshair Grid) */
.crosshair-grid-pattern::before {
    content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 0; pointer-events: none;
    background-image: 
        linear-gradient(to right, rgba(255, 255, 255, 0.02) 1px, transparent 1px),
        linear-gradient(to bottom, rgba(255, 255, 255, 0.02) 1px, transparent 1px);
    background-size: 15px 15px;
    opacity: 1; 
}

/* 23. ğŸ”µ Ù†Ù…Ø· Ø§Ù„Ø¯ÙˆØ§Ø¦Ø± Ø§Ù„Ù…Ø²Ø¯ÙˆØ¬Ø© Ø§Ù„Ù…ØªØ¯Ø§Ø®Ù„Ø© (Double Ring) */
.double-ring-pattern::before {
    content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 0; pointer-events: none;
    background: radial-gradient(circle at center, transparent 10px, rgba(255, 255, 255, 0.05) 10px, rgba(255, 255, 255, 0.05) 12px, transparent 12px, transparent 20px, rgba(255, 255, 255, 0.05) 20px, rgba(255, 255, 255, 0.05) 22px, transparent 22px);
    background-size: 60px 60px;
    opacity: 1; 
}

/* 24. ğŸ“¦ Ù†Ù…Ø· Ø§Ù„Ø­Ø§ÙˆÙŠØ§Øª Ø§Ù„Ø¹ÙƒØ³ÙŠ (Inverse Cargo Stripes - Ø±Ø£Ø³ÙŠ) */
.inverse-cargo-pattern::before {
    content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 0; pointer-events: none;
    background: repeating-linear-gradient(to right, rgba(255, 255, 255, 0.05) 0px, rgba(255, 255, 255, 0.05) 2px, transparent 2px, transparent 20px);
    background-size: 20px 100%;
    opacity: 1; 
}

/* 25. ğŸ§Š Ù†Ù…Ø· Ø§Ù„Ø¨Ù„Ø§Ø·Ø§Øª Ø§Ù„Ù…Ø§Ø¦Ù„Ø© (Tilted Tiles) */
.tilted-tiles-pattern::before {
    content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 0; pointer-events: none;
    background-image: linear-gradient(45deg, rgba(255, 255, 255, 0.05) 50%, transparent 50%), linear-gradient(-45deg, rgba(255, 255, 255, 0.05) 50%, transparent 50%);
    background-size: 40px 40px;
    opacity: 1; 
}

/* 26. ğŸ”´ ØªØ£Ø«ÙŠØ± Ø§Ù„Ø¶ÙˆØ¡ Ø§Ù„Ø¹Ø´ÙˆØ§Ø¦ÙŠ (Scattered Light Effect) */
.scattered-light-effect::before {
    content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 0; pointer-events: none;
    background: radial-gradient(circle at 15% 15%, rgba(255, 255, 255, 0.1), transparent 30%),
                radial-gradient(circle at 80% 60%, rgba(255, 255, 255, 0.05), transparent 25%);
    opacity: 1; 
}

/* 27. ã€°ï¸ Ù†Ù…Ø· Ø§Ù„Ø®Ø·ÙˆØ· Ø§Ù„Ù…ØªØ¹Ø±Ø¬Ø© Ø§Ù„Ø±Ø£Ø³ÙŠØ© (Vertical ZigZag) */
.vertical-zigzag-pattern::before {
    content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 0; pointer-events: none;
    background: repeating-linear-gradient(45deg, rgba(255, 255, 255, 0.05), rgba(255, 255, 255, 0.05) 5px, transparent 5px, transparent 10px),
                repeating-linear-gradient(-45deg, rgba(255, 255, 255, 0.05), rgba(255, 255, 255, 0.05) 5px, transparent 5px, transparent 10px);
    background-size: 20px 20px;
    opacity: 1; 
}

/* 28. ğŸŒ™ Ù†Ù…Ø· Ø§Ù„ØªØ¯Ø±Ø¬ Ù†ØµÙ Ø§Ù„Ø¯Ø§Ø¦Ø±ÙŠ (Half-Circle Gradient) */
.half-circle-gradient::before {
    content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 0; pointer-events: none;
    background: radial-gradient(circle at top left, rgba(255, 255, 255, 0.1) 0%, transparent 50%);
    background-size: 100% 100%;
    opacity: 1; 
}

/* 29. ğŸ”³ Ù†Ù…Ø· Ø§Ù„Ù…Ø±Ø¨Ø¹Ø§Øª Ø§Ù„Ù…ØªØ¯Ø§Ø®Ù„Ø© (Interlaced Squares) */
.interlaced-squares-pattern::before {
    content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 0; pointer-events: none;
    background-image: 
        linear-gradient(90deg, rgba(255, 255, 255, 0.05) 1px, transparent 1px),
        linear-gradient(180deg, rgba(255, 255, 255, 0.05) 1px, transparent 1px);
    background-size: 50px 50px;
    opacity: 1; 
}
/* Ù†Ù…Ø· Ø§Ù„Ø®Ø·ÙˆØ· Ø§Ù„Ù…Ø§Ø¦Ù„Ø© */
        .random-slanted-lines {
            position: relative;
            overflow: hidden;
        }
/* 30. ğŸŒ  Ù†Ù…Ø· Ø§Ù„Ø®Ø·ÙˆØ· Ø§Ù„Ù…Ø§Ø¦Ù„Ø© Ø§Ù„Ø¹Ø´ÙˆØ§Ø¦ÙŠØ© (Random Slanted Lines) */
.random-slanted-lines::before {
    content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 0; pointer-events: none;
    background: repeating-linear-gradient(
        -30deg, transparent, transparent 10px, rgba(255, 255, 255, 0.05) 10px, rgba(255, 255, 255, 0.05) 11px
    );
    opacity: 1; 
}

/* -------------------------------------- */
/* ğŸ”¥ 4. ÙƒÙ„Ø§Ø³ Ø§Ù„ØªØ¹Ø¨Ø¦Ø© Ø§Ù„Ù…Ø¹Ø¯Ù†ÙŠØ© (Ø¨Ø¯ÙˆÙ† Ø£Ù†Ù…Ø§Ø·) - Ù„Ù„ØªØ·Ø¨ÙŠÙ‚ Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø±Ø¨Ø¹Ø§Øª ÙˆØ§Ù„Ø®Ù„ÙÙŠØ§Øª */
.metallic-blue-fill {
    /* Ù†ÙØ³ ØªØ¯Ø±Ø¬ Ø§Ù„Ù‡ÙŠØ¯Ø± ÙˆØ§Ù„ÙÙˆØªØ± */
    background: linear-gradient(to bottom, #2A3475, #1e255a);
    /* Ø¸Ù„ Ø¯Ø§Ø®Ù„ÙŠ Ø®ÙÙŠÙ Ù„Ø¥Ø¹Ø·Ø§Ø¡ Ø§Ù„Ø¹Ù…Ù‚ */
    box-shadow: inset 0px 1px 3px rgba(0, 0, 0, 0.5),
                inset 0px 1px 1px rgba(255, 255, 255, 0.15);
}
/* -------------------------------------- */

/* ØªØ­Ø³ÙŠÙ† Ø´ÙƒÙ„ Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ…Ø±ÙŠØ± Ù„Ù„Ø¬Ø¯ÙˆÙ„ */
.scrollbar-thin::-webkit-scrollbar {
    height: 4px; /* Ø¹Ø±Ø¶ Ø±ÙÙŠØ¹ Ø¬Ø¯Ø§Ù‹ */
}
.scrollbar-thin::-webkit-scrollbar-thumb {
    background-color: #F3A628;
    border-radius: 10px;
}
.scrollbar-thin::-webkit-scrollbar-track {
    background-color: #f1f1f1;
}

    </style>
  <style>@view-transition { navigation: auto; }</style>
 </head>
 <body class="bg-gray-50">
  <div class="min-h-full"><!-- Header -->
<header class="metallic-blue-fill random-slanted-lines shadow-lg border-b-4 border-[#F3A628] sticky top-0 z-50">
        <div class="absolute top-0 left-0 w-24 h-24 overflow-hidden z-[100] pointer-events-none">

    <div class="absolute top-[15px] left-[-30px] w-[110px] bg-gradient-to-r from-[#F3A628] to-[#d48a1b] text-[#2A3475] text-[9px] md:text-[10px] font-black text-center -rotate-45 py-1 shadow-md border-b-2 border-[#2A3475] tracking-wider">

        Ù†Ø³Ø®Ø© ØªØ¬Ø±ÙŠØ¨ÙŠØ©

    </div>

</div>
    <div class="w-full max-w-[98%] mx-auto px-3 py-5 md:px-6 md:py-5">
        
        <div class="hidden lg:flex flex-row items-center justify-between gap-3">
            <div class="flex items-center justify-start gap-4 text-right">
                <div class="bg-white p-2 rounded-xl shadow-lg shrink-0 group hover:scale-105 transition-transform duration-300">
                    <img src="CITL_Logo.gif" alt="Logo" class="h-16 w-auto object-contain transform scale-110">
                </div>
                <div class="flex flex-col">
                    <h1 class="text-white font-black text-[24px] leading-tight tracking-wide drop-shadow-md">ÙƒÙ„ÙŠØ© Ø§Ù„Ù†Ù‚Ù„ Ø§Ù„Ø¯ÙˆÙ„ÙŠ ÙˆØ§Ù„Ù„ÙˆØ¬Ø³ØªÙŠØ§Øª</h1>
                    <h2 class="text-[#F3A628] text-xs font-bold tracking-[2px] uppercase font-sans mt-0.5 opacity-90">College of International Transport & Logistics</h2>
                    <p class="text-xs text-blue-100/90 font-bold mt-1">Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ø°ÙƒÙŠ Ù„Ø¥Ø¯Ø§Ø±Ø© Ù‚Ø§Ø¹Ø© Ø§Ø¬ØªÙ…Ø§Ø¹Ø§Øª Ù…Ø¬Ù„Ø³ Ø§Ù„ÙƒÙ„ÙŠØ©</p>
                </div>
            </div>

            <div class="flex items-center gap-2 h-full">
<button onclick="openAddMeetingModal()" class="inline-flex items-center bg-gradient-to-b from-[#F3A628] to-[#d48a1b] text-[#2A3475] px-3 py-1.5 rounded-lg font-bold hover:brightness-110 shadow-lg border border-white/20 text-[13px]"> 
    <i class="fas fa-plus ml-2 text-base"></i>
    <span>Ø­Ø¬Ø² Ø¬Ø¯ÙŠØ¯</span>
</button>
<a href="schedules.html" class="bg-white/10 hover:bg-white/20 text-white border border-white/10 px-3 py-1.5 rounded-lg font-bold backdrop-blur-sm transition-all text-[13px]"> 
    <i class="fas fa-chalkboard text-base text-[#F3A628] ml-2"></i> Ø§Ù„Ù‚Ø§Ø¹Ø§Øª Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠØ© 
</a>
<button onclick="openDashboard()" class="bg-white/10 hover:bg-white/20 text-white border border-white/10 px-3 py-1.5 rounded-lg font-bold backdrop-blur-sm transition-all text-[13px]"> 
    <i class="fas fa-chart-pie text-base text-[#F3A628] ml-2"></i> Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª 
</button>
<button onclick="openAdminPanel()" class="bg-white/10 hover:bg-white/20 text-white border border-white/10 px-3 py-1.5 rounded-lg font-bold backdrop-blur-sm transition-all text-[13px]"> 
    <i class="fas fa-cogs text-base text-[#F3A628] ml-2"></i> Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… 
</button>
                
                <div class="w-px h-8 bg-white/20 mx-1"></div>
                <div class="relative shrink-0" id="notif-btn-wrapper-pc">
                    <button type="button" onclick="toggleNotifications()" class="bg-white/10 hover:bg-white/20 text-white border border-white/10 p-2.5 rounded-xl backdrop-blur-sm transition-all shadow-sm flex items-center justify-center group relative">
                        <i class="fas fa-bell text-lg"></i>
                        <span id="notif-badge" class="absolute -top-1 -right-1 w-5 h-5 bg-red-600 border-2 border-[#2A3475] rounded-full hidden flex items-center justify-center text-[10px] font-bold text-white">0</span>
                    </button>
                </div>
                <div class="flex items-center gap-3 bg-black/20 rounded-full pl-2 pr-5 py-1.5 border border-white/10 shrink-0 backdrop-blur-md self-center shadow-inner">
                    <div class="flex flex-col text-right">
                        <span id="profile-name" class="text-[13px] font-bold text-white leading-tight">Ø¬Ø§Ø±ÙŠ...</span>
                        <span id="profile-role" class="text-[11px] text-[#F3A628] leading-tight opacity-90">...</span>
                    </div>
                    <div class="w-10 h-10 rounded-full bg-[#2A3475] flex items-center justify-center text-white font-bold shadow-md border border-white/20 text-base relative">
                        <i class="fas fa-user"></i>
                        <span class="absolute bottom-0 right-0 w-3 h-3 bg-green-500 border-2 border-[#2A3475] rounded-full animate-pulse"></span>
                    </div>
                </div>
                <button onclick="window.logout()" class="bg-white/5 hover:bg-red-600 text-red-100 hover:text-white border border-white/10 p-2.5 rounded-xl transition-all shadow-sm ml-1"><i class="fas fa-sign-out-alt text-lg"></i></button>
            </div>
        </div>

        <div class="lg:hidden flex flex-row items-center justify-between w-full gap-1">
            
            <div class="flex items-center gap-1.5 flex-1 min-w-0">
                <div class="relative shrink-0" id="notif-btn-wrapper">
                    <div class="bg-white p-1 rounded-lg shadow-md relative h-11 w-11 flex items-center justify-center border border-white/20">
                        <img src="CITL_Logo.gif" alt="Logo" class="h-8 w-auto object-contain cursor-pointer" onclick="toggleMobileMenu()">
                        <div onclick="toggleMobileMenu()" class="absolute -bottom-1 -right-1 bg-[#2A3475] text-[#F3A628] w-5 h-5 rounded-full flex items-center justify-center text-[8px] border border-white shadow-sm cursor-pointer">
                            <i class="fas fa-bars"></i>
                        </div>
                        <div onclick="event.stopPropagation(); toggleNotifications();" class="absolute -top-1.5 -left-1.5 bg-[#F3A628] text-[#2A3475] w-5 h-5 rounded-full flex items-center justify-center text-[10px] border border-white shadow-md cursor-pointer active:scale-110 transition-transform">
                            <i class="fas fa-bell"></i>
                            <span id="notif-badge-mob" class="absolute -top-1 -right-1 bg-red-600 text-white rounded-full w-3.5 h-3.5 flex items-center justify-center text-[7px] font-black border border-white hidden">0</span>
                        </div>
                    </div>
                </div>

<div class="flex flex-col text-right leading-tight overflow-hidden flex-1 min-w-0">
    <h1 class="text-white font-black text-[clamp(10.5px,3.5vw,13.5px)] whitespace-nowrap drop-shadow-sm">
        ÙƒÙ„ÙŠØ© Ø§Ù„Ù†Ù‚Ù„ Ø§Ù„Ø¯ÙˆÙ„ÙŠ ÙˆØ§Ù„Ù„ÙˆØ¬Ø³ØªÙŠØ§Øª
    </h1>
<h2 class="text-[#F3A628] text-[clamp(7.25px,2.05vw,8.75px)] font-bold uppercase opacity-90 leading-none mt-0.5 whitespace-nowrap">
    College of International Transport & Logistics
</h2>
    <p class="text-[clamp(8px,2.3vw,9.2px)] text-blue-100/70 font-bold leading-none mt-0.5 whitespace-nowrap">
        Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ø°ÙƒÙŠ Ù„Ø¥Ø¯Ø§Ø±Ø© Ù‚Ø§Ø¹Ø© Ø§Ø¬ØªÙ…Ø§Ø¹Ø§Øª Ù…Ø¬Ù„Ø³ Ø§Ù„ÙƒÙ„ÙŠØ©
    </p>
</div>

<div id="mob-profile-capsule" onclick="toggleProfileInfoMenu()" class="flex flex-col justify-center text-left leading-tight bg-black/20 px-2.5 h-11 rounded-xl border border-white/10 backdrop-blur-md shadow-inner w-[clamp(82px,23.5vw,95px)] overflow-hidden shrink-0 cursor-pointer active:bg-black/40 transition-all ml-1">
    <span id="profile-name-mob" class="text-[10.5px] font-bold text-white truncate block w-full">...</span>
    <span id="profile-role-mob" class="text-[8.5px] text-[#F3A628] font-bold opacity-100 uppercase truncate block w-full">...</span>
</div>

        </div>
    </div>
</header><!-- Main Content -->
<main class="w-full max-w-[96%] mx-auto px-4 py-6">
       
<div class="bg-white rounded-lg shadow-md p-4 md:p-6 mb-6 border-b-4 border-[#F3A628] relative overflow-hidden">
    <div class="absolute top-0 right-0 w-32 h-32 bg-[#2A3475] opacity-[0.03] rounded-full -mr-10 -mt-10 hidden sm:block"></div>
    
    <div class="flex flex-col md:flex-row items-center justify-between relative z-10 gap-4">
        <div class="flex items-center space-x-4 space-x-reverse w-full md:w-auto">
            <div class="bg-[#2A3475]/5 p-3 md:p-3.5 rounded-xl border border-[#2A3475]/10 shrink-0">
                <i class="fas fa-door-open text-xl md:text-2xl text-[#2A3475]"></i>
            </div>
            
            <div class="min-w-0 flex-1">
                <h2 id="room-name" class="text-[clamp(16px,4.5vw,20px)] md:text-xl font-bold text-[#2A3475] mb-1 leading-tight">
                    Ù‚Ø§Ø¹Ø© Ø§Ø¬ØªÙ…Ø§Ø¹Ø§Øª Ù…Ø¬Ù„Ø³ Ø§Ù„ÙƒÙ„ÙŠØ©
                </h2>
                <div class="flex flex-wrap items-center text-gray-500 text-[11px] md:text-sm gap-x-3 gap-y-1">
                    <span class="flex items-center whitespace-nowrap"><i class="fas fa-chair ml-1.5 text-[#F3A628]"></i> Ø§Ù„Ø³Ø¹Ø©: 10 Ø£Ø´Ø®Ø§Øµ</span>
                    <span class="text-gray-300 hidden min-[380px]:block">|</span>
                    <span class="flex items-center whitespace-nowrap"><i class="fas fa-wifi ml-1.5 text-[#F3A628]"></i> Ù…Ø¬Ù‡Ø²Ø© Ø¨Ù€ Smart Screen</span>
                </div>
            </div>
        </div>

        <div class="flex items-center bg-green-50 px-4 py-2 rounded-full border border-green-200 shadow-sm shrink-0 w-fit md:w-auto self-center md:self-auto">
            <span class="relative flex h-2.5 w-2.5 ml-2.5">
                <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-green-500 opacity-75"></span>
                <span class="relative inline-flex rounded-full h-2.5 w-2.5 bg-green-600"></span>
            </span>
            <span class="text-green-700 font-bold text-[12px] md:text-sm tracking-wide whitespace-nowrap">Ù…ØªØ§Ø­Ø© Ø§Ù„Ø¢Ù†</span>
        </div>
    </div>
</div>

<div class="bg-white rounded-xl shadow-md p-3 md:p-4 mb-6 border-b-2 border-[#F3A628] border-t border-x border-gray-50">
    <div class="flex flex-col md:flex-row items-center justify-between gap-4">
        <div class="flex items-center bg-[#2A3475]/5 rounded-lg p-1.5 border border-[#2A3475]/10 w-full md:w-auto justify-between md:justify-start">
            <button id="prev-week" class="p-2 text-[#2A3475] hover:bg-white hover:shadow-sm rounded-md transition-all duration-200"> 
                <i class="fas fa-chevron-right text-lg"></i> 
            </button>
            
            <div id="week-dropdown-wrapper" class="relative custom-dropdown min-w-[150px] md:min-w-[200px] text-center tracking-wide mx-2">
                <div id="week-display-trigger" 
                     class="custom-dropdown-display w-full flex items-center justify-center p-0 cursor-pointer" 
                     style="border: none; background: transparent; min-height: 40px;">
                    
                    <span id="current-week" 
                          class="px-2 md:px-6 font-bold text-[#2A3475] text-sm md:text-base lg:text-lg truncate" 
                          style="min-width: 140px;">
                          Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...
                    </span>
                    <i id="week-arrow" class="fas fa-chevron-down text-xs text-[#2A3475] mr-2 transition-transform duration-200"></i>
                </div>
                
                <ul id="week-dropdown-options" 
                    class="custom-dropdown-options mx-auto w-[280px] md:w-[300px] !max-h-60 !overflow-y-auto !z-50 !origin-top !transform !translate-y-1 !shadow-xl right-1/2 translate-x-1/2 md:right-0 md:left-0 md:translate-x-0">
                </ul>
            </div>

            <button id="next-week" class="p-2 text-[#2A3475] hover:bg-white hover:shadow-sm rounded-md transition-all duration-200"> 
                <i class="fas fa-chevron-left text-lg"></i> 
            </button>
        </div>

        <div class="grid grid-cols-2 md:flex items-center flex-wrap justify-center gap-3 w-full md:w-auto">
            <div class="flex items-center justify-center px-3 py-1.5 bg-red-50 border border-red-100 rounded-full transition-transform hover:scale-105 cursor-default">
                <span class="w-2.5 h-2.5 bg-red-600 rounded-full shadow-sm ml-2"></span>
                <span class="text-xs font-bold text-red-700">Ø§Ù„Ø¹Ù…ÙŠØ¯</span>
            </div>
            <div class="flex items-center justify-center px-3 py-1.5 bg-[#2A3475]/5 border border-[#2A3475]/10 rounded-full transition-transform hover:scale-105 cursor-default">
                <span class="w-2.5 h-2.5 bg-[#2A3475] rounded-full shadow-sm ml-2"></span>
                <span class="text-xs font-bold text-[#2A3475]">Ø§Ù„ÙˆÙƒÙ„Ø§Ø¡</span>
            </div>
            <div class="flex items-center justify-center px-3 py-1.5 bg-green-50 border border-green-100 rounded-full transition-transform hover:scale-105 cursor-default">
                <span class="w-2.5 h-2.5 bg-green-600 rounded-full shadow-sm ml-2"></span>
                <span class="text-xs font-bold text-green-700">Ø§Ù„Ø£Ù‚Ø³Ø§Ù…</span>
            </div>
            <div class="flex items-center justify-center px-3 py-1.5 bg-yellow-50 border border-yellow-100 rounded-full transition-transform hover:scale-105 cursor-default">
                <span class="w-2.5 h-2.5 bg-yellow-500 rounded-full shadow-sm ml-2"></span>
                <span class="text-xs font-bold text-yellow-700">Ø§Ù„Ù…Ø¹ÙŠØ¯ÙˆÙ†</span>
            </div>
        </div>
    </div>
</div>

<div class="bg-white rounded-xl shadow-md p-3 md:p-4 mb-6 border-b-2 border-[#F3A628] border-t border-x border-gray-50 relative overflow-hidden">
    
    <div class="md:hidden flex items-center justify-center bg-blue-50/50 py-2 mb-3 rounded-lg border border-blue-100">
        <span class="text-[10px] font-bold text-[#2A3475] animate-pulse">
            <i class="fas fa-arrows-left-right ml-1"></i> Ù…Ø±Ø± ÙŠÙ…ÙŠÙ†Ø§Ù‹ ÙˆÙŠØ³Ø§Ø±Ø§Ù‹ Ù„Ø§Ø³ØªØ¹Ø±Ø§Ø¶ Ø§Ù„Ø¬Ø¯ÙˆÙ„
        </span>
    </div>

    <div class="overflow-x-auto pb-4 scrollbar-thin">
        <div id="calendar-container" class="calendar-grid min-w-[950px] md:min-w-full relative">
            
            <div class="time-slot sticky right-0 z-20 bg-gray-100 border-b-2 border-[#F3A628] h-12 flex items-center justify-center text-xs text-[#2A3475] font-black shadow-[2px_0_5px_rgba(0,0,0,0.05)]">
                Ø§Ù„ÙˆÙ‚Øª
            </div>

            <div class="time-slot bg-gray-50 border-b-2 border-gray-200 h-12 flex items-center justify-center font-bold text-[#2A3475] text-xs">Ø§Ù„Ø£Ø­Ø¯</div>
            <div class="time-slot bg-gray-50 border-b-2 border-gray-200 h-12 flex items-center justify-center font-bold text-[#2A3475] text-xs">Ø§Ù„Ø§Ø«Ù†ÙŠÙ†</div>
            <div class="time-slot bg-gray-50 border-b-2 border-gray-200 h-12 flex items-center justify-center font-bold text-[#2A3475] text-xs">Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡</div>
            <div class="time-slot bg-gray-50 border-b-2 border-gray-200 h-12 flex items-center justify-center font-bold text-[#2A3475] text-xs">Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡</div>
            <div class="time-slot bg-gray-50 border-b-2 border-gray-200 h-12 flex items-center justify-center font-bold text-[#2A3475] text-xs">Ø§Ù„Ø®Ù…ÙŠØ³</div>
            <div class="time-slot bg-gray-50 border-b-2 border-gray-200 h-12 flex items-center justify-center font-bold text-[#2A3475] text-xs opacity-50">Ø§Ù„Ø¬Ù…Ø¹Ø©</div>
            <div class="time-slot bg-gray-50 border-b-2 border-gray-200 h-12 flex items-center justify-center font-bold text-[#2A3475] text-xs opacity-50">Ø§Ù„Ø³Ø¨Øª</div>

            </div>
    </div>

    <div id="scroll-indicator" class="fixed bottom-8 left-1/2 transform -translate-x-1/2 z-50 opacity-0 transition-all duration-500 pointer-events-none translate-y-10">
        <button onclick="scrollToNextMeeting()" class="bg-[#2A3475] text-white px-5 py-2.5 rounded-full shadow-2xl border-2 border-[#F3A628] flex items-center space-x-3 space-x-reverse hover:bg-[#1f2658] hover:scale-105 transition-all cursor-pointer pointer-events-auto animate-bounce">
            <span class="w-6 h-6 bg-[#F3A628] text-[#2A3475] rounded-full flex items-center justify-center text-sm font-bold shadow-sm" id="hidden-count">0</span>
            <span class="text-sm font-bold">ÙŠÙˆØ¬Ø¯ Ø­Ø¬ÙˆØ²Ø§Øª Ø¨Ø§Ù„Ø£Ø³ÙÙ„</span>
            <i class="fas fa-arrow-down mr-2"></i>
        </button>
    </div>
</div>

<div class="bg-white rounded-xl shadow-lg border border-gray-100 p-4 md:p-6 relative overflow-hidden group hover:shadow-xl transition-shadow duration-300">
     
     <div class="absolute top-0 right-0 w-1.5 h-full bg-[#2A3475]"></div>
     
     <div class="flex flex-col md:flex-row items-start md:items-center justify-between mb-6 border-b border-gray-100 pb-4 gap-4">
         <div class="flex items-center space-x-3 space-x-reverse">
             <div class="bg-[#2A3475]/10 p-2 rounded-lg text-[#2A3475]">
                 <i class="fas fa-robot text-xl md:text-2xl animate-bounce-slow"></i>
             </div>
             <div>
                 <h3 class="text-base md:text-lg font-bold text-[#2A3475]">Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯ Ø§Ù„Ø°ÙƒÙŠ</h3>
                 <p class="text-[10px] md:text-xs text-gray-500">ØªØ­Ù„ÙŠÙ„ ÙÙˆØ±ÙŠ Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¬Ø¯ÙˆÙ„</p>
             </div>
         </div>
         <span class="px-2 py-1 bg-blue-50 text-[#2A3475] text-[10px] font-bold rounded border border-blue-100 self-start md:self-center">LIVE ANALYSIS</span>
     </div>

    <div id="ai-suggestions" class="space-y-4">
        
        <div class="bg-gray-50 border-r-4 border-gray-200 p-4 rounded-lg shadow-sm animate-pulse">
            <div class="flex justify-between items-start">
                <div class="w-full">
                    <div class="h-3.5 bg-gray-200 rounded w-1/3 mb-2"></div>
                    <div class="h-3 bg-gray-200 rounded w-1/2 mb-1"></div>
                    <div class="h-2 bg-gray-200 rounded w-1/4"></div>
                </div>
                <div class="h-8 w-8 md:h-10 md:w-10 bg-gray-200 rounded-full shrink-0"></div>
            </div>
        </div>
        
        <div class="bg-gray-50 rounded-lg p-3 md:p-4 border border-gray-100 animate-pulse">
            <div class="flex justify-between items-center mb-3">
                <div class="h-3 bg-gray-200 rounded w-1/4"></div>
                <div class="h-3 bg-gray-200 rounded w-8"></div>
            </div>
            <div class="h-2 bg-gray-200 rounded-full w-full"></div>
        </div>
    </div>
</div>

</main>
<footer class="metallic-blue-fill random-slanted-lines border-t-4 border-[#F3A628] shadow-[0_-4px_20px_rgba(0,0,0,0.3)] relative z-50">
    <div class="w-full max-w-[98%] mx-auto px-6 py-2 md:py-3">
        <div class="flex flex-col md:flex-row justify-between items-center gap-3 md:gap-4">

            <div class="hidden md:flex items-center gap-4">
                <div class="bg-white p-1 rounded-xl shadow-md shrink-0 flex items-center justify-center border border-white/20">
                    <img src="CITL_Logo.gif" alt="CITL Logo" class="h-10 w-auto object-contain transform scale-110">
                </div>
                <div class="text-right leading-tight">
                    <h3 class="font-black text-white text-xs md:text-sm tracking-wide">ÙƒÙ„ÙŠØ© Ø§Ù„Ù†Ù‚Ù„ Ø§Ù„Ø¯ÙˆÙ„ÙŠ ÙˆØ§Ù„Ù„ÙˆØ¬Ø³ØªÙŠØ§Øª</h3>
                    <p class="text-[#F3A628] text-[9px] md:text-[10px] font-bold font-sans tracking-wider uppercase opacity-90">College of International Transport & Logistics</p>
                </div>
            </div>

            <div class="flex flex-col md:flex-row items-center gap-1 md:gap-4 text-[11px] md:text-xs">
                
                <p class="text-blue-100/90 text-center md:text-right font-medium leading-relaxed">
                    Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø© Ù„ÙƒÙ„ÙŠØ© Ø§Ù„Ù†Ù‚Ù„ Ø§Ù„Ø¯ÙˆÙ„ÙŠ ÙˆØ§Ù„Ù„ÙˆØ¬Ø³ØªÙŠØ§Øª Â© 2025
                    <span class="hidden md:inline mx-1">|</span> <br class="md:hidden"> ØªØ·ÙˆÙŠØ± ÙˆØ¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù†Ø¸Ø§Ù… Ø¨ÙˆØ§Ø³Ø·Ø© Ø£. Ø£Ø­Ù…Ø¯ ÙÙƒØ±ÙŠ ( ÙÙ†ÙŠ Ù…Ø¹Ù…Ù„ Ø§Ù„Ø­Ø§Ø³Ø¨ ).
                </p>

                <div class="hidden md:block w-px h-5 bg-white/20"></div>

                <div class="flex items-center gap-1.5 md:gap-3 bg-black/20 px-3 py-1.5 md:px-4 md:py-1.5 rounded-full border border-white/10 shadow-inner">
                    <a href="https://www.facebook.com/CITLAlexandria" target="_blank" class="text-white hover:text-[#F3A628] transition-all text-[12px] md:text-sm"><i class="fab fa-facebook-f"></i></a>
                    <a href="https://www.linkedin.com/in/CITLAlexandria" target="_blank" class="text-white hover:text-[#F3A628] transition-all text-[12px] md:text-sm"><i class="fab fa-linkedin-in"></i></a>
                    <a href="https://www.instagram.com/CITLAlexandria" target="_blank" class="text-white hover:text-[#F3A628] transition-all text-[12px] md:text-sm"><i class="fab fa-instagram"></i></a>
                    <a href="https://x.com/CITLAlexandria" target="_blank" class="text-white hover:text-[#F3A628] transition-all text-[10px] md:text-[13px]"><i class="fab fa-twitter"></i></a>
                    <a href="https://www.youtube.com/@CITLAlexandria" target="_blank" class="text-white hover:text-[#F3A628] transition-all text-[12px] md:text-sm"><i class="fab fa-youtube"></i></a>
                    <div class="w-px h-3 bg-white/10 mx-0.5"></div>
                    <a href="https://www.aast.edu/en/colleges/citl/alex" target="_blank" class="text-[#F3A628] hover:scale-125 transition-all text-[12px] md:text-sm"><i class="fas fa-globe"></i></a>
                </div>
            </div>
        </div>
    </div>
</footer>


<div id="add-meeting-modal" class="modal">
    <div class="modal-content p-0 shadow-2xl rounded-xl flex flex-col h-auto max-h-[92vh] md:max-h-[85vh]" style="max-width: 650px; width: 95%; overflow: visible;">
     
     <div class="metallic-blue-fill random-slanted-lines px-4 py-3 md:px-6 md:py-4 flex items-center justify-between shadow-md relative overflow-hidden rounded-t-xl shrink-0">
        <div class="absolute top-0 left-0 w-full h-full opacity-10 bg-[url('https://www.transparenttextures.com/patterns/cubes.png')]"></div>
        <div class="flex items-center space-x-3 space-x-reverse text-white relative z-10">
            <div class="bg-white/10 p-2 md:p-2.5 rounded-lg backdrop-blur-sm border border-white/10 shadow-inner">
                <i class="fas fa-calendar-plus text-[#F3A628] text-lg md:text-xl"></i>
            </div>
            <div>
                <h3 class="text-sm md:text-lg font-bold tracking-wide">Ø­Ø¬Ø² Ø§Ø¬ØªÙ…Ø§Ø¹ Ø¬Ø¯ÙŠØ¯</h3>
                <p class="text-[10px] md:text-xs text-blue-200 font-light mt-0.5">ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ø¯Ù‚Ø© Ù„Ø¶Ù…Ø§Ù† Ø¹Ø¯Ù… Ø§Ù„ØªØ¹Ø§Ø±Ø¶</p>
            </div>
        </div>
        <button id="close-modal" class="text-white/60 hover:text-white hover:bg-white/10 w-7 h-7 md:w-8 md:h-8 rounded-full flex items-center justify-center transition-all duration-200 relative z-10"> 
            <i class="fas fa-times text-sm"></i> 
        </button>
     </div>

     <form id="meeting-form" class="p-4 md:p-6 bg-[#f8fafc] overflow-y-auto custom-scrollbar flex-1">
      <input type="hidden" id="meeting-id">

      <div class="space-y-4 md:space-y-5">
          
          <div class="group">
              <label class="block text-[11px] md:text-xs font-bold text-[#2A3475] mb-1.5 md:mb-2 flex items-center transition-colors group-focus-within:text-[#F3A628]">
                  <i class="fas fa-heading ml-2 text-gray-400 group-focus-within:text-[#F3A628]"></i> Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø§Ø¬ØªÙ…Ø§Ø¹
              </label> 
              <input type="text" id="meeting-title" required placeholder="Ù…Ø«Ø§Ù„: Ù…Ø¬Ù„Ø³ Ø§Ù„Ù‚Ø³Ù… Ø§Ù„Ø´Ù‡Ø±ÙŠ" 
                     class="w-full px-4 py-2.5 md:py-3 border border-gray-300 rounded-lg text-sm bg-white focus:ring-2 focus:ring-[#2A3475]/20 focus:border-[#2A3475] outline-none transition-all shadow-sm hover:border-gray-400 placeholder-gray-400 font-bold">
          </div>

          <div class="grid grid-cols-1 md:grid-cols-2 gap-4 md:gap-5">
              <div class="group z-30">
                  <label class="block text-[11px] md:text-xs font-bold text-[#2A3475] mb-1.5 md:mb-2 flex items-center transition-colors group-focus-within:text-[#F3A628]">
                      <i class="fas fa-building ml-2 text-gray-400 group-focus-within:text-[#F3A628]"></i> Ø§Ù„Ø¬Ù‡Ø© Ø§Ù„Ø­Ø§Ø¬Ø²Ø©
                  </label> 
                  <div class="relative custom-dropdown w-full">
                    <div class="custom-dropdown-display w-full px-4 py-2.5 md:py-3 border border-gray-300 rounded-lg text-sm bg-white focus:ring-2 focus:ring-[#2A3475]/20 focus:border-[#2A3475] flex items-center justify-between cursor-pointer transition-all shadow-sm">
                        <span class="text-gray-700 truncate">Ø§Ø®ØªØ± Ø§Ù„Ø¬Ù‡Ø©...</span>
                        <i class="fas fa-chevron-down text-[10px] text-gray-500 transition-transform duration-200"></i>
                    </div>
                    <ul class="custom-dropdown-options absolute top-full left-0 w-full bg-white border border-gray-200 rounded-lg mt-1 max-h-48 md:max-h-60 overflow-y-auto z-50 hidden shadow-xl custom-scrollbar">
                        <li class="custom-option px-4 py-2.5 hover:bg-blue-50 cursor-pointer text-sm text-gray-700 transition-colors border-b border-gray-50" data-value="">Ø§Ø®ØªØ± Ø§Ù„Ø¬Ù‡Ø©...</li>
                        <li class="custom-option px-4 py-2.5 hover:bg-blue-50 cursor-pointer text-sm text-gray-700 transition-colors border-b border-gray-50" data-value="dean">Ù…ÙƒØªØ¨ Ø§Ù„Ø¹Ù…ÙŠØ¯</li>
                        <li class="custom-option px-4 py-2.5 hover:bg-blue-50 cursor-pointer text-sm text-gray-700 transition-colors border-b border-gray-50" data-value="transport-logistics">Ù‚Ø³Ù… Ø¥Ø¯Ø§Ø±Ø© Ù„ÙˆØ¬Ø³ØªÙŠØ§Øª Ø§Ù„Ù†Ù‚Ù„</li>
                        <li class="custom-option px-4 py-2.5 hover:bg-blue-50 cursor-pointer text-sm text-gray-700 transition-colors border-b border-gray-50" data-value="trade-logistics">Ù‚Ø³Ù… Ø¥Ø¯Ø§Ø±Ø© Ù„ÙˆØ¬Ø³ØªÙŠØ§Øª Ø§Ù„ØªØ¬Ø§Ø±Ø© Ø§Ù„Ø¯ÙˆÙ„ÙŠØ©</li>
                        <li class="custom-option px-4 py-2.5 hover:bg-blue-50 cursor-pointer text-sm text-gray-700 transition-colors border-b border-gray-50" data-value="supply-chain">Ù‚Ø³Ù… Ø¥Ø¯Ø§Ø±Ø© Ù„ÙˆØ¬Ø³ØªÙŠØ§Øª Ø³Ù„Ø§Ø³Ù„ Ø§Ù„Ø¥Ù…Ø¯Ø§Ø¯</li>
                        <li class="custom-option px-4 py-2.5 hover:bg-blue-50 cursor-pointer text-sm text-gray-700 transition-colors border-b border-gray-50" data-value="energy-logistics">Ù‚Ø³Ù… Ø¥Ø¯Ø§Ø±Ø© Ù„ÙˆØ¬Ø³ØªÙŠØ§Øª Ø§Ù„Ø·Ø§Ù‚Ø© ÙˆØ§Ù„Ø¨ØªØ±ÙˆÙ„</li>
                        <li class="custom-option px-4 py-2.5 hover:bg-blue-50 cursor-pointer text-sm text-gray-700 transition-colors border-b border-gray-50" data-value="admin-followup">Ù‚Ø³Ù… Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±ÙŠØ©</li>
                        <li class="custom-option px-4 py-2.5 hover:bg-blue-50 cursor-pointer text-sm text-gray-700 transition-colors border-b border-gray-50" data-value="training-agency">ÙˆÙƒØ§Ù„Ø© Ø´Ø¤ÙˆÙ† Ø§Ù„ØªØ¯Ø±ÙŠØ¨ ÙˆØ®Ø¯Ù…Ø© Ø§Ù„Ù…Ø¬ØªÙ…Ø¹</li>
                        <li class="custom-option px-4 py-2.5 hover:bg-blue-50 cursor-pointer text-sm text-gray-700 transition-colors border-b border-gray-50" data-value="postgrad-agency">ÙˆÙƒØ§Ù„Ø© Ø§Ù„Ø¯Ø±Ø§Ø³Ø§Øª Ø§Ù„Ø¹Ù„ÙŠØ§ ÙˆØ§Ù„Ø¨Ø­Ø« Ø§Ù„Ø¹Ù„Ù…ÙŠ</li>
                        <li class="custom-option px-4 py-2.5 hover:bg-blue-50 cursor-pointer text-sm text-gray-700 transition-colors border-b border-gray-50" data-value="education-agency">ÙˆÙƒØ§Ù„Ø© Ø´Ø¤ÙˆÙ† Ø§Ù„ØªØ¹Ù„ÙŠÙ…</li>
                        <li class="custom-option px-4 py-2.5 hover:bg-blue-50 cursor-pointer text-sm text-gray-700 transition-colors border-b border-gray-50" data-value="students-agency">ÙˆÙƒØ§Ù„Ø© Ø´Ø¤ÙˆÙ† Ø§Ù„Ø·Ù„Ø§Ø¨</li>
                        <li class="custom-option px-4 py-2.5 hover:bg-blue-50 cursor-pointer text-sm text-gray-700 transition-colors border-b border-gray-50" data-value="assistants-office">Ù…ÙƒØªØ¨ Ø§Ù„Ù…Ø¹ÙŠØ¯ÙŠÙ†</li>
                        <li class="custom-option px-4 py-2.5 hover:bg-blue-50 cursor-pointer text-sm text-gray-700 transition-colors border-b border-gray-50" data-value="computer-lab">Ù…Ø¹Ù…Ù„ Ø§Ù„Ø­Ø§Ø³Ø¨</li>
                        <li class="custom-option px-4 py-2.5 hover:bg-blue-50 cursor-pointer text-sm text-gray-700" data-value="visitor">Ø²Ø§Ø¦Ø± Ø®Ø§Ø±Ø¬ÙŠ</li>
                    </ul>
                    <select id="department" class="hidden">
                        <option value="">Ø§Ø®ØªØ± Ø§Ù„Ø¬Ù‡Ø©...</option> 
                        <option value="dean">Ù…ÙƒØªØ¨ Ø§Ù„Ø¹Ù…ÙŠØ¯</option>
                    </select>
                  </div>
              </div>
              
              <div class="group z-20">
                  <label class="block text-[11px] md:text-xs font-bold text-[#2A3475] mb-1.5 md:mb-2 flex items-center transition-colors group-focus-within:text-[#F3A628]">
                      <i class="far fa-calendar-alt ml-2 text-gray-400 group-focus-within:text-[#F3A628]"></i> Ø§Ù„ØªØ§Ø±ÙŠØ®
                  </label> 
                  <input type="date" id="meeting-date" required class="w-full px-4 py-2.5 md:py-3 border border-gray-300 rounded-lg text-sm bg-white focus:ring-2 focus:ring-[#2A3475]/20 focus:border-[#2A3475] outline-none transition-all shadow-sm cursor-pointer appearance-none font-bold text-gray-700">
              </div>
          </div>

          <div class="grid grid-cols-1 md:grid-cols-2 gap-4 md:gap-5">
               <div class="group z-20">
                  <label class="block text-[11px] md:text-xs font-bold text-[#2A3475] mb-1.5 md:mb-2 flex items-center transition-colors group-focus-within:text-[#F3A628]">
                      <i class="far fa-clock ml-2 text-gray-400 group-focus-within:text-[#F3A628]"></i> ÙˆÙ‚Øª Ø§Ù„Ø¨Ø¯Ø¡
                  </label> 
                  <div class="relative custom-dropdown w-full" id="time-dropdown-container">
                      <div class="custom-dropdown-display w-full px-4 py-2.5 md:py-3 border border-gray-300 rounded-lg text-sm bg-white focus:ring-2 focus:ring-[#2A3475]/20 focus:border-[#2A3475] flex items-center justify-between cursor-pointer transition-all shadow-sm">
                          <span class="text-gray-700 font-bold">Ø§Ø®ØªØ± Ø§Ù„ÙˆÙ‚Øª</span>
                          <i class="fas fa-chevron-down text-[10px] text-gray-500 transition-transform duration-200"></i>
                      </div>
                      <ul id="meeting-time-options" class="custom-dropdown-options absolute top-full left-0 w-full bg-white border border-gray-200 rounded-lg mt-1 max-h-48 md:max-h-60 overflow-y-auto z-50 hidden shadow-xl custom-scrollbar">
                          <li class="custom-option px-4 py-2.5 hover:bg-blue-50 cursor-pointer text-sm text-gray-700" data-value="">Ø§Ø®ØªØ± Ø§Ù„ÙˆÙ‚Øª</li>
                      </ul>
                      <select id="meeting-time" class="hidden"></select>
                  </div>
               </div>
               
               <div class="group z-10">
                  <label class="block text-[11px] md:text-xs font-bold text-[#2A3475] mb-1.5 md:mb-2 flex items-center transition-colors group-focus-within:text-[#F3A628]">
                      <i class="fas fa-hourglass-half ml-2 text-gray-400 group-focus-within:text-[#F3A628]"></i> Ø§Ù„Ù…Ø¯Ø© Ø§Ù„Ù…ØªÙˆÙ‚Ø¹Ø©
                  </label> 
                  <div class="relative custom-dropdown w-full">
                      <div class="custom-dropdown-display w-full px-4 py-2.5 md:py-3 border border-gray-300 rounded-lg text-sm bg-white focus:ring-2 focus:ring-[#2A3475]/20 focus:border-[#2A3475] flex items-center justify-between cursor-pointer transition-all shadow-sm">
                          <span class="text-gray-700 font-bold">Ø³Ø§Ø¹Ø© ÙˆØ§Ø­Ø¯Ø©</span>
                          <i class="fas fa-chevron-down text-[10px] text-gray-500 transition-transform duration-200"></i>
                      </div>
                      <ul class="custom-dropdown-options absolute top-full left-0 w-full bg-white border border-gray-200 rounded-lg mt-1 max-h-40 md:max-h-60 overflow-y-auto z-50 hidden shadow-xl custom-scrollbar">
                          <li class="custom-option px-4 py-2.5 hover:bg-blue-50 cursor-pointer text-sm text-gray-700 border-b border-gray-50" data-value="1">Ø³Ø§Ø¹Ø© ÙˆØ§Ø­Ø¯Ø©</li>
                          <li class="custom-option px-4 py-2.5 hover:bg-blue-50 cursor-pointer text-sm text-gray-700 border-b border-gray-50" data-value="2">Ø³Ø§Ø¹ØªØ§Ù†</li>
                          <li class="custom-option px-4 py-2.5 hover:bg-blue-50 cursor-pointer text-sm text-gray-700 border-b border-gray-50" data-value="3">3 Ø³Ø§Ø¹Ø§Øª</li>
                          <li class="custom-option px-4 py-2.5 hover:bg-blue-50 cursor-pointer text-sm text-gray-700" data-value="4">4 Ø³Ø§Ø¹Ø§Øª</li>
                      </ul>
                      <select id="duration" class="hidden">
                          <option value="1">Ø³Ø§Ø¹Ø© ÙˆØ§Ø­Ø¯Ø©</option> 
                          <option value="2">Ø³Ø§Ø¹ØªØ§Ù†</option> 
                          <option value="3">3 Ø³Ø§Ø¹Ø§Øª</option> 
                          <option value="4">4 Ø³Ø§Ø¹Ø§Øª</option> 
                      </select>
                  </div>
               </div>
          </div>

          <div class="group">
              <label class="block text-[11px] md:text-xs font-bold text-[#2A3475] mb-1.5 md:mb-2 flex items-center transition-colors group-focus-within:text-[#F3A628]">
                  <i class="fas fa-users ml-2 text-gray-400 group-focus-within:text-[#F3A628]"></i> Ø§Ù„Ø­Ø¶ÙˆØ± (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)
              </label> 
              <input type="text" id="attendees" placeholder="Ø£Ø¯Ø®Ù„ Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„Ø­Ø¶ÙˆØ± Ø£Ùˆ Ø§Ù„Ø£Ù‚Ø³Ø§Ù… Ø§Ù„Ù…Ø¯Ø¹ÙˆØ©..." 
                     class="w-full px-4 py-2.5 md:py-3 border border-gray-300 rounded-lg text-sm bg-white focus:ring-2 focus:ring-[#2A3475]/20 focus:border-[#2A3475] outline-none transition-all shadow-sm placeholder-gray-400 font-bold">
          </div>

          <div class="group">
              <label class="block text-[11px] md:text-xs font-bold text-[#2A3475] mb-1.5 md:mb-2 flex items-center transition-colors group-focus-within:text-[#F3A628]">
                  <i class="fas fa-align-right ml-2 text-gray-400 group-focus-within:text-[#F3A628]"></i> Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ©
              </label> 
              <textarea id="description" rows="2" placeholder="Ø£ÙŠ ØªÙØ§ØµÙŠÙ„ Ø¥Ø¶Ø§ÙÙŠØ© Ø¹Ù† Ø§Ù„Ø§Ø¬ØªÙ…Ø§Ø¹..." 
                        class="w-full px-4 py-2.5 md:py-3 border border-gray-300 rounded-lg text-sm bg-white focus:ring-2 focus:ring-[#2A3475]/20 focus:border-[#2A3475] outline-none transition-all shadow-sm resize-none placeholder-gray-400 font-bold md:rows-3"></textarea>
          </div>
      </div>

      <div class="flex flex-col md:flex-row justify-end items-center gap-3 mt-6 pt-4 border-t border-gray-200 bg-gray-50 -mx-4 -mb-4 md:-mx-6 md:-mb-6 px-4 py-4 md:px-6 md:py-4 rounded-b-xl shrink-0">
          <button type="button" id="cancel-meeting" class="w-full md:w-auto px-6 py-2.5 text-gray-600 font-bold hover:bg-gray-200 rounded-lg transition-colors text-xs md:text-sm border border-gray-200 bg-white shadow-sm order-2 md:order-1"> 
              Ø¥Ù„ØºØ§Ø¡ 
          </button> 
          <button type="submit" id="save-meeting" class="w-full md:w-auto px-8 py-2.5 bg-[#2A3475] text-white font-bold rounded-lg hover:bg-[#1f2658] shadow-lg hover:shadow-[#2A3475]/40 transition-all text-xs md:text-sm flex items-center justify-center transform active:scale-95 order-1 md:order-2"> 
              <span id="save-text">Ø­ÙØ¸ Ø§Ù„Ø­Ø¬Ø²</span> 
              <i id="save-loading" class="fas fa-spinner fa-spin hidden mr-2"></i> 
          </button>
      </div>
     </form>
    </div>
</div>

<div id="dashboard-modal" class="modal">
<div class="modal-content p-0 overflow-hidden shadow-2xl rounded-xl" style="max-width: 900px; width: 95%;">
     
<div class="metallic-blue-fill random-slanted-lines px-6 py-4 flex items-center justify-between shadow-md">
            <div class="flex items-center space-x-3 space-x-reverse text-white">
            <div class="bg-white/10 p-2.5 rounded-lg backdrop-blur-sm border border-white/10">
                <i class="fas fa-chart-pie text-[#F3A628] text-xl"></i>
            </div>
            <div>
                <h3 class="text-lg font-bold tracking-wide">Ù„ÙˆØ­Ø© Ø§Ù„Ù‚ÙŠØ§Ø¯Ø© ÙˆØ§Ù„ØªØ­Ù„ÙŠÙ„Ø§Øª</h3>
                <p class="text-xs text-blue-200 font-light mt-0.5">ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø£Ø¯Ø§Ø¡ ÙˆØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</p>
            </div>
        </div>
        <button id="close-dashboard" class="text-white/60 hover:text-white hover:bg-white/10 w-8 h-8 rounded-full flex items-center justify-center transition-all"> 
            <i class="fas fa-times"></i> 
        </button>
     </div>

     <div class="p-3 md:p-6 bg-[#f8fafc] max-h-[85vh] md:max-h-[80vh] overflow-y-auto custom-scrollbar">
      
      <div class="grid grid-cols-1 md:grid-cols-3 gap-3 md:gap-5 mb-6">
          
          <div class="bg-white p-4 rounded-xl shadow-sm border border-gray-100 relative overflow-hidden group hover:shadow-md transition-all">
              <div class="absolute right-0 top-0 w-24 h-24 bg-[#2A3475]/5 rounded-bl-full -mr-4 -mt-4 transition-transform group-hover:scale-110"></div>
              <div class="relative z-10 flex justify-between items-start">
                  <div>
                      <p class="text-xs font-bold text-gray-500 mb-1">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª</p>
                      <h3 class="text-3xl font-bold text-[#2A3475]" id="total-meetings">0</h3>
                  </div>
                  <div class="bg-[#2A3475]/10 p-2 rounded-lg text-[#2A3475]">
                      <i class="fas fa-calendar-check text-xl"></i>
                  </div>
              </div>
              <div class="mt-3 flex items-center text-xs">
                  <span class="text-green-600 bg-green-50 px-1.5 py-0.5 rounded font-bold flex items-center ml-2">
                      <i class="fas fa-arrow-up text-[10px] ml-1"></i> Ù†Ø´Ø·
                  </span>
                  <span class="text-gray-400">Ù…Ù‚Ø§Ø±Ù†Ø© Ø¨Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ Ø§Ù„Ù…Ø§Ø¶ÙŠ</span>
              </div>
          </div>
        
          <div class="bg-white p-4 rounded-xl shadow-sm border border-gray-100 relative overflow-hidden group hover:shadow-md transition-all">
              <div class="absolute right-0 top-0 w-24 h-24 bg-[#F3A628]/5 rounded-bl-full -mr-4 -mt-4 transition-transform group-hover:scale-110"></div>
              <div class="relative z-10 flex justify-between items-start">
                  <div>
                      <p class="text-xs font-bold text-gray-500 mb-1">Ù…Ø¹Ø¯Ù„ Ø§Ù„Ø¥Ø´ØºØ§Ù„</p>
                      <h3 class="text-3xl font-bold text-[#2A3475]" id="usage-percentage">0%</h3>
                  </div>
                  <div class="bg-[#F3A628]/10 p-2 rounded-lg text-[#F3A628]">
                      <i class="fas fa-chart-line text-xl"></i>
                  </div>
              </div>
              <div class="mt-4 w-full bg-gray-100 rounded-full h-1.5">
                  <div id="usage-bar" class="bg-[#F3A628] h-1.5 rounded-full transition-all duration-1000" style="width: 0%"></div>
              </div>
          </div>
        
          <div class="bg-white p-4 rounded-xl shadow-sm border border-gray-100 relative overflow-hidden group hover:shadow-md transition-all">
              <div class="absolute right-0 top-0 w-24 h-24 bg-green-50 rounded-bl-full -mr-4 -mt-4 transition-transform group-hover:scale-110"></div>
              <div class="relative z-10 flex justify-between items-start">
                  <div>
                      <p class="text-xs font-bold text-gray-500 mb-1">Ø§Ù„Ø¬Ù‡Ø§Øª Ø§Ù„Ù†Ø´Ø·Ø©</p>
                      <h3 class="text-3xl font-bold text-[#2A3475]" id="active-departments">0</h3>
                  </div>
                  <div class="bg-green-50 p-2 rounded-lg text-green-600">
                      <i class="fas fa-building text-xl"></i>
                  </div>
              </div>
              <div class="mt-3 text-xs text-gray-400">
                  <i class="fas fa-info-circle ml-1"></i> Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ù‚Ø³Ø§Ù… Ø§Ù„ØªÙŠ Ù‚Ø§Ù…Øª Ø¨Ø§Ù„Ø­Ø¬Ø²
              </div>
          </div>
      </div>

      <div class="grid grid-cols-1 md:grid-cols-2 gap-4 md:gap-6">
          
          <div class="bg-white p-5 rounded-xl shadow-sm border border-gray-100">
              <h4 class="text-sm font-bold text-[#2A3475] mb-4 flex items-center">
                  <i class="fas fa-trophy text-[#F3A628] ml-2"></i> Ø§Ù„Ø¬Ù‡Ø§Øª Ø§Ù„Ø£ÙƒØ«Ø± Ø§Ø³ØªØ®Ø¯Ø§Ù…Ø§Ù‹
              </h4>
              <div id="department-chart" class="space-y-3">
                  </div>
          </div>

          <div class="bg-white p-5 rounded-xl shadow-sm border border-gray-100">
              <h4 class="text-sm font-bold text-[#2A3475] mb-4 flex items-center">
                  <i class="fas fa-history text-gray-400 ml-2"></i> Ø¢Ø®Ø± Ø§Ù„Ù†Ø´Ø§Ø·Ø§Øª
              </h4>
              <div id="recent-meetings" class="space-y-0 relative">
                  <div class="absolute top-2 bottom-2 right-[9px] w-0.5 bg-gray-100"></div>
                  </div>
          </div>

      </div>

      <div class="mt-6 mb-14 md:mb-0 bg-[#2A3475]/5 border border-[#2A3475]/10 rounded-xl p-5 flex flex-col md:flex-row items-center md:items-start gap-4 text-center md:text-right w-full">
          <div class="bg-white p-2 rounded-full shadow-sm shrink-0">
              <i class="fas fa-robot text-[#2A3475] text-xl"></i>
          </div>
          <div>
              <h5 class="font-bold text-[#2A3475] text-sm">Ø±Ø¤ÙŠØ© ØªØ­Ù„ÙŠÙ„ÙŠØ© Ø³Ø±ÙŠØ¹Ø©</h5>
              <p id="dashboard-insight" class="text-xs text-gray-600 mt-1 leading-relaxed">
                  Ø¬Ø§Ø±ÙŠ ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...
              </p>
          </div>
      </div>

     </div>
    </div>
   </div><!-- Meeting Details Modal -->
<div id="meeting-details-modal" class="modal">
    <div class="modal-content p-0 shadow-2xl rounded-xl flex flex-col h-auto max-h-[92vh] md:max-h-none overflow-hidden" style="max-width: 550px; width: 95%;">
        
        <div class="metallic-blue-fill random-slanted-lines px-4 py-3 md:px-6 md:py-4 flex items-center justify-between shadow-md shrink-0">
            <div class="flex items-center space-x-3 space-x-reverse text-white">
                <div class="bg-white/10 p-2 rounded-lg backdrop-blur-sm border border-white/10 shadow-inner">
                    <i class="fas fa-info-circle text-[#F3A628] text-lg md:text-xl"></i>
                </div>
                <h3 class="text-sm md:text-lg font-bold tracking-wide">ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø§Ø¬ØªÙ…Ø§Ø¹</h3>
            </div>
            <button id="close-details" class="text-white/60 hover:text-white hover:bg-white/10 w-8 h-8 rounded-full flex items-center justify-center transition-all"> 
                <i class="fas fa-times text-sm"></i> 
            </button>
        </div>

        <div id="meeting-details-content" class="p-4 md:p-6 bg-white overflow-y-auto custom-scrollbar flex-1 overscroll-contain pb-10 md:pb-6">
            </div>
    </div>
</div>
</div><div id="admin-panel-modal" class="modal">
    <div class="modal-content p-0 overflow-hidden shadow-2xl rounded-xl h-[92vh] md:h-[85vh]" style="max-width: 1100px; width: 95%; display: flex; flex-direction: column;">
     
     <div class="metallic-blue-fill random-slanted-lines px-4 py-3 md:px-6 md:py-4 flex items-center justify-between shadow-md shrink-0 relative overflow-hidden">
        <div class="absolute top-0 left-0 w-full h-full opacity-10 bg-[url('https://www.transparenttextures.com/patterns/cubes.png')]"></div>
        <div class="flex items-center space-x-3 space-x-reverse text-white relative z-10">
            <div class="bg-white/10 p-2 md:p-2.5 rounded-lg backdrop-blur-sm border border-white/10 shadow-inner">
                <i class="fas fa-user-shield text-[#F3A628] text-lg md:text-xl"></i>
            </div>
            <div>
                <h3 class="text-sm md:text-lg font-bold tracking-wide">Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„Ù…Ø±ÙƒØ²ÙŠØ©</h3>
                <p class="text-[10px] md:text-xs text-blue-200 font-light mt-0.5">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù†Ø¸Ø§Ù… ÙˆØ§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª</p>
            </div>
        </div>
        <button id="close-admin-panel" class="text-white/60 hover:text-white hover:bg-white/10 w-8 h-8 rounded-full flex items-center justify-center transition-all relative z-10"> 
            <i class="fas fa-times"></i> 
        </button>
     </div>

     <div class="flex flex-1 flex-col md:flex-row overflow-hidden bg-[#f8fafc]">
         
         <div class="w-full md:w-64 bg-white border-b md:border-b-0 md:border-l border-gray-200 flex flex-col shrink-0 shadow-sm z-10">
             <div class="p-4 md:p-6 border-b border-gray-100 text-center bg-gradient-to-b from-gray-50 to-white flex md:flex-col items-center justify-between md:justify-center gap-3">
                 <div id="sidebar-user-avatar" class="w-10 h-10 md:w-16 md:h-16 bg-[#2A3475] rounded-full flex items-center justify-center text-white text-sm md:text-2xl font-bold shadow-lg border-2 border-[#F3A628] ring-2 ring-[#2A3475]/20">IT</div>
                 <div class="text-right md:text-center flex-1">
                    <h4 id="sidebar-user-name" class="font-bold text-[#2A3475] text-xs md:text-base">Ù…Ø¯ÙŠØ± Ø§Ù„Ù†Ø¸Ø§Ù…</h4>
                    <p id="sidebar-user-role" class="text-[9px] md:text-[10px] text-gray-500 mt-0.5 md:mt-1 bg-gray-100 px-2 py-0.5 rounded-full inline-block">ØªØ­Ù…ÙŠÙ„...</p>
                 </div>
             </div>

            <nav class="flex md:flex-col p-2 md:p-4 gap-2 overflow-x-auto md:overflow-y-auto custom-scrollbar no-scrollbar-mobile whitespace-nowrap">
                
                <button class="admin-tab active min-w-[120px] md:min-w-0 w-full flex items-center gap-2 md:gap-3 px-3 py-2 md:px-4 md:py-3 rounded-xl text-[11px] md:text-sm font-bold transition-all duration-200 group border border-gray-100 md:border-0 hover:bg-gray-50" data-tab="users">
                    <div class="w-6 h-6 md:w-8 md:h-8 rounded-lg bg-gray-100 flex items-center justify-center text-gray-500 group-[.active]:bg-[#2A3475] group-[.active]:text-white group-hover:bg-[#2A3475] group-hover:text-white transition-colors shadow-sm">
                        <i class="fas fa-users-cog"></i>
                    </div>
                    <span class="text-gray-600 group-[.active]:text-[#2A3475] group-hover:text-[#2A3475]">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</span>
                </button>
                
                <button class="admin-tab min-w-[120px] md:min-w-0 w-full flex items-center gap-2 md:gap-3 px-3 py-2 md:px-4 md:py-3 rounded-xl text-[11px] md:text-sm font-bold transition-all duration-200 group border border-gray-100 md:border-0 hover:bg-gray-50" data-tab="meetings">
                    <div class="w-6 h-6 md:w-8 md:h-8 rounded-lg bg-gray-100 flex items-center justify-center text-gray-500 group-[.active]:bg-[#2A3475] group-[.active]:text-white group-hover:bg-[#2A3475] group-hover:text-white transition-colors shadow-sm">
                        <i class="fas fa-calendar-check"></i>
                    </div>
                    <span class="text-gray-600 group-[.active]:text-[#2A3475] group-hover:text-[#2A3475]">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª</span>
                </button>

                <button class="admin-tab min-w-[120px] md:min-w-0 w-full flex items-center gap-2 md:gap-3 px-3 py-2 md:px-4 md:py-3 rounded-xl text-[11px] md:text-sm font-bold transition-all duration-200 group border border-gray-100 md:border-0 hover:bg-gray-50" data-tab="settings">
                    <div class="w-6 h-6 md:w-8 md:h-8 rounded-lg bg-gray-100 flex items-center justify-center text-gray-500 group-[.active]:bg-[#2A3475] group-[.active]:text-white group-hover:bg-[#2A3475] group-hover:text-white transition-colors shadow-sm">
                        <i class="fas fa-sliders-h"></i>
                    </div>
                    <span class="text-gray-600 group-[.active]:text-[#2A3475] group-hover:text-[#2A3475]">Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù…</span>
                </button>

                <button class="admin-tab min-w-[120px] md:min-w-0 w-full flex items-center gap-2 md:gap-3 px-3 py-2 md:px-4 md:py-3 rounded-xl text-[11px] md:text-sm font-bold transition-all duration-200 group border border-gray-100 md:border-0 hover:bg-gray-50" data-tab="profile">
                    <div class="w-6 h-6 md:w-8 md:h-8 rounded-lg bg-gray-100 flex items-center justify-center text-gray-500 group-[.active]:bg-[#2A3475] group-[.active]:text-white group-hover:bg-[#2A3475] group-hover:text-white transition-colors shadow-sm">
                        <i class="fas fa-user-edit"></i>
                    </div>
                    <span class="text-gray-600 group-[.active]:text-[#2A3475] group-hover:text-[#2A3475]">Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ</span>
                </button>

                <button class="admin-tab min-w-[120px] md:min-w-0 w-full flex items-center gap-2 md:gap-3 px-3 py-2 md:px-4 md:py-3 rounded-xl text-[11px] md:text-sm font-bold transition-all duration-200 group border border-gray-100 md:border-0 hover:bg-gray-50" data-tab="reports">
                    <div class="w-6 h-6 md:w-8 md:h-8 rounded-lg bg-gray-100 flex items-center justify-center text-gray-500 group-[.active]:bg-[#2A3475] group-[.active]:text-white group-hover:bg-[#2A3475] group-hover:text-white transition-colors shadow-sm">
                        <i class="fas fa-file-alt"></i>
                    </div>
                    <span class="text-gray-600 group-[.active]:text-[#2A3475] group-hover:text-[#2A3475]">Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±</span>
                </button>

            </nav>
         </div>

         <div class="flex-1 p-4 md:p-8 overflow-y-auto custom-scrollbar relative">

<div id="admin-profile-tab" class="admin-tab-content hidden">
    
    <div class="mb-6">
        <h2 class="text-xl md:text-2xl font-bold text-[#2A3475]">Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ</h2>
        <p class="text-xs md:text-sm text-gray-500 mt-1">ØªØ­Ø¯ÙŠØ« Ø¨ÙŠØ§Ù†Ø§ØªÙƒ ÙˆÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</p>
    </div>

    <div class="bg-white border border-gray-200 rounded-xl p-4 md:p-8 shadow-sm max-w-4xl">
        <form id="admin-profile-form" class="space-y-6">
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 md:gap-6">
                <div>
                    <label class="block text-xs md:text-sm font-bold text-gray-700 mb-2">Ø§Ù„Ø§Ø³Ù… Ø¨Ø§Ù„ÙƒØ§Ù…Ù„</label>
                    <input type="text" id="tab-my-name" class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-[#2A3475] outline-none transition-all text-gray-700 font-bold text-sm">
                </div>

                <div>
                    <label class="block text-xs md:text-sm font-bold text-gray-700 mb-2">Ø±Ù‚Ù… Ø§Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„</label>
                    <input type="tel" id="tab-my-mobile" 
                           placeholder="01xxxxxxxxx"
                           maxlength="11"
                           oninput="this.value = this.value.replace(/[^0-9]/g, '')"
                           class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-[#2A3475] outline-none transition-all text-left dir-ltr font-bold text-sm">
                </div>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 md:gap-6">
                <div>
                    <label class="block text-xs md:text-sm font-bold text-gray-700 mb-2">Ø§Ù„Ù…Ø³Ù…Ù‰ Ø§Ù„ÙˆØ¸ÙŠÙÙŠ</label>
                    <input type="text" id="tab-my-position" placeholder="Ù…Ø«Ø§Ù„: Ù…Ø¹ÙŠØ¯ØŒ Ø¯ÙƒØªÙˆØ±ØŒ Ø¥Ø¯Ø§Ø±ÙŠ..." class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-[#2A3475] outline-none transition-all font-bold text-sm">
                </div>

                <div>
                    <label class="block text-xs md:text-sm font-bold text-gray-700 mb-2">Ø§Ù„Ù‚Ø³Ù… / Ø§Ù„Ø¬Ù‡Ø©</label>
                    
                    <div class="relative custom-dropdown w-full">
                        <div class="custom-dropdown-display w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-[#2A3475] flex items-center justify-between cursor-pointer transition-all font-bold text-gray-700 text-sm">
                            <span class="text-gray-700">Ø§Ø®ØªØ± Ø§Ù„Ø¬Ù‡Ø©...</span>
                            <i class="fas fa-chevron-down text-xs text-gray-500 transition-transform duration-200"></i>
                        </div>
                        
                        <ul class="custom-dropdown-options absolute top-full left-0 w-full bg-white border border-gray-200 rounded-lg mt-1 max-h-60 overflow-y-auto z-50 hidden shadow-xl custom-scrollbar">
                            <li class="custom-option px-4 py-2.5 hover:bg-blue-50 cursor-pointer text-sm text-gray-700 transition-colors border-b border-gray-50" data-value="">Ø§Ø®ØªØ± Ø§Ù„Ø¬Ù‡Ø©...</li>
                            <li class="custom-option px-4 py-2.5 hover:bg-blue-50 cursor-pointer text-sm text-gray-700 transition-colors border-b border-gray-50" data-value="dean">Ù…ÙƒØªØ¨ Ø§Ù„Ø¹Ù…ÙŠØ¯</li>
                            <li class="custom-option px-4 py-2.5 hover:bg-blue-50 cursor-pointer text-sm text-gray-700 transition-colors border-b border-gray-50" data-value="transport-logistics">Ø¥Ø¯Ø§Ø±Ø© Ù„ÙˆØ¬Ø³ØªÙŠØ§Øª Ø§Ù„Ù†Ù‚Ù„</li>
                            <li class="custom-option px-4 py-2.5 hover:bg-blue-50 cursor-pointer text-sm text-gray-700 transition-colors border-b border-gray-50" data-value="trade-logistics">Ù„ÙˆØ¬Ø³ØªÙŠØ§Øª Ø§Ù„ØªØ¬Ø§Ø±Ø© Ø§Ù„Ø¯ÙˆÙ„ÙŠØ©</li>
                            <li class="custom-option px-4 py-2.5 hover:bg-blue-50 cursor-pointer text-sm text-gray-700 transition-colors border-b border-gray-50" data-value="supply-chain">Ø³Ù„Ø§Ø³Ù„ Ø§Ù„Ø¥Ù…Ø¯Ø§Ø¯</li>
                            <li class="custom-option px-4 py-2.5 hover:bg-blue-50 cursor-pointer text-sm text-gray-700 transition-colors border-b border-gray-50" data-value="energy-logistics">Ù„ÙˆØ¬Ø³ØªÙŠØ§Øª Ø§Ù„Ø·Ø§Ù‚Ø©</li>
                            <li class="custom-option px-4 py-2.5 hover:bg-blue-50 cursor-pointer text-sm text-gray-700 transition-colors border-b border-gray-50" data-value="admin-followup">Ù‚Ø³Ù… Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±ÙŠØ©</li>
                            <li class="custom-option px-4 py-2.5 hover:bg-blue-50 cursor-pointer text-sm text-gray-700 transition-colors border-b border-gray-50" data-value="training-agency">ÙˆÙƒØ§Ù„Ø© Ø§Ù„ØªØ¯Ø±ÙŠØ¨</li>
                            <li class="custom-option px-4 py-2.5 hover:bg-blue-50 cursor-pointer text-sm text-gray-700 transition-colors border-b border-gray-50" data-value="postgrad-agency">ÙˆÙƒØ§Ù„Ø© Ø§Ù„Ø¯Ø±Ø§Ø³Ø§Øª Ø§Ù„Ø¹Ù„ÙŠØ§</li>
                            <li class="custom-option px-4 py-2.5 hover:bg-blue-50 cursor-pointer text-sm text-gray-700 transition-colors border-b border-gray-50" data-value="education-agency">ÙˆÙƒØ§Ù„Ø© Ø§Ù„ØªØ¹Ù„ÙŠÙ…</li>
                            <li class="custom-option px-4 py-2.5 hover:bg-blue-50 cursor-pointer text-sm text-gray-700 transition-colors border-b border-gray-50" data-value="students-agency">ÙˆÙƒØ§Ù„Ø© Ø§Ù„Ø·Ù„Ø§Ø¨</li>
                            <li class="custom-option px-4 py-2.5 hover:bg-blue-50 cursor-pointer text-sm text-gray-700 transition-colors border-b border-gray-50" data-value="assistants-office">Ù…ÙƒØªØ¨ Ø§Ù„Ù…Ø¹ÙŠØ¯ÙŠÙ†</li>
                            <li class="custom-option px-4 py-2.5 hover:bg-blue-50 cursor-pointer text-sm text-gray-700 transition-colors border-b border-gray-50" data-value="computer-lab">Ù…Ø¹Ù…Ù„ Ø§Ù„Ø­Ø§Ø³Ø¨</li>
                            <li class="custom-option px-4 py-2.5 hover:bg-blue-50 cursor-pointer text-sm text-gray-700 transition-colors" data-value="visitor">Ø²Ø§Ø¦Ø± Ø®Ø§Ø±Ø¬ÙŠ</li>
                        </ul>

                        <select id="tab-my-dept" class="hidden">
                            <option value="">Ø§Ø®ØªØ± Ø§Ù„Ø¬Ù‡Ø©...</option> 
                            <option value="dean">Ù…ÙƒØªØ¨ Ø§Ù„Ø¹Ù…ÙŠØ¯</option>
                            <option value="transport-logistics">Ù‚Ø³Ù… Ø¥Ø¯Ø§Ø±Ø© Ù„ÙˆØ¬Ø³ØªÙŠØ§Øª Ø§Ù„Ù†Ù‚Ù„</option>
                            <option value="trade-logistics">Ù‚Ø³Ù… Ø¥Ø¯Ø§Ø±Ø© Ù„ÙˆØ¬Ø³ØªÙŠØ§Øª Ø§Ù„ØªØ¬Ø§Ø±Ø© Ø§Ù„Ø¯ÙˆÙ„ÙŠØ©</option>
                            <option value="supply-chain">Ù‚Ø³Ù… Ø¥Ø¯Ø§Ø±Ø© Ù„ÙˆØ¬Ø³ØªÙŠØ§Øª Ø³Ù„Ø§Ø³Ù„ Ø§Ù„Ø¥Ù…Ø¯Ø§Ø¯</option>
                            <option value="energy-logistics">Ù‚Ø³Ù… Ø¥Ø¯Ø§Ø±Ø© Ù„ÙˆØ¬Ø³ØªÙŠØ§Øª Ø§Ù„Ø·Ø§Ù‚Ø© ÙˆØ§Ù„Ø¨ØªØ±ÙˆÙ„</option>
                            <option value="admin-followup">Ù‚Ø³Ù… Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±ÙŠØ©</option>
                            <option value="training-agency">ÙˆÙƒØ§Ù„Ø© Ø´Ø¤ÙˆÙ† Ø§Ù„ØªØ¯Ø±ÙŠØ¨ ÙˆØ®Ø¯Ù…Ø© Ø§Ù„Ù…Ø¬ØªÙ…Ø¹</option>
                            <option value="postgrad-agency">ÙˆÙƒØ§Ù„Ø© Ø§Ù„Ø¯Ø±Ø§Ø³Ø§Øª Ø§Ù„Ø¹Ù„ÙŠØ§ ÙˆØ§Ù„Ø¨Ø­Ø« Ø§Ù„Ø¹Ù„Ù…ÙŠ</option>
                            <option value="education-agency">ÙˆÙƒØ§Ù„Ø© Ø´Ø¤ÙˆÙ† Ø§Ù„ØªØ¹Ù„ÙŠÙ…</option>
                            <option value="students-agency">ÙˆÙƒØ§Ù„Ø© Ø´Ø¤ÙˆÙ† Ø§Ù„Ø·Ù„Ø§Ø¨</option>
                            <option value="assistants-office">Ù…ÙƒØªØ¨ Ø§Ù„Ù…Ø¹ÙŠØ¯ÙŠÙ†</option>
                            <option value="computer-lab">Ù…Ø¹Ù…Ù„ Ø§Ù„Ø­Ø§Ø³Ø¨ (IT)</option> 
                            <option value="visitor">Ø²Ø§Ø¦Ø± Ø®Ø§Ø±Ø¬ÙŠ</option>
                        </select>
                    </div>
                </div>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 md:gap-6 pt-4 border-t border-gray-100">
                
                <div class="bg-yellow-50 p-4 rounded-xl border border-yellow-200">
                    <label class="block text-xs md:text-sm font-bold text-gray-700 mb-2">Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</label>
                    <input type="email" id="tab-my-email" class="w-full px-4 py-3 border-2 border-white rounded-lg bg-white focus:border-[#2A3475] outline-none transition-all shadow-sm text-sm">
                    <p class="text-[10px] md:text-xs text-yellow-700 mt-2 flex items-center font-bold">
                        <i class="fas fa-info-circle ml-2"></i>
                        ÙŠØ­ØªØ§Ø¬ ØªØ£ÙƒÙŠØ¯ Ø¹Ù†Ø¯ Ø§Ù„ØªØºÙŠÙŠØ±
                    </p>
                </div>

                <div class="bg-gray-50 p-4 rounded-xl border border-gray-200">
                    <label class="block text-xs md:text-sm font-bold text-gray-700 mb-2">ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©</label>
                    <input type="password" id="tab-my-password" placeholder="Ø§ØªØ±ÙƒÙ‡Ø§ ÙØ§Ø±ØºØ© Ù„Ø¹Ø¯Ù… Ø§Ù„ØªØºÙŠÙŠØ±" class="w-full px-4 py-3 border-2 border-white rounded-lg bg-white focus:border-[#2A3475] outline-none transition-all shadow-sm text-sm">
                    <p class="text-[10px] md:text-xs text-gray-400 mt-2 flex items-center">
                        <i class="fas fa-lock ml-2"></i>
                        Ø§Ø®ØªÙŠØ§Ø±ÙŠ (Ù„Ù„Ø£Ù…Ø§Ù†)
                    </p>
                </div>
            </div>

            <div class="pt-4 flex justify-end">
                <button type="submit" class="w-full md:w-auto bg-[#2A3475] text-white px-6 py-2.5 rounded-lg font-bold text-sm hover:bg-[#1f2658] transition-all shadow-md hover:shadow-lg flex items-center justify-center gap-2 transform active:scale-95">
                    <i class="fas fa-save"></i> Ø­ÙØ¸ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª
                </button>
            </div>
        </form>
    </div>
</div>

<div id="admin-users-tab" class="admin-tab-content">
    
    <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-6 gap-4">
        <div>
            <h2 class="text-xl md:text-2xl font-bold text-[#2A3475]">Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</h2>
            <p class="text-xs md:text-sm text-gray-500 mt-1">ØªØ­ÙƒÙ… ÙÙŠ ØµÙ„Ø§Ø­ÙŠØ§Øª Ø§Ù„ÙˆØµÙˆÙ„ ÙˆØ¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ø¹Ø¶Ø§Ø¡</p>
        </div>
        
        <div class="flex flex-col md:flex-row gap-3 w-full md:w-auto items-stretch md:items-center">
            
<div class="relative custom-dropdown w-full md:w-72">
                
                <div class="custom-dropdown-display w-full px-4 py-2.5 border border-gray-300 rounded-lg text-xs md:text-sm bg-white focus:ring-2 focus:ring-[#2A3475]/20 focus:border-[#2A3475] flex items-center justify-between cursor-pointer transition-all shadow-sm">
                    <span id="dropdown-label" class="truncate">Ø¹Ø±Ø¶ ÙƒÙ„ Ø§Ù„Ø£Ù‚Ø³Ø§Ù…</span>
                    <i class="fas fa-chevron-down text-xs text-gray-500 transition-transform duration-200"></i>
                </div>
                
                <ul class="custom-dropdown-options absolute top-full left-0 w-full bg-white border border-gray-200 rounded-lg mt-1 max-h-60 overflow-y-auto z-50 hidden shadow-xl custom-scrollbar">
<li class="custom-option px-4 py-2.5 hover:bg-blue-50 cursor-pointer text-sm text-gray-700 transition-colors border-b border-gray-50" data-value="">Ø¹Ø±Ø¶ ÙƒÙ„ Ø§Ù„Ø£Ù‚Ø³Ø§Ù…</li>                    <li class="custom-option px-4 py-2 hover:bg-blue-50 cursor-pointer text-sm text-gray-700 border-b border-gray-50" data-value="dean">Ù…ÙƒØªØ¨ Ø§Ù„Ø¹Ù…ÙŠØ¯</li>
                    <li class="custom-option px-4 py-2 hover:bg-blue-50 cursor-pointer text-sm text-gray-700 border-b border-gray-50" data-value="transport-logistics">Ù‚Ø³Ù… Ø¥Ø¯Ø§Ø±Ø© Ù„ÙˆØ¬Ø³ØªÙŠØ§Øª Ø§Ù„Ù†Ù‚Ù„</li>
                    <li class="custom-option px-4 py-2 hover:bg-blue-50 cursor-pointer text-sm text-gray-700 border-b border-gray-50" data-value="trade-logistics">Ù‚Ø³Ù… Ø¥Ø¯Ø§Ø±Ø© Ù„ÙˆØ¬Ø³ØªÙŠØ§Øª Ø§Ù„ØªØ¬Ø§Ø±Ø© Ø§Ù„Ø¯ÙˆÙ„ÙŠØ©</li>
                    <li class="custom-option px-4 py-2 hover:bg-blue-50 cursor-pointer text-sm text-gray-700 border-b border-gray-50" data-value="supply-chain">Ù‚Ø³Ù… Ø¥Ø¯Ø§Ø±Ø© Ù„ÙˆØ¬Ø³ØªÙŠØ§Øª Ø³Ù„Ø§Ø³Ù„ Ø§Ù„Ø¥Ù…Ø¯Ø§Ø¯</li>
                    <li class="custom-option px-4 py-2 hover:bg-blue-50 cursor-pointer text-sm text-gray-700 border-b border-gray-50" data-value="energy-logistics">Ù‚Ø³Ù… Ø¥Ø¯Ø§Ø±Ø© Ù„ÙˆØ¬Ø³ØªÙŠØ§Øª Ø§Ù„Ø·Ø§Ù‚Ø© ÙˆØ§Ù„Ø¨ØªØ±ÙˆÙ„</li>
                    <li class="custom-option px-4 py-2 hover:bg-blue-50 cursor-pointer text-sm text-gray-700 border-b border-gray-50" data-value="admin-followup">Ù‚Ø³Ù… Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±ÙŠØ©</li>
                    <li class="custom-option px-4 py-2 hover:bg-blue-50 cursor-pointer text-sm text-gray-700 border-b border-gray-50" data-value="training-agency">ÙˆÙƒØ§Ù„Ø© Ø´Ø¤ÙˆÙ† Ø§Ù„ØªØ¯Ø±ÙŠØ¨ ÙˆØ®Ø¯Ù…Ø© Ø§Ù„Ù…Ø¬ØªÙ…Ø¹</li>
                    <li class="custom-option px-4 py-2 hover:bg-blue-50 cursor-pointer text-sm text-gray-700 border-b border-gray-50" data-value="postgrad-agency">ÙˆÙƒØ§Ù„Ø© Ø§Ù„Ø¯Ø±Ø§Ø³Ø§Øª Ø§Ù„Ø¹Ù„ÙŠØ§ ÙˆØ§Ù„Ø¨Ø­Ø« Ø§Ù„Ø¹Ù„Ù…ÙŠ</li>
                    <li class="custom-option px-4 py-2 hover:bg-blue-50 cursor-pointer text-sm text-gray-700 border-b border-gray-50" data-value="education-agency">ÙˆÙƒØ§Ù„Ø© Ø´Ø¤ÙˆÙ† Ø§Ù„ØªØ¹Ù„ÙŠÙ…</li>
                    <li class="custom-option px-4 py-2 hover:bg-blue-50 cursor-pointer text-sm text-gray-700 border-b border-gray-50" data-value="students-agency">ÙˆÙƒØ§Ù„Ø© Ø´Ø¤ÙˆÙ† Ø§Ù„Ø·Ù„Ø§Ø¨</li>
                    <li class="custom-option px-4 py-2 hover:bg-blue-50 cursor-pointer text-sm text-gray-700 border-b border-gray-50" data-value="assistants-office">Ù…ÙƒØªØ¨ Ø§Ù„Ù…Ø¹ÙŠØ¯ÙŠÙ†</li>
                    <li class="custom-option px-4 py-2 hover:bg-blue-50 cursor-pointer text-sm text-gray-700 border-b border-gray-50" data-value="computer-lab">Ù…Ø¹Ù…Ù„ Ø§Ù„Ø­Ø§Ø³Ø¨ (IT)</li>
                    <li class="custom-option px-4 py-2 hover:bg-blue-50 cursor-pointer text-sm text-gray-700" data-value="visitor">Ø²Ø§Ø¦Ø± Ø®Ø§Ø±Ø¬ÙŠ</li>
                </ul>

                <select id="filter-users-dept" class="hidden" onchange="updateAdminUsersList()">
                    <option value="">Ø¹Ø±Ø¶ ÙƒÙ„ Ø§Ù„Ø£Ù‚Ø³Ø§Ù…</option>
                    <option value="dean">Ù…ÙƒØªØ¨ Ø§Ù„Ø¹Ù…ÙŠØ¯</option>
                    <option value="transport-logistics">Ù‚Ø³Ù… Ø¥Ø¯Ø§Ø±Ø© Ù„ÙˆØ¬Ø³ØªÙŠØ§Øª Ø§Ù„Ù†Ù‚Ù„</option>
                    <option value="trade-logistics">Ù‚Ø³Ù… Ø¥Ø¯Ø§Ø±Ø© Ù„ÙˆØ¬Ø³ØªÙŠØ§Øª Ø§Ù„ØªØ¬Ø§Ø±Ø© Ø§Ù„Ø¯ÙˆÙ„ÙŠØ©</option>
                    <option value="supply-chain">Ù‚Ø³Ù… Ø¥Ø¯Ø§Ø±Ø© Ù„ÙˆØ¬Ø³ØªÙŠØ§Øª Ø³Ù„Ø§Ø³Ù„ Ø§Ù„Ø¥Ù…Ø¯Ø§Ø¯</option>
                    <option value="energy-logistics">Ù‚Ø³Ù… Ø¥Ø¯Ø§Ø±Ø© Ù„ÙˆØ¬Ø³ØªÙŠØ§Øª Ø§Ù„Ø·Ø§Ù‚Ø© ÙˆØ§Ù„Ø¨ØªØ±ÙˆÙ„</option>
                    <option value="admin-followup">Ù‚Ø³Ù… Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±ÙŠØ©</option>
                    <option value="training-agency">ÙˆÙƒØ§Ù„Ø© Ø´Ø¤ÙˆÙ† Ø§Ù„ØªØ¯Ø±ÙŠØ¨ ÙˆØ®Ø¯Ù…Ø© Ø§Ù„Ù…Ø¬ØªÙ…Ø¹</option>
                    <option value="postgrad-agency">ÙˆÙƒØ§Ù„Ø© Ø§Ù„Ø¯Ø±Ø§Ø³Ø§Øª Ø§Ù„Ø¹Ù„ÙŠØ§ ÙˆØ§Ù„Ø¨Ø­Ø« Ø§Ù„Ø¹Ù„Ù…ÙŠ</option>
                    <option value="education-agency">ÙˆÙƒØ§Ù„Ø© Ø´Ø¤ÙˆÙ† Ø§Ù„ØªØ¹Ù„ÙŠÙ…</option>
                    <option value="students-agency">ÙˆÙƒØ§Ù„Ø© Ø´Ø¤ÙˆÙ† Ø§Ù„Ø·Ù„Ø§Ø¨</option>
                    <option value="assistants-office">Ù…ÙƒØªØ¨ Ø§Ù„Ù…Ø¹ÙŠØ¯ÙŠÙ†</option>
                    <option value="computer-lab">Ù…Ø¹Ù…Ù„ Ø§Ù„Ø­Ø§Ø³Ø¨ (IT)</option>
                    <option value="visitor">Ø²Ø§Ø¦Ø± Ø®Ø§Ø±Ø¬ÙŠ</option>
                </select>
            </div>

            <button id="add-user-btn" onclick="openAddUserModal()" class="bg-[#2A3475] text-white px-5 py-2.5 rounded-lg shadow-lg hover:bg-[#1f2658] transition-all flex items-center justify-center text-xs md:text-sm font-bold hover:shadow-xl transform active:scale-95 whitespace-nowrap">
                <i class="fas fa-user-plus ml-2"></i> Ø¥Ø¶Ø§ÙØ© Ø¹Ø¶Ùˆ
            </button>
        </div>
    </div>

    <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-3 md:gap-4 mb-6 md:mb-8">
        <div class="bg-white p-4 rounded-xl border border-gray-100 shadow-sm flex items-center space-x-3 space-x-reverse">
            <div class="bg-blue-50 p-3 rounded-full text-blue-600"><i class="fas fa-users text-lg"></i></div>
            <div>
                <p class="text-[10px] md:text-xs text-gray-500 font-bold">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø£Ø¹Ø¶Ø§Ø¡</p>
                <h4 class="text-lg md:text-xl font-bold text-[#2A3475]" id="stats-total-users">...</h4>
            </div>
        </div>
        <div class="bg-white p-4 rounded-xl border border-gray-100 shadow-sm flex items-center space-x-3 space-x-reverse">
            <div class="bg-red-50 p-3 rounded-full text-red-600"><i class="fas fa-user-shield text-lg"></i></div>
            <div>
                <p class="text-[10px] md:text-xs text-gray-500 font-bold">Ø§Ù„Ù…Ø¯ÙŠØ±ÙŠÙ†</p>
                <h4 class="text-lg md:text-xl font-bold text-[#2A3475]" id="stats-total-admins">...</h4>
            </div>
        </div>
        <div class="bg-white p-4 rounded-xl border border-gray-100 shadow-sm flex items-center space-x-3 space-x-reverse">
            <div class="bg-green-50 p-3 rounded-full text-green-600"><i class="fas fa-user-check text-lg"></i></div>
            <div>
                <p class="text-[10px] md:text-xs text-gray-500 font-bold">Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</p>
                <h4 class="text-lg md:text-xl font-bold text-[#2A3475]" id="stats-total-normal">...</h4>
            </div>
        </div>
    </div>

    <div class="flex flex-col gap-6 md:gap-8">
        <div class="bg-white border border-gray-200 rounded-xl overflow-hidden shadow-sm">
            <div class="p-3 md:p-4 border-b border-gray-100 bg-gray-50 flex justify-between items-center">
                <h5 class="font-bold text-[#2A3475] text-xs md:text-sm flex items-center">
                    <i class="fas fa-list ml-2"></i> Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø§Ù„Ù…Ø³Ø¬Ù„ÙŠÙ†
                </h5>
                <span class="text-[10px] text-gray-400 bg-white border border-gray-200 px-2 py-1 rounded" id="users-count-badge">...</span>
            </div>
            <div class="overflow-x-auto">
                <table class="w-full text-xs md:text-sm text-right min-w-[600px]">
                    <thead class="bg-gray-50 text-gray-600 font-bold uppercase text-[10px] md:text-xs tracking-wider border-b border-gray-200 whitespace-nowrap">
                        <tr>
                            <th class="px-4 py-4 w-1/4">Ø§Ù„Ø¹Ø¶Ùˆ</th>
                            <th class="px-4 py-4 w-1/5">Ø§Ù„Ù…Ø³Ù…Ù‰ Ø§Ù„ÙˆØ¸ÙŠÙÙŠ</th>
                            <th class="px-4 py-4 w-1/5">Ø§Ù„Ù‚Ø³Ù… / Ø§Ù„Ø¬Ù‡Ø©</th>
                            <th class="px-4 py-4 w-[15%]">Ø§Ù„Ø¯ÙˆØ±</th>
                            <th class="px-4 py-4 text-center">ØªØ­ÙƒÙ…</th>
                        </tr>
                    </thead>
                    <tbody id="active-users-list" class="divide-y divide-gray-100"></tbody>
                </table>
            </div>
        </div>

        <div class="bg-white p-4 md:p-5 rounded-xl border border-gray-200 shadow-sm">
            <h5 class="font-bold text-[#2A3475] mb-4 text-xs md:text-sm border-b border-gray-100 pb-2 flex items-center">
                <i class="fas fa-chart-bar ml-2"></i> Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ù†Ø´Ø§Ø· Ø§Ù„Ø£Ù‚Ø³Ø§Ù…
            </h5>
            <div id="department-stats" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3 md:gap-4"></div>
        </div>
    </div>
</div>

<div id="admin-meetings-tab" class="admin-tab-content hidden">
                 
                 <div id="pending-requests-section" class="mb-6 md:mb-8 hidden">
                     <h2 class="text-lg md:text-xl font-bold text-yellow-600 mb-4 flex items-center animate-pulse">
                         <i class="fas fa-exclamation-circle ml-2"></i> Ø·Ù„Ø¨Ø§Øª Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø©
                     </h2>
                     <div class="bg-yellow-50 border border-yellow-200 rounded-xl overflow-hidden shadow-sm">
                         <div class="overflow-x-auto">
                            <table class="w-full text-xs md:text-sm text-right min-w-[600px]">
                                <thead class="bg-yellow-100 text-yellow-800 font-bold text-[10px] md:text-xs uppercase whitespace-nowrap">
                                    <tr>
                                        <th class="px-4 md:px-6 py-3">Ø§Ù„Ø¹Ù†ÙˆØ§Ù†</th>
                                        <th class="px-4 md:px-6 py-3">Ø·Ø§Ù„Ø¨ Ø§Ù„Ø­Ø¬Ø²</th>
                                        <th class="px-4 md:px-6 py-3">Ø§Ù„Ù…ÙˆØ¹Ø¯</th>
                                        <th class="px-6 py-3 text-center">Ù‚Ø±Ø§Ø± Ø§Ù„Ù…Ø¯ÙŠØ±</th>
                                    </tr>
                                </thead>
                                <tbody id="pending-meetings-list" class="divide-y divide-yellow-200 bg-white">
                                    </tbody>
                            </table>
                         </div>
                     </div>
                 </div>

                 <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-6 gap-4">
                     <div>
                         <h2 class="text-xl md:text-2xl font-bold text-[#2A3475]">Ø³Ø¬Ù„ Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª Ø§Ù„Ù…Ø¹ØªÙ…Ø¯Ø©</h2>
                         <p class="text-xs md:text-sm text-gray-500 mt-1">Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø²Ù…Ù†ÙŠ Ø§Ù„Ø±Ø³Ù…ÙŠ</p>
                     </div>
                     <div class="flex items-center space-x-3 space-x-reverse w-full sm:w-auto overflow-x-auto no-scrollbar pb-1">
                        <div class="flex items-center bg-white border border-gray-200 rounded-lg p-1 shrink-0">
                             <button id="filter-all" class="filter-btn active px-3 py-1.5 text-[10px] md:text-xs font-bold rounded-md bg-[#2A3475] text-white shadow-sm transition-colors" onclick="filterAdminMeetings('all')">Ø§Ù„ÙƒÙ„</button>
                             <button id="filter-upcoming" class="filter-btn px-3 py-1.5 text-[10px] md:text-xs font-bold rounded-md text-gray-500 hover:bg-gray-50 transition-colors" onclick="filterAdminMeetings('upcoming')">Ø§Ù„Ù‚Ø§Ø¯Ù…Ø©</button>
                             <button id="filter-past" class="filter-btn px-3 py-1.5 text-[10px] md:text-xs font-bold rounded-md text-gray-500 hover:bg-gray-50 transition-colors" onclick="filterAdminMeetings('past')">Ø§Ù„Ù…Ù†ØªÙ‡ÙŠØ©</button>
                        </div>
                        <button id="bulk-delete-btn" class="px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors text-xs md:text-sm shadow-sm flex items-center shrink-0"> 
                            <i class="fas fa-trash ml-2"></i> Ø­Ø°Ù
                        </button>
                     </div>
                 </div>
                 
                 <div class="bg-white border border-gray-200 rounded-xl overflow-hidden shadow-sm">
                     <div class="overflow-x-auto">
                        <table class="w-full text-xs md:text-sm text-right min-w-[700px]">
                            <thead class="bg-gray-50 text-gray-600 font-bold uppercase text-[10px] md:text-xs tracking-wider border-b border-gray-200 whitespace-nowrap">
                                <tr>
                                    <th class="px-6 py-4"><input type="checkbox" id="select-all-meetings" class="rounded border-gray-300 text-[#2A3475] focus:ring-[#2A3475]"></th>
                                    <th class="px-6 py-4">Ø§Ù„Ø¹Ù†ÙˆØ§Ù†</th>
                                    <th class="px-6 py-4">Ø§Ù„Ø¬Ù‡Ø©</th>
                                    <th class="px-6 py-4">Ø§Ù„ØªØ§Ø±ÙŠØ® ÙˆØ§Ù„ÙˆÙ‚Øª</th>
                                    <th class="px-6 py-4">Ø§Ù„Ø­Ø§Ù„Ø©</th>
                                    <th class="px-6 py-4 text-center">Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                                </tr>
                            </thead>
                            <tbody id="admin-meetings-list" class="divide-y divide-gray-100"></tbody>
                        </table>
                     </div>
                 </div>
             </div>

<div id="admin-settings-tab" class="admin-tab-content hidden">
    
    <div class="mb-6">
        <h2 class="text-xl md:text-2xl font-bold text-[#2A3475]">Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù…</h2>
        <p class="text-xs md:text-sm text-gray-500 mt-1">ØªØ®ØµÙŠØµ Ø³Ø§Ø¹Ø§Øª Ø§Ù„Ø¹Ù…Ù„ Ø§Ù„Ø±Ø³Ù…ÙŠØ© ÙˆØ¶Ø¨Ø· Ø§Ù„Ø¬Ø¯ÙˆÙ„</p>
    </div>
    
    <div class="bg-white border border-gray-200 rounded-xl p-4 md:p-6 shadow-sm mb-6">
        <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-4 pb-2 border-b border-gray-100 gap-3">
            <h5 class="font-bold text-gray-800 text-sm md:text-base flex items-center">
                <i class="fas fa-clock text-[#F3A628] ml-2"></i> Ø³Ø§Ø¹Ø§Øª Ø§Ù„Ø¹Ù…Ù„ Ø§Ù„Ø±Ø³Ù…ÙŠØ©
            </h5>
            <button onclick="saveSystemSettings()" class="w-full sm:w-auto bg-[#2A3475] text-white px-5 py-2 sm:py-1.5 rounded-lg text-[11px] md:text-xs font-bold hover:bg-[#1f2658] transition-colors shadow-sm transform active:scale-95">
                Ø­ÙØ¸ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª
            </button>
        </div>
        
        <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 md:gap-6">
            
            <div>
                <label class="block text-[10px] md:text-xs font-bold text-gray-600 mb-2">Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„ÙŠÙˆÙ…</label>
                
                <div class="relative custom-dropdown w-full">
                    <div class="custom-dropdown-display w-full px-4 py-2.5 border border-gray-300 rounded-lg text-sm bg-white focus:ring-2 focus:ring-[#2A3475]/20 focus:border-[#2A3475] flex items-center justify-between cursor-pointer transition-all shadow-sm">
                        <span class="text-gray-700 font-bold">08:00 ØµØ¨Ø§Ø­Ø§Ù‹</span>
                        <i class="fas fa-chevron-down text-xs text-gray-500 transition-transform duration-200"></i>
                    </div>
                    <ul class="custom-dropdown-options absolute top-full left-0 w-full bg-white border border-gray-200 rounded-lg mt-1 max-h-48 overflow-y-auto z-50 hidden shadow-xl custom-scrollbar">
                        <li class="custom-option px-4 py-2.5 hover:bg-blue-50 cursor-pointer text-sm text-gray-700 border-b border-gray-50 font-bold" data-value="6">06:00 ØµØ¨Ø§Ø­Ø§Ù‹</li>
                        <li class="custom-option px-4 py-2.5 hover:bg-blue-50 cursor-pointer text-sm text-gray-700 border-b border-gray-50 font-bold" data-value="7">07:00 ØµØ¨Ø§Ø­Ø§Ù‹</li>
                        <li class="custom-option px-4 py-2.5 hover:bg-blue-50 cursor-pointer text-sm text-gray-700 border-b border-gray-50 font-bold" data-value="8">08:00 ØµØ¨Ø§Ø­Ø§Ù‹</li>
                        <li class="custom-option px-4 py-2.5 hover:bg-blue-50 cursor-pointer text-sm text-gray-700 border-b border-gray-50 font-bold" data-value="9">09:00 ØµØ¨Ø§Ø­Ø§Ù‹</li>
                        <li class="custom-option px-4 py-2.5 hover:bg-blue-50 cursor-pointer text-sm text-gray-700 font-bold" data-value="10">10:00 ØµØ¨Ø§Ø­Ø§Ù‹</li>
                    </ul>
                    <select id="setting-start-hour" class="hidden">
                        <option value="6">06:00 ØµØ¨Ø§Ø­Ø§Ù‹</option>
                        <option value="7">07:00 ØµØ¨Ø§Ø­Ø§Ù‹</option>
                        <option value="8">08:00 ØµØ¨Ø§Ø­Ø§Ù‹</option>
                        <option value="9">09:00 ØµØ¨Ø§Ø­Ø§Ù‹</option>
                        <option value="10">10:00 ØµØ¨Ø§Ø­Ø§Ù‹</option>
                    </select>
                </div>
            </div>

            <div>
                <label class="block text-[10px] md:text-xs font-bold text-gray-600 mb-2">Ù†Ù‡Ø§ÙŠØ© Ø§Ù„ÙŠÙˆÙ…</label>
                
                <div class="relative custom-dropdown w-full">
                    <div class="custom-dropdown-display w-full px-4 py-2.5 border border-gray-300 rounded-lg text-sm bg-white focus:ring-2 focus:ring-[#2A3475]/20 focus:border-[#2A3475] flex items-center justify-between cursor-pointer transition-all shadow-sm">
                        <span class="text-gray-700 font-bold">06:00 Ù…Ø³Ø§Ø¡Ù‹</span>
                        <i class="fas fa-chevron-down text-xs text-gray-500 transition-transform duration-200"></i>
                    </div>
                    <ul class="custom-dropdown-options absolute top-full left-0 w-full bg-white border border-gray-200 rounded-lg mt-1 max-h-48 overflow-y-auto z-50 hidden shadow-xl custom-scrollbar">
                        <li class="custom-option px-4 py-2.5 hover:bg-blue-50 cursor-pointer text-sm text-gray-700 border-b border-gray-50 font-bold" data-value="14">02:00 Ù…Ø³Ø§Ø¡Ù‹</li>
                        <li class="custom-option px-4 py-2.5 hover:bg-blue-50 cursor-pointer text-sm text-gray-700 border-b border-gray-50 font-bold" data-value="15">03:00 Ù…Ø³Ø§Ø¡Ù‹</li>
                        <li class="custom-option px-4 py-2.5 hover:bg-blue-50 cursor-pointer text-sm text-gray-700 border-b border-gray-50 font-bold" data-value="16">04:00 Ù…Ø³Ø§Ø¡Ù‹</li>
                        <li class="custom-option px-4 py-2.5 hover:bg-blue-50 cursor-pointer text-sm text-gray-700 border-b border-gray-50 font-bold" data-value="17">05:00 Ù…Ø³Ø§Ø¡Ù‹</li>
                        <li class="custom-option px-4 py-2.5 hover:bg-blue-50 cursor-pointer text-sm text-gray-700 border-b border-gray-50 font-bold" data-value="18">06:00 Ù…Ø³Ø§Ø¡Ù‹</li>
                        <li class="custom-option px-4 py-2.5 hover:bg-blue-50 cursor-pointer text-sm text-gray-700 border-b border-gray-50 font-bold" data-value="19">07:00 Ù…Ø³Ø§Ø¡Ù‹</li>
                        <li class="custom-option px-4 py-2.5 hover:bg-blue-50 cursor-pointer text-sm text-gray-700 font-bold" data-value="20">08:00 Ù…Ø³Ø§Ø¡Ù‹</li>
                    </ul>
                    <select id="setting-end-hour" class="hidden">
                        <option value="14">02:00 Ù…Ø³Ø§Ø¡Ù‹</option>
                        <option value="15">03:00 Ù…Ø³Ø§Ø¡Ù‹</option>
                        <option value="16">04:00 Ù…Ø³Ø§Ø¡Ù‹</option>
                        <option value="17">05:00 Ù…Ø³Ø§Ø¡Ù‹</option>
                        <option value="18">06:00 Ù…Ø³Ø§Ø¡Ù‹</option>
                        <option value="19">07:00 Ù…Ø³Ø§Ø¡Ù‹</option>
                        <option value="20">08:00 Ù…Ø³Ø§Ø¡Ù‹</option>
                    </select>
                </div>
            </div>

        </div>
        <p class="text-[9px] md:text-[10px] text-gray-400 mt-3 flex items-center gap-1">
            <i class="fas fa-info-circle"></i>
            Ø³ÙŠØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¬Ø¯ÙˆÙ„ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø¹Ù†Ø¯ Ø§Ù„Ø­ÙØ¸ Ù„Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†.
        </p>
    </div>
</div>

<div id="admin-reports-tab" class="admin-tab-content hidden">
    
    <div class="flex flex-col sm:flex-row items-start sm:items-center justify-between mb-6 gap-4">
        <div>
            <h2 class="text-xl md:text-2xl font-bold text-[#2A3475]">Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± ÙˆØ§Ù„ØªØ­Ù„ÙŠÙ„Ø§Øª</h2>
            <p class="text-xs md:text-sm text-gray-500 mt-1">Ø¹Ø±Ø¶ Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… ÙˆØªØ­Ù„ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª</p>
        </div>
        <button id="export-report-btn" class="w-full sm:w-auto px-5 py-2.5 bg-[#2A3475] text-white rounded-lg hover:bg-[#1f2658] transition-all shadow-md flex items-center justify-center text-xs md:text-sm font-bold transform active:scale-95"> 
            <i class="fas fa-download ml-2"></i> ØªØµØ¯ÙŠØ± Ø§Ù„ØªÙ‚Ø±ÙŠØ± 
        </button>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 md:gap-6">
        <div class="bg-white rounded-xl p-4 md:p-6 shadow-sm border border-gray-200">
            <h5 class="font-bold text-gray-700 mb-4 text-xs md:text-sm">ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø´Ù‡Ø±ÙŠ</h5>
            <div id="monthly-usage-chart" class="space-y-3"></div>
        </div>
        <div class="bg-white rounded-xl p-4 md:p-6 shadow-sm border border-gray-200">
            <h5 class="font-bold text-gray-700 mb-4 text-xs md:text-sm">Ø£ÙˆÙ‚Ø§Øª Ø§Ù„Ø°Ø±ÙˆØ©</h5>
            <div id="peak-times-chart" class="space-y-3"></div>
        </div>
    </div>
    
    <div class="mt-6 bg-white rounded-xl p-4 md:p-6 shadow-sm border border-gray-200">
        <h5 class="font-bold text-gray-700 mb-4 text-xs md:text-sm">Ù…Ù„Ø®Øµ Ø´Ø§Ù…Ù„</h5>
        <div id="detailed-analytics" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-3 md:gap-4"></div>
    </div>
</div>

         </div>
     </div>
    </div>
   </div><!-- Add User Modal -->
<div id="add-user-modal" class="modal">
    <div class="modal-content p-0 shadow-2xl rounded-xl flex flex-col h-auto max-h-[92vh] md:max-h-[85vh]" style="max-width: 650px; width: 95%; overflow: visible;">
     
     <div class="metallic-blue-fill random-slanted-lines px-4 py-3 md:px-6 md:py-4 flex items-center justify-between shadow-md relative overflow-hidden rounded-t-xl shrink-0">
        <div class="absolute top-0 left-0 w-full h-full opacity-10 bg-[url('https://www.transparenttextures.com/patterns/cubes.png')]"></div>
        <div class="flex items-center space-x-3 space-x-reverse text-white relative z-10">
            <div class="bg-white/10 p-2 md:p-2.5 rounded-lg backdrop-blur-sm border border-white/10 shadow-inner">
                <i class="fas fa-user-plus text-[#F3A628] text-lg md:text-xl"></i>
            </div>
            <div>
                <h3 class="text-sm md:text-lg font-bold tracking-wide">Ø¥Ø¶Ø§ÙØ© Ù…Ø³ØªØ®Ø¯Ù… Ø¬Ø¯ÙŠØ¯</h3>
                <p class="text-[10px] md:text-xs text-blue-200 font-light mt-0.5">Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯ ÙˆØªØ­Ø¯ÙŠØ¯ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª</p>
            </div>
        </div>
        <button onclick="closeModal('add-user-modal')" class="text-white/60 hover:text-white hover:bg-white/10 w-7 h-7 md:w-8 md:h-8 rounded-full flex items-center justify-center transition-all duration-200 relative z-10"> 
            <i class="fas fa-times text-sm"></i> 
        </button>
     </div>

    <form id="add-user-form" class="p-4 md:p-6 bg-[#f8fafc] rounded-b-xl overflow-y-auto custom-scrollbar flex-1">
        <div class="space-y-4 md:space-y-5">
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 md:gap-5">
                <div>
                    <label class="block text-[11px] md:text-xs font-bold text-[#2A3475] mb-1.5 md:mb-2">Ø§Ù„Ø§Ø³Ù… Ø¨Ø§Ù„ÙƒØ§Ù…Ù„</label> 
                    <input type="text" id="new-user-name" required class="w-full px-4 py-2.5 md:py-3 border border-gray-300 rounded-lg text-sm bg-white focus:ring-2 focus:ring-[#2A3475]/20 focus:border-[#2A3475] outline-none transition-all shadow-sm font-bold">
                </div>
                <div>
                    <label class="block text-[11px] md:text-xs font-bold text-[#2A3475] mb-1.5 md:mb-2">Ø±Ù‚Ù… Ø§Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„</label> 
                    <input type="tel" id="new-user-mobile" placeholder="01xxxxxxxxx" maxlength="11" oninput="this.value = this.value.replace(/[^0-9]/g, '')" class="w-full px-4 py-2.5 md:py-3 border border-gray-300 rounded-lg text-sm bg-white focus:ring-2 focus:ring-[#2A3475]/20 focus:border-[#2A3475] outline-none transition-all shadow-sm text-left dir-ltr font-bold">
                </div>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 md:gap-5">
                <div>
                    <label class="block text-[11px] md:text-xs font-bold text-[#2A3475] mb-1.5 md:mb-2">Ø§Ù„Ù…Ø³Ù…Ù‰ Ø§Ù„ÙˆØ¸ÙŠÙÙŠ</label> 
                    <input type="text" id="new-user-position" placeholder="Ù…Ø«Ø§Ù„: Ù…Ø¹ÙŠØ¯ØŒ Ø¯ÙƒØªÙˆØ±..." class="w-full px-4 py-2.5 md:py-3 border border-gray-300 rounded-lg text-sm bg-white focus:ring-2 focus:ring-[#2A3475]/20 focus:border-[#2A3475] outline-none transition-all shadow-sm font-bold">
                </div>
                
                <div class="relative custom-dropdown w-full z-30">
                    <label class="block text-[11px] md:text-xs font-bold text-[#2A3475] mb-1.5 md:mb-2">Ø§Ù„Ù‚Ø³Ù… / Ø§Ù„Ø¬Ù‡Ø©</label> 
                    <div class="custom-dropdown-display w-full px-4 py-2.5 md:py-3 border border-gray-300 rounded-lg text-sm bg-white focus:ring-2 focus:ring-[#2A3475]/20 focus:border-[#2A3475] flex items-center justify-between cursor-pointer transition-all shadow-sm">
                        <span class="text-gray-700 truncate font-bold">Ø§Ø®ØªØ± Ø§Ù„Ø¬Ù‡Ø©...</span>
                        <i class="fas fa-chevron-down text-[10px] text-gray-500 transition-transform duration-200"></i>
                    </div>
                    <ul class="custom-dropdown-options absolute top-full left-0 w-full bg-white border border-gray-200 rounded-lg mt-1 max-h-48 md:max-h-60 overflow-y-auto z-50 hidden shadow-xl custom-scrollbar">
                        <li class="custom-option px-4 py-2.5 hover:bg-blue-50 cursor-pointer text-sm text-gray-700 transition-colors border-b border-gray-50" data-value="">Ø§Ø®ØªØ± Ø§Ù„Ø¬Ù‡Ø©...</li>
                        <li class="custom-option px-4 py-2.5 hover:bg-blue-50 cursor-pointer text-sm text-gray-700 transition-colors border-b border-gray-50" data-value="dean">Ù…ÙƒØªØ¨ Ø§Ù„Ø¹Ù…ÙŠØ¯</li>
                        <li class="custom-option px-4 py-2.5 hover:bg-blue-50 cursor-pointer text-sm text-gray-700 transition-colors border-b border-gray-50" data-value="transport-logistics">Ù‚Ø³Ù… Ø¥Ø¯Ø§Ø±Ø© Ù„ÙˆØ¬Ø³ØªÙŠØ§Øª Ø§Ù„Ù†Ù‚Ù„</li>
                        <li class="custom-option px-4 py-2.5 hover:bg-blue-50 cursor-pointer text-sm text-gray-700 transition-colors border-b border-gray-50" data-value="trade-logistics">Ù‚Ø³Ù… Ø¥Ø¯Ø§Ø±Ø© Ù„ÙˆØ¬Ø³ØªÙŠØ§Øª Ø§Ù„ØªØ¬Ø§Ø±Ø© Ø§Ù„Ø¯ÙˆÙ„ÙŠØ©</li>
                        <li class="custom-option px-4 py-2.5 hover:bg-blue-50 cursor-pointer text-sm text-gray-700 transition-colors border-b border-gray-50" data-value="supply-chain">Ù‚Ø³Ù… Ø¥Ø¯Ø§Ø±Ø© Ù„ÙˆØ¬Ø³ØªÙŠØ§Øª Ø³Ù„Ø§Ø³Ù„ Ø§Ù„Ø¥Ù…Ø¯Ø§Ø¯</li>
                        <li class="custom-option px-4 py-2.5 hover:bg-blue-50 cursor-pointer text-sm text-gray-700 transition-colors border-b border-gray-50" data-value="energy-logistics">Ù‚Ø³Ù… Ø¥Ø¯Ø§Ø±Ø© Ù„ÙˆØ¬Ø³ØªÙŠØ§Øª Ø§Ù„Ø·Ø§Ù‚Ø© ÙˆØ§Ù„Ø¨ØªØ±ÙˆÙ„</li>
                        <li class="custom-option px-4 py-2.5 hover:bg-blue-50 cursor-pointer text-sm text-gray-700 transition-colors border-b border-gray-50" data-value="admin-followup">Ù‚Ø³Ù… Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±ÙŠØ©</li>
                        <li class="custom-option px-4 py-2.5 hover:bg-blue-50 cursor-pointer text-sm text-gray-700 transition-colors border-b border-gray-50" data-value="training-agency">ÙˆÙƒØ§Ù„Ø© Ø´Ø¤ÙˆÙ† Ø§Ù„ØªØ¯Ø±ÙŠØ¨ ÙˆØ®Ø¯Ù…Ø© Ø§Ù„Ù…Ø¬ØªÙ…Ø¹</li>
                        <li class="custom-option px-4 py-2.5 hover:bg-blue-50 cursor-pointer text-sm text-gray-700 transition-colors border-b border-gray-50" data-value="postgrad-agency">ÙˆÙƒØ§Ù„Ø© Ø§Ù„Ø¯Ø±Ø§Ø³Ø§Øª Ø§Ù„Ø¹Ù„ÙŠØ§ ÙˆØ§Ù„Ø¨Ø­Ø« Ø§Ù„Ø¹Ù„Ù…ÙŠ</li>
                        <li class="custom-option px-4 py-2.5 hover:bg-blue-50 cursor-pointer text-sm text-gray-700 transition-colors border-b border-gray-50" data-value="education-agency">ÙˆÙƒØ§Ù„Ø© Ø´Ø¤ÙˆÙ† Ø§Ù„ØªØ¹Ù„ÙŠÙ…</li>
                        <li class="custom-option px-4 py-2.5 hover:bg-blue-50 cursor-pointer text-sm text-gray-700 transition-colors border-b border-gray-50" data-value="students-agency">ÙˆÙƒØ§Ù„Ø© Ø´Ø¤ÙˆÙ† Ø§Ù„Ø·Ù„Ø§Ø¨</li>
                        <li class="custom-option px-4 py-2.5 hover:bg-blue-50 cursor-pointer text-sm text-gray-700 transition-colors border-b border-gray-50" data-value="assistants-office">Ù…ÙƒØªØ¨ Ø§Ù„Ù…Ø¹ÙŠØ¯ÙŠÙ†</li>
                        <li class="custom-option px-4 py-2.5 hover:bg-blue-50 cursor-pointer text-sm text-gray-700 transition-colors border-b border-gray-50" data-value="computer-lab">Ù…Ø¹Ù…Ù„ Ø§Ù„Ø­Ø§Ø³Ø¨ (IT)</li>
                        <li class="custom-option px-4 py-2.5 hover:bg-blue-50 cursor-pointer text-sm text-gray-700" data-value="visitor">Ø²Ø§Ø¦Ø± Ø®Ø§Ø±Ø¬ÙŠ</li>
                    </ul>
                    <select id="new-user-dept" class="hidden" required>
                        <option value="">Ø§Ø®ØªØ± Ø§Ù„Ø¬Ù‡Ø©...</option> 
                        </select>
                </div>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 md:gap-5">
                <div>
                    <label class="block text-[11px] md:text-xs font-bold text-[#2A3475] mb-1.5 md:mb-2">Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</label> 
                    <input type="email" id="new-user-email" required class="w-full px-4 py-2.5 md:py-3 border border-gray-300 rounded-lg text-sm bg-white focus:ring-2 focus:ring-[#2A3475]/20 focus:border-[#2A3475] outline-none transition-all shadow-sm font-bold">
                </div>
                <div>
                    <label class="block text-[11px] md:text-xs font-bold text-[#2A3475] mb-1.5 md:mb-2">ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label> 
                    <input type="password" id="new-user-password" required minlength="6" placeholder="******" class="w-full px-4 py-2.5 md:py-3 border border-gray-300 rounded-lg text-sm bg-white focus:ring-2 focus:ring-[#2A3475]/20 focus:border-[#2A3475] outline-none transition-all shadow-sm font-bold">
                </div>
            </div>
            
            <div class="bg-gray-50 p-4 rounded-xl border border-gray-200">
              <p class="text-[11px] md:text-xs font-bold text-[#2A3475] mb-3 flex items-center"><i class="fas fa-user-shield ml-2"></i> ØªØ­Ø¯ÙŠØ¯ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª ÙˆØ§Ù„Ù…Ù‡Ø§Ù…:</p>
              <div class="space-y-3">
                  <label class="flex items-center cursor-pointer group">
                      <input type="checkbox" id="new-perm-approve" class="w-4 h-4 text-[#2A3475] rounded border-gray-300 focus:ring-[#2A3475] cursor-pointer">
                      <span class="mr-2 text-[11px] md:text-xs font-bold text-gray-700 group-hover:text-[#2A3475] transition-colors">Ø§Ø¹ØªÙ…Ø§Ø¯ ÙˆØ±ÙØ¶ Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª</span>
                  </label>
                  <label class="flex items-center cursor-pointer group">
                      <input type="checkbox" id="new-perm-users" class="w-4 h-4 text-[#2A3475] rounded border-gray-300 focus:ring-[#2A3475] cursor-pointer">
                      <span class="mr-2 text-[11px] md:text-xs font-bold text-gray-700 group-hover:text-[#2A3475] transition-colors">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</span>
                  </label>
                  <label class="flex items-center cursor-pointer group">
                      <input type="checkbox" id="new-perm-delete" class="w-4 h-4 text-red-600 rounded border-gray-300 focus:ring-red-600 cursor-pointer">
                      <span class="mr-2 text-[11px] md:text-xs font-bold text-red-700 group-hover:text-red-800 transition-colors">Ø­Ø°Ù Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª (Ø®Ø·Ø±)</span>
                  </label>
              </div>
            </div>

            <div class="flex flex-col md:flex-row justify-end items-center gap-3 pt-4 border-t border-gray-100 shrink-0">
                <button type="button" onclick="closeModal('add-user-modal')" class="w-full md:w-auto px-6 py-2.5 text-gray-600 font-bold hover:bg-gray-200 rounded-lg transition-colors text-xs md:text-sm border border-gray-200 bg-white shadow-sm order-2 md:order-1">Ø¥Ù„ØºØ§Ø¡</button> 
                <button type="submit" class="w-full md:w-auto px-8 py-2.5 bg-[#2A3475] text-white font-bold rounded-lg hover:bg-[#1f2658] shadow-lg hover:shadow-[#2A3475]/40 transition-all text-xs md:text-sm flex items-center justify-center transform active:scale-95 order-1 md:order-2">Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</button>
            </div>
        </div>
    </form>
    </div>
</div>

<div id="permissions-modal" class="modal">
    <div class="modal-content" style="width: 95%; max-width: 450px;">
        <div class="metallic-blue-fill random-slanted-lines px-4 py-3 -mx-6 -mt-6 mb-6 flex justify-between items-center rounded-t-xl">
            <h3 class="text-lg font-bold text-white">ØªØ¹Ø¯ÙŠÙ„ ØµÙ„Ø§Ø­ÙŠØ§Øª Ø§Ù„Ø¹Ø¶Ùˆ</h3>
            <button onclick="closeModal('permissions-modal')" class="text-white/70 hover:text-white"><i class="fas fa-times"></i></button>
        </div>
        <form id="permissions-form" class="space-y-4">
            <input type="hidden" id="perm-user-id">
            <div class="bg-blue-50 p-3 rounded-lg border border-blue-100 mb-4">
                <p class="text-xs text-[#2A3475] font-bold mb-1">Ø§Ù„Ø¹Ø¶Ùˆ Ø§Ù„Ù…Ø­Ø¯Ø¯:</p>
                <p id="perm-user-name" class="text-sm text-gray-700">...</p>
            </div>
            <div class="space-y-3">
                <label class="flex items-center p-3 border rounded-lg cursor-pointer hover:bg-gray-50 transition-colors">
                    <input type="checkbox" id="perm-approve" class="w-5 h-5 text-[#2A3475] rounded focus:ring-[#2A3475]">
                    <div class="mr-3"><span class="block text-sm font-bold text-gray-800">Ø§Ø¹ØªÙ…Ø§Ø¯ ÙˆØ±ÙØ¶ Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª</span></div>
                </label>
                <label class="flex items-center p-3 border rounded-lg cursor-pointer hover:bg-gray-50 transition-colors">
                    <input type="checkbox" id="perm-users" class="w-5 h-5 text-[#2A3475] rounded focus:ring-[#2A3475]">
                    <div class="mr-3"><span class="block text-sm font-bold text-gray-800">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</span></div>
                </label>
                <label class="flex items-center p-3 border border-red-100 bg-red-50/30 rounded-lg cursor-pointer hover:bg-red-50 transition-colors">
                    <input type="checkbox" id="perm-delete" class="w-5 h-5 text-red-600 rounded focus:ring-red-600">
                    <div class="mr-3"><span class="block text-sm font-bold text-red-800">Ø­Ø°Ù Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª (Ø®Ø·Ø±)</span></div>
                </label>
            </div>
            <div class="pt-4 flex gap-3">
                <button type="button" onclick="closeModal('permissions-modal')" class="flex-1 py-2.5 border border-gray-300 rounded-lg text-gray-600 font-bold">Ø¥Ù„ØºØ§Ø¡</button>
                <button type="submit" class="flex-1 py-2.5 bg-[#2A3475] text-white rounded-lg font-bold hover:bg-[#1f2658]">Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª</button>
            </div>
        </form>
    </div>
</div>

<div id="edit-user-info-modal" class="modal">
<div class="modal-content p-0 shadow-2xl rounded-xl" style="max-width: 650px; width: 95%; overflow: visible;">     
     <div class="metallic-blue-fill random-slanted-lines px-6 py-4 flex items-center justify-between shadow-md relative overflow-hidden rounded-t-xl">
        <div class="absolute top-0 left-0 w-full h-full opacity-10 bg-[url('https://www.transparenttextures.com/patterns/cubes.png')]"></div>
        <div class="flex items-center space-x-3 space-x-reverse text-white relative z-10">
            <div class="bg-white/10 p-2.5 rounded-lg backdrop-blur-sm border border-white/10 shadow-inner">
                <i class="fas fa-user-edit text-[#F3A628] text-xl"></i>
            </div>
            <div>
                <h3 class="text-lg font-bold tracking-wide">ØªØ¹Ø¯ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ø¶Ùˆ</h3>
                <p class="text-xs text-blue-200 font-light mt-0.5">ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© ÙˆØ§Ù„ÙˆØ¸ÙŠÙÙŠØ©</p>
            </div>
        </div>
        <button onclick="closeModal('edit-user-info-modal')" class="text-white/60 hover:text-white hover:bg-white/10 w-8 h-8 rounded-full flex items-center justify-center transition-all duration-200 relative z-10"> 
            <i class="fas fa-times"></i> 
        </button>
     </div>
     
     <form id="edit-user-info-form" class="p-6 bg-[#f8fafc] rounded-b-xl">
      <input type="hidden" id="edit-user-id">
      
      <div class="space-y-5">
          
          <div class="grid grid-cols-1 md:grid-cols-2 gap-5">
              <div>
                  <label class="block text-xs font-bold text-[#2A3475] mb-2">Ø§Ù„Ø§Ø³Ù… Ø¨Ø§Ù„ÙƒØ§Ù…Ù„</label>
                  <input type="text" id="edit-user-name" class="w-full px-4 py-3 border border-gray-300 rounded-lg text-sm bg-white focus:ring-2 focus:ring-[#2A3475]/20 focus:border-[#2A3475] outline-none transition-all shadow-sm">
              </div>
              <div>
                  <label class="block text-xs font-bold text-[#2A3475] mb-2">Ø±Ù‚Ù… Ø§Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„</label>
                  <input type="tel" id="edit-user-mobile" maxlength="11" class="w-full px-4 py-3 border border-gray-300 rounded-lg text-sm bg-white focus:ring-2 focus:ring-[#2A3475]/20 focus:border-[#2A3475] outline-none transition-all shadow-sm text-left dir-ltr">
              </div>
          </div>

          <div class="grid grid-cols-1 md:grid-cols-2 gap-5">
              <div>
                  <label class="block text-xs font-bold text-[#2A3475] mb-2">Ø§Ù„Ù…Ø³Ù…Ù‰ Ø§Ù„ÙˆØ¸ÙŠÙÙŠ</label>
                  <input type="text" id="edit-user-position" placeholder="Ù…Ø«Ø§Ù„: Ù…Ø¹ÙŠØ¯" class="w-full px-4 py-3 border border-gray-300 rounded-lg text-sm bg-white focus:ring-2 focus:ring-[#2A3475]/20 focus:border-[#2A3475] outline-none transition-all shadow-sm">
              </div>
              
              <div class="relative custom-dropdown w-full">
                  <label class="block text-xs font-bold text-[#2A3475] mb-2">Ø§Ù„Ù‚Ø³Ù… / Ø§Ù„Ø¬Ù‡Ø©</label>
                  
                  <div class="custom-dropdown-display w-full px-4 py-3 border border-gray-300 rounded-lg text-sm bg-white focus:ring-2 focus:ring-[#2A3475]/20 focus:border-[#2A3475] flex items-center justify-between cursor-pointer transition-all shadow-sm">
                      <span class="text-gray-700">Ø§Ø®ØªØ± Ø§Ù„Ø¬Ù‡Ø©...</span>
                      <i class="fas fa-chevron-down text-xs text-gray-500 transition-transform duration-200"></i>
                  </div>
                  
                  <ul class="custom-dropdown-options absolute top-full left-0 w-full bg-white border border-gray-200 rounded-lg mt-1 max-h-60 overflow-y-auto z-50 hidden shadow-xl custom-scrollbar">
                        <li class="custom-option px-4 py-2.5 hover:bg-blue-50 cursor-pointer text-sm text-gray-700 transition-colors border-b border-gray-50" data-value="">Ø§Ø®ØªØ± Ø§Ù„Ø¬Ù‡Ø©...</li>
                        <li class="custom-option px-4 py-2.5 hover:bg-blue-50 cursor-pointer text-sm text-gray-700 transition-colors border-b border-gray-50" data-value="dean">Ù…ÙƒØªØ¨ Ø§Ù„Ø¹Ù…ÙŠØ¯</li>
                        <li class="custom-option px-4 py-2.5 hover:bg-blue-50 cursor-pointer text-sm text-gray-700 transition-colors border-b border-gray-50" data-value="transport-logistics">Ø¥Ø¯Ø§Ø±Ø© Ù„ÙˆØ¬Ø³ØªÙŠØ§Øª Ø§Ù„Ù†Ù‚Ù„</li>
                        <li class="custom-option px-4 py-2.5 hover:bg-blue-50 cursor-pointer text-sm text-gray-700 transition-colors border-b border-gray-50" data-value="trade-logistics">Ù„ÙˆØ¬Ø³ØªÙŠØ§Øª Ø§Ù„ØªØ¬Ø§Ø±Ø© Ø§Ù„Ø¯ÙˆÙ„ÙŠØ©</li>
                        <li class="custom-option px-4 py-2.5 hover:bg-blue-50 cursor-pointer text-sm text-gray-700 transition-colors border-b border-gray-50" data-value="supply-chain">Ø³Ù„Ø§Ø³Ù„ Ø§Ù„Ø¥Ù…Ø¯Ø§Ø¯</li>
                        <li class="custom-option px-4 py-2.5 hover:bg-blue-50 cursor-pointer text-sm text-gray-700 transition-colors border-b border-gray-50" data-value="energy-logistics">Ù„ÙˆØ¬Ø³ØªÙŠØ§Øª Ø§Ù„Ø·Ø§Ù‚Ø©</li>
                        <li class="custom-option px-4 py-2.5 hover:bg-blue-50 cursor-pointer text-sm text-gray-700 transition-colors border-b border-gray-50" data-value="admin-followup">Ù‚Ø³Ù… Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±ÙŠØ©</li>
                        <li class="custom-option px-4 py-2.5 hover:bg-blue-50 cursor-pointer text-sm text-gray-700 transition-colors border-b border-gray-50" data-value="training-agency">ÙˆÙƒØ§Ù„Ø© Ø§Ù„ØªØ¯Ø±ÙŠØ¨</li>
                        <li class="custom-option px-4 py-2.5 hover:bg-blue-50 cursor-pointer text-sm text-gray-700 transition-colors border-b border-gray-50" data-value="postgrad-agency">ÙˆÙƒØ§Ù„Ø© Ø§Ù„Ø¯Ø±Ø§Ø³Ø§Øª Ø§Ù„Ø¹Ù„ÙŠØ§</li>
                        <li class="custom-option px-4 py-2.5 hover:bg-blue-50 cursor-pointer text-sm text-gray-700 transition-colors border-b border-gray-50" data-value="education-agency">ÙˆÙƒØ§Ù„Ø© Ø§Ù„ØªØ¹Ù„ÙŠÙ…</li>
                        <li class="custom-option px-4 py-2.5 hover:bg-blue-50 cursor-pointer text-sm text-gray-700 transition-colors border-b border-gray-50" data-value="students-agency">ÙˆÙƒØ§Ù„Ø© Ø§Ù„Ø·Ù„Ø§Ø¨</li>
                        <li class="custom-option px-4 py-2.5 hover:bg-blue-50 cursor-pointer text-sm text-gray-700 transition-colors border-b border-gray-50" data-value="assistants-office">Ù…ÙƒØªØ¨ Ø§Ù„Ù…Ø¹ÙŠØ¯ÙŠÙ†</li>
                        <li class="custom-option px-4 py-2.5 hover:bg-blue-50 cursor-pointer text-sm text-gray-700 transition-colors border-b border-gray-50" data-value="computer-lab">Ù…Ø¹Ù…Ù„ Ø§Ù„Ø­Ø§Ø³Ø¨</li>
                        <li class="custom-option px-4 py-2.5 hover:bg-blue-50 cursor-pointer text-sm text-gray-700 transition-colors" data-value="visitor">Ø²Ø§Ø¦Ø± Ø®Ø§Ø±Ø¬ÙŠ</li>
                  </ul>

                  <select id="edit-user-dept" class="hidden">
                        <option value="">Ø§Ø®ØªØ± Ø§Ù„Ø¬Ù‡Ø©...</option> 
                        <option value="dean">Ù…ÙƒØªØ¨ Ø§Ù„Ø¹Ù…ÙŠØ¯</option>
                        <option value="transport-logistics">Ù‚Ø³Ù… Ø¥Ø¯Ø§Ø±Ø© Ù„ÙˆØ¬Ø³ØªÙŠØ§Øª Ø§Ù„Ù†Ù‚Ù„</option>
                        <option value="trade-logistics">Ù‚Ø³Ù… Ø¥Ø¯Ø§Ø±Ø© Ù„ÙˆØ¬Ø³ØªÙŠØ§Øª Ø§Ù„ØªØ¬Ø§Ø±Ø© Ø§Ù„Ø¯ÙˆÙ„ÙŠØ©</option>
                        <option value="supply-chain">Ù‚Ø³Ù… Ø¥Ø¯Ø§Ø±Ø© Ù„ÙˆØ¬Ø³ØªÙŠØ§Øª Ø³Ù„Ø§Ø³Ù„ Ø§Ù„Ø¥Ù…Ø¯Ø§Ø¯</option>
                        <option value="energy-logistics">Ù‚Ø³Ù… Ø¥Ø¯Ø§Ø±Ø© Ù„ÙˆØ¬Ø³ØªÙŠØ§Øª Ø§Ù„Ø·Ø§Ù‚Ø© ÙˆØ§Ù„Ø¨ØªØ±ÙˆÙ„</option>
                        <option value="admin-followup">Ù‚Ø³Ù… Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±ÙŠØ©</option>
                        <option value="training-agency">ÙˆÙƒØ§Ù„Ø© Ø´Ø¤ÙˆÙ† Ø§Ù„ØªØ¯Ø±ÙŠØ¨ ÙˆØ®Ø¯Ù…Ø© Ø§Ù„Ù…Ø¬ØªÙ…Ø¹</option>
                        <option value="postgrad-agency">ÙˆÙƒØ§Ù„Ø© Ø§Ù„Ø¯Ø±Ø§Ø³Ø§Øª Ø§Ù„Ø¹Ù„ÙŠØ§ ÙˆØ§Ù„Ø¨Ø­Ø« Ø§Ù„Ø¹Ù„Ù…ÙŠ</option>
                        <option value="education-agency">ÙˆÙƒØ§Ù„Ø© Ø´Ø¤ÙˆÙ† Ø§Ù„ØªØ¹Ù„ÙŠÙ…</option>
                        <option value="students-agency">ÙˆÙƒØ§Ù„Ø© Ø´Ø¤ÙˆÙ† Ø§Ù„Ø·Ù„Ø§Ø¨</option>
                        <option value="assistants-office">Ù…ÙƒØªØ¨ Ø§Ù„Ù…Ø¹ÙŠØ¯ÙŠÙ†</option>
                        <option value="computer-lab">Ù…Ø¹Ù…Ù„ Ø§Ù„Ø­Ø§Ø³Ø¨ (IT)</option> 
                        <option value="visitor">Ø²Ø§Ø¦Ø± Ø®Ø§Ø±Ø¬ÙŠ</option>
                  </select>
              </div>
          </div>
      </div>
      
      <div class="flex justify-end items-center pt-4 border-t border-gray-200 mt-4">
        <button type="submit" class="px-8 py-2.5 bg-[#2A3475] text-white font-bold rounded-lg hover:bg-[#1f2658] transition-colors shadow-md transform active:scale-95">
            Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª
        </button>
      </div>
     </form>
    </div>
   </div>
   
<div id="permissions-modal" class="modal">
    <div class="modal-content" style="width: 95%; max-width: 450px;">
        <div class="metallic-blue-fill random-slanted-lines px-4 py-3 -mx-6 -mt-6 mb-6 flex justify-between items-center rounded-t-xl">
            <h3 class="text-lg font-bold text-white">Ø¥Ø¯Ø§Ø±Ø© ØµÙ„Ø§Ø­ÙŠØ§Øª Ø§Ù„Ø¹Ø¶Ùˆ</h3>
            <button onclick="closeModal('permissions-modal')" class="text-white/70 hover:text-white"><i class="fas fa-times"></i></button>
        </div>
        
<form id="permissions-form-2" class="space-y-4">
            <input type="hidden" id="perm-user-id-2">
            
            <div class="bg-blue-50 p-3 rounded-lg border border-blue-100 mb-4">
                <p class="text-xs text-[#2A3475] font-bold mb-1">Ø§Ù„Ø¹Ø¶Ùˆ Ø§Ù„Ù…Ø­Ø¯Ø¯:</p>
                <p id="perm-user-name-2" class="text-sm text-gray-700">...</p>
            </div>

            <div class="space-y-3">
                <label for="perm-approve-2" class="flex items-center p-3 border rounded-lg cursor-pointer hover:bg-gray-50 transition-colors">
                    <input type="checkbox" id="perm-approve-2" class="w-5 h-5 text-[#2A3475] rounded focus:ring-[#2A3475]">
                    <div class="mr-3">
                        <span class="block text-sm font-bold text-gray-800">Ø§Ø¹ØªÙ…Ø§Ø¯ ÙˆØ±ÙØ¶ Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª</span>
                        <span class="block text-xs text-gray-500">ÙŠØ³Ù…Ø­ Ù„Ù‡ Ø¨Ù‚Ø¨ÙˆÙ„ Ø£Ùˆ Ø±ÙØ¶ Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù…Ø¹Ù„Ù‚Ø©.</span>
                    </div>
                </label>

                <label for="perm-users-2" class="flex items-center p-3 border rounded-lg cursor-pointer hover:bg-gray-50 transition-colors">
                    <input type="checkbox" id="perm-users-2" class="w-5 h-5 text-[#2A3475] rounded focus:ring-[#2A3475]">
                    <div class="mr-3">
                        <span class="block text-sm font-bold text-gray-800">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</span>
                        <span class="block text-xs text-gray-500">ÙŠØ³Ù…Ø­ Ù„Ù‡ Ø¨Ø¥Ø¶Ø§ÙØ© ÙˆØªØ¹Ø¯ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£Ø¹Ø¶Ø§Ø¡.</span>
                    </div>
                </label>

                <label for="perm-delete-2" class="flex items-center p-3 border border-red-100 bg-red-50/30 rounded-lg cursor-pointer hover:bg-red-50 transition-colors">
                    <input type="checkbox" id="perm-delete-2" class="w-5 h-5 text-red-600 rounded focus:ring-red-600">
                    <div class="mr-3">
                        <span class="block text-sm font-bold text-red-800">Ø­Ø°Ù Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª (Ø®Ø·Ø±)</span>
                        <span class="block text-xs text-red-600">ÙŠØ³Ù…Ø­ Ù„Ù‡ Ø¨Ø­Ø°Ù Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª Ø§Ù„Ù…Ø¤ÙƒØ¯Ø© Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹.</span>
                    </div>
                </label>
            </div>

            <div class="pt-4 flex gap-3">
                <button type="button" onclick="closeModal('permissions-modal')" class="flex-1 py-2.5 border border-gray-300 rounded-lg text-gray-600 text-sm font-bold hover:bg-gray-50">Ø¥Ù„ØºØ§Ø¡</button>
                <button type="submit" class="flex-1 py-2.5 bg-[#2A3475] text-white rounded-lg text-sm font-bold hover:bg-[#1f2658] shadow-md">Ø­ÙØ¸ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª</button>
            </div>
        </form>
    </div>
</div>

<div id="edit-user-info-modal" class="modal">
    <div class="modal-content" style="width: 95%; max-width: 400px;">
     
     <div class="flex items-center justify-between mb-6 border-b border-gray-100 pb-3">
      <h3 class="text-lg font-bold text-[#2A3475]">ØªØ¹Ø¯ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ø¶Ùˆ</h3>
      <button onclick="closeModal('edit-user-info-modal')" class="text-gray-400 hover:text-red-500"><i class="fas fa-times"></i></button>
     </div>
     
     <form id="edit-user-info-form-2" class="space-y-4">
      <input type="hidden" id="edit-user-id-2">
      
      <div>
          <label class="block text-xs font-bold text-gray-600 mb-1.5">Ø§Ù„Ø§Ø³Ù… Ø¨Ø§Ù„ÙƒØ§Ù…Ù„</label>
          <input type="text" id="edit-user-name-2" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#2A3475] outline-none">
      </div>
      
      <div>
          <label class="block text-xs font-bold text-gray-600 mb-1.5">Ø§Ù„Ù‚Ø³Ù… / Ø§Ù„Ø¬Ù‡Ø©</label>
<select id="edit-user-dept-2" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#2A3475] outline-none">
    <option value="">Ø§Ø®ØªØ± Ø§Ù„Ø¬Ù‡Ø©...</option> 
    <option value="dean">Ù…ÙƒØªØ¨ Ø§Ù„Ø¹Ù…ÙŠØ¯</option>
    <option value="transport-logistics">Ù‚Ø³Ù… Ø¥Ø¯Ø§Ø±Ø© Ù„ÙˆØ¬Ø³ØªÙŠØ§Øª Ø§Ù„Ù†Ù‚Ù„</option>
    <option value="trade-logistics">Ù‚Ø³Ù… Ø¥Ø¯Ø§Ø±Ø© Ù„ÙˆØ¬Ø³ØªÙŠØ§Øª Ø§Ù„ØªØ¬Ø§Ø±Ø© Ø§Ù„Ø¯ÙˆÙ„ÙŠØ©</option>
    <option value="supply-chain">Ù‚Ø³Ù… Ø¥Ø¯Ø§Ø±Ø© Ù„ÙˆØ¬Ø³ØªÙŠØ§Øª Ø³Ù„Ø§Ø³Ù„ Ø§Ù„Ø¥Ù…Ø¯Ø§Ø¯</option>
    <option value="energy-logistics">Ù‚Ø³Ù… Ø¥Ø¯Ø§Ø±Ø© Ù„ÙˆØ¬Ø³ØªÙŠØ§Øª Ø§Ù„Ø·Ø§Ù‚Ø© ÙˆØ§Ù„Ø¨ØªØ±ÙˆÙ„</option>
    <option value="training-agency">ÙˆÙƒØ§Ù„Ø© Ø´Ø¤ÙˆÙ† Ø§Ù„ØªØ¯Ø±ÙŠØ¨ ÙˆØ®Ø¯Ù…Ø© Ø§Ù„Ù…Ø¬ØªÙ…Ø¹</option>
    <option value="postgrad-agency">ÙˆÙƒØ§Ù„Ø© Ø§Ù„Ø¯Ø±Ø§Ø³Ø§Øª Ø§Ù„Ø¹Ù„ÙŠØ§ ÙˆØ§Ù„Ø¨Ø­Ø« Ø§Ù„Ø¹Ù„Ù…ÙŠ</option>
    <option value="education-agency">ÙˆÙƒØ§Ù„Ø© Ø´Ø¤ÙˆÙ† Ø§Ù„ØªØ¹Ù„ÙŠÙ…</option>
    <option value="students-agency">ÙˆÙƒØ§Ù„Ø© Ø´Ø¤ÙˆÙ† Ø§Ù„Ø·Ù„Ø§Ø¨</option>
    <option value="assistants-office">Ù…ÙƒØªØ¨ Ø§Ù„Ù…Ø¹ÙŠØ¯ÙŠÙ†</option>
    <option value="computer-lab">Ù…Ø¹Ù…Ù„ Ø§Ù„Ø­Ø§Ø³Ø¨</option> 
    <option value="visitor">Ø²Ø§Ø¦Ø± Ø®Ø§Ø±Ø¬ÙŠ</option>
</select>
      </div>
      
      <button type="submit" class="w-full bg-[#2A3475] text-white font-bold py-2.5 rounded-lg hover:bg-[#1f2658] transition-colors shadow-md">Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª</button>
     </form>
    </div>
   </div>

   </div><!-- Notification Toast -->
<div id="notification-toast" class="notification-toast" aria-live="polite" role="status">
  <span id="notification-message" class="notification-text"></span>
    </div>
   </div>
  </div>
<div id="notif-menu" class="hidden fixed w-80 bg-white/95 backdrop-blur-md rounded-2xl shadow-[0_20px_50px_rgba(0,0,0,0.15)] border border-gray-100 z-[10001] overflow-hidden transform transition-all duration-300 ease-in-out">
    <div class="px-5 py-4 flex justify-between items-center border-b border-gray-50">
        <div class="flex items-center gap-2">
            <span class="w-2 h-2 bg-[#F3A628] rounded-full animate-pulse"></span>
            <h3 class="text-[#2A3475] font-bold text-sm">Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª</h3>
        </div>
        <button onclick="toggleNotifications()" class="text-gray-400 hover:text-red-500 transition-colors">
            <i class="fas fa-times text-xs"></i>
        </button>
    </div>
    
    <div id="notif-list" class="max-h-[350px] overflow-y-auto custom-scrollbar p-2">
        </div>
    
    <div class="p-3 bg-gray-50/50 border-t border-gray-50 text-center">
        <button onclick="localStorage.setItem('seen_notifications', '[]'); checkUserNotifications();" class="text-[11px] font-medium text-gray-500 hover:text-[#2A3475] transition-colors">
            ØªØ­Ø¯ÙŠØ¯ Ø§Ù„ÙƒÙ„ ÙƒÙ…Ù‚Ø±ÙˆØ¡
        </button>
    </div>
</div>
<div id="global-loader" class="fixed inset-0 z-[99999] hidden items-center justify-center bg-white/60 backdrop-blur-[5px] transition-opacity duration-300 opacity-0">
    <div class="relative bg-white p-6 md:p-10 rounded-[2rem] shadow-2xl flex flex-col items-center justify-center border border-gray-100 transform scale-95 transition-transform duration-300 min-w-[80vw] md:min-w-[400px] gap-0">
        
        <div class="mb-0 -mt-6 md:-mt-10">
            <img src="CITL_Logo.gif" alt="Loading..." class="h-24 md:h-48 w-auto object-contain mix-blend-multiply brightness-110 contrast-110 saturate-110">
        </div>

        <div class="text-center -mt-2 md:-mt-6">
            <h3 class="text-[#2A3475] font-black text-lg md:text-2xl tracking-wide leading-tight">Ø¬Ø§Ø±ÙŠ ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù†Ø¸Ø§Ù…</h3>
            <p id="loader-text" class="text-gray-400 text-xs md:text-sm font-bold mt-1 md:mt-2">ÙŠØªÙ… Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§ØªØŒ ÙŠØ±Ø¬Ù‰ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±...</p>
        </div>
    </div>
</div>

<div id="mobile-menu" class="hidden fixed inset-0 z-[10002] lg:hidden">
    <div class="absolute inset-0 bg-[#2A3475]/60 backdrop-blur-sm transition-opacity" onclick="toggleMobileMenu()"></div>
    
<div id="mobile-menu-content" class="absolute right-0 top-0 bottom-0 w-60 bg-white shadow-2xl transform translate-x-full transition-transform duration-300 flex flex-col">
    
    <div class="metallic-blue-fill p-5 relative overflow-hidden shrink-0 border-b-2 border-[#F3A628]">
        <div class="absolute top-0 left-0 w-24 h-24 bg-white/5 rounded-full -ml-10 -mt-10"></div>
        <div class="flex flex-col items-center text-center gap-3 relative z-10">
            <img src="CITL_Logo.gif" class="h-14 w-auto bg-white p-1 rounded-lg shadow-sm" alt="Logo">
            <div class="flex flex-col gap-1">
                <h1 class="text-white font-black text-[12px] leading-tight drop-shadow-md">ÙƒÙ„ÙŠØ© Ø§Ù„Ù†Ù‚Ù„ Ø§Ù„Ø¯ÙˆÙ„ÙŠ ÙˆØ§Ù„Ù„ÙˆØ¬Ø³ØªÙŠØ§Øª</h1>
                <h2 class="text-[#F3A628] text-[8px] font-bold uppercase opacity-90">College of International Transport & Logistics</h2>
                <p class="text-[9px] text-blue-100/90 font-bold leading-tight">Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ø°ÙƒÙŠ Ù„Ø¥Ø¯Ø§Ø±Ø© Ù‚Ø§Ø¹Ø© Ø§Ø¬ØªÙ…Ø§Ø¹Ø§Øª Ù…Ø¬Ù„Ø³ Ø§Ù„ÙƒÙ„ÙŠØ©</p>
            </div>
        </div>
    </div>

        <div class="flex-1 py-5 px-4 space-y-3 overflow-y-auto custom-scrollbar">
            <button onclick="openAddMeetingModal(); toggleMobileMenu();" class="w-full flex items-center justify-between p-4 rounded-xl bg-orange-50 text-[#d48a1b] font-bold text-sm border border-orange-100 transform active:scale-95 transition-all">
                <div class="flex items-center gap-3">
                    <i class="fas fa-plus-circle text-lg"></i>
                    <span>Ø­Ø¬Ø² Ø§Ø¬ØªÙ…Ø§Ø¹ Ø¬Ø¯ÙŠØ¯</span>
                </div>
                <i class="fas fa-chevron-left text-[10px] opacity-50"></i>
            </button>
            
            <a href="schedules.html" class="w-full flex items-center justify-between p-4 rounded-xl hover:bg-gray-50 text-gray-700 font-bold text-sm transition-colors border border-transparent hover:border-gray-100">
                <div class="flex items-center gap-3">
                    <i class="fas fa-chalkboard text-lg text-[#2A3475]"></i>
                    <span>Ø§Ù„Ù‚Ø§Ø¹Ø§Øª Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠØ©</span>
                </div>
            </a>

            <button onclick="openDashboard(); toggleMobileMenu();" class="w-full flex items-center justify-between p-4 rounded-xl hover:bg-gray-50 text-gray-700 font-bold text-sm transition-colors">
                <div class="flex items-center gap-3">
                    <i class="fas fa-chart-pie text-lg text-[#2A3475]"></i>
                    <span>Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ù†Ø¸Ø§Ù…</span>
                </div>
            </button>

            <button onclick="openAdminPanel(); toggleMobileMenu();" class="w-full flex items-center justify-between p-4 rounded-xl hover:bg-gray-50 text-gray-700 font-bold text-sm transition-colors">
                <div class="flex items-center gap-3">
                    <i class="fas fa-cogs text-lg text-[#2A3475]"></i>
                    <span>Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</span>
                </div>
            </button>

            <div class="border-t border-gray-100 my-4"></div>
            
            <button onclick="logout();" class="w-full flex items-center gap-3 p-4 rounded-xl text-red-600 font-bold text-sm hover:bg-red-50 transition-colors">
                <i class="fas fa-sign-out-alt text-lg"></i>
                <span>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</span>
            </button>
        </div>

<div class="p-4 bg-gray-50 border-t border-gray-100"></div>
    </div>
</div>

<div id="profile-info-menu" class="hidden fixed w-64 bg-white/95 backdrop-blur-md rounded-2xl shadow-[0_20px_50px_rgba(0,0,0,0.15)] border border-gray-100 z-[10001] overflow-hidden transform transition-all duration-300">
    <div class="metallic-blue-fill p-4 border-b border-[#F3A628] relative overflow-hidden">
        <div class="absolute top-0 left-0 w-20 h-20 bg-white/5 rounded-full -ml-10 -mt-10"></div>
        <div class="flex items-center gap-3 relative z-10">
            <div class="w-10 h-10 rounded-full bg-white/10 flex items-center justify-center text-white border border-white/20 shadow-inner">
                <i class="fas fa-user-circle text-xl"></i>
            </div>
            <div class="text-right">
                <p class="text-xs text-blue-200 font-bold">Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø³Ø§Ø¨</p>
                <h4 id="full-profile-name" class="text-white font-black text-sm leading-tight truncate w-40">...</h4>
            </div>
        </div>
    </div>
    <div class="p-4 bg-white">
        <div class="flex items-start gap-3 mb-4">
            <div class="bg-gray-50 p-2 rounded-lg text-[#2A3475]"><i class="fas fa-id-badge text-sm"></i></div>
            <div class="text-right flex-1 min-w-0">
                <p class="text-[10px] text-gray-400 font-bold uppercase tracking-wider">Ø§Ù„Ù…Ø³Ù…Ù‰ Ø§Ù„ÙˆØ¸ÙŠÙÙŠ ÙˆØ§Ù„Ø¬Ù‡Ø©</p>
                <p id="full-profile-role" class="text-xs text-gray-700 font-bold leading-relaxed break-words">...</p>
            </div>
        </div>
        <button onclick="toggleProfileInfoMenu(); openAdminPanel();" class="w-full py-2.5 bg-[#2A3475]/5 text-[#2A3475] rounded-xl text-[11px] font-bold border border-[#2A3475]/10 hover:bg-[#2A3475] hover:text-white transition-all transform active:scale-95 flex items-center justify-center gap-2">
            <i class="fas fa-user-edit"></i> ØªØ¹Ø¯ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§ØªÙŠ
        </button>
    </div>
</div>

  <script>

window.logout = async function() {
    if (typeof supabase !== 'undefined') {
        await supabase.auth.signOut();
    }
    localStorage.clear();
    window.location.href = 'index.html';
};

// --- Ø¯ÙˆØ§Ù„ Ø§Ù„ØªØ­ÙƒÙ… ÙÙŠ Ø´Ø§Ø´Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„ (Unified) ---
window.showLoader = function(text = "Ø¬Ø§Ø±ÙŠ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©...") {
    const loader = document.getElementById('global-loader');
    const textEl = document.getElementById('loader-text');
    
    if(textEl) textEl.textContent = text;

    if(loader) {
        loader.classList.remove('hidden');
        loader.classList.add('flex');
        
        setTimeout(() => {
            loader.classList.remove('opacity-0');
            const inner = loader.querySelector('.relative');
            if(inner) {
                inner.classList.remove('scale-95');
                inner.classList.add('scale-100');
            }
        }, 10);
    }
}; // ğŸ‘ˆ (1) Ø¶ÙÙ†Ø§ ÙØ§ØµÙ„Ø© Ù…Ù†Ù‚ÙˆØ·Ø© Ù‡Ù†Ø§

window.hideLoader = function() {
    const loader = document.getElementById('global-loader');
    if(loader) {
        loader.classList.add('opacity-0');
        const inner = loader.querySelector('.relative');
        if(inner) {
            inner.classList.remove('scale-100');
            inner.classList.add('scale-95');
        }
        
        setTimeout(() => {
            loader.classList.add('hidden');
            loader.classList.remove('flex');
        }, 300);
    }
}; // ğŸ‘ˆ (2) Ø¶ÙÙ†Ø§ ÙØ§ØµÙ„Ø© Ù…Ù†Ù‚ÙˆØ·Ø© Ù‡Ù†Ø§

  // --- Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ (EmailJS) ---
        ;(function(){ // ğŸ‘ˆ (3) Ø¶ÙÙ†Ø§ ÙØ§ØµÙ„Ø© Ù…Ù†Ù‚ÙˆØ·Ø© Ù‚Ø¨Ù„ Ø§Ù„Ù‚ÙˆØ³ Ù„Ù„Ø£Ù…Ø§Ù†
            // âš ï¸ Ø§Ø³ØªØ¨Ø¯Ù„ Ù‡Ø°Ø§ Ø¨Ø§Ù„Ù…ÙØªØ§Ø­ Ø§Ù„Ø¹Ø§Ù… Ø§Ù„Ø®Ø§Øµ Ø¨Ùƒ
            emailjs.init("su_jhKxAtjo-Kr-8w"); 
        })();

        const EMAIL_SERVICE_ID = "service_rpu85xb";   // âš ï¸ Ø§Ø³ØªØ¨Ø¯Ù„ Ø¨Ø§Ù„Ø®Ø¯Ù…Ø©
        const EMAIL_TEMPLATE_ID = "template_v4fabdd"; // âš ï¸ Ø§Ø³ØªØ¨Ø¯Ù„ Ø¨Ø§Ù„Ù‚Ø§Ù„Ø¨

        // Ø¯Ø§Ù„Ø© Ù…Ø³Ø§Ø¹Ø¯Ø© Ù„Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„
        async function sendEmailNotification(toEmail, toName, subject, messageBody) {
            if (!toEmail) return;
            
            const templateParams = {
                to_email: toEmail,
                to_name: toName,
                subject: subject,
                message: messageBody
            };

            try {
                await emailjs.send(EMAIL_SERVICE_ID, EMAIL_TEMPLATE_ID, templateParams);
                console.log('âœ… Email sent to:', toEmail);
            } catch (error) {
                console.error('âŒ Failed to send email:', error);
            }
        }
        
// =======================================================
// 1. Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù€ Supabase
// =======================================================
const SUPABASE_URL = 'https://xgqukdbonzukxrpjovmb.supabase.co';

// Ø§Ù„Ù…ÙØªØ§Ø­ Ø§Ù„Ø¹Ø§Ø¯ÙŠ (Public anon key)
const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InhncXVrZGJvbnp1a3hycGpvdm1iIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjM4OTg4MDMsImV4cCI6MjA3OTQ3NDgwM30.3-70d7uB-zjVF7Jfr8ZjITT7suYPo3EWsYngO-sFVqM';

// âš ï¸ ØªØ­Ø°ÙŠØ± Ø£Ù…Ù†ÙŠ: Service Role Ù„Ø§ ÙŠÙØ³ØªØ®Ø¯Ù… ÙÙŠ Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø£Ù…Ø§Ù…ÙŠØ©
const SUPABASE_SERVICE_ROLE = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InhncXVrZGJvbnp1a3hycGpvdm1iIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc2Mzg5ODgwMywiZXhwIjoyMDc5NDc0ODAzfQ.5scdGp3iWsHq45xpO4K92UuvA3cLm13zl6brA1i87C0';

// =======================================================
// Ø­ÙØ¸ factory Ø§Ù„Ø£ØµÙ„ÙŠ Ù‚Ø¨Ù„ Ø£ÙŠ ØªØ¹Ø¯ÙŠÙ„
// =======================================================
const supabaseFactory = window.supabase;

// =======================================================
// Ø§Ù„Ø¹Ù…ÙŠÙ„ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ (Ù…Ø³ØªØ®Ø¯Ù… Ø¹Ø§Ø¯ÙŠ)
// =======================================================
const sb = supabaseFactory.createClient(SUPABASE_URL, SUPABASE_KEY, {
    auth: {
        storageKey: 'sb-main-auth',
        persistSession: true,
        autoRefreshToken: true,
        detectSessionInUrl: true
    }
});

// =======================================================
// Ø¹Ù…ÙŠÙ„ Ø§Ù„Ø£Ø¯Ù…Ù† (Ø¨Ø¯ÙˆÙ† ØªØ®Ø²ÙŠÙ† â€“ ÙŠÙ…Ù†Ø¹ ØªØ¶Ø§Ø±Ø¨ Ø§Ù„Ø¬Ù„Ø³Ø§Øª)
// =======================================================
const sbAdmin = supabaseFactory.createClient(SUPABASE_URL, SUPABASE_SERVICE_ROLE, {
    auth: {
        persistSession: false,
        autoRefreshToken: false,
        detectSessionInUrl: false
    }
});

// =======================================================
// ğŸ”¥ğŸ”¥ Ø£Ù‡Ù… Ø®Ø·ÙˆØ©: Ø±Ø¨Ø· Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ Ø¨Ø§Ù„Ù†Ø§ÙØ°Ø© (Global Exposure) ğŸ”¥ğŸ”¥
// =======================================================
window.supabase = sb;       // Ø§Ù„Ø¹Ù…ÙŠÙ„ Ø§Ù„Ø¹Ø§Ø¯ÙŠ
window.supabaseAdmin = sbAdmin; // ğŸ‘ˆ Ù‡Ø°Ø§ Ù‡Ùˆ Ø§Ù„Ø³Ø·Ø± Ø§Ù„Ù†Ø§Ù‚Øµ Ø§Ù„Ø°ÙŠ Ø³ÙŠØ­Ù„ Ø§Ù„Ù…Ø´ÙƒÙ„Ø©

// Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø­Ø§Ù„ÙŠ
let currentUser = null;

// 2. Ø¯Ø§Ù„Ø© ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª (Ù…Ø¹Ø¯Ù„Ø© Ù„Ù„Ù‡ÙŠØ¯Ø± Ø§Ù„Ø¬Ø¯ÙŠØ¯)
function applyUserPermissions() {
    if (currentUser) {
    const mobName = document.getElementById('profile-name-mob');
    const mobRole = document.getElementById('profile-role-mob');
    if(mobName) mobName.textContent = currentUser.full_name || 'Ù…Ø³ØªØ®Ø¯Ù…';
    if(mobRole) {
        const deptName = departments[currentUser.department]?.name || currentUser.department;
        mobRole.textContent = `${deptName} - ${currentUser.position || ''}`;
    }
}
    const adminBtn = document.getElementById('admin-panel-btn');
    const logoutBtn = document.getElementById('logout-btn');

    // Ø¹Ù†Ø§ØµØ± Ø§Ù„ÙƒØ¨Ø³ÙˆÙ„Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© (Ø¨Ø¯Ù„Ø§Ù‹ Ù…Ù† user-welcome)
    const profileName = document.getElementById('profile-name');
    const profileRole = document.getElementById('profile-role');

    // 1. Ø¹Ø±Ø¶ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… (Ø§Ù„Ø§Ø³Ù… ÙˆØ§Ù„ÙˆØ¸ÙŠÙØ©) ÙÙŠ Ø§Ù„ÙƒØ¨Ø³ÙˆÙ„Ø©
    if(profileName && typeof currentUser !== 'undefined' && currentUser) {
        // Ø¬Ù„Ø¨ Ø§Ø³Ù… Ø§Ù„Ù‚Ø³Ù…
        const deptName = (typeof departments !== 'undefined' && departments[currentUser.department]) 
                          ? departments[currentUser.department].name 
                          : (currentUser.department || 'Ù…Ø³ØªØ®Ø¯Ù…');
        
        // Ø§Ù„Ù…Ø³Ù…Ù‰ Ø§Ù„ÙˆØ¸ÙŠÙÙŠ
        const userPosition = currentUser.position ? currentUser.position : '';
        
        // ØªØ¹Ø¨Ø¦Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        // Ø§Ù„Ø³Ø·Ø± Ø§Ù„Ø£ÙˆÙ„: Ø§Ù„Ø§Ø³Ù…
        profileName.textContent = `Ù…Ø±Ø­Ø¨Ø§Ù‹ØŒ ${currentUser.full_name || currentUser.email}`;
        
        // Ø§Ù„Ø³Ø·Ø± Ø§Ù„Ø«Ø§Ù†ÙŠ: Ø§Ù„Ù‚Ø³Ù… - Ø§Ù„ÙˆØ¸ÙŠÙØ©
        if(profileRole) {
             profileRole.textContent = `${deptName}${userPosition ? ' - ' + userPosition : ''}`;
        }
    }

    // 2. Ø§Ù„ØªØ­ÙƒÙ… ÙÙŠ Ø²Ø± Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…
    if (adminBtn) {
        // Ø§Ù„Ø²Ø± ÙŠØ¸Ù‡Ø± Ù„Ù„Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¢Ù†
        adminBtn.style.display = 'flex';
        
        // Ù†ØºÙŠØ± Ø§Ù„Ù†Øµ ÙˆØ§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø­Ø³Ø¨ Ø§Ù„Ø¯ÙˆØ±
        const btnText = adminBtn.querySelector('span');
        const btnIcon = adminBtn.querySelector('i');
        
        if (currentUser.role === 'manager') {
            // ğŸ”¥ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨: Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… ğŸ”¥
            if(btnText) btnText.textContent = 'Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…'; 
            if(btnIcon) btnIcon.className = 'fas fa-cogs text-[#F3A628]'; 
            
            // (Ø²Ø± Ø§Ù„Ù…Ø¯ÙŠØ± ÙŠØ¹Ù…Ù„ Ø¨Ø´ÙƒÙ„ Ø§ÙØªØ±Ø§Ø¶ÙŠ Ù„ÙØªØ­ Ø§Ù„Ù…ÙˆØ¯Ø§Ù„)
        } else {
            // Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø¹Ø§Ø¯ÙŠ
            if(btnText) btnText.textContent = 'Ù…Ù„ÙÙŠ Ø§Ù„Ø´Ø®ØµÙŠ';
            if(btnIcon) btnIcon.className = 'fas fa-user-circle text-[#F3A628]';
            
            // ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø²Ø± Ù„ÙØªØ­ Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ Ø¹Ù†Ø¯ Ø§Ù„Ø¶ØºØ·
            adminBtn.onclick = function() { 
                if(typeof openEditUserInfoModal === 'function') openEditUserInfoModal(); 
            };
        }
    }

    // 3. Ø²Ø± Ø§Ù„Ø®Ø±ÙˆØ¬
    if(logoutBtn) {
        const newBtn = logoutBtn.cloneNode(true);
        logoutBtn.parentNode.replaceChild(newBtn, logoutBtn);
        newBtn.addEventListener('click', async () => {
            try { await supabase.auth.signOut(); } catch (e) {}
            localStorage.clear();
            window.location.href = 'index.html';
        });
    }
}

// Global variables
let meetings = [];
let currentWeekStart = new Date();
let selectedMeeting = null;

// Default configuration
const defaultConfig = {
    system_title: "Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ø°ÙƒÙŠ Ù„Ø¥Ø¯Ø§Ø±Ø© Ù‚Ø§Ø¹Ø© Ø§Ø¬ØªÙ…Ø§Ø¹Ø§Øª Ù…Ø¬Ù„Ø³ Ø§Ù„ÙƒÙ„ÙŠØ©",
    college_name: "ÙƒÙ„ÙŠØ© Ø§Ù„Ù†Ù‚Ù„ Ø§Ù„Ø¯ÙˆÙ„ÙŠ ÙˆØ§Ù„Ù„ÙˆØ¬Ø³ØªÙŠØ§Øª",
    room_name: "Ù‚Ø§Ø¹Ø© Ø§Ø¬ØªÙ…Ø§Ø¹Ø§Øª Ù…Ø¬Ù„Ø³ Ø§Ù„ÙƒÙ„ÙŠØ©"
};

        // Department configurations
const departments = {
            // ================================
            // 1. Ø§Ù„Ø£ÙƒÙˆØ§Ø¯ Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© (Ø§Ù„ØªÙŠ Ø³ØªØ¸Ù‡Ø± ÙÙŠ Ø§Ù„Ù‚ÙˆØ§Ø¦Ù…)
            // ================================
            'dean': { name: 'Ù…ÙƒØªØ¨ Ø§Ù„Ø¹Ù…ÙŠØ¯', priority: 1, color: 'dean-priority' },
            
            'transport-logistics': { name: 'Ù‚Ø³Ù… Ø¥Ø¯Ø§Ø±Ø© Ù„ÙˆØ¬Ø³ØªÙŠØ§Øª Ø§Ù„Ù†Ù‚Ù„', priority: 3, color: 'department-priority' },
            'trade-logistics': { name: 'Ù‚Ø³Ù… Ø¥Ø¯Ø§Ø±Ø© Ù„ÙˆØ¬Ø³ØªÙŠØ§Øª Ø§Ù„ØªØ¬Ø§Ø±Ø© Ø§Ù„Ø¯ÙˆÙ„ÙŠØ©', priority: 3, color: 'department-priority' },
            'supply-chain': { name: 'Ù‚Ø³Ù… Ø¥Ø¯Ø§Ø±Ø© Ù„ÙˆØ¬Ø³ØªÙŠØ§Øª Ø³Ù„Ø§Ø³Ù„ Ø§Ù„Ø¥Ù…Ø¯Ø§Ø¯', priority: 3, color: 'department-priority' },
            'energy-logistics': { name: 'Ù‚Ø³Ù… Ø¥Ø¯Ø§Ø±Ø© Ù„ÙˆØ¬Ø³ØªÙŠØ§Øª Ø§Ù„Ø·Ø§Ù‚Ø© ÙˆØ§Ù„Ø¨ØªØ±ÙˆÙ„', priority: 3, color: 'department-priority' },
            'admin-followup': { name: 'Ù‚Ø³Ù… Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±ÙŠØ©', priority: 3, color: 'department-priority' },

            'training-agency': { name: 'ÙˆÙƒØ§Ù„Ø© Ø´Ø¤ÙˆÙ† Ø§Ù„ØªØ¯Ø±ÙŠØ¨ ÙˆØ®Ø¯Ù…Ø© Ø§Ù„Ù…Ø¬ØªÙ…Ø¹', priority: 2, color: 'vice-dean-priority' },
            'postgrad-agency': { name: 'ÙˆÙƒØ§Ù„Ø© Ø§Ù„Ø¯Ø±Ø§Ø³Ø§Øª Ø§Ù„Ø¹Ù„ÙŠØ§ ÙˆØ§Ù„Ø¨Ø­Ø« Ø§Ù„Ø¹Ù„Ù…ÙŠ', priority: 2, color: 'vice-dean-priority' },
            'education-agency': { name: 'ÙˆÙƒØ§Ù„Ø© Ø´Ø¤ÙˆÙ† Ø§Ù„ØªØ¹Ù„ÙŠÙ…', priority: 2, color: 'vice-dean-priority' },
            'students-agency': { name: 'ÙˆÙƒØ§Ù„Ø© Ø´Ø¤ÙˆÙ† Ø§Ù„Ø·Ù„Ø§Ø¨', priority: 2, color: 'vice-dean-priority' },

            'assistants-office': { name: 'Ù…ÙƒØªØ¨ Ø§Ù„Ù…Ø¹ÙŠØ¯ÙŠÙ†', priority: 4, color: 'assistant-priority' },
            'visitor': { name: 'Ø²Ø§Ø¦Ø± Ø®Ø§Ø±Ø¬ÙŠ', priority: 5, color: 'bg-gray-500 text-white' },
            'computer-lab': { name: 'Ù…Ø¹Ù…Ù„ Ø§Ù„Ø­Ø§Ø³Ø¨', priority: 3, color: 'department-priority' },

            // ================================
            // 2. Ø§Ù„Ø£ÙƒÙˆØ§Ø¯ Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø© (Legacy Support)
            // (Ù‡Ø§Ù…Ø© Ø¬Ø¯Ø§Ù‹ Ù„Ù…Ù†Ø¹ Ø§Ù„Ø®Ø·Ø£ - Ù„Ø§ ØªØ­Ø°ÙÙ‡Ø§ Ø­ØªÙ‰ Ù„Ùˆ Ù„Ù… ØªØ³ØªØ®Ø¯Ù…Ù‡Ø§)
            // ================================
            'vice-dean-academic': { name: 'ÙˆÙƒØ§Ù„Ø© Ø´Ø¤ÙˆÙ† Ø§Ù„ØªØ¹Ù„ÙŠÙ… (Ø³Ø§Ø¨Ù‚Ø§Ù‹)', priority: 2, color: 'vice-dean-priority' },
            'vice-dean-graduate': { name: 'ÙˆÙƒØ§Ù„Ø© Ø§Ù„Ø¯Ø±Ø§Ø³Ø§Øª Ø§Ù„Ø¹Ù„ÙŠØ§ (Ø³Ø§Ø¨Ù‚Ø§Ù‹)', priority: 2, color: 'vice-dean-priority' },
            'vice-dean-community': { name: 'ÙˆÙƒØ§Ù„Ø© Ø®Ø¯Ù…Ø© Ø§Ù„Ù…Ø¬ØªÙ…Ø¹ (Ø³Ø§Ø¨Ù‚Ø§Ù‹)', priority: 2, color: 'vice-dean-priority' },
            'vice-dean-development': { name: 'ÙˆÙƒØ§Ù„Ø© Ø§Ù„ØªØ·ÙˆÙŠØ± (Ø³Ø§Ø¨Ù‚Ø§Ù‹)', priority: 2, color: 'vice-dean-priority' },
            'logistics-dept': { name: 'Ù‚Ø³Ù… Ø§Ù„Ù„ÙˆØ¬Ø³ØªÙŠØ§Øª (Ø³Ø§Ø¨Ù‚Ø§Ù‹)', priority: 3, color: 'department-priority' },
            'transport-dept': { name: 'Ù‚Ø³Ù… Ø§Ù„Ù†Ù‚Ù„ (Ø³Ø§Ø¨Ù‚Ø§Ù‹)', priority: 3, color: 'department-priority' },
            'supply-dept': { name: 'Ù‚Ø³Ù… Ø³Ù„Ø§Ø³Ù„ Ø§Ù„Ø¥Ù…Ø¯Ø§Ø¯ (Ø³Ø§Ø¨Ù‚Ø§Ù‹)', priority: 3, color: 'department-priority' },
            'business-dept': { name: 'Ù‚Ø³Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ø¹Ù…Ø§Ù„ (Ø³Ø§Ø¨Ù‚Ø§Ù‹)', priority: 3, color: 'department-priority' },
            'assistant': { name: 'Ù…Ø¹ÙŠØ¯ (Ø³Ø§Ø¨Ù‚Ø§Ù‹)', priority: 4, color: 'assistant-priority' }
        };

// ØªØ¹Ø±ÙŠÙ Ø§Ù„Ù…ØµÙÙˆÙØ© ÙØ§Ø±ØºØ© (Ø³ÙŠØªÙ… Ù…Ù„Ø¤Ù‡Ø§ Ù…Ù† Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª)
        let timeSlots = [];

        // Local storage functions
        function saveMeetings() {
            localStorage.setItem('meetings', JSON.stringify(meetings));
        }

function refreshAllViews() {
    renderCalendar();
    updateDashboard();
    
    // ØªØ´ØºÙŠÙ„ Ø§Ù„Ù€ Skeleton
    showDashboardSkeleton();

    // ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø°ÙƒÙŠ
    setTimeout(() => {
        generateAISuggestions();
    }, 600);
    
    // ØªØ­Ø¯ÙŠØ« Ù„ÙˆØ­Ø§Øª Ø§Ù„Ø£Ø¯Ù…Ù†
    try { 
        updateAdminMeetingsList(); 
        updateAdminReports();
        if(typeof updateActivityLogs === 'function') updateActivityLogs(); 
    } catch(e) {}

    // ğŸ”¥ğŸ”¥ğŸ”¥ Ø§Ù„Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©: ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ù…Ø¹ ÙƒÙ„ Ø±ÙŠÙØ±ÙŠØ´ ğŸ”¥ğŸ”¥ğŸ”¥
    checkUserNotifications();
}

async function loadMeetings() {
            try {
                // Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ 1: Ø·Ù„Ø¨Ù†Ø§ (email) Ù…Ø¹ (full_name) ÙÙŠ Ø§Ù„Ø§Ø³ØªØ¹Ù„Ø§Ù…
                const { data, error } = await supabase
                    .from('meetings')
                    .select('*, profiles(full_name, email)'); 
                
                if (error) throw error;

                meetings = data.map(m => {
                    // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø§Ù„Ù‚Ø³Ù… (ÙƒÙˆØ¯ Ø§Ù„Ø£Ù…Ø§Ù† Ø§Ù„Ù‚Ø¯ÙŠÙ…)
                    const deptInfo = departments[m.department] || { 
                        name: 'Ù‚Ø³Ù… ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ', 
                        priority: 5, 
                        color: 'bg-gray-400 text-white' 
                    };

                    // Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ 2: Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„ Ø¨Ø´ÙƒÙ„ Ø¢Ù…Ù† (Ù„Ùˆ Ù…Ø´ Ù…ÙˆØ¬ÙˆØ¯ ÙŠØ¨Ù‚Ù‰ null)
                    const creatorEmail = (m.profiles && m.profiles.email) ? m.profiles.email : null;

                    return {
                        ...m,
                        startTime: m.start_time.slice(0, 5),
                        endTime: m.end_time.slice(0, 5),
                        createdAt: m.created_at,
                        // Ø§Ù„Ø§Ø³Ù…: Ù„Ùˆ Ù…ÙˆØ¬ÙˆØ¯ ÙÙŠ Ø§Ù„Ø¨Ø±ÙˆÙØ§ÙŠÙ„ Ù‡Ø§ØªÙ‡ØŒ Ù„Ùˆ Ù„Ø£ Ù‡Ø§Øª Ø§Ø³Ù… Ø§Ù„Ù‚Ø³Ù…
                        createdBy: (m.profiles && m.profiles.full_name) ? m.profiles.full_name : deptInfo.name,
                        creatorEmail: creatorEmail, // Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ 3: ØªØ®Ø²ÙŠÙ† Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„ Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…Ù‡ Ù„Ø§Ø­Ù‚Ø§Ù‹
                        priority: deptInfo.priority 
                    };
                });
                
                refreshAllViews();
                
            } catch (error) {
                console.error('Error:', error);
                
                // ÙƒÙˆØ¯ Ø§Ù„Ø£Ù…Ø§Ù† (Fallback): Ù„Ùˆ ÙØ´Ù„ Ø§Ù„Ø±Ø¨Ø·ØŒ Ù‡Ø§Øª Ø§Ù„Ø§Ø¬ØªÙ…Ø§Ø¹Ø§Øª Ø¨Ø³ Ø¹Ø´Ø§Ù† Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ù…ÙŠÙˆÙ‚ÙØ´
                if (error.code === 'PGRST200') {
                     const { data: retryData } = await supabase.from('meetings').select('*');
                     if (retryData) {
                        meetings = retryData.map(m => {
                            // Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„Ù‚Ø³Ù… ÙÙŠ Ø­Ø§Ù„Ø© Ø§Ù„Ø®Ø·Ø£ Ø£ÙŠØ¶Ø§Ù‹
                            const deptInfo = departments[m.department] || { name: 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ' };
                            return {
                                ...m,
                                startTime: m.start_time.slice(0, 5),
                                endTime: m.end_time.slice(0, 5),
                                createdAt: m.created_at,
                                createdBy: deptInfo.name,
                                creatorEmail: null, // ÙÙŠ Ø­Ø§Ù„Ø© Ø§Ù„Ø®Ø·Ø£ Ù…ÙÙŠØ´ Ø¥ÙŠÙ…ÙŠÙ„
                                priority: 3
                            };
                        });
                        refreshAllViews();
                     }
                }
            }
        }

// --- Ø¯Ø§Ù„Ø© Ø§Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ (Realtime) - Ù…Ø¹Ø¯Ù„Ø© Ù„Ù„Ø±ÙØ¶ ---
function setupRealtimeSubscription() {
    const channel = supabase.channel('public:meetings');
    
    channel
        .on('postgres_changes', { event: '*', schema: 'public', table: 'meetings' }, async (payload) => {
            console.log('âš¡ ØªØ­Ø¯ÙŠØ« ÙÙˆØ±ÙŠ:', payload);
            
            // 1. ÙØ­Øµ Ø®Ø§Øµ Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ø±ÙØ¶ Ù„Ø¥Ø¸Ù‡Ø§Ø± ØªÙ†Ø¨ÙŠÙ‡ ÙÙˆØ±ÙŠ
            if (payload.eventType === 'UPDATE' && payload.new.pending_changes && payload.new.pending_changes.rejected === true) {
                // Ù†Ù…Ø³Ø­ Ø§Ù„Ù€ ID Ù…Ù† Ø§Ù„Ø°Ø§ÙƒØ±Ø© Ù„ÙŠØ¸Ù‡Ø± Ø§Ù„Ø¥Ø´Ø¹Ø§Ø± ÙÙŠ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©
                let seenIds = JSON.parse(localStorage.getItem('seen_notifications') || '[]');
                seenIds = seenIds.filter(id => id !== payload.new.id);
                localStorage.setItem('seen_notifications', JSON.stringify(seenIds));
                
                // ØªÙ†Ø¨ÙŠÙ‡ Ù…Ù†Ø¨Ø«Ù‚ (Toast) Ù„ØµØ§Ø­Ø¨ Ø§Ù„Ø­Ø¬Ø²
                if (currentUser && payload.new.user_id === currentUser.id) {
                    showNotification(`âŒ ØªÙ… Ø±ÙØ¶ ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø­Ø¬Ø²: ${payload.new.title}`, 'error');
                }
            }

            // 2. Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
            await loadMeetings();
            
            // 3. Ø¨Ø§Ù‚ÙŠ Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª
            if (payload.eventType === 'INSERT') {
                if (currentUser.role === 'manager' && payload.new.status === 'pending') {
                    showNotification(`ğŸ“… Ø·Ù„Ø¨ Ø­Ø¬Ø² Ø¬Ø¯ÙŠØ¯: ${payload.new.title}`, 'info');
                }
            }
            else if (payload.eventType === 'UPDATE') {
                // Ù…ÙˆØ§ÙÙ‚Ø© Ø¹Ø§Ø¯ÙŠØ©
                if (payload.new.status === 'confirmed' && !payload.new.pending_changes && payload.new.user_id === currentUser.id) {
                    showNotification(`ğŸ‰ Ù…Ø¨Ø±ÙˆÙƒ! ØªÙ…Øª Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø© Ø¹Ù„Ù‰ Ø­Ø¬Ø²Ùƒ: ${payload.new.title}`, 'success');
                }
                // Ø·Ù„Ø¨Ø§Øª Ù„Ù„Ù…Ø¯ÙŠØ±
                else if (currentUser.role === 'manager' && (payload.new.status === 'modification_requested' || payload.new.status === 'cancellation_requested')) {
                    showNotification(`ğŸ“ ÙŠÙˆØ¬Ø¯ Ø·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯ ÙŠØ­ØªØ§Ø¬ Ù…Ø±Ø§Ø¬Ø¹Ø©`, 'info');
                }
            }
            
            // 4. ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©
            checkUserNotifications();
        })
        .subscribe();
}

// --- 1. Ø¯Ø§Ù„Ø© Ø§Ù„Ø¨Ø¯Ø¡ ÙˆØ§Ù„Ø­Ù…Ø§ÙŠØ© (Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„ÙƒØ§Ù…Ù„Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©) ---
async function initializeApp() {
    try {
        // ---------------------------------------------------------
        // Ø£. ÙƒÙˆØ¯ Ø§Ù„Ø­Ù…Ø§ÙŠØ© ÙˆØ§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
        // ---------------------------------------------------------
        const savedUser = localStorage.getItem('currentUser');
        const sessionToken = localStorage.getItem('sessionToken');

        // Ù„Ùˆ Ù…ÙÙŠØ´ Ø¨ÙŠØ§Ù†Ø§Øª Ø¯Ø®ÙˆÙ„ØŒ Ø§Ø·Ø±Ø¯Ù‡ ÙÙˆØ±Ø§Ù‹ Ù„ØµÙØ­Ø© Ø§Ù„Ø¯Ø®ÙˆÙ„
        if (!savedUser || !sessionToken) {
            window.location.href = 'index.html';
            return; 
        }

        // ÙÙƒ ØªØ´ÙÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        currentUser = JSON.parse(savedUser);

        // ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª ÙˆØªØ­Ø¯ÙŠØ« Ø§Ù„Ù‡ÙŠØ¯Ø±
        if (typeof applyUserPermissions === 'function') {
            applyUserPermissions();
        }

        // ğŸ”¥ğŸ”¥ğŸ”¥ Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„ØªØ¹Ø¯ÙŠÙ„: ØªØ´ØºÙŠÙ„ Ø§Ù„Ù„ÙˆØ¯Ø± Ø§Ù„Ø´Ø§Ù…Ù„ ğŸ”¥ğŸ”¥ğŸ”¥
        showLoader('Ø¬Ø§Ø±ÙŠ ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù†Ø¸Ø§Ù…...');

        // ---------------------------------------------------------
        // ğŸ”¥ ØªØ´ØºÙŠÙ„ Ø´Ø§Ø´Ø© Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø± (Skeleton) ÙÙˆØ±Ø§Ù‹ (Ø®Ù„ÙÙŠØ© Ù„Ù„ÙˆØ¯Ø±)
        // ---------------------------------------------------------
        if (typeof renderSkeletonLoading === 'function') {
            renderSkeletonLoading(); 
        }

        // ---------------------------------------------------------
        // Ø¨. ÙƒÙˆØ¯ Element SDK
        // ---------------------------------------------------------
        if (window.elementSdk) {
            await window.elementSdk.init({
                defaultConfig,
                onConfigChange: async (config) => {
                    const sysTitle = document.getElementById('system-title');
                    const colName = document.getElementById('college-name');
                    const roomNameElement = document.getElementById('room-name');

                    if(sysTitle) sysTitle.textContent = config.system_title || defaultConfig.system_title;
                    if(colName) colName.textContent = config.college_name || defaultConfig.college_name;
                    if(roomNameElement) roomNameElement.textContent = config.room_name || defaultConfig.room_name;
                },
                mapToCapabilities: (config) => ({
                    recolorables: [],
                    borderables: [],
                    fontEditable: undefined,
                    fontSizeable: undefined
                }),
                mapToEditPanelValues: (config) => new Map([
                    ["system_title", config.system_title || defaultConfig.system_title],
                    ["college_name", config.college_name || defaultConfig.college_name],
                    ["room_name", config.room_name || defaultConfig.room_name]
                ])
            });
        }
        
        // ---------------------------------------------------------
        // Ø¬. ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ø§Ù„ØªØ±ØªÙŠØ¨ Ø§Ù„ØµØ­ÙŠØ­
        // ---------------------------------------------------------
        
        // 1. ØªØ­Ù…ÙŠÙ„ Ø³Ø§Ø¹Ø§Øª Ø§Ù„Ø¹Ù…Ù„ Ø£ÙˆÙ„Ø§Ù‹
        await loadSystemSettings(); 

        // 2. ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª Ù…Ù† Ø§Ù„Ø³ÙŠØ±ÙØ±
        await loadMeetings();
        
        // 3. ØªØ´ØºÙŠÙ„ Ø§Ù„Ø¬Ø¯ÙˆÙ„ ÙˆØ§Ù„ÙˆØ§Ø¬Ù‡Ø©
        initializeCalendar();
        setupEventListeners();
        populateTimeSlots();
        setupCustomDropdowns();
        
        // ğŸ”¥ğŸ”¥ Ù‡Ø§Ù… Ø¬Ø¯Ø§Ù‹: ÙØ­Øµ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª ÙÙˆØ± ÙØªØ­ Ø§Ù„Ù…ÙˆÙ‚Ø¹ ğŸ”¥ğŸ”¥
        if (typeof checkUserNotifications === 'function') {
            checkUserNotifications();
        }

        // 4. ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ©
        if (typeof updateSidebarProfile === 'function') {
            updateSidebarProfile();
        }

        // ---------------------------------------------------------
        // ğŸ”¥ ØªØ´ØºÙŠÙ„ Ø§Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ (Realtime)
        // ---------------------------------------------------------
        if (typeof setupRealtimeSubscription === 'function') {
            setupRealtimeSubscription();
        }
        
        // ğŸ”¥ğŸ”¥ğŸ”¥ Ù†Ù‡Ø§ÙŠØ© Ø§Ù„ØªØ¹Ø¯ÙŠÙ„: Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ù„ÙˆØ¯Ø± Ø¨Ø¹Ø¯ Ø§ÙƒØªÙ…Ø§Ù„ Ø§Ù„ØªØ­Ù…ÙŠÙ„ ğŸ”¥ğŸ”¥ğŸ”¥
        hideLoader();

    } catch (error) {
        console.error("Error initializing app:", error);
        // ÙÙŠ Ø­Ø§Ù„Ø© Ø§Ù„Ø®Ø·Ø£ Ù†Ø®ÙÙŠ Ø§Ù„Ù„ÙˆØ¯Ø± Ø­ØªÙ‰ Ù„Ø§ ÙŠØ¹Ù„Ù‚ Ø§Ù„Ù†Ø¸Ø§Ù…
        hideLoader();
    }
}

        // Initialize calendar
        function initializeCalendar() {
            const today = new Date();
            const dayOfWeek = today.getDay();
            const diff = today.getDate() - dayOfWeek + (dayOfWeek === 0 ? -6 : 1);
            currentWeekStart = new Date(today.setDate(diff));
            updateWeekDisplay();
            renderCalendar();
        }

// ğŸ”¥ Ø¯Ø§Ù„Ø© ØªØ­Ø¯ÙŠØ« Ø´Ø±ÙŠØ· Ø§Ù„ØªØ§Ø±ÙŠØ® ÙˆØ§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù†Ø³Ø¯Ù„Ø©
function updateWeekDisplay() {
    const weekEnd = new Date(currentWeekStart);
    weekEnd.setDate(weekEnd.getDate() + 6);
    
    const options = { year: 'numeric', month: 'long', day: 'numeric' };
    const startStr = currentWeekStart.toLocaleDateString('ar-EG', options);
    const endStr = weekEnd.toLocaleDateString('ar-EG', options);
    
    const weekDisplaySpan = document.getElementById('current-week');
    
    // ğŸ”¥ Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ù€ Skeleton ÙˆØ¥Ø¸Ù‡Ø§Ø± Ø§Ù„ØªØ§Ø±ÙŠØ®
    if(weekDisplaySpan) {
        weekDisplaySpan.textContent = `${startStr} - ${endStr}`;
        // Ø¥Ø²Ø§Ù„Ø© ÙƒÙ„Ø§Ø³Ø§Øª Ø§Ù„Ù€ Skeleton Ø¨Ù…Ø¬Ø±Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        weekDisplaySpan.classList.remove('animate-pulse', 'bg-gray-200', 'h-6');
        weekDisplaySpan.style.minWidth = 'auto';
    }

    // ğŸ”¥ ØªØ¹Ø¨Ø¦Ø© Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù†Ø³Ø¯Ù„Ø©
    const dropdownOptions = document.getElementById('week-dropdown-options');
    if (!dropdownOptions) return;
    
    dropdownOptions.innerHTML = '';
    
    // Ù†Ù†Ø´Ø¦ Ø®ÙŠØ§Ø±Ø§Øª Ù„Ù„Ø£Ø³Ø§Ø¨ÙŠØ¹ (Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ Ø§Ù„Ø­Ø§Ù„ÙŠØŒ 3 Ø£Ø³Ø§Ø¨ÙŠØ¹ Ø³Ø§Ø¨Ù‚Ø©ØŒ 3 Ø£Ø³Ø§Ø¨ÙŠØ¹ Ù‚Ø§Ø¯Ù…Ø©)
    for (let i = -3; i <= 3; i++) {
        const weekDate = new Date(currentWeekStart);
        weekDate.setDate(currentWeekStart.getDate() + (i * 7));
        
        const weekEndDisplay = new Date(weekDate);
        weekEndDisplay.setDate(weekEndDisplay.getDate() + 6);
        
        const startText = weekDate.toLocaleDateString('ar-EG', { month: 'short', day: 'numeric' });
        const endText = weekEndDisplay.toLocaleDateString('ar-EG', { month: 'short', day: 'numeric' });
        
        const isCurrent = i === 0;
        const text = isCurrent ? `Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ Ø§Ù„Ø­Ø§Ù„ÙŠ: ${startText} - ${endText}` : `${startText} - ${endText}`;
        const value = weekDate.toISOString(); // Ù†Ø­ÙØ¸ Ø§Ù„ØªØ§Ø±ÙŠØ® ÙƒÙ€ ISO string

        dropdownOptions.innerHTML += `
            <li class="custom-option px-4 py-2.5 hover:bg-[#2A3475] hover:text-white cursor-pointer text-sm font-bold border-b border-gray-50 transition-all ${isCurrent ? 'bg-[#2A3475] text-white selected' : 'text-gray-700'}" 
                data-value="${value}" 
                onclick="jumpToWeek('${value}')">
                ${text}
            </li>
        `;
    }
}

        // Render calendar
function renderCalendar() {
    const container = document.getElementById('calendar-container');
    if (!container) return; // Ø­Ù…Ø§ÙŠØ© Ù„Ù„ØªØ£ÙƒØ¯ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø§Ù„Ø­Ø§ÙˆÙŠØ©
    container.innerHTML = '';

    // 1. ØªØµÙ…ÙŠÙ… Ø±Ø£Ø³ Ø§Ù„Ø¬Ø¯ÙˆÙ„ (Ø§Ù„Ø£ÙŠØ§Ù…)
    const dayNames = ['Ø§Ù„Ø£Ø­Ø¯', 'Ø§Ù„Ø§Ø«Ù†ÙŠÙ†', 'Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡', 'Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡', 'Ø§Ù„Ø®Ù…ÙŠØ³', 'Ø§Ù„Ø¬Ù…Ø¹Ø©', 'Ø§Ù„Ø³Ø¨Øª'];
    
    for (let i = 0; i <= 7; i++) {
        const cell = document.createElement('div');
        
        if (i === 0) {
             // === Ø®Ø§Ù†Ø© Ø§Ù„ÙˆÙ‚Øª (Ø§Ù„Ø±Ø£Ø³) ===
             cell.className = 'time-slot sticky right-0 z-20 bg-gray-100 text-[#2A3475] font-extrabold text-xs flex items-center justify-center border-b-2 border-[#F3A628] shadow-[2px_0_5px_rgba(0,0,0,0.05)]';
             cell.textContent = 'Ø§Ù„ÙˆÙ‚Øª';
        } else {
             // === Ø®Ø§Ù†Ø§Øª Ø§Ù„Ø£ÙŠØ§Ù… (Ø§Ù„Ø±Ø£Ø³) ===
             const dayIndex = i - 1;
             const dateObj = new Date(currentWeekStart);
             dateObj.setDate(currentWeekStart.getDate() + dayIndex);
             const dateStr = dateObj.toLocaleDateString('ar-EG', { day: 'numeric', month: 'numeric' });

cell.className = 'time-slot metallic-blue-fill random-slanted-lines text-white font-bold flex flex-col items-center justify-center tracking-wide border-l border-blue-800 py-1';             cell.innerHTML = `
                <span class="text-xs md:text-sm font-extrabold mb-0.5">${dayNames[dayIndex]}</span>
                <span class="text-[9px] md:text-xs text-[#F3A628] font-bold bg-white/10 px-2 py-0.5 rounded-full border border-[#F3A628]/20">${dateStr}</span>
             `;
        }
        container.appendChild(cell);
    }

    // 2. Ø¬Ø³Ù… Ø§Ù„Ø¬Ø¯ÙˆÙ„ (Ø§Ù„Ø³Ø§Ø¹Ø§Øª ÙˆØ§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯)
    timeSlots.forEach(time => {
        // Ø¹Ù…ÙˆØ¯ Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠ
        const timeLabel = document.createElement('div');
        timeLabel.className = 'time-slot sticky right-0 z-20 bg-gray-50 flex items-center justify-center font-bold text-[#2A3475] border-b border-gray-200 text-xs md:text-sm shadow-[2px_0_5px_rgba(0,0,0,0.05)]';
        timeLabel.textContent = toArabicNum(time); // Ø¹Ø±Ø¶ Ø§Ù„ÙˆÙ‚Øª Ø¨Ø§Ù„Ø£Ø±Ù‚Ø§Ù… Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©
        container.appendChild(timeLabel);

        for (let day = 0; day < 7; day++) {
            const cell = document.createElement('div');
            cell.className = 'time-slot relative border-b border-l border-gray-100 cursor-pointer transition-all duration-200 hover:bg-blue-50 hover:shadow-inner group min-h-[70px]';
            
            const currentDate = new Date(currentWeekStart);
            currentDate.setDate(currentWeekStart.getDate() + day);
            
            // Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ 1: Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª Ø§Ù„Ù…Ø¤ÙƒØ¯Ø© (confirmed) ÙÙ‚Ø· Ù„ØªØ¸Ù‡Ø± ÙÙŠ Ø§Ù„Ø¬Ø¯ÙˆÙ„
            const meeting = meetings.find(m => {
                const meetingDate = new Date(m.date);
                return meetingDate.toDateString() === currentDate.toDateString() && 
                       m.startTime === time && 
                       m.status === 'confirmed'; 
            });

            if (meeting) {
                const meetingBlock = document.createElement('div');
                meetingBlock.className = `meeting-block ${departments[meeting.department].color} shadow-md rounded border-r-4 border-black/20 hover:scale-[1.02] transition-transform z-10 h-[calc(100%-8px)] m-1`;
                
                // Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ 2: Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¬Ù‡Ø© Ø§Ù„Ø­Ø§Ø¬Ø²Ø© ÙˆØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ù„ÙŠÙƒÙˆÙ† Ù…ØªØ¬Ø§ÙˆØ¨Ø§Ù‹ Ù…Ø¹ Ø§Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„ ÙˆØ§Ù„ÙƒÙ…Ø¨ÙŠÙˆØªØ±
                meetingBlock.innerHTML = `
                    <div class="p-1 md:p-1.5 h-full flex flex-col justify-between overflow-hidden text-white">
                        <div class="flex flex-col gap-0.5">
                            <p class="text-[9px] md:text-[11px] font-black leading-tight truncate text-right">
                                ${meeting.title}
                            </p>
                            <p class="text-[7px] md:text-[9px] font-bold opacity-90 truncate text-right flex items-center justify-start gap-1">
                                <i class="fas fa-building text-[6px] md:text-[8px] opacity-70"></i>
                                <span>${departments[meeting.department].name}</span>
                            </p>
                        </div>
                        
                        <div class="flex items-center justify-between mt-0.5 border-t border-white/20 pt-0.5">
                            <span class="text-[8px] md:text-[10px] font-bold opacity-90 whitespace-nowrap">
                                ${toArabicNum(meeting.startTime)}
                            </span>
                            <i class="fas fa-bookmark text-[7px] md:text-[9px] opacity-60"></i>
                        </div>
                    </div>
                `;
                
                meetingBlock.addEventListener('click', (e) => {
                    e.stopPropagation();
                    showMeetingDetails(meeting);
                });
                cell.appendChild(meetingBlock);
            } else {
                const addIcon = document.createElement('div');
                addIcon.className = 'absolute inset-0 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none';
                addIcon.innerHTML = '<i class="fas fa-plus text-[#F3A628] text-xl opacity-50"></i>';
                cell.appendChild(addIcon);

                cell.addEventListener('click', () => openAddMeetingModal(currentDate, time));
            }
            container.appendChild(cell);
        }
    });

    // 3. ÙØ­Øµ Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª Ø§Ù„Ù…Ø®ÙÙŠØ©
    if (typeof checkHiddenMeetings === 'function') {
        setTimeout(checkHiddenMeetings, 100);
    }
}

// Populate time slots (Ù…Ø¹Ø¯Ù„Ø© Ù„Ø¯Ø¹Ù… Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø§Ø­ØªØ±Ø§ÙÙŠØ©)
        function populateTimeSlots() {
            const select = document.getElementById('meeting-time');
            const ulOptions = document.getElementById('meeting-time-options'); // Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
            
            if(select) select.innerHTML = '<option value="">Ø§Ø®ØªØ± Ø§Ù„ÙˆÙ‚Øª</option>';
            if(ulOptions) ulOptions.innerHTML = '<li class="custom-option px-4 py-2.5 hover:bg-blue-50 cursor-pointer text-sm text-gray-700 border-b border-gray-50" data-value="">Ø§Ø®ØªØ± Ø§Ù„ÙˆÙ‚Øª</li>';
            
            timeSlots.forEach(time => {
                // Ù…Ù„Ø¡ Ø§Ù„Ù€ Select Ø§Ù„Ù…Ø®ÙÙŠ (Ø¹Ø´Ø§Ù† Ø§Ù„ÙÙˆØ±Ù… ÙŠØ´ØªØºÙ„)
                const option = document.createElement('option');
                option.value = time;
                option.textContent = time;
                if(select) select.appendChild(option);

                // Ù…Ù„Ø¡ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¸Ø§Ù‡Ø±Ø© (Ø¹Ø´Ø§Ù† Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙŠØ´ÙˆÙÙ‡Ø§)
                if(ulOptions) {
                    const li = document.createElement('li');
                    li.className = 'custom-option px-4 py-2.5 hover:bg-blue-50 cursor-pointer text-sm text-gray-700 border-b border-gray-50 font-bold';
                    li.dataset.value = time;
                    li.textContent = time;
                    ulOptions.appendChild(li);
                }
            });

            // Ø¥Ø¹Ø§Ø¯Ø© ØªØ´ØºÙŠÙ„ Ù…Ø³ØªÙ…Ø¹ÙŠ Ø§Ù„Ø£Ø­Ø¯Ø§Ø« Ù„Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
            if(typeof setupCustomDropdowns === 'function') setupCustomDropdowns();
        }

        // --- Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù… (System Settings) ---

        // 1. ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ù…Ù† Ø§Ù„Ø³ÙŠØ±ÙØ±
        async function loadSystemSettings() {
            try {
                const { data, error } = await supabase.from('settings').select('*').single();
                
                let start = 8;
                let end = 18;

                if (!error && data) {
                    start = data.start_hour;
                    end = data.end_hour;
                    
                    // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù‚ÙŠÙ… ÙÙŠ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…
                    const startSelect = document.getElementById('setting-start-hour');
                    const endSelect = document.getElementById('setting-end-hour');
                    if(startSelect) startSelect.value = start;
                    if(endSelect) endSelect.value = end;
                }

                // Ø¥Ø¹Ø§Ø¯Ø© Ø¨Ù†Ø§Ø¡ Ù…ØµÙÙˆÙØ© Ø§Ù„ÙˆÙ‚Øª Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
                timeSlots = [];
                for (let hour = start; hour < end; hour++) {
                    timeSlots.push(`${hour.toString().padStart(2, '0')}:00`);
                }

                // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¬Ø¯ÙˆÙ„ ÙˆØ§Ù„Ù‚ÙˆØ§Ø¦Ù… Ø¨Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯ Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
                renderCalendar();
                populateTimeSlots();

            } catch (err) {
                console.error("Error loading settings:", err);
                // Ù‚ÙŠÙ… Ø§ÙØªØ±Ø§Ø¶ÙŠØ© ÙÙŠ Ø­Ø§Ù„Ø© Ø§Ù„Ø®Ø·Ø£
                timeSlots = [];
                for (let hour = 8; hour < 18; hour++) timeSlots.push(`${hour}:00`);
            }
        }

        // 2. Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
        async function saveSystemSettings() {
            const start = parseInt(document.getElementById('setting-start-hour').value);
            const end = parseInt(document.getElementById('setting-end-hour').value);

            if (start >= end) {
                showNotification('ÙˆÙ‚Øª Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† Ù‚Ø¨Ù„ Ø§Ù„Ù†Ù‡Ø§ÙŠØ©!', 'error');
                return;
            }

            try {
                // Ù…Ø­Ø§ÙˆÙ„Ø© ØªØ­Ø¯ÙŠØ« Ø§Ù„ØµÙ Ø§Ù„Ø£ÙˆÙ„
                const { error } = await supabase
                    .from('settings')
                    .update({ start_hour: start, end_hour: end })
                    .eq('id', 1);

                // Ù„Ùˆ Ù…ÙÙŠØ´ ØµÙ (Ø£ÙˆÙ„ Ù…Ø±Ø©)ØŒ Ù†Ø¹Ù…Ù„ Insert
                if (error) {
                     await supabase.from('settings').insert([{ id: 1, start_hour: start, end_hour: end }]);
                }

                showNotification('ØªÙ… ØªØ­Ø¯ÙŠØ« Ù…ÙˆØ§Ø¹ÙŠØ¯ Ø§Ù„Ø¹Ù…Ù„ Ø¨Ù†Ø¬Ø§Ø­');
                
                // Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø¨Ø§Ù„ØªÙˆÙ‚ÙŠØª Ø§Ù„Ø¬Ø¯ÙŠØ¯ ÙÙˆØ±Ø§Ù‹
                await loadSystemSettings(); 

            } catch (err) {
                console.error(err);
                showNotification('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø­ÙØ¸', 'error');
            }
        }
      
        // --- Ù‚Ø³Ù… Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± ÙˆØ§Ù„ÙˆØ¸Ø§Ø¦Ù Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø© (ÙƒØ§Ù† Ù†Ø§Ù‚Øµ) ---

// 1. Ø¯Ø§Ù„Ø© ØªØµØ¯ÙŠØ± Ø§Ù„ØªÙ‚Ø±ÙŠØ± (Excel - CSV) - Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ø§Ø­ØªØ±Ø§ÙÙŠØ©
        function exportReport() {
            // Ø§Ù„Ø¹Ù†Ø§ÙˆÙŠÙ† (Ø±Ø£Ø³ Ø§Ù„Ø¬Ø¯ÙˆÙ„)
            const headers = ['Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø§Ø¬ØªÙ…Ø§Ø¹', 'Ø§Ù„Ø¬Ù‡Ø© Ø§Ù„Ø­Ø§Ø¬Ø²Ø©', 'Ø§Ù„ØªØ§Ø±ÙŠØ®', 'Ø§Ù„ÙˆÙ‚Øª', 'Ø§Ù„Ø­Ø§Ù„Ø©', 'Ø§Ù„Ø­Ø¶ÙˆØ±', 'Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª'];
            
            // ØªØ¬Ù‡ÙŠØ² Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
            const rows = meetings.map(m => {
                const deptName = departments[m.department] ? departments[m.department].name : m.department;
                const status = m.status === 'confirmed' ? 'Ù…Ø¤ÙƒØ¯' : 'Ù‚ÙŠØ¯ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±';
                
                // ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ù†ØµÙˆØµ Ù…Ù† Ø§Ù„ÙÙˆØ§ØµÙ„ Ø¹Ø´Ø§Ù† Ù…Ù„Ù Ø§Ù„Ø¥ÙƒØ³ÙŠÙ„ Ù…ÙŠØ¨ÙˆØ¸Ø´
                const clean = (text) => `"${(text || '').replace(/"/g, '""')}"`;

                return [
                    clean(m.title),
                    clean(deptName),
                    clean(new Date(m.date).toLocaleDateString('ar-EG')),
                    clean(`${m.startTime} - ${m.endTime}`),
                    clean(status),
                    clean(m.attendees || 'Ù„Ø§ ÙŠÙˆØ¬Ø¯'),
                    clean(m.description || 'Ù„Ø§ ÙŠÙˆØ¬Ø¯')
                ];
            });

            // Ø¯Ù…Ø¬ Ø§Ù„Ø¹Ù†Ø§ÙˆÙŠÙ† Ù…Ø¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
            const csvContent = [
                headers.join(','), 
                ...rows.map(row => row.join(','))
            ].join('\n');

            // Ø¥Ø¶Ø§ÙØ© BOM Ù„Ø¶Ù…Ø§Ù† Ø¸Ù‡ÙˆØ± Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­ ÙÙŠ Ø§Ù„Ø¥ÙƒØ³ÙŠÙ„
            const bom = '\uFEFF'; 
            const blob = new Blob([bom + csvContent], { type: 'text/csv;charset=utf-8;' });
            
            // Ø¥Ù†Ø´Ø§Ø¡ Ø±Ø§Ø¨Ø· Ø§Ù„ØªØ­Ù…ÙŠÙ„
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `ØªÙ‚Ø±ÙŠØ±-Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª-${new Date().toISOString().split('T')[0]}.csv`; // Ø§Ø³Ù… Ø§Ù„Ù…Ù„Ù Ø¨Ø§Ù„Ø¹Ø±Ø¨ÙŠ
            
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(url);

            showNotification('ØªÙ… ØªØ­Ù…ÙŠÙ„ ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø¥ÙƒØ³ÙŠÙ„ Ø¨Ù†Ø¬Ø§Ø­ ğŸ“Š');
        }

        // 3. Ø¯Ø§Ù„Ø© ØªØ­Ø¯ÙŠØ¯ Ø§Ù„ÙƒÙ„ (Ù„Ù„Ø¬Ø¯ÙˆÙ„)
        function toggleSelectAllMeetings() {
            const selectAll = document.getElementById('select-all-meetings');
            document.querySelectorAll('.meeting-checkbox').forEach(cb => cb.checked = selectAll.checked);
        }
// ============================================================
// Ø¯Ø§Ù„Ø© Ø­Ø°Ù Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… (Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ù…Ø³ØªÙ‚Ù„Ø© ÙˆØ§Ù„Ù…Ø­Ù…ÙŠØ© - Final Fix)
// ============================================================
async function deleteUser(userId, userName) {
    
    // 1. ØªØ¹Ø±ÙŠÙ Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª Ù…Ø­Ù„ÙŠØ§Ù‹ Ù„Ø­Ù„ Ù…Ø´Ø§ÙƒÙ„ (ReferenceError & undefined)
    const FOUNDER_EMAIL_CHECK = "fekrythug@gmail.com".trim().toLowerCase();
    
    // Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø¹Ù…ÙŠÙ„ Supabase Ø³ÙˆØ§Ø¡ ÙƒØ§Ù† window.supabase Ø£Ùˆ supabase Ù…Ø¨Ø§Ø´Ø±Ø©
    const sbClient = (typeof window !== 'undefined' && window.supabase) ? window.supabase : ((typeof supabase !== 'undefined') ? supabase : null);
    
    // Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø¹Ù…ÙŠÙ„ Ø§Ù„Ø£Ø¯Ù…Ù† Ø¨Ø£ÙƒØ«Ø± Ù…Ù† Ø·Ø±ÙŠÙ‚Ø© Ù„Ø¶Ù…Ø§Ù† Ø¹Ø¯Ù… Ø¸Ù‡ÙˆØ± Ø®Ø·Ø£ (reading 'from')
    const sbAdmin = (typeof window !== 'undefined' && window.supabaseAdmin) ? window.supabaseAdmin : ((typeof supabaseAdmin !== 'undefined') ? supabaseAdmin : null);

    // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ù…ÙØªØ§Ø­ Ø§Ù„Ø£Ø¯Ù…Ù† Ù‚Ø¨Ù„ Ø§Ù„Ø¨Ø¯Ø¡
    if (!sbAdmin) {
        alert("Ø®Ø·Ø£ ØªÙ‚Ù†ÙŠ: Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ø­Ø°Ù Ù„Ø£Ù† Ù…ÙØªØ§Ø­ Ø§Ù„Ø£Ø¯Ù…Ù† (supabaseAdmin) ØºÙŠØ± Ù…Ø¹Ø±Ù.\nØªØ£ÙƒØ¯ Ù…Ù† ÙˆØ¶Ø¹Ù‡ ÙÙŠ Ø£Ø¹Ù„Ù‰ Ù…Ù„Ù smrm.html.");
        return;
    }

    // 2. ğŸ›¡ï¸ Ø®Ø·ÙˆØ© Ø§Ù„Ø­Ù…Ø§ÙŠØ© Ø§Ù„Ù‚ØµÙˆÙ‰: ÙØ­Øµ Ø§Ù„Ø­ØµØ§Ù†Ø©
    try {
        // Ù†Ø¬Ù„Ø¨ Ø¥ÙŠÙ…ÙŠÙ„ Ø§Ù„Ø´Ø®Øµ Ø§Ù„Ù…Ø±Ø§Ø¯ Ø­Ø°ÙÙ‡ Ù„Ù„ØªØ£ÙƒØ¯
        const { data: targetUser } = await sbClient
            .from('profiles')
            .select('email')
            .eq('id', userId)
            .single();

        // Ù„Ùˆ Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„ Ù‡Ùˆ Ø¥ÙŠÙ…ÙŠÙ„ Ø§Ù„Ù…Ø¤Ø³Ø³ -> ÙˆÙ‚Ù ÙÙˆØ±Ø§Ù‹
        if (targetUser && targetUser.email.trim().toLowerCase() === FOUNDER_EMAIL_CHECK) {
            alert("â›” Ø®Ø·Ø£ Ø£Ù…Ù†ÙŠ: Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø­Ø°Ù Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø¤Ø³Ø³ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ Ù„Ù„Ù†Ø¸Ø§Ù… Ù…Ù‡Ù…Ø§ ÙƒØ§Ù†Øª Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª!");
            return; // ğŸ›‘ Ø®Ø±ÙˆØ¬ Ù†Ù‡Ø§Ø¦ÙŠ Ù…Ù† Ø§Ù„Ø¯Ø§Ù„Ø©
        }
    } catch (e) {
        console.error("Ø®Ø·Ø£ ÙÙŠ ÙØ­Øµ Ø§Ù„Ø­Ù…Ø§ÙŠØ© (ØªÙ… ØªØ¬Ø§Ù‡Ù„Ù‡ Ù„Ù„Ø¥ÙƒÙ…Ø§Ù„ Ø¨Ø­Ø°Ø±):", e);
    }

    // 3. ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø­Ø°Ù (Ø§Ù„Ø­ÙØ§Ø¸ Ø¹Ù„Ù‰ ÙƒÙˆØ¯Ùƒ Ø§Ù„Ø£ØµÙ„ÙŠ)
    const confirmed = await showConfirmDialog(`Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ ØªÙ…Ø§Ù…Ø§Ù‹ Ù…Ù† Ø­Ø°Ù Ø§Ù„Ø¹Ø¶Ùˆ "${userName || 'Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…'}"ØŸ\nØ³ÙŠØªÙ… Ø­Ø°Ù Ø­Ø³Ø§Ø¨Ù‡ ÙˆØ¬Ù…ÙŠØ¹ Ø¨ÙŠØ§Ù†Ø§ØªÙ‡ ÙˆØ­Ø¬ÙˆØ²Ø§ØªÙ‡ Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹.`);
    if (!confirmed) return;

    // 4. ØªØºÙŠÙŠØ± Ø§Ù„Ù…Ø¤Ø´Ø± Ù„Ù„ØªØ­Ù…ÙŠÙ„
    document.body.style.cursor = 'wait';

    try {
        // 5. Ø§Ù„Ø­Ø°Ù Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù…ÙØªØ§Ø­ Ø§Ù„Ø£Ø¯Ù…Ù† (Ø§Ø³ØªØ®Ø¯Ø§Ù… sbAdmin Ø§Ù„Ù…Ø¹Ø±Ù Ù…Ø­Ù„ÙŠØ§Ù‹)
        
        // Ø£ÙˆÙ„Ø§Ù‹: Ù†Ø­Ø°Ù Ù…Ù† Ø¬Ø¯ÙˆÙ„ profiles
        const { error: dbError } = await sbAdmin.from('profiles').delete().eq('id', userId);
        if (dbError) throw dbError;

        // Ø«Ø§Ù†ÙŠØ§Ù‹: Ù†Ø­Ø°Ù Ù…Ù† Ù†Ø¸Ø§Ù… Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø© (Auth)
        const { error: authError } = await sbAdmin.auth.admin.deleteUser(userId);
        if (authError) throw authError;

        showNotification('ØªÙ… Ø­Ø°Ù Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¨Ù†Ø¬Ø§Ø­');
        
        // 6. ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© ÙÙˆØ±Ø§Ù‹ (Ø§Ù„Ø­ÙØ§Ø¸ Ø¹Ù„Ù‰ ÙƒÙˆØ¯Ùƒ Ø§Ù„Ø£ØµÙ„ÙŠ)
        if(typeof updateAdminUsersList === 'function') {
            await updateAdminUsersList();
        } else if (typeof fetchUsers === 'function') {
            fetchUsers();
        }

    } catch (err) {
        console.error('Error deleting user:', err);
        showNotification('ÙØ´Ù„ Ø­Ø°Ù Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…: ' + (err.message || err), 'error');
    } finally {
        document.body.style.cursor = 'default';
    }
}

// --- Ù†Ø¸Ø§Ù… Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡ Ø§Ù„Ø°ÙƒÙŠ (Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ù…Ø­Ø³Ù†Ø© Ù„Ù„Ø§Ø®ØªÙØ§Ø¡) ---

        function checkHiddenMeetings() {
            const indicator = document.getElementById('scroll-indicator');
            const countSpan = document.getElementById('hidden-count');
            
            if (!indicator) return;

            const windowHeight = window.innerHeight;
            const scrollY = window.scrollY || document.documentElement.scrollTop;
            
            // 1. Ø­Ø³Ø§Ø¨ Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ø±ØªÙØ§Ø¹ Ø§Ù„ØµÙØ­Ø© Ø¨Ø¯Ù‚Ø© Ø£ÙƒØ¨Ø±
            const docHeight = Math.max(
                document.body.scrollHeight, document.documentElement.scrollHeight,
                document.body.offsetHeight, document.documentElement.offsetHeight,
                document.body.clientHeight, document.documentElement.clientHeight
            );

            // 2. Ù‡Ù„ ÙˆØµÙ„Ù†Ø§ Ù„Ù†Ù‡Ø§ÙŠØ© Ø§Ù„ØµÙØ­Ø©ØŸ (Ø¨Ù†Ø³Ø¨Ø© ØªØ³Ø§Ù…Ø­ 50 Ø¨ÙƒØ³Ù„)
            // Ù„Ùˆ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù†Ø²Ù„ Ù„Ø­Ø¯ ØªØ­Øª Ø®Ø§Ù„ØµØŒ Ø§Ø®ÙÙŠ Ø§Ù„Ø²Ø±Ø§Ø± ÙÙˆØ±Ø§Ù‹ Ù…Ù‡Ù…Ø§ Ø­ØµÙ„
            if ((windowHeight + scrollY) >= docHeight - 50) {
                indicator.classList.add('opacity-0', 'translate-y-10', 'pointer-events-none');
                return; // ÙˆÙ‚Ù Ø§Ù„Ø¯Ø§Ù„Ø© Ù‡Ù†Ø§ Ø®Ù„Ø§Øµ
            }

            // 3. Ù„Ùˆ Ù„Ø³Ù‡ Ù…Ù†Ø²Ù„Ù†Ø§Ø´ Ù„Ù„Ø¢Ø®Ø±ØŒ Ù†Ø´ÙˆÙ ÙÙŠÙ‡ Ø­Ø¬ÙˆØ²Ø§Øª Ù…Ø³ØªØ®Ø¨ÙŠØ© ÙˆÙ„Ø§ Ù„Ø£
            const meetingBlocks = document.querySelectorAll('.meeting-block');
            let hiddenCount = 0;

            meetingBlocks.forEach(block => {
                const rect = block.getBoundingClientRect();
                // Ù„Ùˆ Ù‚Ù…Ø© Ø§Ù„Ø¹Ù†ØµØ± ØªØ­Øª Ø®Ø· Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ø´Ø§Ø´Ø© Ø¨Ø£ÙƒØªØ± Ù…Ù† 50 Ø¨ÙƒØ³Ù„
                // (Ø²ÙˆØ¯Ù†Ø§ Ø§Ù„Ù‡Ø§Ù…Ø´ Ø¹Ø´Ø§Ù† ÙŠØ®ØªÙÙŠ Ø¨Ø¯Ø±ÙŠ Ø´ÙˆÙŠØ© ÙˆÙ‡Ùˆ Ø·Ø§Ù„Ø¹)
                if (rect.top > windowHeight + 50) { 
                    hiddenCount++;
                }
            });

            // 4. Ø¥Ø¸Ù‡Ø§Ø± Ø£Ùˆ Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø²Ø±
            if (hiddenCount > 0) {
                indicator.classList.remove('opacity-0', 'translate-y-10', 'pointer-events-none');
                countSpan.textContent = hiddenCount;
            } else {
                indicator.classList.add('opacity-0', 'translate-y-10', 'pointer-events-none');
            }
        }

// Ø²Ø± Ø§Ù„Ù†Ø²ÙˆÙ„ Ø§Ù„Ø°ÙƒÙŠ (ÙŠØ°Ù‡Ø¨ Ù„Ø£ÙˆÙ„ Ø§Ø¬ØªÙ…Ø§Ø¹ Ù…Ø®ÙÙŠ)
        function scrollToNextMeeting() {
            const windowHeight = window.innerHeight;
            const meetingBlocks = document.querySelectorAll('.meeting-block');
            
            // Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø£ÙˆÙ„ Ø§Ø¬ØªÙ…Ø§Ø¹ Ù…Ø³ØªØ®Ø¨ÙŠ
            for (const block of meetingBlocks) {
                const rect = block.getBoundingClientRect();
                if (rect.top > windowHeight) {
                    // Ø§Ù„Ø°Ù‡Ø§Ø¨ Ø¥Ù„ÙŠÙ‡ ÙˆÙˆØ¶Ø¹Ù‡ ÙÙŠ Ù…Ù†ØªØµÙ Ø§Ù„Ø´Ø§Ø´Ø©
                    block.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    break; // ÙƒÙØ§ÙŠØ© Ø£ÙˆÙ„ ÙˆØ§Ø­Ø¯
                }
            }
        }

        // ØªØ´ØºÙŠÙ„ Ø§Ù„Ù…Ø±Ø§Ù‚Ø¨ Ø¹Ù„Ù‰ Ø§Ù„Ø´Ø§Ø´Ø© (Window Scroll)
        function initScrollObserver() {
            window.addEventListener('scroll', checkHiddenMeetings);
            window.addEventListener('resize', checkHiddenMeetings);
            // ÙØ­Øµ Ù…Ø¨Ø¯Ø¦ÙŠ Ø¨Ø¹Ø¯ Ø«Ø§Ù†ÙŠØ©
            setTimeout(checkHiddenMeetings, 1000); 
        }

// Setup event listeners (Ù†Ø³Ø®Ø© Ø¢Ù…Ù†Ø© ÙˆÙ…ØµØ­Ø­Ø© ÙˆÙ…Ø¶Ø§ÙØ© Ø¥Ù„ÙŠÙ‡Ø§ ÙˆØ¸ÙŠÙØ© ÙØªØ­ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø£Ø³Ø§Ø¨ÙŠØ¹)
function setupEventListeners() {
    // Helper function to safely add listener
    const addListener = (id, event, handler) => {
        const el = document.getElementById(id);
        if (el) el.addEventListener(event, handler);
    };

    // Navigation buttons (Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ Ø§Ù„Ø³Ø§Ø¨Ù‚ ÙˆØ§Ù„ØªØ§Ù„ÙŠ)
    addListener('prev-week', 'click', () => {
        currentWeekStart.setDate(currentWeekStart.getDate() - 7);
        updateWeekDisplay();
        renderCalendar();
    });

    addListener('next-week', 'click', () => {
        currentWeekStart.setDate(currentWeekStart.getDate() + 7);
        updateWeekDisplay();
        renderCalendar();
    });

    // ğŸ”¥ğŸ”¥ğŸ”¥ Ø§Ù„Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©: Ø±Ø¨Ø· Ø²Ø± ÙØªØ­ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù†Ø³Ø¯Ù„Ø© Ù„Ù„Ø£Ø³Ø¨ÙˆØ¹ ğŸ”¥ğŸ”¥ğŸ”¥
    addListener('week-display-trigger', 'click', (e) => {
        e.stopPropagation();
        const options = document.getElementById('week-dropdown-options');
        const arrow = document.getElementById('week-arrow');

        // Ø¥ØºÙ„Ø§Ù‚ Ø£ÙŠ Ù‚ÙˆØ§Ø¦Ù… Ù…Ù†Ø³Ø¯Ù„Ø© Ø£Ø®Ø±Ù‰ Ù‚Ø¨Ù„ Ø§Ù„ÙØªØ­
        document.querySelectorAll('.custom-dropdown-options').forEach(opt => {
            if(opt !== options) opt.classList.remove('show');
        });

        options.classList.toggle('show');
        
        // ØªØ¯ÙˆÙŠØ± Ø§Ù„Ø³Ù‡Ù…
        if(arrow) arrow.style.transform = options.classList.contains('show') ? 'rotate(180deg)' : 'rotate(0deg)';
    });
    // -------------------------------------------------------------

    // Modal controls
    addListener('add-meeting-btn', 'click', () => openAddMeetingModal());
    addListener('dashboard-btn', 'click', () => openDashboard());
    addListener('admin-panel-btn', 'click', () => openAdminPanel());
    addListener('logout-btn', 'click', async () => { await supabase.auth.signOut(); localStorage.clear(); window.location.href = 'index.html'; });
    
    // Close buttons (Ù…Ø¬Ù…Ø¹Ø© Ù„Ù„ØªØ³Ù‡ÙŠÙ„)
    ['close-modal', 'cancel-meeting', 'close-dashboard', 'close-admin-panel', 'close-details', 'close-add-user', 'cancel-add-user']
    .forEach(id => addListener(id, 'click', () => document.querySelectorAll('.modal').forEach(m => m.classList.remove('show'))));

    // Admin panel controls
    addListener('add-user-btn', 'click', () => openAddUserModal());
    addListener('bulk-delete-btn', 'click', () => bulkDeleteMeetings());
    addListener('select-all-meetings', 'change', toggleSelectAllMeetings);
    
    // ØªØµØ­ÙŠØ­ Ù…Ù‡Ù…: Ø±Ø¨Ø· Ø§Ù„ÙÙ„ØªØ± Ø¨Ø§Ù„Ø¯Ø§Ù„Ø© Ø§Ù„ØµØ­ÙŠØ­Ø©
    addListener('filter-department', 'change', filterAdminMeetings); 
    addListener('export-report-btn', 'click', exportReport);

    // Admin tabs logic
    document.querySelectorAll('.admin-tab').forEach(tab => {
        tab.addEventListener('click', (e) => {
            const btn = e.target.closest('.admin-tab');
            if(btn) switchAdminTab(btn.dataset.tab);
        });
    });

    // Forms
    addListener('add-user-form', 'submit', handleAddUser);
    addListener('meeting-form', 'submit', handleMeetingSubmission);

    // Meeting actions
    addListener('delete-meeting', 'click', deleteMeeting);
    addListener('edit-meeting', 'click', editMeeting);

    // --- Ø§Ù„Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©: ØªØ´ØºÙŠÙ„ Ù…Ø±Ø§Ù‚Ø¨ Ø§Ù„Ø³ÙƒØ±ÙˆÙ„ Ù„Ù„Ø¬Ø¯ÙˆÙ„ ---
    if (typeof initScrollObserver === 'function') {
        initScrollObserver();
    }
}

// ÙØªØ­ Ù†Ø§ÙØ°Ø© Ø§Ù„Ø­Ø¬Ø² (Ù…Ø­Ø¯Ø«Ø© Ù„ØªÙØ§Ø¯ÙŠ Ø§Ù„Ù…Ø´ÙƒÙ„Ø©)
        function openAddMeetingModal(date = null, time = null) {
            // ğŸ”¥ Ø£Ù‡Ù… Ø®Ø·ÙˆØ©: ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ù‚Ø¯ÙŠÙ… Ù‚Ø¨Ù„ Ù…Ø§ Ù†ÙØªØ­ Ø§Ù„Ø¬Ø¯ÙŠØ¯
            resetFormUI(); 
            
            document.getElementById('save-text').textContent = 'Ø­ÙØ¸ Ø§Ù„Ø­Ø¬Ø²';
            const modal = document.getElementById('add-meeting-modal');
            modal.classList.add('show');
            
            // ØªØ¹Ø¨Ø¦Ø© Ø§Ù„ØªØ§Ø±ÙŠØ® ÙˆØ§Ù„ÙˆÙ‚Øª Ù„Ùˆ Ø¶ØºØ·Øª Ø¹Ù„Ù‰ Ø§Ù„Ø¬Ø¯ÙˆÙ„
            if (date) {
                const offset = date.getTimezoneOffset() * 60000;
                const localDate = new Date(date.getTime() - offset);
                document.getElementById('meeting-date').value = localDate.toISOString().split('T')[0];
            }
            
            if (time) {
                // Ù„Ùˆ Ø¬Ø§ÙŠ Ù…Ù† Ø§Ù„Ø¬Ø¯ÙˆÙ„ØŒ Ù†Ø®ØªØ§Ø± Ø§Ù„ÙˆÙ‚Øª ÙˆÙ†Ø­Ø¯Ø« Ø´ÙƒÙ„Ù‡
                if(typeof setDropdownValue === 'function') {
                    setDropdownValue('meeting-time', time);
                }
            }
        }

        // Ø²Ø± ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø­Ø¬Ø² (ÙˆØ¶Ø¹ Ø§Ù„Ù€ ID)
        function editMeeting() {
            if (!selectedMeeting) return;
            
            // ÙˆØ¶Ø¹ ID Ø§Ù„Ø§Ø¬ØªÙ…Ø§Ø¹ ÙÙŠ Ø§Ù„Ø­Ù‚Ù„ Ø§Ù„Ù…Ø®ÙÙŠ
            document.getElementById('meeting-id').value = selectedMeeting.id;
            document.getElementById('save-text').textContent = 'ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø­Ø¬Ø²';

            // ØªØ¹Ø¨Ø¦Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
            document.getElementById('meeting-title').value = selectedMeeting.title;
            document.getElementById('meeting-date').value = selectedMeeting.date;
            document.getElementById('attendees').value = selectedMeeting.attendees || '';
            document.getElementById('description').value = selectedMeeting.description || '';
            
            // ØªØ¹Ø¨Ø¦Ø© Ø§Ù„Ù‚ÙˆØ§Ø¦Ù… Ø§Ù„Ø§Ø­ØªØ±Ø§ÙÙŠØ© (Ø§Ù„Ù‚Ø³Ù…ØŒ Ø§Ù„ÙˆÙ‚ØªØŒ Ø§Ù„Ù…Ø¯Ø©)
            setDropdownValue('department', selectedMeeting.department);
            setDropdownValue('meeting-time', selectedMeeting.startTime);

            // Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø¯Ø© ÙˆØªØ¹Ø¨Ø¦ØªÙ‡Ø§
            const startMinutes = timeToMinutes(selectedMeeting.startTime);
            const endMinutes = timeToMinutes(selectedMeeting.endTime);
            const duration = (endMinutes - startMinutes) / 60;
            setDropdownValue('duration', duration.toString());
            
            closeModal('meeting-details-modal');
            document.getElementById('add-meeting-modal').classList.add('show');
        }

        // Close modal
        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('show');
        }

// ------- START: Ø¯Ø§Ù„Ø© Ù…Ø³Ø§Ø¹Ø¯Ø© Ù„Ø­Ù„ Ù…Ø´ÙƒÙ„Ø© Ø§Ù„Ù‚Ø±Ø§Ø¡Ø© Ù…Ù† Ø§Ù„Ù‚ÙˆØ§Ø¦Ù… Ø§Ù„Ù…Ø®ØµØµØ© -------
function getValueFromDropdown(selectId) {
    // Ø­Ø§ÙˆÙ„ Ø§Ù„Ù‚Ø±Ø§Ø¡Ø© Ù…Ù† Ø§Ù„Ù€ select Ø§Ù„Ù…Ø®ÙÙŠ Ø£ÙˆÙ„Ø§Ù‹
    const select = document.getElementById(selectId);
    if (select && select.value) return select.value;

    // Ø¥Ø°Ø§ Ù„Ù… ØªÙƒÙ† Ù‚ÙŠÙ…Ø© Ø§Ù„Ù€ select Ù…ÙˆØ¬ÙˆØ¯Ø©ØŒ Ù†Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ù€ custom-dropdown Ø§Ù„Ø°ÙŠ ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ select Ø°ÙŠ Ù†ÙØ³ Ø§Ù„Ù€ id
    const allDropdowns = document.querySelectorAll('.custom-dropdown');
    for (const dd of allDropdowns) {
        const hidden = dd.querySelector('select');
        if (!hidden) continue;
        if (hidden.id === selectId) {
            // Ù†Ø­ØµÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ù†Øµ Ø§Ù„Ù…Ø¹Ø±ÙˆØ¶
            const displaySpan = dd.querySelector('.custom-dropdown-display span');
            const displayText = displaySpan ? displaySpan.textContent.trim() : '';
            // Ù†Ø­Ø§ÙˆÙ„ Ø¥ÙŠØ¬Ø§Ø¯ Ø®ÙŠØ§Ø± Ù…Ø·Ø§Ø¨Ù‚ ÙÙŠ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¸Ø§Ù‡Ø±Ø©
            const option = Array.from(dd.querySelectorAll('.custom-option'))
                                .find(li => li.innerText.trim() === displayText);
            if (option && option.dataset && option.dataset.value !== undefined) return option.dataset.value;
            // ÙƒØ­Ù„ Ø§Ø­ØªÙŠØ§Ø·ÙŠ: Ù†Ø¹ÙŠØ¯ Ù‚ÙŠÙ…Ø© Ø§Ù„Ù€ select (Ù‚Ø¯ ØªÙƒÙˆÙ† ÙØ§Ø±ØºØ©) Ø£Ùˆ Ø³Ù„Ø³Ù„Ø© ÙØ§Ø±ØºØ©
            return hidden.value || '';
        }
    }

    // ÙØ´Ù„ Ø§Ù„Ø§Ø³ØªØ¯Ù„Ø§Ù„ -> Ù†Ø±Ø¬Ø¹ Ø³Ù„Ø³Ù„Ø© ÙØ§Ø±ØºØ©
    return '';
}
// ------- END: Ø¯Ø§Ù„Ø© Ù…Ø³Ø§Ø¹Ø¯Ø© -------


async function handleMeetingSubmission(e) {
    e.preventDefault();

    // 1. Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ù‚ÙŠÙ…
    const titleVal = (document.getElementById('meeting-title').value || '').trim();
    const deptVal  = getValueFromDropdown('department');
    const dateVal  = (document.getElementById('meeting-date').value || '').trim();
    const timeVal  = getValueFromDropdown('meeting-time');
    const durVal   = getValueFromDropdown('duration') || (document.getElementById('duration')?.value || '');

    if (!titleVal || !deptVal || !dateVal || !timeVal) {
        showNotification('ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©', 'error');
        return;
    }

    if (!currentUser || !currentUser.id) {
        showNotification('Ø®Ø·Ø£: Ø¬Ù„Ø³Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ØºÙŠØ± ØµØ§Ù„Ø­Ø©.', 'error');
        return;
    }

    const meetingId = document.getElementById('meeting-id').value;

    showLoader('Ø¬Ø§Ø±ÙŠ Ø­ÙØ¸ Ø§Ù„Ø­Ø¬Ø² ÙˆØ¥Ø¨Ù„Ø§Øº Ø§Ù„Ù…Ø¯ÙŠØ±ÙŠÙ†...'); 

    try {
        const endTimeVal = calculateEndTime(timeVal, parseInt(durVal));

        const meetingData = {
            title: titleVal,
            department: deptVal,
            date: dateVal,
            start_time: timeVal,
            end_time: endTimeVal,
            description: document.getElementById('description').value,
            attendees: document.getElementById('attendees').value,
            user_id: currentUser.id
        };

        const conflict = checkConflicts(meetingData, meetingId);
        if (conflict) throw new Error('Conflict');

        // -------------------------------------------------------------
        // Ø¯Ø§Ù„Ø© Ù…Ø³Ø§Ø¹Ø¯Ø© Ù„Ø¬Ù„Ø¨ Ø¥ÙŠÙ…ÙŠÙ„Ø§Øª ÙƒÙ„ Ø§Ù„Ù…Ø¯ÙŠØ±ÙŠÙ† ÙˆØ¥Ø±Ø³Ø§Ù„ Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª
        // -------------------------------------------------------------
        const notifyAllManagers = async (subject, message) => {
            const { data: managers } = await supabase
                .from('profiles')
                .select('email, full_name')
                .eq('role', 'manager');

            if (managers && managers.length > 0) {
                managers.forEach(manager => {
                    if (manager.email) {
                        sendEmailNotification(
                            manager.email,      
                            manager.full_name,  
                            subject,            
                            message             
                        );
                    }
                });
                console.log(`ØªÙ… Ø¥Ø±Ø³Ø§Ù„ ØªÙ†Ø¨ÙŠÙ‡Ø§Øª Ù„Ø¹Ø¯Ø¯ ${managers.length} Ù…Ø¯ÙŠØ±.`);
            }
        };

        // === Ø§Ù„Ø³ÙŠÙ†Ø§Ø±ÙŠÙˆ 1: ØªØ¹Ø¯ÙŠÙ„ Ø­Ø¬Ø² Ù…ÙˆØ¬ÙˆØ¯ ===
        if (meetingId) {
            const originalMeeting = meetings.find(m => String(m.id) === String(meetingId));
            const isManager = currentUser.role === 'manager';
            const isOwner = originalMeeting && originalMeeting.user_id === currentUser.id;

            if (!isManager && !isOwner) {
                showNotification('â›” Ù„Ø§ ØªÙ…Ù„Ùƒ ØµÙ„Ø§Ø­ÙŠØ© Ø§Ù„ØªØ¹Ø¯ÙŠÙ„', 'error');
                return;
            }

            if (isManager) {
                const { error } = await supabase.from('meetings').update({
                    ...meetingData,
                    status: 'confirmed',
                    pending_changes: null
                }).eq('id', meetingId);
                
                if (error) throw error;
                showNotification('ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø­Ø¬Ø² Ø¨Ù†Ø¬Ø§Ø­');
            } 
            else {
                // Ù…Ø³ØªØ®Ø¯Ù… Ø¹Ø§Ø¯ÙŠ: Ø·Ù„Ø¨ ØªØ¹Ø¯ÙŠÙ„
                const { error } = await supabase.from('meetings').update({
                    status: 'modification_requested',
                    pending_changes: meetingData
                }).eq('id', meetingId);
                
                if (error) throw error;
                
                // Ø¬Ù„Ø¨ Ø§Ø³Ù… Ù‚Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø­Ø§Ù„ÙŠ
                const deptName = departments[currentUser.department]?.name || currentUser.department;
                
                // Ø§Ù„ØªØ¹Ø¯ÙŠÙ„: ØªØºÙŠÙŠØ± "ØµØ§Ø­Ø¨ Ø§Ù„Ø·Ù„Ø¨" Ø¥Ù„Ù‰ "Ù…Ù‚Ø¯Ù… Ø§Ù„Ø·Ù„Ø¨"
                const msgBody = `<strong>ÙˆØ±Ø¯ Ø·Ù„Ø¨ ØªØ¹Ø¯ÙŠÙ„ Ø¹Ù„Ù‰ Ø­Ø¬Ø² Ù‚Ø§Ø¦Ù… Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ù…ÙˆØ§ÙÙ‚ØªÙƒÙ….</strong>
                
                <strong>Ù…Ù‚Ø¯Ù… Ø§Ù„Ø·Ù„Ø¨:</strong> ${currentUser.full_name} (${deptName})
                <strong>Ø§Ù„Ø­Ø¬Ø² Ø§Ù„Ø£ØµÙ„ÙŠ:</strong> ${originalMeeting.title}
                <strong>Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ø£ØµÙ„ÙŠ:</strong> ${originalMeeting.date}
                
                <strong>ÙŠØ±Ø¬Ù‰ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¥Ù„Ù‰ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… Ù„Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª Ø§Ù„Ù…Ù‚ØªØ±Ø­Ø© ÙˆÙ‚Ø¨ÙˆÙ„Ù‡Ø§ Ø£Ùˆ Ø±ÙØ¶Ù‡Ø§.</strong>`;

                await notifyAllManagers("ØªÙ†Ø¨ÙŠÙ‡: Ø·Ù„Ø¨ ØªØ¹Ø¯ÙŠÙ„ Ø­Ø¬Ø²", msgBody);

                showNotification('ğŸ“ ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ù„Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©');
            }
        } 
        // === Ø§Ù„Ø³ÙŠÙ†Ø§Ø±ÙŠÙˆ 2: Ø­Ø¬Ø² Ø¬Ø¯ÙŠØ¯ ===
        else {
            const status = currentUser.role === 'manager' ? 'confirmed' : 'pending';
            const { error } = await supabase.from('meetings').insert([{
                ...meetingData,
                status: status
            }]);

            if (error) throw error;

            if (status === 'pending') {
                // Ø¬Ù„Ø¨ Ø§Ø³Ù… Ø§Ù„Ø¬Ù‡Ø© Ø§Ù„Ù…Ø­Ø¬ÙˆØ² Ù„Ù‡Ø§ + Ø§Ø³Ù… Ù‚Ø³Ù… Ù…Ù‚Ø¯Ù… Ø§Ù„Ø·Ù„Ø¨
                const bookingDeptName = departments[deptVal]?.name || deptVal;
                const userDeptName = departments[currentUser.department]?.name || currentUser.department;
                
                // Ø§Ù„ØªØ¹Ø¯ÙŠÙ„: Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù‚Ø³Ù… Ø¨Ø¬Ø§Ù†Ø¨ Ø§Ø³Ù… Ù…Ù‚Ø¯Ù… Ø§Ù„Ø·Ù„Ø¨
                const msgBody = `<strong>Ù‡Ù†Ø§Ùƒ Ø·Ù„Ø¨ Ø­Ø¬Ø² Ø¬Ø¯ÙŠØ¯ Ù„Ù„Ù‚Ø§Ø¹Ø© ÙŠØªØ·Ù„Ø¨ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©.</strong>
                
                <strong>Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø§Ø¬ØªÙ…Ø§Ø¹:</strong> ${titleVal}
                <strong>Ø§Ù„Ø¬Ù‡Ø© Ø§Ù„Ø­Ø§Ø¬Ø²Ø©:</strong> ${bookingDeptName}
                <strong>Ù…Ù‚Ø¯Ù… Ø§Ù„Ø·Ù„Ø¨:</strong> ${currentUser.full_name} (${userDeptName})
                <strong>Ø§Ù„Ù…ÙˆØ¹Ø¯ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨:</strong> ${dateVal}
                <strong>Ø§Ù„ØªÙˆÙ‚ÙŠØª:</strong> Ù…Ù† ${timeVal} Ø¥Ù„Ù‰ ${endTimeVal}
                
                <strong>ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªÙØ¶Ù„ Ø¨Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù„Ù„Ù†Ø¸Ø§Ù… Ù„Ø§ØªØ®Ø§Ø° Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ Ø§Ù„Ù…Ù†Ø§Ø³Ø¨.</strong>`;

                await notifyAllManagers("ØªÙ†Ø¨ÙŠÙ‡: Ø·Ù„Ø¨ Ø­Ø¬Ø² Ø¬Ø¯ÙŠØ¯", msgBody);
            }

            showNotification('ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨ Ø§Ù„Ø­Ø¬Ø² Ø¨Ù†Ø¬Ø§Ø­');
        }

        await loadMeetings();
        closeModal('add-meeting-modal');
        resetFormUI();

    } catch (error) {
        console.error(error);
        if (error.message === 'Conflict') {
            showNotification('ÙŠÙˆØ¬Ø¯ ØªØ¹Ø§Ø±Ø¶ ÙÙŠ Ø§Ù„Ù…ÙˆØ¹Ø¯!', 'error');
        } else {
            showNotification('Ø­Ø¯Ø« Ø®Ø·Ø£: ' + error.message, 'error');
        }
    } finally {
        hideLoader();
    }
}

// Ø§Ø³ØªØ¨Ø¯Ù„ Ø¯Ø§Ù„Ø© calculateEndTime Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø© Ø¨Ù‡Ø°Ù‡ Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ø¢Ù…Ù†Ø©
function calculateEndTime(startTime, duration) {
    // Ø­Ù…Ø§ÙŠØ©: Ù„Ùˆ Ø§Ù„ÙˆÙ‚Øª ÙØ§Ø¶ÙŠ Ù†Ø±Ø¬Ø¹ Ù‚ÙŠÙ…Ø© Ø§ÙØªØ±Ø§Ø¶ÙŠØ© Ø¹Ø´Ø§Ù† Ø§Ù„ÙƒÙˆØ¯ Ù…ÙŠÙØµÙ„Ø´
    if (!startTime || typeof startTime !== 'string' || !startTime.includes(':')) {
        return "00:00";
    }
    
    try {
        const [hoursStr, minutesStr] = startTime.split(':');
        const hours = parseInt(hoursStr);
        const minutes = parseInt(minutesStr);
        
        // Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù† Ø§Ù„Ø£Ø±Ù‚Ø§Ù… ØµØ­ÙŠØ­Ø©
        if (isNaN(hours) || isNaN(minutes)) return "00:00";

        const endHour = hours + parseInt(duration);
        return `${endHour.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}`;
    } catch (e) {
        console.error("Error calculating time:", e);
        return "00:00";
    }
}

function checkConflicts(newMeeting, excludeId = null) {
            const conflictingMeeting = meetings.find(meeting => {
                // ğŸ‘‡ Ù‡Ø°Ø§ Ø§Ù„Ø³Ø·Ø± Ù‡Ùˆ Ø§Ù„Ø­Ù„: ØªØ¬Ø§Ù‡Ù„ Ø§Ù„Ø§Ø¬ØªÙ…Ø§Ø¹ Ø§Ù„Ø­Ø§Ù„ÙŠ Ù„Ùˆ Ø¨Ù†Ø¹Ø¯Ù„Ù‡
                if (excludeId && String(meeting.id) === String(excludeId)) return false;

                if (!meeting || !meeting.startTime || !meeting.endTime) return false;
                if (meeting.date !== newMeeting.date) return false;
                
                const newStart = timeToMinutes(newMeeting.start_time || newMeeting.startTime);
                const newEnd = timeToMinutes(newMeeting.end_time || newMeeting.endTime);
                const existingStart = timeToMinutes(meeting.startTime);
                const existingEnd = timeToMinutes(meeting.endTime);
                
                return (newStart < existingEnd && newEnd > existingStart);
            });

            if (conflictingMeeting) {
                const newDept = departments[newMeeting.department];
                const newPriority = newDept ? newDept.priority : 5;
                const existingPriority = conflictingMeeting.priority || 5;
                
                const canOverride = newPriority < existingPriority;
                return { meeting: conflictingMeeting, canOverride };
            }
            return null;
        }

// 2. ØªØ­ÙˆÙŠÙ„ Ø§Ù„ÙˆÙ‚Øª Ù„Ø¯Ù‚Ø§Ø¦Ù‚ (Ù†Ø³Ø®Ø© Ø¢Ù…Ù†Ø© Ø¬Ø¯Ø§Ù‹)
        function timeToMinutes(time) {
            // Ù„Ùˆ Ø§Ù„ÙˆÙ‚Øª ÙØ§Ø¶ÙŠ Ø£Ùˆ Ù…Ø´ Ù†ØµØŒ Ù†Ø±Ø¬Ø¹ 0 Ø¹Ø´Ø§Ù† Ø§Ù„ÙƒÙˆØ¯ Ù…ÙŠØ±Ù…ÙŠØ´ Error
            if (!time || typeof time !== 'string') return 0;
            
            try {
                const [hours, minutes] = time.split(':').map(Number);
                return hours * 60 + minutes;
            } catch (e) {
                return 0;
            }
        }

// Show meeting details (Ù…Ø¹Ø¯Ù„Ø© Ù„Ù„Ø­Ù…Ø§ÙŠØ© + Ø¥ØµÙ„Ø§Ø­ ØªØ´ØºÙŠÙ„ Ø§Ù„Ø£Ø²Ø±Ø§Ø±)
// Ø¯Ø§Ù„Ø© Ø¹Ø±Ø¶ Ø§Ù„ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ø­Ø¯Ø«Ø© Ù„ØªÙ†Ø§Ø³Ø¨ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø´Ø§Ø´Ø§Øª (ØªØ¹Ø¯ÙŠÙ„ Ù†Ù‡Ø§Ø¦ÙŠ)
function showMeetingDetails(meeting) {
    selectedMeeting = meeting;
    const modal = document.getElementById('meeting-details-modal');
    const content = document.getElementById('meeting-details-content');
    
    const startDt = new Date(`2000-01-01T${meeting.startTime}`);
    const endDt = new Date(`2000-01-01T${meeting.endTime}`);
    const durationHrs = (endDt - startDt) / (1000 * 60 * 60);

    const createdDateDisplay = meeting.createdAt ? new Date(meeting.createdAt).toLocaleString('ar-EG') : 'ØºÙŠØ± Ù…Ø³Ø¬Ù„';
    const creatorName = meeting.createdBy || 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ';

    const isOwner = (currentUser && currentUser.id === meeting.user_id);
    const isManager = (currentUser && currentUser.role === 'manager');
    const canManage = isOwner || isManager;
    
    let buttonsHTML = '';
    if (canManage) {
        // Ø§Ù„ØªØ¹Ø¯ÙŠÙ„: Ø§Ù„Ø£Ø²Ø±Ø§Ø± ØªØ­Øª Ø¨Ø¹Ø¶ ÙÙŠ Ø§Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„ (w-full) ÙˆØ¬Ù†Ø¨ Ø¨Ø¹Ø¶ ÙÙŠ Ø§Ù„ÙƒÙ…Ø¨ÙŠÙˆØªØ± (w-auto)
        buttonsHTML = `
            <div class="flex flex-col md:flex-row justify-end gap-3 pt-4 border-t border-gray-100 mt-6 shrink-0">
                <button id="delete-meeting" class="w-full md:w-auto px-5 py-2.5 bg-red-50 text-red-600 border border-red-200 rounded-lg hover:bg-red-600 hover:text-white transition-all font-bold text-xs md:text-sm flex items-center justify-center order-2 md:order-1 active:scale-95"> 
                    <i class="fas fa-trash ml-2"></i> Ø­Ø°Ù Ø§Ù„Ø­Ø¬Ø² 
                </button> 
                <button id="edit-meeting" class="w-full md:w-auto px-6 py-2.5 bg-[#2A3475] text-white rounded-lg hover:bg-[#1f2658] transition-all font-bold text-xs md:text-sm shadow-md flex items-center justify-center transform active:scale-95 order-1 md:order-2"> 
                    <i class="fas fa-edit ml-2"></i> ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø­Ø¬Ø² 
                </button>
            </div>
        `;
    }

    content.innerHTML = `
        <div class="pb-4 mb-4 border-b border-gray-100">
            <div class="flex flex-col md:flex-row justify-between items-start gap-3">
                <div class="min-w-0 flex-1">
                    <h4 class="text-lg md:text-2xl font-bold text-[#2A3475] mb-1 break-words leading-tight">${meeting.title}</h4>
                    <div class="flex items-center text-xs md:text-sm text-gray-500 font-bold">
                        <i class="fas fa-building text-[#F3A628] ml-2"></i>
                        <span>${departments[meeting.department] ? departments[meeting.department].name : meeting.department}</span>
                    </div>
                </div>
                <span class="px-3 py-1 bg-green-50 text-green-700 border border-green-100 rounded-full text-[10px] md:text-xs font-bold whitespace-nowrap self-start flex items-center">
                    <span class="w-2 h-2 bg-green-500 rounded-full ml-2 inline-block animate-pulse"></span>
                    ${meeting.status === 'confirmed' ? 'Ù…Ø¤ÙƒØ¯ / ÙØ¹Ø§Ù„' : 'Ù‚ÙŠØ¯ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±'}
                </span>
            </div>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-3 md:gap-4 mb-6">
            <div class="bg-gray-50 p-3 rounded-xl border-r-4 border-[#2A3475] shadow-sm">
                <div class="text-[10px] text-gray-400 font-bold mb-1 uppercase tracking-wider">Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ø±Ø³Ù…ÙŠ</div>
                <div class="text-xs md:text-sm font-bold text-gray-800 flex items-center">
                    <i class="far fa-calendar-check text-[#F3A628] ml-2"></i>
                    ${new Date(meeting.date).toLocaleDateString('ar-EG', { weekday: 'long', day: 'numeric', month: 'long' })}
                </div>
            </div>

            <div class="bg-gray-50 p-3 rounded-xl border-r-4 border-[#F3A628] shadow-sm">
                <div class="text-[10px] text-gray-400 font-bold mb-1 uppercase tracking-wider">Ø§Ù„ØªÙˆÙ‚ÙŠØª ÙˆØ§Ù„Ù…Ø¯Ø©</div>
                <div class="text-xs md:text-sm font-bold text-gray-800 flex items-center">
                    <i class="far fa-clock text-[#2A3475] ml-2"></i>
                    ${toArabicNum(meeting.startTime)} - ${toArabicNum(meeting.endTime)} 
                    <span class="text-[10px] text-gray-400 mr-2">(${durationHrs} Ø³Ø§Ø¹Ø©)</span>
                </div>
            </div>
        </div>

        <div class="space-y-4">
            ${meeting.attendees ? `
            <div>
                <h5 class="text-xs md:text-sm font-bold text-[#2A3475] mb-2 flex items-center"><i class="fas fa-users ml-2 text-gray-400"></i> Ø§Ù„Ø­Ø¶ÙˆØ±</h5>
                <div class="bg-white border border-gray-100 rounded-lg p-2.5 text-xs md:text-sm text-gray-600 font-bold leading-relaxed">${meeting.attendees}</div>
            </div>` : ''}
            
            ${meeting.description ? `
            <div>
                <h5 class="text-xs md:text-sm font-bold text-[#2A3475] mb-2 flex items-center"><i class="fas fa-align-right ml-2 text-gray-400"></i> Ù…Ù„Ø§Ø­Ø¸Ø§Øª</h5>
                <div class="bg-blue-50/30 rounded-lg p-3 text-xs md:text-sm text-gray-600 leading-relaxed border border-blue-50">${meeting.description}</div>
            </div>` : ''}
        </div>

        <div class="mt-6 pt-4 border-t border-gray-50 flex flex-col sm:flex-row justify-between items-start sm:items-center gap-2 text-[9px] md:text-[10px] text-gray-400">
            <div class="flex items-center"><i class="fas fa-user-edit ml-1"></i> Ù…Ø­Ø¬ÙˆØ² Ø¨ÙˆØ§Ø³Ø·Ø©: <span class="font-bold text-gray-500 mr-1">${creatorName}</span></div>
            <div class="flex items-center"><i class="fas fa-history ml-1"></i> ØªØ§Ø±ÙŠØ® Ø§Ù„Ø·Ù„Ø¨: ${createdDateDisplay}</div>
        </div>
        
        ${buttonsHTML}
    `;
    
    setTimeout(() => {
        const delBtn = document.getElementById('delete-meeting');
        const editBtn = document.getElementById('edit-meeting');
        if(delBtn) delBtn.onclick = deleteMeeting; 
        if(editBtn) editBtn.onclick = editMeeting;   
    }, 50);

    modal.classList.add('show');
}

// Ø­Ø°Ù Ø§Ù„Ø­Ø¬Ø² Ù…Ù† Supabase
// Ø¯Ø§Ù„Ø© Ø§Ù„Ø­Ø°Ù (Ø§Ù„Ù…Ø¹Ø¯Ù„Ø© Ù„Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨ Ø¨Ø¯Ù„Ø§Ù‹ Ù…Ù† Ø§Ù„Ø­Ø°Ù Ø§Ù„Ù…Ø¨Ø§Ø´Ø± Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†)
async function deleteMeeting() {
    if (!selectedMeeting) return;
    
    // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø£Ù† Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù‡Ùˆ ØµØ§Ø­Ø¨ Ø§Ù„Ø­Ø¬Ø² Ø£Ùˆ Ø§Ù„Ù…Ø¯ÙŠØ±
    const isOwner = selectedMeeting.user_id === currentUser.id;
    const isManager = currentUser.role === 'manager';

    if (!isOwner && !isManager) {
        showNotification('â›” Ù„Ø§ ØªÙ…Ù„Ùƒ ØµÙ„Ø§Ø­ÙŠØ© Ù„Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø­Ø¬Ø²!', 'error');
        return;
    }

    // --- Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰: Ø§Ù„Ù…Ø¯ÙŠØ± (Ø­Ø°Ù Ù†Ù‡Ø§Ø¦ÙŠ) ---
    if (isManager) {
        const isConfirmed = await showConfirmDialog('Ø¨ØµÙØªÙƒ Ù…Ø¯ÙŠØ±Ø§Ù‹ØŒ Ø³ÙŠØªÙ… Ø§Ù„Ø­Ø°Ù Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹. Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ØŸ');
        if (!isConfirmed) return;

        // ğŸ”¥ ØªØ´ØºÙŠÙ„ Ø§Ù„Ù„ÙˆØ¯Ø±
        showLoader('Ø¬Ø§Ø±ÙŠ Ø­Ø°Ù Ø§Ù„Ø­Ø¬Ø² Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹...');

        try {
            const { error } = await supabase.from('meetings').delete().eq('id', selectedMeeting.id);
            if (error) throw error;
            
            meetings = meetings.filter(m => m.id !== selectedMeeting.id);
            refreshAllViews();
            closeModal('meeting-details-modal');
            showNotification('ØªÙ… Ø§Ù„Ø­Ø°Ù Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹ âœ…');
        } catch (error) { 
            showNotification('ÙØ´Ù„ Ø§Ù„Ø­Ø°Ù', 'error'); 
        } finally { 
            // ğŸ”¥ Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ù„ÙˆØ¯Ø±
            hideLoader(); 
        }
    
    } else {
        // --- Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ø«Ø§Ù†ÙŠØ©: Ù…Ø³ØªØ®Ø¯Ù… Ø¹Ø§Ø¯ÙŠ (Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨ Ø¥Ù„ØºØ§Ø¡) ---
        const isConfirmed = await showConfirmDialog('Ù‡Ù„ ØªØ±ÙŠØ¯ Ø¥Ø±Ø³Ø§Ù„ "Ø·Ù„Ø¨ Ø¥Ù„ØºØ§Ø¡" Ù„Ù‡Ø°Ø§ Ø§Ù„Ø­Ø¬Ø² Ù„Ù„Ù…Ø¯ÙŠØ±ØŸ\nÙ„Ù† ÙŠØªÙ… Ø§Ù„Ø­Ø°Ù Ø­ØªÙ‰ ÙŠÙˆØ§ÙÙ‚ Ø§Ù„Ù…Ø¯ÙŠØ±.');
        if (!isConfirmed) return;

        // ğŸ”¥ ØªØ´ØºÙŠÙ„ Ø§Ù„Ù„ÙˆØ¯Ø±
        showLoader('Ø¬Ø§Ø±ÙŠ Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨ Ø§Ù„Ø¥Ù„ØºØ§Ø¡...');

        try {
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø­Ø§Ù„Ø© Ø¥Ù„Ù‰ "Ø·Ù„Ø¨ Ø¥Ù„ØºØ§Ø¡"
            const { error } = await supabase
                .from('meetings')
                .update({ status: 'cancellation_requested' })
                .eq('id', selectedMeeting.id);

            if (error) throw error;

            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø­Ø§Ù„Ø© Ù…Ø­Ù„ÙŠØ§Ù‹
            const mIndex = meetings.findIndex(m => m.id === selectedMeeting.id);
            if(mIndex > -1) meetings[mIndex].status = 'cancellation_requested';

            refreshAllViews();
            closeModal('meeting-details-modal');
            showNotification('âœ… ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨ Ø§Ù„Ø¥Ù„ØºØ§Ø¡ Ù„Ù„Ù…Ø¯ÙŠØ± Ø¨Ù†Ø¬Ø§Ø­');
        } catch (error) { 
            showNotification('ÙØ´Ù„ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨', 'error'); 
        } finally { 
            // ğŸ”¥ Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ù„ÙˆØ¯Ø±
            hideLoader(); 
        }
    }
}

// Ø¯Ø§Ù„Ø© Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ (Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„ÙƒØ§Ù…Ù„Ø© Ø§Ù„Ù…ØµØ­Ø­Ø© Ù„Ø¬Ù„Ø¨ ÙƒÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©)
function editMeeting() {
    if (!selectedMeeting) return;

    // 1. Ø§Ù„Ø­Ù…Ø§ÙŠØ©: Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ© (Ù…Ø¯ÙŠØ± Ø£Ùˆ ØµØ§Ø­Ø¨ Ø§Ù„Ø­Ø¬Ø²)
    const isOwner = (currentUser && currentUser.id === selectedMeeting.user_id);
    const isManager = (currentUser && currentUser.role === 'manager');
    
    if (!isManager && !isOwner) {
        showNotification('â›” Ø¹Ø°Ø±Ø§Ù‹ØŒ Ù„Ø§ ØªÙ…Ù„Ùƒ ØµÙ„Ø§Ø­ÙŠØ© Ù„ØªØ¹Ø¯ÙŠÙ„ Ù‡Ø°Ø§ Ø§Ù„Ø­Ø¬Ø²!', 'error');
        return;
    }

    // 2. ØªØ¹Ø¨Ø¦Ø© Ø§Ù„Ù€ ID ÙˆØªØºÙŠÙŠØ± Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø²Ø±
    document.getElementById('meeting-id').value = selectedMeeting.id;
    document.getElementById('save-text').textContent = 'ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø­Ø¬Ø²';

    // 3. ØªØ¹Ø¨Ø¦Ø© Ø§Ù„Ø¹Ù†ÙˆØ§Ù†
    document.getElementById('meeting-title').value = selectedMeeting.title || '';

    // 4. ØªØ¹Ø¨Ø¦Ø© Ø§Ù„ØªØ§Ø±ÙŠØ® (Ø¥ØµÙ„Ø§Ø­ Ø§Ù„Ù…Ø´ÙƒÙ„Ø© Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©)
    if (selectedMeeting.date) {
        const d = new Date(selectedMeeting.date);
        // ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„ØªÙˆÙ‚ÙŠØª Ù„Ø¶Ù…Ø§Ù† Ø¸Ù‡ÙˆØ± Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„ØµØ­ÙŠØ­ (ØªÙØ§Ø¯ÙŠ Ù…Ø´ÙƒÙ„Ø© Ø§Ù„ÙŠÙˆÙ… Ø§Ù„Ø³Ø§Ø¨Ù‚)
        const localDate = new Date(d.getTime() - (d.getTimezoneOffset() * 60000));
        document.getElementById('meeting-date').value = localDate.toISOString().split('T')[0];
    }

    // 5. ØªØ¹Ø¨Ø¦Ø© Ø§Ù„Ù‚ÙˆØ§Ø¦Ù… Ø§Ù„Ù…Ù†Ø³Ø¯Ù„Ø© (Ø§Ù„Ù‚Ø³Ù… ÙˆØ§Ù„ÙˆÙ‚Øª) ÙˆØªØ­Ø¯ÙŠØ« Ø´ÙƒÙ„Ù‡Ø§
    // Ù†Ø³ØªØ®Ø¯Ù… Ø¯Ø§Ù„Ø© setDropdownValue Ù„Ø¶Ù…Ø§Ù† Ø£Ù† Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© ØªØ¸Ù‡Ø± Ø§Ù„Ø®ÙŠØ§Ø± Ø§Ù„Ù…Ø®ØªØ§Ø±
    setDropdownValue('department', selectedMeeting.department);
    setDropdownValue('meeting-time', selectedMeeting.startTime);

    // 6. Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø¯Ø© ÙˆØªØ­Ø¯ÙŠØ¯Ù‡Ø§ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹
    let duration = 1; // Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ
    if (selectedMeeting.startTime && selectedMeeting.endTime) {
        const startH = parseInt(selectedMeeting.startTime.split(':')[0]);
        const endH = parseInt(selectedMeeting.endTime.split(':')[0]);
        duration = endH - startH;
    }
    setDropdownValue('duration', duration.toString());

    // 7. ØªØ¹Ø¨Ø¦Ø© Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù†ØµÙŠØ© Ø§Ù„Ø¥Ø¶Ø§ÙÙŠØ©
    document.getElementById('attendees').value = selectedMeeting.attendees || '';
    document.getElementById('description').value = selectedMeeting.description || '';

    // 8. Ø¥ØºÙ„Ø§Ù‚ Ù†Ø§ÙØ°Ø© Ø§Ù„ØªÙØ§ØµÙŠÙ„ ÙˆÙØªØ­ Ù†Ø§ÙØ°Ø© Ø§Ù„ØªØ¹Ø¯ÙŠÙ„
    closeModal('meeting-details-modal');
    document.getElementById('add-meeting-modal').classList.add('show');
}
        
        // Open dashboard
        function openDashboard() {
            updateDashboard();
            document.getElementById('dashboard-modal').classList.add('show');
        }

// Update dashboard (Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ø°ÙƒÙŠØ© Ø§Ù„Ù…Ø·ÙˆØ±Ø©)
        function updateDashboard() {
            // 1. ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø£Ø±Ù‚Ø§Ù… Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
            document.getElementById('total-meetings').textContent = meetings.length;
            
            // Ø­Ø³Ø§Ø¨ Ù†Ø³Ø¨Ø© Ø§Ù„Ø¥Ø´ØºØ§Ù„ Ø¨Ø¯Ù‚Ø©
            const totalHours = meetings.reduce((sum, meeting) => {
                const duration = timeToMinutes(meeting.endTime) - timeToMinutes(meeting.startTime);
                return sum + (duration / 60);
            }, 0);
            const maxHours = 10 * 6; // Ø§ÙØªØ±Ø§Ø¶: 10 Ø³Ø§Ø¹Ø§Øª Ø¹Ù…Ù„ * 6 Ø£ÙŠØ§Ù…
            const usagePercentage = Math.min(Math.round((totalHours / maxHours) * 100), 100);
            
            document.getElementById('usage-percentage').textContent = `${usagePercentage}%`;
            document.getElementById('usage-bar').style.width = `${usagePercentage}%`;
            
            // Ø§Ù„Ø¬Ù‡Ø§Øª Ø§Ù„Ù†Ø´Ø·Ø©
            const activeDepts = new Set(meetings.map(m => m.department));
            document.getElementById('active-departments').textContent = activeDepts.size;
            
            // 2. ØªØ­Ø¯ÙŠØ« Ù‚Ø§Ø¦Ù…Ø© "Ø§Ù„Ø£ÙƒØ«Ø± Ø§Ø³ØªØ®Ø¯Ø§Ù…Ø§Ù‹" (Leaderboard)
            const deptUsage = {};
            meetings.forEach(meeting => {
                const dept = departments[meeting.department].name;
                deptUsage[dept] = (deptUsage[dept] || 0) + 1;
            });
            
            // ØªØ±ØªÙŠØ¨ Ø§Ù„Ø£Ù‚Ø³Ø§Ù… ØªÙ†Ø§Ø²Ù„ÙŠØ§Ù‹
            const sortedDepts = Object.entries(deptUsage).sort((a, b) => b[1] - a[1]).slice(0, 4);
            const chartContainer = document.getElementById('department-chart');
            chartContainer.innerHTML = '';
            
            if (sortedDepts.length === 0) {
                chartContainer.innerHTML = '<div class="text-center text-gray-400 text-xs py-4">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª ÙƒØ§ÙÙŠØ©</div>';
            } else {
                sortedDepts.forEach(([dept, count], index) => {
                    const percentage = Math.round((count / meetings.length) * 100);
                    const rankColor = index === 0 ? 'bg-yellow-100 text-yellow-700 border-yellow-200' : 'bg-gray-50 text-gray-600 border-gray-100';
                    const icon = index === 0 ? '<i class="fas fa-crown text-yellow-500 ml-2"></i>' : '';
                    
                    const bar = document.createElement('div');
                    bar.innerHTML = `
                        <div class="flex justify-between items-center mb-1 text-xs">
                            <span class="font-bold text-gray-700 flex items-center">${icon} ${dept}</span>
                            <span class="font-bold text-[#2A3475]">${count} Ø­Ø¬Ø²</span>
                        </div>
                        <div class="w-full bg-gray-100 rounded-full h-2 mb-3">
                            <div class="bg-[#2A3475] h-2 rounded-full" style="width: ${percentage}%"></div>
                        </div>
                    `;
                    chartContainer.appendChild(bar);
                });
            }
            
            // 3. ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª Ø§Ù„Ø£Ø®ÙŠØ±Ø© (Timeline)
            const recentMeetings = meetings
                .sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt))
                .slice(0, 4);
            
            const recentContainer = document.getElementById('recent-meetings');
            recentContainer.innerHTML = '<div class="absolute top-2 bottom-2 right-[9px] w-0.5 bg-gray-100"></div>'; // Ø¥Ø¹Ø§Ø¯Ø© Ø±Ø³Ù… Ø§Ù„Ø®Ø·
            
            if (recentMeetings.length === 0) {
                recentContainer.innerHTML += '<div class="text-center text-gray-400 text-xs py-4 pr-4">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†Ø´Ø§Ø·Ø§Øª Ø­Ø¯ÙŠØ«Ø©</div>';
            } else {
                recentMeetings.forEach(meeting => {
                    const item = document.createElement('div');
                    item.className = 'flex items-start relative pr-6 mb-4 last:mb-0';
                    item.innerHTML = `
                        <div class="absolute right-0 top-1.5 w-5 h-5 bg-white border-2 border-[#F3A628] rounded-full z-10"></div>
                        
                        <div class="flex-1">
                            <div class="font-bold text-xs text-[#2A3475]">${meeting.title}</div>
                            <div class="text-[10px] text-gray-500 mt-0.5 flex items-center">
                                <i class="far fa-clock ml-1"></i> ${new Date(meeting.date).toLocaleDateString('ar-EG', {month:'numeric', day:'numeric'})} | ${meeting.startTime}
                            </div>
                            <span class="inline-block mt-1 px-2 py-0.5 bg-gray-100 text-gray-600 text-[10px] rounded border border-gray-200">
                                ${departments[meeting.department].name}
                            </span>
                        </div>
                    `;
                    recentContainer.appendChild(item);
                });
            }

            // 4. ØªÙˆÙ„ÙŠØ¯ Ø±Ø¤ÙŠØ© ØªØ­Ù„ÙŠÙ„ÙŠØ© (Insight)
            const insightBox = document.getElementById('dashboard-insight');
            if (sortedDepts.length > 0) {
                const topDept = sortedDepts[0][0];
                insightBox.innerHTML = `Ø§Ù„Ø¬Ù‡Ø© Ø§Ù„Ø£ÙƒØ«Ø± Ù†Ø´Ø§Ø·Ø§Ù‹ Ù‡Ø°Ø§ Ø§Ù„Ø´Ù‡Ø± Ù‡ÙŠ <span class="font-bold text-[#2A3475]">${topDept}</span>. 
                Ù…Ø¹Ø¯Ù„ Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª ÙŠØ´ÙŠØ± Ø¥Ù„Ù‰ ${usagePercentage > 50 ? 'Ø¶ØºØ· Ù…Ø±ØªÙØ¹' : 'Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù…ØªÙˆØ§Ø²Ù†'} Ù„Ù„Ù‚Ø§Ø¹Ø©.`;
            } else {
                insightBox.textContent = "Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª ÙƒØ§ÙÙŠØ© Ù„ØªÙ‚Ø¯ÙŠÙ… ØªØ­Ù„ÙŠÙ„ Ø­Ø§Ù„ÙŠØ§Ù‹.";
            }
        }

// Generate Smart AI Analytics (Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ù…ØªØ·ÙˆØ±Ø© Ø¬Ø¯Ø§Ù‹)
        function generateAISuggestions() {
            const container = document.getElementById('ai-suggestions');
            container.innerHTML = '';
            
            const now = new Date();
            const currentHour = now.getHours();
            const currentMinutes = now.getMinutes();
            const currentTimeVal = currentHour * 60 + currentMinutes; // ØªØ­ÙˆÙŠÙ„ Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ø­Ø§Ù„ÙŠ Ù„Ø¯Ù‚Ø§Ø¦Ù‚
            const timeString = `${currentHour.toString().padStart(2, '0')}:${currentMinutes.toString().padStart(2, '0')}`;

            // 1. ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ø­ÙŠØ© ÙˆØ§Ù„Ø¹Ø¯Ø§Ø¯ Ø§Ù„ØªÙ†Ø§Ø²Ù„ÙŠ
            let currentMeeting = null;
            let nextMeeting = null;
            let timeRemaining = "";
            let statusHTML = "";

            meetings.forEach(m => {
                const mDate = new Date(m.date);
                if (mDate.toDateString() === now.toDateString()) {
                    // ØªØ­ÙˆÙŠÙ„ Ø£ÙˆÙ‚Ø§Øª Ø§Ù„Ø§Ø¬ØªÙ…Ø§Ø¹ Ù„Ø¯Ù‚Ø§Ø¦Ù‚ Ù„Ù„Ù…Ù‚Ø§Ø±Ù†Ø©
                    const startMin = timeToMinutes(m.startTime);
                    const endMin = timeToMinutes(m.endTime);

                    if (currentTimeVal >= startMin && currentTimeVal < endMin) {
                        currentMeeting = m;
                        // Ø­Ø³Ø§Ø¨ Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ
                        const remaining = endMin - currentTimeVal;
                        const rHours = Math.floor(remaining / 60);
                        const rMins = remaining % 60;
                        timeRemaining = rHours > 0 ? `${rHours} Ø³Ø§Ø¹Ø© Ùˆ ${rMins} Ø¯Ù‚ÙŠÙ‚Ø©` : `${rMins} Ø¯Ù‚ÙŠÙ‚Ø©`;
                    }
                    if (startMin > currentTimeVal && (!nextMeeting || startMin < timeToMinutes(nextMeeting.startTime))) {
                        nextMeeting = m;
                    }
                }
            });

            // ÙƒØ§Ø±Øª Ø§Ù„Ø­Ø§Ù„Ø© (Live Status)
            if (currentMeeting) {
                statusHTML = `
                    <div class="bg-red-50 border-r-4 border-red-500 p-4 rounded-lg mb-3 shadow-sm">
                        <div class="flex justify-between items-start">
                            <div>
                                <h4 class="text-red-800 font-bold text-sm mb-1"><i class="fas fa-circle text-[10px] animate-pulse ml-2"></i> Ø§Ù„Ù‚Ø§Ø¹Ø© Ù…Ø´ØºÙˆÙ„Ø© Ø­Ø§Ù„ÙŠØ§Ù‹</h4>
                                <p class="text-gray-700 font-bold text-base">${currentMeeting.title}</p>
                                <p class="text-xs text-gray-500 mt-1">Ø¨ÙˆØ§Ø³Ø·Ø©: ${departments[currentMeeting.department].name}</p>
                            </div>
                            <div class="text-left">
                                <span class="block text-xs text-gray-400">Ø³ØªÙØ±Øº Ø®Ù„Ø§Ù„</span>
                                <span class="block text-lg font-bold text-red-600">${timeRemaining}</span>
                            </div>
                        </div>
                    </div>
                `;
            } else {
                statusHTML = `
                    <div class="bg-green-50 border-r-4 border-green-500 p-4 rounded-lg mb-3 shadow-sm">
                        <div class="flex justify-between items-center">
                            <div>
                                <h4 class="text-green-800 font-bold text-sm mb-1"><i class="fas fa-check-circle ml-2"></i> Ø§Ù„Ù‚Ø§Ø¹Ø© Ù…ØªØ§Ø­Ø© Ø§Ù„Ø¢Ù†</h4>
                                <p class="text-xs text-gray-600 mt-1">
                                    ${nextMeeting 
                                    ? `Ø§Ù„Ø§Ø¬ØªÙ…Ø§Ø¹ Ø§Ù„Ù‚Ø§Ø¯Ù… Ø§Ù„Ø³Ø§Ø¹Ø© <span class="font-bold text-[#2A3475]">${nextMeeting.startTime}</span>` 
                                    : 'Ù„Ø§ ØªÙˆØ¬Ø¯ Ø§Ø¬ØªÙ…Ø§Ø¹Ø§Øª Ø£Ø®Ø±Ù‰ Ø§Ù„ÙŠÙˆÙ…'}
                                </p>
                            </div>
                            <div class="bg-white p-2 rounded-full shadow-sm">
                                <i class="fas fa-door-open text-green-500 text-xl"></i>
                            </div>
                        </div>
                    </div>
                `;
            }

            // 2. ØªØ­Ù„ÙŠÙ„ Ø§Ù„ÙƒÙØ§Ø¡Ø© ÙˆØ§Ù„ÙØ¬ÙˆØ§Øª (Gap Analysis)
            // Ù†Ø¬Ù…Ø¹ ÙƒÙ„ Ø§Ù„Ø¯Ù‚Ø§Ø¦Ù‚ Ø§Ù„Ù…Ø­Ø¬ÙˆØ²Ø© Ø§Ù„Ù†Ù‡Ø§Ø±Ø¯Ø© Ø¹Ø´Ø§Ù† Ù†Ø­Ø³Ø¨ Ø§Ù„Ù†Ø³Ø¨Ø©
            let occupiedMinutes = 0;
            const totalWorkMinutes = (18 - 8) * 60; // Ù…Ù† 8 Øµ Ù„Ù€ 6 Ù… (10 Ø³Ø§Ø¹Ø§Øª)
            
            const todayMeetings = meetings.filter(m => new Date(m.date).toDateString() === now.toDateString());
            todayMeetings.forEach(m => {
                occupiedMinutes += (timeToMinutes(m.endTime) - timeToMinutes(m.startTime));
            });

            const utilizationRate = Math.round((occupiedMinutes / totalWorkMinutes) * 100);
            let utilizationColor = utilizationRate > 75 ? 'bg-red-500' : (utilizationRate > 40 ? 'bg-yellow-500' : 'bg-green-500');
            let utilizationText = utilizationRate > 75 ? 'Ø¶ØºØ· Ù…Ø±ØªÙØ¹' : (utilizationRate > 40 ? 'Ù†Ø´Ø§Ø· Ù…ØªÙˆØ³Ø·' : 'Ù‡Ø¯ÙˆØ¡ Ù†Ø³Ø¨ÙŠ');

            // Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† "Ø§Ù„ÙØ±ØµØ© Ø§Ù„Ø°Ù‡Ø¨ÙŠØ©" (Ø£ÙƒØ¨Ø± ÙØ¬ÙˆØ© ÙØ§Ø±ØºØ©)
            // (Ø®ÙˆØ§Ø±Ø²Ù…ÙŠØ© Ø¨Ø³ÙŠØ·Ø© Ù„Ø§Ù‚ØªØ±Ø§Ø­ Ø£ÙØ¶Ù„ ÙˆÙ‚Øª)
            let suggestionHTML = "";
            if (utilizationRate < 90) {
                 suggestionHTML = `
                    <div class="flex items-start space-x-3 space-x-reverse mt-4 pt-4 border-t border-gray-100">
                        <div class="bg-[#F3A628]/10 p-2 rounded-lg shrink-0">
                            <i class="fas fa-lightbulb text-[#F3A628] text-lg"></i>
                        </div>
                        <div>
                            <h5 class="text-sm font-bold text-[#2A3475]">Ø§Ù‚ØªØ±Ø§Ø­ Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ø°ÙƒÙŠ</h5>
                            <p class="text-xs text-gray-500 mt-1 leading-relaxed">
                                Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø¬Ø¯ÙˆÙ„ØŒ Ø§Ù„ÙØªØ±Ø© Ø§Ù„ØµØ¨Ø§Ø­ÙŠØ© Ù…Ù† <span class="font-bold text-gray-800">08:00 - 10:00</span> Ù‡ÙŠ Ø§Ù„Ø£Ù†Ø³Ø¨ Ù„Ø¹Ù‚Ø¯ Ø§Ù„Ø§Ø¬ØªÙ…Ø§Ø¹Ø§Øª Ø§Ù„Ø·ÙˆÙŠÙ„Ø© Ø§Ù„ÙŠÙˆÙ… Ù„Ù‚Ù„Ø© Ø§Ù„ØªØ¹Ø§Ø±Ø¶Ø§Øª.
                            </p>
                        </div>
                    </div>
                 `;
            }

            // ØªØ¬Ù…ÙŠØ¹ Ø§Ù„Ù€ HTML Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ
            container.innerHTML = `
                ${statusHTML}
                
                <div class="bg-gray-50 rounded-lg p-3 border border-gray-100">
                    <div class="flex justify-between items-center mb-2">
                        <span class="text-xs font-bold text-gray-600">Ù…Ø¹Ø¯Ù„ Ø¥Ø´ØºØ§Ù„ Ø§Ù„ÙŠÙˆÙ…</span>
                        <span class="text-[10px] px-2 py-0.5 rounded-full ${utilizationColor} text-white font-bold">${utilizationText} (${utilizationRate}%)</span>
                    </div>
                    <div class="w-full bg-gray-200 rounded-full h-2">
                        <div class="${utilizationColor} h-2 rounded-full transition-all duration-1000" style="width: ${utilizationRate}%"></div>
                    </div>
                </div>

                ${suggestionHTML}
            `;
        }

// Open admin panel
function openAdminPanel() {
    // ØªØ­Ø¯ÙŠØ« Ø§Ù„ØµÙˆØ±Ø© ÙˆØ§Ù„Ø§Ø³Ù… ÙÙŠ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ©
    updateSidebarProfile(); 

    // Ø¬Ù„Ø¨ ÙƒÙ„ Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª ÙÙŠ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ©
    const allTabs = document.querySelectorAll('.admin-tab');

    if (currentUser.role === 'manager') {
        // --- Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø¯ÙŠØ±: Ø¥Ø¸Ù‡Ø§Ø± ÙƒÙ„ Ø´ÙŠØ¡ ---
        allTabs.forEach(tab => tab.style.display = 'flex');
        
        // ÙØªØ­ ØªØ¨ÙˆÙŠØ¨ Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª Ø§ÙØªØ±Ø§Ø¶ÙŠØ§Ù‹ Ù„Ù„Ù…Ø¯ÙŠØ±
        updateAdminMeetingsList();
        updateAdminUsersList();
        try { updateAdminReports(); } catch(e) {}
        switchAdminTab('meetings');
        
    } else {
        // --- Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø¹Ø§Ø¯ÙŠ: Ø¥Ø®ÙØ§Ø¡ ÙƒÙ„ Ø´ÙŠØ¡ Ù…Ø§ Ø¹Ø¯Ø§ Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ ---
        allTabs.forEach(tab => {
            if (tab.dataset.tab === 'profile') {
                tab.style.display = 'flex'; // Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ ÙÙ‚Ø·
            } else {
                tab.style.display = 'none'; // Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø¨Ø§Ù‚ÙŠ
            }
        });
        
        // ÙØªØ­ ØªØ¨ÙˆÙŠØ¨ Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ Ø¥Ø¬Ø¨Ø§Ø±ÙŠØ§Ù‹
        switchAdminTab('profile');
    }

    // Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ù†Ø§ÙØ°Ø©
    document.getElementById('admin-panel-modal').classList.add('show');
}

        // Switch admin tabs (ØªØ­Ø¯ÙŠØ« Ù„Ù„ÙƒÙˆØ¯ Ø§Ù„Ø¬Ø¯ÙŠØ¯ - Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ©)
        function switchAdminTab(tabName) {
            // 1. Ø¥Ø²Ø§Ù„Ø© Ø§Ù„ØªÙ†Ø´ÙŠØ· Ù…Ù† ÙƒÙ„ Ø§Ù„Ø£Ø²Ø±Ø§Ø±
            document.querySelectorAll('.admin-tab').forEach(btn => {
                btn.classList.remove('active', 'bg-gray-100'); // Ø¥Ø²Ø§Ù„Ø© Ø®Ù„ÙÙŠØ© Ø§Ù„Ø²Ø± Ø§Ù„Ù†Ø´Ø·
                
                // Ø¥Ø±Ø¬Ø§Ø¹ Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø© Ù„Ù„ÙˆÙ† Ø§Ù„Ø±Ù…Ø§Ø¯ÙŠ
                const iconBox = btn.querySelector('div');
                if (iconBox) {
                    iconBox.classList.remove('bg-[#2A3475]', 'text-white');
                    iconBox.classList.add('bg-gray-100', 'text-gray-500');
                }

                // Ø§Ù„Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©:
            if (tabName === 'profile') {
                loadProfileTab();
            }

                // Ø¥Ø±Ø¬Ø§Ø¹ Ø§Ù„Ù†Øµ Ù„Ù„ÙˆÙ† Ø§Ù„Ø±Ù…Ø§Ø¯ÙŠ
                const text = btn.querySelector('span');
                if (text) {
                    text.classList.remove('text-[#2A3475]');
                    text.classList.add('text-gray-600');
                }
            });
            
            // 2. ØªÙ†Ø´ÙŠØ· Ø§Ù„Ø²Ø± Ø§Ù„Ù…Ø®ØªØ§Ø±
            const activeBtn = document.querySelector(`.admin-tab[data-tab="${tabName}"]`);
            if (activeBtn) {
                activeBtn.classList.add('active', 'bg-gray-100'); // Ø¥Ø¶Ø§ÙØ© Ø®Ù„ÙÙŠØ© Ø®ÙÙŠÙØ© Ù„Ù„Ø²Ø±
                
                // ØªÙ„ÙˆÙŠÙ† Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø¨Ø§Ù„ÙƒØ­Ù„ÙŠ
                const iconBox = activeBtn.querySelector('div');
                if (iconBox) {
                    iconBox.classList.remove('bg-gray-100', 'text-gray-500');
                    iconBox.classList.add('bg-[#2A3475]', 'text-white');
                }
                
                // ØªÙ„ÙˆÙŠÙ† Ø§Ù„Ù†Øµ Ø¨Ø§Ù„ÙƒØ­Ù„ÙŠ
                const text = activeBtn.querySelector('span');
                if (text) {
                    text.classList.remove('text-gray-600');
                    text.classList.add('text-[#2A3475]');
                }
            }

            // 3. Ø¥Ø®ÙØ§Ø¡ ÙƒÙ„ Ø§Ù„Ù…Ø­ØªÙˆÙ‰ ÙˆØ¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ù…Ø·Ù„ÙˆØ¨ ÙÙ‚Ø·
            document.querySelectorAll('.admin-tab-content').forEach(content => {
                content.classList.add('hidden');
            });
            
            const targetContent = document.getElementById(`admin-${tabName}-tab`);
            if (targetContent) {
                targetContent.classList.remove('hidden');
            }
        }

function updateAdminMeetingsList() {
            filterAdminMeetings('all'); // Ø§ÙØªØ±Ø§Ø¶ÙŠØ§Ù‹ ÙŠØ¹Ø±Ø¶ Ø§Ù„ÙƒÙ„
        }

        // Ø¯Ø§Ù„Ø© ÙÙ„ØªØ±Ø© Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª ÙÙŠ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…
        function filterAdminMeetings(type) {
            // 1. ØªØ­Ø¯ÙŠØ« Ø´ÙƒÙ„ Ø§Ù„Ø£Ø²Ø±Ø§Ø±
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.classList.remove('bg-[#2A3475]', 'text-white', 'shadow-sm');
                btn.classList.add('text-gray-500', 'hover:bg-gray-50');
            });
            
            const activeBtn = document.getElementById(`filter-${type}`);
            if(activeBtn) {
                activeBtn.classList.remove('text-gray-500', 'hover:bg-gray-50');
                activeBtn.classList.add('bg-[#2A3475]', 'text-white', 'shadow-sm');
            }

            // 2. Ø§Ù„ÙÙ„ØªØ±Ø© Ø§Ù„ÙØ¹Ù„ÙŠØ©
            const now = new Date();
            now.setHours(0,0,0,0); // ØªØµÙÙŠØ± Ø§Ù„ÙˆÙ‚Øª Ù„Ù„Ù…Ù‚Ø§Ø±Ù†Ø© Ø¨Ø§Ù„ÙŠÙˆÙ…

            let filteredMeetings = [];
            
            if (type === 'all') {
                filteredMeetings = meetings;
            } else if (type === 'upcoming') {
                filteredMeetings = meetings.filter(m => new Date(m.date) >= now);
            } else if (type === 'past') {
                filteredMeetings = meetings.filter(m => new Date(m.date) < now);
            }

            // 3. Ø¥Ø¹Ø§Ø¯Ø© Ø±Ø³Ù… Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø¨Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ÙÙ„ØªØ±Ø©
            renderAdminMeetingsTable(filteredMeetings);
        }


// ==========================================
        // Ø¯ÙˆØ§Ù„ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ (Profile Management) - Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„ÙƒØ§Ù…Ù„Ø©
        // ==========================================

        // 1. ÙØªØ­ Ø§Ù„Ù†Ø§ÙØ°Ø© ÙˆØªØ¹Ø¨Ø¦Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        window.openProfileModal = function() {
            if(!currentUser) return;
            
            // ØªØ¹Ø¨Ø¦Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©
            document.getElementById('my-name').value = currentUser.full_name || '';
            document.getElementById('my-mobile').value = currentUser.mobile || '';
            document.getElementById('my-email').value = currentUser.email || '';
            
            // ØªØ¹Ø¨Ø¦Ø© Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© (Ø§Ù„Ù…Ø³Ù…Ù‰ ÙˆØ§Ù„Ù‚Ø³Ù…)
            // Ù†ØªØ£ÙƒØ¯ Ø¥Ù† Ø§Ù„Ø¹Ù†Ø§ØµØ± Ù…ÙˆØ¬ÙˆØ¯Ø© Ø§Ù„Ø£ÙˆÙ„ Ø¹Ø´Ø§Ù† Ù…ÙŠØ¯ÙŠÙ†Ø§Ø´ Ø®Ø·Ø£
            const posInput = document.getElementById('my-position');
            const deptInput = document.getElementById('my-dept');
            
            if(posInput) posInput.value = currentUser.position || '';
            if(deptInput) deptInput.value = currentUser.department || '';

            // ØªØµÙÙŠØ± Ø§Ù„Ø¨Ø§Ø³ÙˆØ±Ø¯
            document.getElementById('my-new-password').value = ''; 
            
            document.getElementById('profile-modal').classList.add('show');
        }

        // 2. Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø­ÙØ¸ Ø¨Ø°ÙƒØ§Ø¡ (Ø´Ø§Ù…Ù„Ø© Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©)
        const profileForm = document.getElementById('profile-form');
        if(profileForm) {
            profileForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                const btn = e.target.querySelector('button');
                const originalText = btn.innerText;
                btn.innerText = 'Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø­ÙØ¸...';
                btn.disabled = true;

                // Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ù‚ÙŠÙ… Ù…Ù† Ø§Ù„ÙÙˆØ±Ù…
                const newName = document.getElementById('my-name').value;
                const newMobile = document.getElementById('my-mobile').value;
                const newEmail = document.getElementById('my-email').value;
                const newPass = document.getElementById('my-new-password').value;
                
                // Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
                const newPosition = document.getElementById('my-position') ? document.getElementById('my-position').value : null;
                const newDept = document.getElementById('my-dept') ? document.getElementById('my-dept').value : null;

                let messages = [];

                try {
                    // Ø£. ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© (Ø§Ù„Ø§Ø³Ù…ØŒ Ø§Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„ØŒ Ø§Ù„ÙˆØ¸ÙŠÙØ©ØŒ Ø§Ù„Ù‚Ø³Ù…) ÙÙŠ Ø¬Ø¯ÙˆÙ„ profiles
                    // Ø¨Ù†Ø´ÙˆÙ Ù‡Ù„ ÙÙŠÙ‡ Ø£ÙŠ ØªØºÙŠÙŠØ± Ø­ØµÙ„ ÙÙŠ Ø£ÙŠ Ø­Ù‚Ù„ Ù…Ù† Ø¯ÙˆÙ„
                    if (newName !== currentUser.full_name || 
                        newMobile !== currentUser.mobile || 
                        newPosition !== currentUser.position || 
                        newDept !== currentUser.department) {
                        
                        const updateData = {
                            full_name: newName,
                            mobile: newMobile,
                            position: newPosition,
                            department: newDept
                        };

                        const { error } = await supabase
                            .from('profiles')
                            .update(updateData)
                            .eq('id', currentUser.id);
                        
                        if (error) throw error;
                        
                        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ù„ÙŠØ© ÙÙŠ Ø§Ù„Ù…ØªØµÙØ­ ÙÙˆØ±Ø§Ù‹
                        currentUser.full_name = newName;
                        currentUser.mobile = newMobile;
                        currentUser.position = newPosition;
                        currentUser.department = newDept;
                        localStorage.setItem('currentUser', JSON.stringify(currentUser));
                        
                        // ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© (Ø§Ù„Ù‡ÙŠØ¯Ø± ÙˆØ§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ©)
                        if (typeof applyUserPermissions === 'function') applyUserPermissions();
                        if (typeof updateSidebarProfile === 'function') updateSidebarProfile();
                        
                        messages.push("ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø´Ø®ØµÙŠØ© âœ…");
                    }

                    // Ø¨. ØªØ­Ø¯ÙŠØ« ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± (Ù„Ùˆ Ø§ØªÙƒØªØ¨Øª)
                    if (newPass && newPass.length >= 6) {
                        const { error } = await supabase.auth.updateUser({ password: newPass });
                        if (error) throw error;
                        messages.push("ØªÙ… ØªØºÙŠÙŠØ± ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø¨Ù†Ø¬Ø§Ø­ ğŸ”’");
                    }

                    // Ø¬. ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„ (Ù„Ùˆ Ø§ØªØºÙŠØ±) - Ø¯Ù‡ Ø¨ÙŠØ­ØªØ§Ø¬ ØªØ£ÙƒÙŠØ¯
                    if (newEmail !== currentUser.email) {
                        const { error } = await supabase.auth.updateUser({ email: newEmail });
                        if (error) throw error;
                        messages.push("âš ï¸ ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø±Ø§Ø¨Ø· ØªØ£ÙƒÙŠØ¯ Ø¥Ù„Ù‰ Ø¥ÙŠÙ…ÙŠÙ„Ùƒ Ø§Ù„Ø¬Ø¯ÙŠØ¯. Ù„Ù† ÙŠØªØºÙŠØ± Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„ Ø­ØªÙ‰ ØªØ¤ÙƒØ¯Ù‡.");
                    }

                    // Ø¹Ø±Ø¶ Ø§Ù„Ù†ØªÙŠØ¬Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©
                    if (messages.length > 0) {
                        const hasWarning = messages.some(m => m.includes('âš ï¸'));
                        showNotification(messages.join('<br>'), hasWarning ? 'info' : 'success');
                        closeModal('profile-modal');
                        
                        // ØªØ³Ø¬ÙŠÙ„ ÙÙŠ Ø§Ù„Ù„ÙˆØ¬
                        logActivity('ØªØ­Ø¯ÙŠØ« Ø¨Ø±ÙˆÙØ§ÙŠÙ„', 'Ù‚Ø§Ù… Ø¨ØªØ­Ø¯ÙŠØ« Ø¨ÙŠØ§Ù†Ø§ØªÙ‡ Ø§Ù„Ø´Ø®ØµÙŠØ©');
                    } else {
                        showNotification('Ù„Ù… ÙŠØªÙ… ØªØºÙŠÙŠØ± Ø£ÙŠ Ø¨ÙŠØ§Ù†Ø§Øª', 'info');
                    }

                } catch (err) {
                    console.error(err);
                    showNotification('Ø®Ø·Ø£: ' + err.message, 'error');
                } finally {
                    btn.innerText = originalText;
                    btn.disabled = false;
                }
            });
        }
        
// 2. Ø­Ø°Ù Ø­Ø¬Ø² ÙØ±Ø¯ÙŠ Ù…Ù† Ø§Ù„Ù„ÙˆØ­Ø© (ØªÙ… Ø§Ù„ØªØµØ­ÙŠØ­ Ù„ØªÙƒÙˆÙ† Global)
        window.deleteMeetingFromAdmin = async function(id) {
            if(!confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø­Ø¬Ø² Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹ Ù…Ù† Ø§Ù„Ø³Ø¬Ù„Ø§ØªØŸ')) return;

            // ØªØºÙŠÙŠØ± Ø´ÙƒÙ„ Ø§Ù„Ø²Ø±Ø§Ø± Ù„ÙŠØ¯Ù„ Ø¹Ù„Ù‰ Ø§Ù„ØªØ­Ù…ÙŠÙ„ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ Ù„Ùˆ Ø­Ø§Ø¨Ø¨ ØªØ¶ÙŠÙ ID Ù„Ù„Ø²Ø±Ø§Ø±)
            document.body.style.cursor = 'wait';

            try {
                // Ø§Ù„Ø­Ø°Ù Ù…Ù† Supabase
                const { error } = await supabase.from('meetings').delete().eq('id', id);
                if(error) throw error;

                // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…ØµÙÙˆÙØ© Ø§Ù„Ù…Ø­Ù„ÙŠØ©
                meetings = meetings.filter(m => m.id != id);
                
                // ØªØ­Ø¯ÙŠØ« ÙƒÙ„ Ø§Ù„ÙˆØ§Ø¬Ù‡Ø§Øª ÙÙˆØ±Ø§Ù‹
                updateAdminMeetingsList(); // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¬Ø¯ÙˆÙ„ ÙÙŠ Ø§Ù„Ù„ÙˆØ­Ø©
                renderCalendar();         // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ
                updateDashboard();        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
                generateAISuggestions();  // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯ Ø§Ù„Ø°ÙƒÙŠ
                
                showNotification('ØªÙ… Ø­Ø°Ù Ø§Ù„Ø­Ø¬Ø² Ø¨Ù†Ø¬Ø§Ø­');

            } catch(err) {
                console.error(err);
                showNotification('ÙØ´Ù„ Ø§Ù„Ø­Ø°Ù', 'error');
            } finally {
                document.body.style.cursor = 'default';
            }
        };

        // 4. ØªØ´ØºÙŠÙ„ Ø²Ø± "ØªØ­Ø¯ÙŠØ¯ Ø§Ù„ÙƒÙ„"
        const selectAllBtn = document.getElementById('select-all-meetings');
        if(selectAllBtn) {
            selectAllBtn.addEventListener('change', (e) => {
                const checkboxes = document.querySelectorAll('.meeting-checkbox');
                checkboxes.forEach(cb => cb.checked = e.target.checked);
            });
        }
// ØªØ­Ø¯ÙŠØ« Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¨Ø±ÙˆÙØ§ÙŠÙ„ ÙÙŠ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ© (Ù…Ø¹Ø¯Ù„Ø© Ù„Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø³Ù…Ù‰ Ø§Ù„ÙˆØ¸ÙŠÙÙŠ)
        function updateSidebarProfile() {
            const sidebarName = document.getElementById('sidebar-user-name');
            const sidebarRole = document.getElementById('sidebar-user-role');
            const sidebarAvatar = document.getElementById('sidebar-user-avatar');

            if (currentUser) {
                // 1. ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø§Ø³Ù…
                if(sidebarName) sidebarName.textContent = currentUser.full_name || 'Ù…Ø³ØªØ®Ø¯Ù…';
                
                // 2. ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¯ÙˆØ± (Ø§Ù„ÙˆØµÙ Ø§Ù„Ù„ÙŠ ØªØ­Øª Ø§Ù„Ø§Ø³Ù…)
                if(sidebarRole) {
                    // Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ© Ø§Ù„Ø£ÙˆÙ„Ù‰: Ø§Ù„Ù…Ø³Ù…Ù‰ Ø§Ù„ÙˆØ¸ÙŠÙÙŠ (Ø²ÙŠ "ÙÙ†ÙŠ" Ø£Ùˆ "Ø¯ÙƒØªÙˆØ±")
                    if (currentUser.position && currentUser.position.trim() !== "") {
                        sidebarRole.textContent = currentUser.position;
                    }
                    // Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ© Ø§Ù„Ø«Ø§Ù†ÙŠØ©: Ù„Ùˆ Ù…ÙÙŠØ´ Ù…Ø³Ù…Ù‰ØŒ Ù†Ø´ÙˆÙ Ø§Ù„Ù‚Ø³Ù…
                    else if (currentUser.department === 'computer-lab') {
                        sidebarRole.textContent = 'IT Unit';
                    } 
                    // Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ© Ø§Ù„Ø«Ø§Ù„Ø«Ø©: Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©
                    else {
                        sidebarRole.textContent = currentUser.role === 'manager' ? 'Ù…Ø¯ÙŠØ± Ø§Ù„Ù†Ø¸Ø§Ù…' : 'Ù…Ø³ØªØ®Ø¯Ù…';
                    }
                }
                
                // 3. ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù„ÙˆØ¬Ùˆ (Ø§Ù„Ø¯Ø§Ø¦Ø±Ø© Ø§Ù„ÙƒØ¨ÙŠØ±Ø©)
                if (sidebarAvatar) {
                    if (currentUser.role === 'manager' || currentUser.department === 'computer-lab') {
                        sidebarAvatar.textContent = 'IT';
                        sidebarAvatar.style.borderColor = '#4ade80'; 
                    } else {
                        sidebarAvatar.textContent = currentUser.full_name ? currentUser.full_name.charAt(0).toUpperCase() : 'U';
                        sidebarAvatar.style.borderColor = '#F3A628'; 
                    }
                }
            }
        }

// ============================================================
// ØªØ­Ø¯ÙŠØ« Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† ÙˆØ¥Ø­ØµØ§Ø¦ÙŠØ§ØªÙ‡Ù… (Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ© Ø§Ù„Ø°ÙƒÙŠØ© ğŸ§ )
// ============================================================
async function updateAdminUsersList() {
    if(typeof updateSidebarProfile === 'function') updateSidebarProfile(); 

    const activeUsersList = document.getElementById('active-users-list');
    const countBadge = document.getElementById('users-count-badge');
    const filterDept = document.getElementById('filter-users-dept') ? document.getElementById('filter-users-dept').value : '';
    const deptStats = document.getElementById('department-stats');

    // Ø¹Ø±Ø¶ Ù…Ø¤Ø´Ø± Ø§Ù„ØªØ­Ù…ÙŠÙ„
    if(activeUsersList) activeUsersList.innerHTML = '<tr><td colspan="5" class="text-center py-8"><i class="fas fa-spinner fa-spin text-[#2A3475] text-2xl"></i></td></tr>';

    try {
        // 1. Ø¬Ù„Ø¨ ÙƒÙ„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†
        let { data: users, error } = await supabase.from('profiles').select('*').order('created_at', { ascending: false });
        if (error) throw error;

        // 2. ØªØ­Ø¯ÙŠØ« Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
        const totalAdmins = users.filter(u => u.role === 'manager').length;
        const totalNormal = users.length - totalAdmins;

        if(document.getElementById('stats-total-users')) document.getElementById('stats-total-users').textContent = users.length;
        if(document.getElementById('stats-total-admins')) document.getElementById('stats-total-admins').textContent = totalAdmins;
        if(document.getElementById('stats-total-normal')) document.getElementById('stats-total-normal').textContent = totalNormal;

        // 3. ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ÙÙ„ØªØ±
        if (filterDept) users = users.filter(u => u.department === filterDept);

        if(countBadge) countBadge.textContent = `${users.length} Ù…Ø³ØªØ®Ø¯Ù…`;

        // 4. Ø±Ø³Ù… Ø§Ù„Ø¬Ø¯ÙˆÙ„ (Ù…Ø¹ ØªØµÙ…ÙŠÙ… Ø§Ù„Ø­Ù…Ø§ÙŠØ© Ø§Ù„Ø°ÙƒÙŠ Ù„Ù„Ù…Ø¤Ø³Ø³)
        if(activeUsersList) {
            activeUsersList.innerHTML = '';
            
            if (users.length === 0) {
                activeUsersList.innerHTML = '<tr><td colspan="5" class="text-center py-8 text-gray-400">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬</td></tr>';
            } else {
                users.forEach(user => {
                    // ğŸ›¡ï¸ ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…Ø¤Ø³Ø³
                    const isFounderRow = user.email.trim().toLowerCase() === "fekrythug@gmail.com";
                    // ğŸ‘¤ ØªØ­Ø¯ÙŠØ¯ Ù‡Ù„ Ø£Ù†Ø§ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø­Ø§Ù„ÙŠØŸ
                    const isMe = (currentUser && user.id === currentUser.id);

                    // ØªØ¬Ù‡ÙŠØ² Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ø±Ø¶
                    let deptName = user.department;
                    if (departments[user.department]) deptName = departments[user.department].name;
                    
                    const position = user.position || '---';
                    
                    const mobileDisplay = user.mobile 
                        ? `<div class="text-[10px] text-[#2A3475] font-bold font-sans mt-0.5 flex items-center gap-1" title="${user.mobile}"><i class="fas fa-phone-alt text-gray-400 text-[9px]"></i> ${user.mobile}</div>` 
                        : '';
                    
                    const roleBadge = user.role === 'manager' 
                        ? '<span class="px-2 py-1 bg-red-50 text-red-700 text-[10px] font-bold rounded border border-red-100">Ù…Ø¯ÙŠØ±</span>'
                        : '<span class="px-2 py-1 bg-blue-50 text-blue-700 text-[10px] font-bold rounded border border-blue-100">Ù…Ø³ØªØ®Ø¯Ù…</span>';

                    const avatarText = (user.role === 'manager' || user.department === 'computer-lab') ? 'IT' : (user.full_name ? user.full_name.charAt(0) : 'U');
                    const avatarColor = (user.role === 'manager' || user.department === 'computer-lab') ? 'bg-[#2A3475]' : 'bg-gray-400';

                    // ğŸ”¥ğŸ”¥ğŸ”¥ Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„Ù…Ù†Ø·Ù‚ Ø§Ù„Ø°ÙƒÙŠ Ù„Ù„Ø£Ø²Ø±Ø§Ø± ğŸ”¥ğŸ”¥ğŸ”¥
                    let actionBtns = '';

                    if (isFounderRow) {
                        if (isMe) {
                            // âœ… Ø§Ù„Ø­Ø§Ù„Ø© 1: Ø£Ù†Ø§ Ø§Ù„Ù…Ø¤Ø³Ø³ ÙˆØ£Ù†Ø¸Ø± Ù„Ù†ÙØ³ÙŠ
                            // Ø£Ø¸Ù‡Ø± Ø²Ø± Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ ÙÙ‚Ø· + Ø´Ø§Ø±Ø© Ù…Ù…ÙŠØ²Ø©
                            actionBtns = `<div class="flex justify-center gap-1">`;
                            actionBtns += `<button onclick="openEditUserInfo('${user.id}', '${user.full_name||''}', '${user.department||''}', '${user.position||''}', '${user.mobile||''}')" class="w-7 h-7 flex items-center justify-center rounded-full bg-blue-50 hover:bg-blue-600 hover:text-white text-blue-600 transition-colors" title="ØªØ¹Ø¯ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§ØªÙŠ"><i class="fas fa-pen text-xs"></i></button>`;
                            actionBtns += `<span class="text-[10px] text-gray-400 mx-1 bg-yellow-100 text-yellow-700 px-2 py-1 rounded border border-yellow-200 font-bold">Ø£Ù†Øª (Ø§Ù„Ù…Ø¤Ø³Ø³)</span>`;
                            actionBtns += `</div>`;
                        } else {
                            // â›” Ø§Ù„Ø­Ø§Ù„Ø© 2: Ù…Ø¯ÙŠØ± Ø¢Ø®Ø± ÙŠÙ†Ø¸Ø± Ù„Ù„Ù…Ø¤Ø³Ø³
                            // Ø¯Ø±Ø¹ Ø§Ù„Ø­Ù…Ø§ÙŠØ© ÙÙ‚Ø·
                            actionBtns = `
                                <div class="flex justify-center items-center">
                                    <div class="px-3 py-1 bg-[#F3A628] text-white rounded-full shadow-sm flex items-center gap-2 cursor-help transform hover:scale-105 transition-transform" title="Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø¤Ø³Ø³ (Ù…Ø­Ù…ÙŠ Ø¨Ø§Ù„ÙƒØ§Ù…Ù„)">
                                        <i class="fas fa-shield-alt text-xs"></i>
                                        <span class="text-[10px] font-bold">Ø§Ù„Ù…Ø¤Ø³Ø³</span>
                                    </div>
                                </div>
                            `;
                        }
                    } else {
                        // âœ… Ø§Ù„Ø­Ø§Ù„Ø© 3: Ù…Ø³ØªØ®Ø¯Ù… Ø¹Ø§Ø¯ÙŠ (Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„ÙƒØ§Ù…Ù„Ø©)
                        actionBtns = `<div class="flex justify-center gap-1">`;
                        
                        // Ø²Ø± Ø§Ù„ØªØ¹Ø¯ÙŠÙ„
                        actionBtns += `<button onclick="openEditUserInfo('${user.id}', '${user.full_name||''}', '${user.department||''}', '${user.position||''}', '${user.mobile||''}')" class="w-7 h-7 flex items-center justify-center rounded-full bg-gray-100 hover:bg-[#2A3475] hover:text-white text-gray-500 transition-colors" title="ØªØ¹Ø¯ÙŠÙ„"><i class="fas fa-pen text-xs"></i></button>`;
                        
                        if (!isMe) {
                            const permString = encodeURIComponent(JSON.stringify(user.permissions || {}));
                            // Ø²Ø± Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª
                            actionBtns += `<button onclick="openPermissionsModal('${user.id}', '${user.full_name}', '${permString}')" class="w-7 h-7 flex items-center justify-center rounded-full bg-gray-100 hover:bg-[#2A3475] hover:text-white text-gray-500 transition-colors" title="Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª"><i class="fas fa-user-cog text-xs"></i></button>`;
                            // Ø²Ø± Ø§Ù„Ø­Ø°Ù
                            actionBtns += `<button onclick="deleteUser('${user.id}', '${user.full_name}')" class="w-7 h-7 flex items-center justify-center rounded-full bg-red-50 hover:bg-red-600 hover:text-white text-red-500 transition-colors" title="Ø­Ø°Ù"><i class="fas fa-trash-alt text-xs"></i></button>`;
                        } else {
                            // Ù„Ùˆ Ø£Ù†Ø§ Ø¨Ø³ Ù…Ø´ Ø§Ù„Ù…Ø¤Ø³Ø³
                            actionBtns += `<span class="text-[10px] text-gray-400 mx-1 bg-gray-100 px-2 py-1 rounded">Ø£Ù†Øª</span>`;
                        }
                        actionBtns += `</div>`;
                    }
                    // ğŸ”¥ğŸ”¥ğŸ”¥ Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ù…Ù†Ø·Ù‚ ğŸ”¥ğŸ”¥ğŸ”¥

                    const tr = document.createElement('tr');
                    tr.className = 'border-b border-gray-50 hover:bg-gray-50 transition-colors';
                    
                    // ØªÙ…ÙŠÙŠØ² ØµÙ Ø§Ù„Ù…Ø¤Ø³Ø³ Ø¨Ù„ÙˆÙ† Ø°Ù‡Ø¨ÙŠ Ø®ÙÙŠÙ
                    if(isFounderRow) {
                        tr.className += ' bg-yellow-50/30'; 
                        tr.style.borderRight = '3px solid #F3A628';
                    }

                    tr.innerHTML = `
                        <td class="px-4 py-3">
                            <div class="flex items-start gap-3">
                                <div class="w-8 h-8 rounded-full ${avatarColor} text-white flex items-center justify-center text-xs font-bold shrink-0 border border-gray-200 mt-1">${avatarText}</div>
                                <div class="min-w-0">
                                    <div class="font-bold text-gray-800 text-sm truncate max-w-[150px]" title="${user.full_name}">
                                        ${user.full_name || 'Ù…Ø³ØªØ®Ø¯Ù…'} 
                                        ${isFounderRow ? '<i class="fas fa-crown text-[#F3A628] text-[10px] mr-1" title="Ø§Ù„Ù…Ø¤Ø³Ø³"></i>' : ''}
                                    </div>
                                    <div class="text-[10px] text-gray-400 truncate max-w-[150px] font-sans">${user.email}</div>
                                    ${mobileDisplay} 
                                </div>
                            </div>
                        </td>
                        <td class="px-4 py-3 text-sm text-gray-700 font-medium max-w-[130px] truncate" title="${position}">${position}</td>
                        <td class="px-4 py-3 text-sm text-gray-600 max-w-[150px]"><div class="truncate" title="${deptName}">${deptName}</div></td>
                        <td class="px-4 py-3">${roleBadge}</td>
                        <td class="px-4 py-3 text-center">${actionBtns}</td>
                    `;
                    activeUsersList.appendChild(tr);
                });
            }
        }
        
        // 5. ØªØ­Ø¯ÙŠØ« Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø£Ù‚Ø³Ø§Ù…
        if(deptStats) {
            deptStats.innerHTML = '';
            const deptCounts = {};
            users.forEach(u => { 
                if(u.department) {
                    const dName = departments[u.department] ? departments[u.department].name : u.department;
                    deptCounts[dName] = (deptCounts[dName] || 0) + 1; 
                }
            });
            if (Object.keys(deptCounts).length === 0) {
                deptStats.innerHTML = '<div class="col-span-full text-center text-gray-400 py-4 text-xs">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù†Ø´Ø·Ø©</div>';
            } else {
                Object.entries(deptCounts).sort((a, b) => b[1] - a[1]).forEach(([dName, count]) => {
                    deptStats.innerHTML += `<div class="flex justify-between items-center p-3 bg-gray-50 rounded-lg border border-gray-100"><span class="text-gray-700 font-bold text-xs truncate ml-2">${dName}</span><span class="bg-[#2A3475] text-white px-2 py-0.5 rounded text-xs font-bold">${count}</span></div>`;
                });
            }
        }

    } catch (err) {
        console.error(err);
        if(activeUsersList) activeUsersList.innerHTML = '<tr><td colspan="5" class="text-center text-red-500 py-4">ÙØ´Ù„ Ø§Ù„ØªØ­Ù…ÙŠÙ„</td></tr>';
    }
}
       
        // Ø¯Ø§Ù„Ø© ØªØºÙŠÙŠØ± Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ© (Ø¬Ø¯ÙŠØ¯Ø©)
        async function changeUserRole(userId, newRole) {
            if (!confirm(`Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† ØªØºÙŠÙŠØ± ØµÙ„Ø§Ø­ÙŠØ© Ù‡Ø°Ø§ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¥Ù„Ù‰ ${newRole === 'manager' ? 'Ù…Ø¯ÙŠØ±' : 'Ù…Ø³ØªØ®Ø¯Ù…'}ØŸ`)) return;

            try {
                const { error } = await supabase
                    .from('profiles')
                    .update({ role: newRole })
                    .eq('id', userId);

                if (error) throw error;

                showNotification('ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ© Ø¨Ù†Ø¬Ø§Ø­');
                updateAdminUsersList(); // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© ÙÙˆØ±Ø§Ù‹

            } catch (err) {
                console.error(err);
                showNotification('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„ØªØ­Ø¯ÙŠØ«', 'error');
            }
        }
// --- ÙƒÙˆØ¯ ØªØ¹Ø¯ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† (Ø¬Ø¯ÙŠØ¯) ---

function updateAdminReports() {
    
    /* ===============================
Â  Â  Â  Â Guards & Empty State
Â  Â  ================================ */
    const monthlyChart = document.getElementById('monthly-usage-chart');
    const peakChart    = document.getElementById('peak-times-chart');
    const analytics    = document.getElementById('detailed-analytics');

    // Ø¯Ø§Ù„Ø© Ù…Ø³Ø§Ø¹Ø¯Ø© Ù„ØªØ­ÙˆÙŠÙ„ Ø§Ù„ÙˆÙ‚Øª Ø¥Ù„Ù‰ Ø¯Ù‚Ø§Ø¦Ù‚ (ÙŠØ¬Ø¨ Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† ÙˆØ¬ÙˆØ¯Ù‡Ø§ Ø®Ø§Ø±Ø¬ Ù‡Ø°Ù‡ Ø§Ù„Ø¯Ø§Ù„Ø©)
    const timeToMinutes = (time) => {
        if (!time) return 0;
        const [h, m] = time.split(':').map(Number);
        return h * 60 + m;
    };

    if (!Array.isArray(meetings) || meetings.length === 0) {
        monthlyChart.innerHTML = `<div class="text-center text-gray-400 text-sm py-6">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ø¹Ø¯</div>`;
        peakChart.innerHTML    = `<div class="text-center text-gray-400 text-sm py-6">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ø¹Ø¯</div>`;
        analytics.innerHTML    = `<div class="text-center text-gray-400 text-sm py-6">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„ØªØ­Ù„ÙŠÙ„Ù‡Ø§</div>`;
        return;
    }

    /* ===============================
Â  Â  Â  Â Monthly usage chart - Fixed Dynamic Range
Â  Â  ================================ */
    monthlyChart.innerHTML = '';
    
    const monthNames = [
        'ÙŠÙ†Ø§ÙŠØ±','ÙØ¨Ø±Ø§ÙŠØ±','Ù…Ø§Ø±Ø³','Ø£Ø¨Ø±ÙŠÙ„','Ù…Ø§ÙŠÙˆ','ÙŠÙˆÙ†ÙŠÙˆ',
        'ÙŠÙˆÙ„ÙŠÙˆ','Ø£ØºØ³Ø·Ø³','Ø³Ø¨ØªÙ…Ø¨Ø±','Ø£ÙƒØªÙˆØ¨Ø±','Ù†ÙˆÙÙ…Ø¨Ø±','Ø¯ÙŠØ³Ù…Ø¨Ø±'
    ];

    // 1. Pre-calc meetings by YYYY-MM key and find report start/max count
    const meetingsByMonth = {};
    let maxMonthlyCount = 0;
    let earliestDate = new Date(); // ÙŠØ¨Ø¯Ø£ Ù…Ù† Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ø­Ø§Ù„ÙŠ
    let hasValidDate = false;

    meetings.forEach(m => {
        if (!m.date) return;
        const d = new Date(m.date);
        
        // ØªØ­Ø¯ÙŠØ« Ø£Ù‚Ø¯Ù… ØªØ§Ø±ÙŠØ® Ø­Ù‚ÙŠÙ‚ÙŠ Ù„Ù„Ø­Ø¬Ø²
        if (d < earliestDate) earliestDate = d;
        hasValidDate = true;
        
        // Key is YYYY-MM (Ø§Ù„Ø£ÙƒØ«Ø± Ø¯Ù‚Ø© Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ø´Ù‡ÙˆØ± ÙˆØ§Ù„Ø³Ù†ÙŠÙ†)
        const key = `${d.getFullYear()}-${d.getMonth()}`; 
        meetingsByMonth[key] = (meetingsByMonth[key] || 0) + 1;
        
        if (meetingsByMonth[key] > maxMonthlyCount) maxMonthlyCount = meetingsByMonth[key];
    });
    
    if (!hasValidDate) {
        monthlyChart.innerHTML = '<div class="text-center text-gray-400 text-sm py-6">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø­Ø¬ÙˆØ²Ø§Øª ÙÙŠ Ø§Ù„ÙØªØ±Ø© Ø§Ù„Ù…Ø­Ø¯Ø¯Ø©</div>';
        return;
    }

    // ØªØ­Ø¯ÙŠØ¯ Ù†Ø·Ø§Ù‚ Ø§Ù„ØªÙ‚Ø±ÙŠØ± (Ù…Ù† Ø£Ù‚Ø¯Ù… Ø­Ø¬Ø² Ø­ØªÙ‰ Ø§Ù„Ø´Ù‡Ø± Ø§Ù„Ø­Ø§Ù„ÙŠ)
    let startMonth = earliestDate.getMonth();
    let startYear  = earliestDate.getFullYear();

    const now = new Date();
    let endMonth = now.getMonth();
    let endYear  = now.getFullYear();

    // 2. Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø´Ø±Ø§Ø¦Ø­ Ø§Ù„Ø´Ù‡Ø±ÙŠØ©
    let m = startMonth;
    let y = startYear;
    let chartHTML = '';
    const scale = maxMonthlyCount > 0 ? maxMonthlyCount : 10;
    let totalMonthsInReport = 0; 

    // Ø§Ù„Ø´Ø±Ø·: Ø§Ø³ØªÙ…Ø± ÙÙŠ Ø§Ù„Ø­Ù„Ù‚Ø© Ø·Ø§Ù„Ù…Ø§ Ù„Ù… Ù†ØµÙ„ Ø¥Ù„Ù‰ Ø§Ù„Ø´Ù‡Ø± Ø§Ù„ØªØ§Ù„ÙŠ Ù„Ù„Ø´Ù‡Ø± Ø§Ù„Ø­Ø§Ù„ÙŠ (ÙƒØ­Ø¯ Ø£Ù‚ØµÙ‰ 12 Ø´Ù‡Ø±)
    while ((y < endYear || (y === endYear && m <= endMonth)) && totalMonthsInReport < 12) {
        
        const key = `${y}-${m}`;
        const count = meetingsByMonth[key] || 0;
        const percentage = Math.min(Math.round((count / scale) * 100), 100);
        
        chartHTML += `
            <div class="flex items-center space-x-3 space-x-reverse">
                <div class="w-24 text-sm text-gray-600 font-bold">
                    ${monthNames[m]} ${y}
                </div>
                <div class="flex-1 bg-gray-200 rounded-full h-4">
                    <div class="bg-[#2A3475] hover:bg-[#1f2658] h-4 rounded-full transition-all"
                         style="width:${percentage}%"></div>
                </div>
                <div class="w-8 text-sm text-gray-600">${count}</div>
            </div>
        `;

        // Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ù„Ù„Ø´Ù‡Ø± Ø§Ù„ØªØ§Ù„ÙŠ
        m++;
        if (m > 11) {
            m = 0;
            y++;
        }
        totalMonthsInReport++; 
    }

    // 3. Ø¹Ø±Ø¶ Ø§Ù„Ù†ØªÙŠØ¬Ø©
    monthlyChart.innerHTML = chartHTML;


    /* ===============================
Â  Â  Â  Â Peak times chart - Hourly Occupancy (Ø£ÙˆÙ‚Ø§Øª Ø§Ù„Ø°Ø±ÙˆØ©)
Â  Â  ================================ */
    peakChart.innerHTML = '';

    const timeUsage = {};
    let maxHourlyCount = 0; 
    const confirmedMeetings = meetings.filter(m => m.status === 'confirmed'); 

    confirmedMeetings.forEach(meeting => {
        if (!meeting.startTime || !meeting.endTime) return;
        
        const startHour = parseInt(meeting.startTime.split(':')[0]);
        const endHour = parseInt(meeting.endTime.split(':')[0]);
        
        for(let h = startHour; h < endHour; h++) {
            timeUsage[h] = (timeUsage[h] || 0) + 1;
            if (timeUsage[h] > maxHourlyCount) maxHourlyCount = timeUsage[h];
        }
    });

    if (Object.keys(timeUsage).length === 0) {
        peakChart.innerHTML = `<div class="text-center text-gray-400 text-sm py-6">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ø¹Ø±Ø¶ Ø£ÙˆÙ‚Ø§Øª Ø§Ù„Ø°Ø±ÙˆØ©</div>`;
    } else {
        const hourlyScale = maxHourlyCount > 0 ? maxHourlyCount : 10;
        
        Object.keys(timeUsage).sort((a,b) => a-b).forEach(hour => {
            const count = timeUsage[hour];
            const percentage = Math.round((count / hourlyScale) * 100);

            peakChart.innerHTML += `
                <div class="flex items-center space-x-3 space-x-reverse">
                    <div class="w-16 text-sm text-gray-600 font-bold">${hour}:00</div>
                    <div class="flex-1 bg-gray-200 rounded-full h-4">
                        <div class="bg-[#F3A628] h-4 rounded-full transition-all"
                             style="width:${percentage}%"></div>
                    </div>
                    <div class="w-8 text-sm text-gray-600">${count}</div>
                </div>
            `;
        });
    }

    /* ===============================
Â  Â  Â  Â Detailed analytics - Occupancy Rate (Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ù…ÙØµÙ„Ø©)
Â  Â  ================================ */
    const uniqueDepts = new Set(meetings.map(m => m.department)).size;
    
    const totalHoursBooked = meetings.reduce((sum, meeting) => {
        const startMin = timeToMinutes(meeting.startTime);
        const endMin = timeToMinutes(meeting.endTime);
        const durationMin = endMin > startMin ? endMin - startMin : 0;
        return sum + (durationMin / 60); 
    }, 0);

    // Ø­Ø³Ø§Ø¨ Ø§Ù„ÙØªØ±Ø© Ø§Ù„Ø²Ù…Ù†ÙŠØ© Ù„Ù„ØªÙ‚Ø±ÙŠØ± Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ§Ù‹
    const oneDay = 24 * 60 * 60 * 1000;
    const today = new Date(now.getFullYear(), now.getMonth(), now.getDate());
    const reportStartDate = new Date(startYear, startMonth, 1);
    const totalDays = Math.round((today.getTime() - reportStartDate.getTime()) / oneDay) + 1; // +1 Ù„Ù„ÙŠÙˆÙ… Ø§Ù„Ø­Ø§Ù„ÙŠ

    // Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø³Ø§Ø¹Ø§Øª Ø§Ù„Ø¹Ù…Ù„ Ø§Ù„Ù…ØªØ§Ø­Ø© (Ù†ÙØªØ±Ø¶ 10 Ø³Ø§Ø¹Ø§Øª Ø¹Ù…Ù„ ÙŠÙˆÙ…ÙŠØ§Ù‹ * 5 Ø£ÙŠØ§Ù… Ø£Ø³Ø¨ÙˆØ¹ÙŠØ§Ù‹)
    // 10/7: Ù…ØªÙˆØ³Ø· Ø³Ø§Ø¹Ø§Øª Ø§Ù„Ø¹Ù…Ù„ Ø§Ù„ÙŠÙˆÙ…ÙŠØ©
    const availableWorkHours = totalDays * (10 * (5/7)); 
    
    const occupancyPercentage = availableWorkHours > 0 
                                ? Math.round((totalHoursBooked / availableWorkHours) * 100)
                                : 0;

    analytics.innerHTML = `
        <div class="bg-white p-4 rounded-lg border">
            <div class="text-2xl font-bold text-[#2A3475]">${meetings.length}</div>
            <div class="text-sm text-gray-600">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª</div>
        </div>

        <div class="bg-white p-4 rounded-lg border">
            <div class="text-2xl font-bold text-green-600">${uniqueDepts}</div>
            <div class="text-sm text-gray-600">Ø§Ù„Ø£Ù‚Ø³Ø§Ù… Ø§Ù„Ù†Ø´Ø·Ø©</div>
        </div>

        <div class="bg-white p-4 rounded-lg border">
            <div class="text-2xl font-bold text-[#F3A628]">
                ${occupancyPercentage}%
            </div>
            <div class="text-sm text-gray-600">Ù…Ø¹Ø¯Ù„ Ø§Ù„Ø¥Ø´ØºØ§Ù„ Ø§Ù„ÙƒÙ„ÙŠ</div>
        </div>
    `;
}

        // Toggle select all meetings
        function toggleSelectAllMeetings() {
            const selectAll = document.getElementById('select-all-meetings');
            const checkboxes = document.querySelectorAll('.meeting-checkbox');
            
            checkboxes.forEach(checkbox => {
                checkbox.checked = selectAll.checked;
            });
        }

        // Filter meetings by department
        function filterMeetingsByDepartment() {
            const filter = document.getElementById('filter-department').value;
            const rows = document.querySelectorAll('#admin-meetings-list tr');
            
            rows.forEach(row => {
                if (!filter) {
                    row.style.display = '';
                } else {
                    const meetingId = row.querySelector('.meeting-checkbox').dataset.meetingId;
                    const meeting = meetings.find(m => m.id === meetingId);
                    row.style.display = meeting && meeting.department === filter ? '' : 'none';
                }
            });
        }

        // --- Ø¯Ø§Ù„Ø© Ø±Ø³Ù… Ø§Ù„Ù‡ÙŠÙƒÙ„ Ø§Ù„ÙˆÙ‡Ù…ÙŠ (Skeleton Loading) ---
        // Ø¯ÙŠ ÙˆØ¸ÙŠÙØªÙ‡Ø§ ØªØ±Ø³Ù… Ø¬Ø¯ÙˆÙ„ "Ø±Ù…Ø§Ø¯ÙŠ" ÙˆÙ…Ø±Ø¨Ø¹Ø§Øª Ø¨ØªÙ†ÙˆØ± ÙˆØªØ·ÙÙŠ Ø¹Ø´Ø§Ù† ØªÙˆØ­ÙŠ Ø¨Ø§Ù„ØªØ­Ù…ÙŠÙ„
        function renderSkeletonLoading() {
            const container = document.getElementById('calendar-container');
            if(!container) return;

            container.innerHTML = ''; // Ù…Ø³Ø­ Ø£ÙŠ Ø­Ø§Ø¬Ø© Ù…ÙˆØ¬ÙˆØ¯Ø©

            // 1. Ø±Ø³Ù… Ø§Ù„ØµÙ Ø§Ù„Ø¹Ù„ÙˆÙŠ (Ø±Ø¤ÙˆØ³ Ø§Ù„Ø£ÙŠØ§Ù… Ø§Ù„ÙˆÙ‡Ù…ÙŠØ©)
            // Ø®Ø§Ù†Ø© "Ø§Ù„ÙˆÙ‚Øª" Ø§Ù„ÙØ§Ø¶ÙŠØ©
            const timeHeader = document.createElement('div');
            timeHeader.className = 'time-slot bg-gray-100 border-b-2 border-[#F3A628] h-12';
            container.appendChild(timeHeader);

            // 7 Ø®Ø§Ù†Ø§Øª Ù„Ù„Ø£ÙŠØ§Ù… (Ø±Ù…Ø§Ø¯ÙŠ ÙØ§ØªØ­)
            for(let i=0; i<7; i++) {
                const cell = document.createElement('div');
                // animate-pulse: Ù‡Ùˆ Ø§Ù„ÙƒÙ„Ø§Ø³ Ø§Ù„Ø³Ø­Ø±ÙŠ Ø§Ù„Ù„ÙŠ Ø¨ÙŠØ®Ù„ÙŠ Ø§Ù„Ù„ÙˆÙ† ÙŠØ±ÙˆØ­ ÙˆÙŠØ¬ÙŠ
                cell.className = 'time-slot bg-gray-200 border-l border-white h-12 animate-pulse';
                container.appendChild(cell);
            }

            // 2. Ø±Ø³Ù… Ø¬Ø³Ù… Ø§Ù„Ø¬Ø¯ÙˆÙ„ (ØµÙÙˆÙ Ø§Ù„Ø³Ø§Ø¹Ø§Øª)
            // Ù‡Ù†Ø±Ø³Ù… 10 ØµÙÙˆÙ ÙƒØ£Ù†Ù‡Ù… 10 Ø³Ø§Ø¹Ø§Øª Ø¹Ù…Ù„
            for(let i=0; i<10; i++) {
                // Ø¹Ù…ÙˆØ¯ Ø§Ù„ÙˆÙ‚Øª (Ø§Ù„Ø´Ù…Ø§Ù„)
                const timeLabel = document.createElement('div');
                timeLabel.className = 'time-slot bg-gray-50 border-b border-gray-200 h-24 flex items-center justify-center';
                // Ø±Ø³Ù… "Ø´Ø±ÙŠØ·" ØµØºÙŠØ± ÙƒØ£Ù†Ù‡ Ø§Ù„Ø³Ø§Ø¹Ø©
                timeLabel.innerHTML = '<div class="h-3 w-10 bg-gray-300 rounded animate-pulse"></div>';
                container.appendChild(timeLabel);

                // Ø§Ù„Ù€ 7 Ø£ÙŠØ§Ù… Ø¨ØªÙˆØ¹ Ø§Ù„Ø³Ø§Ø¹Ø© Ø¯ÙŠ
                for(let d=0; d<7; d++) {
                    const cell = document.createElement('div');
                    cell.className = 'time-slot border-b border-l border-gray-100 h-24 relative p-2 bg-white';
                    
                    // Ø­Ø±ÙƒØ© Ø±ÙˆØ´Ø©: Ø¨Ù†Ø­Ø· "Ø­Ø¬Ø² ÙˆÙ‡Ù…ÙŠ" ÙÙŠ Ø¨Ø¹Ø¶ Ø§Ù„Ø®Ø§Ù†Ø§Øª Ø¹Ø´ÙˆØ§Ø¦ÙŠØ§Ù‹ Ø¹Ø´Ø§Ù† ÙŠØ¨Ø§Ù† ÙˆØ§Ù‚Ø¹ÙŠ
                    if(Math.random() > 0.7) {
                        const fakeMeeting = document.createElement('div');
                        fakeMeeting.className = 'absolute inset-2 bg-gray-100 rounded-lg animate-pulse';
                        cell.appendChild(fakeMeeting);
                    }
                    container.appendChild(cell);
                }
            }
        }

        // Bulk delete meetings
        async function bulkDeleteMeetings() {
            const selectedCheckboxes = document.querySelectorAll('.meeting-checkbox:checked');
            
            if (selectedCheckboxes.length === 0) {
                showNotification('ÙŠØ±Ø¬Ù‰ ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª Ø§Ù„Ù…Ø±Ø§Ø¯ Ø­Ø°ÙÙ‡Ø§', 'error');
                return;
            }

            const confirmDelete = await showConfirmDialog(`Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù ${selectedCheckboxes.length} Ø­Ø¬Ø²ØŸ`);
            if (!confirmDelete) return;

            const deleteBtn = document.getElementById('bulk-delete-btn');
            deleteBtn.disabled = true;
            deleteBtn.innerHTML = '<i class="fas fa-spinner fa-spin ml-2"></i>Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø­Ø°Ù...';

            try {
                const selectedIds = Array.from(selectedCheckboxes).map(cb => cb.dataset.meetingId);
                meetings = meetings.filter(m => !selectedIds.includes(m.id));
                saveMeetings();
                renderCalendar();
                updateDashboard();
                generateAISuggestions();
                updateAdminMeetingsList();
                
                showNotification(`ØªÙ… Ø­Ø°Ù ${selectedCheckboxes.length} Ø­Ø¬Ø² Ø¨Ù†Ø¬Ø§Ø­!`);
                document.getElementById('select-all-meetings').checked = false;
                
            } catch (error) {
                showNotification('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø­Ø°Ù Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª', 'error');
            } finally {
                deleteBtn.disabled = false;
                deleteBtn.innerHTML = '<i class="fas fa-trash ml-2"></i>Ø­Ø°Ù Ø§Ù„Ù…Ø­Ø¯Ø¯';
            }
        }

        // Edit meeting from admin panel
        window.editMeetingFromAdmin = function(meetingId) {
            const meeting = meetings.find(m => m.id === meetingId);
            if (meeting) {
                selectedMeeting = meeting;
                editMeeting();
                closeModal('admin-panel-modal');
            }
        };

// Ø¯Ø§Ù„Ø© Ø±Ø³Ù… Ø¬Ø¯Ø§ÙˆÙ„ Ø§Ù„Ù…Ø¯ÙŠØ± (Ù…Ø­Ø¯Ø«Ø© Ù„ØªØ¹Ø±ÙŠØ¨ Ø§Ù„Ø£Ø±Ù‚Ø§Ù… ÙÙŠ Ø§Ù„ÙˆÙ‚Øª)
window.renderAdminMeetingsTable = function(list) {
    const pendingTbody = document.getElementById('pending-meetings-list');
    const approvedTbody = document.getElementById('admin-meetings-list');
    const pendingSection = document.getElementById('pending-requests-section');
    
    if(!approvedTbody) return;
    
    pendingTbody.innerHTML = '';
    approvedTbody.innerHTML = '';

    // ØªØµÙÙŠØ© Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù…Ø¹Ù„Ù‚Ø©
    const requestsList = list.filter(m => 
        m.status === 'pending' || 
        m.status === 'cancellation_requested' || 
        m.status === 'modification_requested'
    );
    
    // ØªØµÙÙŠØ© Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª Ø§Ù„Ù…Ø¹ØªÙ…Ø¯Ø©
    const approvedList = list.filter(m => m.status === 'confirmed' || m.status === 'modification_requested' || m.status === 'cancellation_requested');

    // === 1. Ù‚Ø³Ù… Ø§Ù„Ø·Ù„Ø¨Ø§Øª (Ø§Ù„Ø£Ø¹Ù„Ù‰) ===
    if (requestsList.length > 0) {
        pendingSection.classList.remove('hidden');
        requestsList.forEach(m => {
            const deptInfo = departments[m.department] || { name: m.department };
            let statusBadge = '';
            let actionButtons = '';
            let detailsHTML = '';

            // --- Ø£. Ø·Ù„Ø¨ ØªØ¹Ø¯ÙŠÙ„ ---
            if (m.status === 'modification_requested') {
                statusBadge = '<span class="text-blue-600 font-bold text-xs"><i class="fas fa-edit ml-1"></i> Ø·Ù„Ø¨ ØªØ¹Ø¯ÙŠÙ„</span>';
                
                const changes = m.pending_changes || {};
                detailsHTML = `
                    <div class="text-[10px] text-gray-500 mt-1 bg-blue-50 p-1 rounded border border-blue-100">
                        <div class="flex justify-between"><span>Ù…Ù†:</span> <b>${new Date(m.date).toLocaleDateString('ar-EG')} (${toArabicNum(m.startTime)})</b></div>
                        <div class="flex justify-between text-blue-700"><span>Ø¥Ù„Ù‰:</span> <b>${new Date(changes.date).toLocaleDateString('ar-EG')} (${toArabicNum(changes.start_time)})</b></div>
                    </div>
                `;

                actionButtons = `
                    <button onclick="window.approveModification('${m.id}')" class="bg-blue-600 text-white px-3 py-1.5 rounded-lg text-xs font-bold hover:bg-blue-700 shadow-sm ml-2">Ù‚Ø¨ÙˆÙ„ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„</button>
                    <button onclick="window.rejectModification('${m.id}')" class="bg-gray-500 text-white px-3 py-1.5 rounded-lg text-xs font-bold hover:bg-gray-600 shadow-sm">Ø¥Ø¨Ù‚Ø§Ø¡ Ø§Ù„Ù‚Ø¯ÙŠÙ…</button>
                `;
            } 
            // --- Ø¨. Ø·Ù„Ø¨ Ø¥Ù„ØºØ§Ø¡ ---
            else if (m.status === 'cancellation_requested') {
                statusBadge = '<span class="text-red-600 font-bold text-xs"><i class="fas fa-trash-alt ml-1"></i> Ø·Ù„Ø¨ Ø¥Ù„ØºØ§Ø¡</span>';
                actionButtons = `
                    <button onclick="window.confirmDeleteRequest('${m.id}')" class="bg-red-600 text-white px-3 py-1.5 rounded-lg text-xs font-bold hover:bg-red-700 shadow-sm ml-2">ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø­Ø°Ù</button>
                    <button onclick="window.rejectDeleteRequest('${m.id}')" class="bg-gray-500 text-white px-3 py-1.5 rounded-lg text-xs font-bold hover:bg-gray-600 shadow-sm">Ø±ÙØ¶</button>
                `;
            }
            // --- Ø¬. Ø­Ø¬Ø² Ø¬Ø¯ÙŠØ¯ ---
            else {
                statusBadge = '<span class="text-green-600 font-bold text-xs"><i class="fas fa-plus-circle ml-1"></i> Ø­Ø¬Ø² Ø¬Ø¯ÙŠØ¯</span>';
                actionButtons = `
                    <button onclick="window.approveMeeting('${m.id}')" class="bg-green-600 text-white px-3 py-1.5 rounded-lg text-xs font-bold hover:bg-green-700 shadow-sm ml-2">Ù…ÙˆØ§ÙÙ‚Ø©</button>
                    <button onclick="window.rejectMeeting('${m.id}')" class="bg-red-600 text-white px-3 py-1.5 rounded-lg text-xs font-bold hover:bg-red-700 shadow-sm">Ø±ÙØ¶</button>
                `;
            }

            const tr = document.createElement('tr');
            tr.id = `req-row-${m.id}`; 
            tr.className = 'bg-white border-b border-gray-100 hover:bg-gray-50 transition-colors duration-500';

            tr.innerHTML = `
                <td class="px-6 py-4 font-bold text-gray-800">
                    ${m.title}
                    <div class="mt-1">${statusBadge}</div>
                </td>
                <td class="px-6 py-4 text-xs text-gray-600">
                    <div class="font-bold">${deptInfo.name}</div>
                    <div class="text-[10px] text-gray-500">${m.createdBy || '---'}</div>
                </td>
                <td class="px-6 py-4 text-xs font-sans">
                    <span class="block font-bold text-[#2A3475]">${new Date(m.date).toLocaleDateString('ar-EG')}</span>
                    <span class="block text-gray-600 font-bold mt-1" dir="ltr">${toArabicNum(m.startTime)} - ${toArabicNum(m.endTime)}</span>
                    ${detailsHTML}
                </td>
                <td class="px-6 py-4 text-center">
                    <div class="flex justify-center items-center">
                        ${actionButtons}
                    </div>
                </td>
            `;
            pendingTbody.appendChild(tr);
        });
    } else {
        pendingSection.classList.add('hidden');
    }

    // === 2. Ø§Ù„Ù‚Ø³Ù… Ø§Ù„Ø³ÙÙ„ÙŠ (Ø§Ù„Ù…Ø¹ØªÙ…Ø¯) ===
    if (approvedList.length === 0) {
        approvedTbody.innerHTML = '<tr><td colspan="6" class="text-center py-6 text-gray-500">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø­Ø¬ÙˆØ²Ø§Øª Ù…Ø¹ØªÙ…Ø¯Ø©</td></tr>';
    } else {
        approvedList.sort((a, b) => new Date(b.date) - new Date(a.date));
        approvedList.forEach(m => {
            const deptInfo = departments[m.department] || { name: m.department };
            
            let statusDisplay = '<span class="px-2 py-1 bg-green-50 text-green-700 text-[10px] font-bold rounded-full border border-green-100">Ù…Ø¤ÙƒØ¯</span>';
            if(m.status === 'modification_requested') statusDisplay = '<span class="px-2 py-1 bg-blue-50 text-blue-700 text-[10px] font-bold rounded-full border border-blue-100 animate-pulse">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„...</span>';
            if(m.status === 'cancellation_requested') statusDisplay = '<span class="px-2 py-1 bg-red-50 text-red-700 text-[10px] font-bold rounded-full border border-red-100 animate-pulse">Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø­Ø°Ù...</span>';

            const tr = document.createElement('tr');
            tr.className = 'border-b border-gray-50 hover:bg-gray-50';
            tr.innerHTML = `
                <td class="px-6 py-4"><input type="checkbox" class="meeting-checkbox rounded border-gray-300" value="${m.id}"></td>
                <td class="px-6 py-4 font-bold text-[#2A3475] text-sm">${m.title}</td>
                <td class="px-6 py-4 text-xs text-gray-600">${deptInfo.name}</td>
                <td class="px-6 py-4 text-xs text-gray-500">
                    <div>${new Date(m.date).toLocaleDateString('ar-EG')}</div>
                    <div class="text-[10px] font-bold mt-1" dir="ltr">${toArabicNum(m.startTime)} - ${toArabicNum(m.endTime)}</div>
                </td>
                <td class="px-6 py-4">${statusDisplay}</td>
                <td class="px-6 py-4 text-center">
                   <button onclick="window.deleteMeetingFromAdmin('${m.id}')" class="text-red-500 hover:bg-red-50 p-2 rounded-full"><i class="fas fa-trash-alt"></i></button>
                   <button onclick="window.editMeetingFromAdmin('${m.id}')" class="text-blue-500 hover:bg-blue-50 p-2 rounded-full"><i class="fas fa-edit"></i></button>
                </td>
            `;
            approvedTbody.appendChild(tr);
        });
    }
};

        // 2. Ø­Ø°Ù Ø­Ø¬Ø² ÙØ±Ø¯ÙŠ (ØªÙ… ØªÙØ¹ÙŠÙ„ Ø§Ù„Ù†Ø§ÙØ°Ø© Ø§Ù„Ø´ÙØ§ÙØ©)
        window.deleteMeetingFromAdmin = async function(id) {
            if(!id) return;

            // âœ… Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù†Ø§ÙØ°Ø© Ø§Ù„Ø§Ø­ØªØ±Ø§ÙÙŠØ© Ø¨Ø¯Ù„Ø§Ù‹ Ù…Ù† confirm Ø§Ù„Ø¹Ø§Ø¯ÙŠØ©
            const isConfirmed = await showConfirmDialog('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ ØªÙ…Ø§Ù…Ø§Ù‹ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø­Ø¬Ø² Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹ Ù…Ù† Ø§Ù„Ø³Ø¬Ù„Ø§ØªØŸ');
            
            if(!isConfirmed) return;

            document.body.style.cursor = 'wait';

            try {
                const { error } = await supabase.from('meetings').delete().eq('id', id);
                
                if(error) throw error;

                // Ø­Ø°Ù Ù…Ø­Ù„ÙŠ ÙˆØªØ­Ø¯ÙŠØ«
                meetings = meetings.filter(m => String(m.id) !== String(id));
                
                updateAdminMeetingsList();
                renderCalendar();
                updateDashboard();
                generateAISuggestions();
                
                showNotification('ØªÙ… Ø­Ø°Ù Ø§Ù„Ø­Ø¬Ø² Ø¨Ù†Ø¬Ø§Ø­ âœ…');

            } catch(err) {
                console.error(err);
                showNotification('ÙØ´Ù„ Ø§Ù„Ø­Ø°Ù', 'error');
            } finally {
                document.body.style.cursor = 'default';
            }
        };

        // 3. Ø­Ø°Ù Ø¬Ù…Ø§Ø¹ÙŠ (ØªÙ… ØªÙØ¹ÙŠÙ„ Ø§Ù„Ù†Ø§ÙØ°Ø© Ø§Ù„Ø´ÙØ§ÙØ© + Ø¥ØµÙ„Ø§Ø­ Ù‚Ø±Ø§Ø¡Ø© IDs)
        window.bulkDeleteMeetings = async function() {
            const checkboxes = document.querySelectorAll('.meeting-checkbox:checked');
            
            if (checkboxes.length === 0) {
                showNotification('ÙŠØ±Ø¬Ù‰ ØªØ­Ø¯ÙŠØ¯ Ø­Ø¬Ø² ÙˆØ§Ø­Ø¯ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„', 'info');
                return;
            }

            // Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ù‚ÙŠÙ… Ù…Ù† value Ù…Ø¨Ø§Ø´Ø±Ø©
            const idsToDelete = Array.from(checkboxes).map(cb => cb.value);

            // âœ… Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù†Ø§ÙØ°Ø© Ø§Ù„Ø§Ø­ØªØ±Ø§ÙÙŠØ© Ù…Ø¹ Ø¹Ø±Ø¶ Ø§Ù„Ø¹Ø¯Ø¯
            const isConfirmed = await showConfirmDialog(`Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù <span class="text-red-600 font-bold text-lg">${idsToDelete.length}</span> Ø­Ø¬Ø² Ø¯ÙØ¹Ø© ÙˆØ§Ø­Ø¯Ø©ØŸ`);
            
            if(!isConfirmed) return;

            const btn = document.getElementById('bulk-delete-btn');
            const originalText = btn.innerHTML;
            btn.innerHTML = '<i class="fas fa-spinner fa-spin ml-2"></i> Ø¬Ø§Ø±ÙŠ...';
            btn.disabled = true;

            try {
                const { error } = await supabase
                    .from('meetings')
                    .delete()
                    .in('id', idsToDelete);

                if(error) throw error;

                // Ø­Ø°Ù Ù…Ù† Ø§Ù„Ù…ØµÙÙˆÙØ© Ø§Ù„Ù…Ø­Ù„ÙŠØ©
                meetings = meetings.filter(m => !idsToDelete.includes(String(m.id)));

                updateAdminMeetingsList();
                renderCalendar();
                updateDashboard();
                
                showNotification(`ØªÙ… Ø­Ø°Ù ${idsToDelete.length} Ø­Ø¬Ø² Ø¨Ù†Ø¬Ø§Ø­ âœ…`);
                
                const selectAll = document.getElementById('select-all-meetings');
                if(selectAll) selectAll.checked = false;

            } catch(err) {
                console.error(err);
                showNotification('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø­Ø°Ù Ø§Ù„Ø¬Ù…Ø§Ø¹ÙŠ', 'error');
            } finally {
                btn.innerHTML = originalText;
                btn.disabled = false;
            }
        };

        // Open add user modal
        function openAddUserModal() {
            document.getElementById('add-user-modal').classList.add('show');
        }

// ---------- showNotification: Ù…Ø±ÙƒØ²ÙŠØŒ Ø¨Ø¯ÙˆÙ† Ø¥ÙŠÙ…ÙˆØ¬ÙŠØŒ ÙŠØ²ÙŠÙ„ Ø£ÙŠ Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ ----------
;(function(){ // ğŸ‘ˆ (4) Ø¶ÙÙ†Ø§ ÙØ§ØµÙ„Ø© Ù…Ù†Ù‚ÙˆØ·Ø© Ù‡Ù†Ø§ ÙƒÙ…Ø§Ù† Ø¶Ø±ÙˆØ±ÙŠ Ø¬Ø¯Ø§Ù‹
    // Ù…Ø³Ø§Ø¹Ø¯Ø© Ù„ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ù†Øµ Ù…Ù† Ø¥ÙŠÙ…ÙˆØ¬ÙŠ ÙˆØ±Ù…ÙˆØ² Ù…Ø«Ù„ âœ“ âŒ âš ï¸ ğŸ”’ ... 
    function stripEmojisAndIcons(text) {
        if (!text) return '';
        // ÙŠØ­Ø°Ù Ø±Ù…ÙˆØ² Emoji + Ø±Ù…ÙˆØ² Ø´Ø§Ø¦Ø¹Ø© Ù…Ø«Ù„ âœ“ âŒ âš ï¸ ğŸ”’
        // regex Ø¹Ø§Ù… ÙŠØºØ·ÙŠ Ù†Ø·Ø§Ù‚Ø§Øª Emoji + Ø¨Ø¹Ø¶ Ø§Ù„Ø±Ù…ÙˆØ² Ø§Ù„Ø´Ø§Ø¦Ø¹Ø©
        return String(text)
            .replace(/[\u{1F300}-\u{1FAFF}\u{1F600}-\u{1F64F}\u{2700}-\u{27BF}\u{2600}-\u{26FF}]/gu, '')
            .replace(/[âœ“âœ”âœ–âŒâš ï¸âš ğŸ”’ğŸ””âœ…â]/g, '') // Ø¥Ø²Ø§Ù„Ø© Ø£ÙŠ Ø¹Ù„Ø§Ù…Ø§Øª Ø´Ø§Ø¦Ø¹Ø©
            .trim();
    }

    // Ø§Ù„Ø¯Ø§Ù„Ø© Ù†ÙØ³Ù‡Ø§
window.showNotification = function(message, type = 'success') {
        const toast = document.getElementById('notification-toast');
        const messageEl = document.getElementById('notification-message') || document.querySelector('#notification-toast .notification-text');

        if (!toast || !messageEl) return;

        const clean = stripEmojisAndIcons(message);
        messageEl.textContent = clean || '';
        toast.className = 'notification-toast';

        if (type === 'error') toast.classList.add('bg-error');
        else if (type === 'info') toast.classList.add('bg-info');
        else toast.classList.add('bg-success');

        void toast.offsetWidth;
        toast.classList.add('show');

        if (toast._hideTimeout) clearTimeout(toast._hideTimeout);
        toast._hideTimeout = setTimeout(() => {
            toast.classList.remove('show');
        }, 3000);
    };
})();

// Custom confirmation dialog (ØªØµÙ…ÙŠÙ… Ø§Ø­ØªØ±Ø§ÙÙŠ Ù„Ù„ØªØ­Ø°ÙŠØ±)
// Custom confirmation dialog (Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ø°ÙƒÙŠØ© Ø§Ù„Ù…Ø±Ù†Ø©)
function showConfirmDialog(message, options = {}) {
    return new Promise((resolve) => {
        // Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ© (Ù„Ùˆ Ù…Ø¨Ø¹ØªØ´ Ø­Ø§Ø¬Ø© Ù‡ØªØ´ØªØºÙ„ ÙƒØ£Ù†Ù‡Ø§ Ø­Ø°Ù)
        const settings = {
            title: options.title || 'ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø­Ø°Ù',
            confirmBtnText: options.confirmText || 'Ù†Ø¹Ù…ØŒ Ø§Ø­Ø°Ù',
            confirmBtnColor: options.color || 'bg-red-600 hover:bg-red-700', // Ù„ÙˆÙ† Ø§Ù„Ø²Ø±
            icon: options.icon || 'fa-trash-alt', // Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø©
            iconColor: options.iconColor || 'text-red-600', // Ù„ÙˆÙ† Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø©
            iconBg: options.iconBg || 'bg-red-100', // Ø®Ù„ÙÙŠØ© Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø©
            borderColor: options.borderColor || 'border-[#F3A628]' // Ù„ÙˆÙ† Ø§Ù„Ø­Ø¯ÙˆØ¯ Ø§Ù„Ø¹Ù„ÙˆÙŠØ©
        };

        const overlay = document.createElement('div');
        overlay.className = 'fixed inset-0 bg-[#2A3475] bg-opacity-90 flex items-center justify-center z-[5000] backdrop-blur-sm transition-opacity duration-300';
        
        const modal = document.createElement('div');
        modal.className = `bg-white rounded-lg shadow-2xl max-w-sm w-full mx-4 transform scale-100 transition-transform duration-300 border-t-8 ${settings.borderColor}`;
        
        modal.innerHTML = `
            <div class="p-6 text-center">
                <div class="w-16 h-16 ${settings.iconBg} rounded-full flex items-center justify-center mx-auto mb-4">
                    <i class="fas ${settings.icon} ${settings.iconColor} text-2xl animate-pulse"></i>
                </div>
                
                <h3 class="text-xl font-bold text-gray-800 mb-2">${settings.title}</h3>
                <p class="text-gray-600 text-sm mb-6 leading-relaxed">${message}</p>
                
                <div class="flex justify-center space-x-3 space-x-reverse">
                    <button id="confirm-cancel" class="px-5 py-2.5 rounded-lg border border-gray-300 text-gray-700 font-medium hover:bg-gray-50 transition-colors focus:outline-none">
                        Ø¥Ù„ØºØ§Ø¡
                    </button>
                    <button id="confirm-ok" class="px-5 py-2.5 rounded-lg text-white font-medium shadow-lg transition-all focus:outline-none flex items-center ${settings.confirmBtnColor}">
                        <i class="fas ${settings.icon} ml-2"></i> ${settings.confirmBtnText}
                    </button>
                </div>
            </div>
        `;
        
        overlay.appendChild(modal);
        document.body.appendChild(overlay);
        
        const okBtn = modal.querySelector('#confirm-ok');
        const cancelBtn = modal.querySelector('#confirm-cancel');

        function closeAndResolve(result) {
            overlay.classList.add('opacity-0');
            setTimeout(() => {
                if(document.body.contains(overlay)) document.body.removeChild(overlay);
                resolve(result);
            }, 200);
        }
        
        okBtn.addEventListener('click', () => closeAndResolve(true));
        cancelBtn.addEventListener('click', () => closeAndResolve(false));
        overlay.addEventListener('click', (e) => { if (e.target === overlay) closeAndResolve(false); });
    });
}

// Ø¯Ø§Ù„Ø© Ø§Ù„Ø­Ø°Ù (ØªÙ… Ø¥ØµÙ„Ø§Ø­ ØµÙ„Ø§Ø­ÙŠØ§Øª Ø§Ù„Ù…Ø¯ÙŠØ±)
async function deleteMeeting() {
    if (!selectedMeeting) return;
    
    // 1. ØªØ­Ø¯ÙŠØ¯ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª
    const isOwner = selectedMeeting.user_id === currentUser.id;
    const isManager = currentUser.role === 'manager'; // Ø§Ù„Ù…Ø¯ÙŠØ± ÙŠÙ…Ù„Ùƒ ØµÙ„Ø§Ø­ÙŠØ© Ù…Ø·Ù„Ù‚Ø©
    const canDeleteSpecific = currentUser.permissions && currentUser.permissions.can_delete === true;

    // Ø§Ù„Ø´Ø±Ø· Ø§Ù„Ù…ØµØ­Ø­: Ù„Ùˆ Ù…Ø´ ØµØ§Ø­Ø¨ Ø§Ù„Ø­Ø¬Ø²ØŒ ÙˆÙ…Ø´ Ù…Ø¯ÙŠØ±ØŒ ÙˆÙ…Ø¹Ù‡ÙˆØ´ ØµÙ„Ø§Ø­ÙŠØ© Ø®Ø§ØµØ© => Ø§Ù…Ù†Ø¹Ù‡
    if (!isOwner && !isManager && !canDeleteSpecific) {
        showNotification('â›” Ø¹ÙÙˆØ§Ù‹ØŒ Ù„Ø§ ØªÙ…Ù„Ùƒ ØµÙ„Ø§Ø­ÙŠØ© Ù„Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø­Ø¬Ø²!', 'error');
        return;
    }

    // 2. Ø·Ù„Ø¨ Ø§Ù„ØªØ£ÙƒÙŠØ¯ (Ù†Ø³ØªØ®Ø¯Ù… Ø§Ù„Ù†Ø§ÙØ°Ø© Ø§Ù„Ø§Ø­ØªØ±Ø§ÙÙŠØ©)
    const isConfirmed = await showConfirmDialog('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ ØªÙ…Ø§Ù…Ø§Ù‹ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø­Ø¬Ø² Ù…Ù† Ø§Ù„Ù†Ø¸Ø§Ù…ØŸ');
    if (!isConfirmed) return;

    document.body.style.cursor = 'wait';

    try {
        const { error } = await supabase.from('meetings').delete().eq('id', selectedMeeting.id);
        
        if (error) throw error;

        // ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
        meetings = meetings.filter(m => m.id !== selectedMeeting.id);
        refreshAllViews();
        closeModal('meeting-details-modal');
        showNotification('ØªÙ… Ø­Ø°Ù Ø§Ù„Ø­Ø¬Ø² Ø¨Ù†Ø¬Ø§Ø­ âœ…');

    } catch (error) {
        console.error(error);
        showNotification('ÙØ´Ù„ Ø§Ù„Ø­Ø°Ù: ' + error.message, 'error');
    } finally {
        document.body.style.cursor = 'default';
    }
}

        document.addEventListener('DOMContentLoaded', initializeApp);
       
        // ============================================
        // Ø¯ÙˆØ§Ù„ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† (User Management)
        // ============================================

// Ø¯Ø§Ù„Ø© ÙØªØ­ Ù†Ø§ÙØ°Ø© ØªØ¹Ø¯ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ø¶Ùˆ (Ù…ØµØ­Ø­Ø© Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù†Ø³Ø¯Ù„Ø©)
window.openEditUserInfo = function(id, name, dept, position, mobile) {
    const idInput = document.getElementById('edit-user-id');
    const nameInput = document.getElementById('edit-user-name');
    const posInput = document.getElementById('edit-user-position');
    const mobileInput = document.getElementById('edit-user-mobile');
    const deptInput = document.getElementById('edit-user-dept');
    const modal = document.getElementById('edit-user-info-modal');

    // 1. ØªØ¹Ø¨Ø¦Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©
    if (idInput) idInput.value = id;
    if (nameInput) nameInput.value = (name && name !== 'undefined' && name !== 'null') ? name : '';
    if (posInput) posInput.value = (position && position !== 'undefined' && position !== 'null') ? position : '';
    if (mobileInput) mobileInput.value = (mobile && mobile !== 'undefined' && mobile !== 'null') ? mobile : '';

    // 2. ØªØ¹Ø¨Ø¦Ø© Ø§Ù„Ù‚Ø³Ù… ÙˆØªØ­Ø¯ÙŠØ« Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù†Ø³Ø¯Ù„Ø© (Fix Dropdown Display)
    if (deptInput) {
        const val = (dept && dept !== 'undefined' && dept !== 'null') ? dept : '';
        deptInput.value = val; // Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠØ©

        // Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ù€ Wrapper ÙˆØªØ­Ø¯ÙŠØ« Ø§Ù„Ù†Øµ Ø§Ù„Ø¸Ø§Ù‡Ø±
        const wrapper = deptInput.closest('.custom-dropdown');
        if(wrapper) {
            const displaySpan = wrapper.querySelector('.custom-dropdown-display span');
            const matchingOption = wrapper.querySelector(`.custom-option[data-value="${val}"]`);
            
            if(displaySpan) {
                if(matchingOption) {
                    displaySpan.textContent = matchingOption.textContent.trim(); // Ø¹Ø±Ø¶ Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø¹Ø±Ø¨ÙŠ
                    displaySpan.classList.add('text-[#2A3475]', 'font-bold');
                } else {
                    displaySpan.textContent = 'Ø§Ø®ØªØ± Ø§Ù„Ø¬Ù‡Ø©...';
                    displaySpan.classList.remove('text-[#2A3475]', 'font-bold');
                }
            }
        }
    }
    
    // 3. ÙØªØ­ Ø§Ù„Ù†Ø§ÙØ°Ø©
    if (modal) modal.classList.add('show');
};

// ============================================================
// ÙØªØ­ Ù†Ø§ÙØ°Ø© Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª (ÙŠÙ…Ù„Ø£ Ø§Ù„ÙÙˆØ±Ù… Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ ÙˆØ§Ù„Ø¥Ø¶Ø§ÙÙŠ Ù…Ø¹Ø§Ù‹)
// ============================================================
window.openPermissionsModal = function(userId, userName, permString) {
    const perms = JSON.parse(decodeURIComponent(permString));
    
    // 1. ØªØ¹Ø¨Ø¦Ø© Ø§Ù„ÙÙˆØ±Ù… Ø§Ù„Ø£ÙˆÙ„ (Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ) - ÙƒÙ…Ø§ Ù‡Ùˆ ÙÙŠ ÙƒÙˆØ¯Ùƒ Ø§Ù„Ù‚Ø¯ÙŠÙ…
    const idInput1 = document.getElementById('perm-user-id');
    if(idInput1) {
        idInput1.value = userId;
        if(document.getElementById('perm-user-name')) document.getElementById('perm-user-name').textContent = userName;
        
        if(document.getElementById('perm-approve')) document.getElementById('perm-approve').checked = perms.can_approve === true;
        if(document.getElementById('perm-users')) document.getElementById('perm-users').checked = perms.can_manage_users === true;
        if(document.getElementById('perm-delete')) document.getElementById('perm-delete').checked = perms.can_delete === true;
    }

    // 2. ØªØ¹Ø¨Ø¦Ø© Ø§Ù„ÙÙˆØ±Ù… Ø§Ù„Ø«Ø§Ù†ÙŠ (Ø§Ù„Ø¬Ø¯ÙŠØ¯ -2) - ğŸ”¥ Ù‡Ø°Ø§ Ù‡Ùˆ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¶Ø±ÙˆØ±ÙŠ
    const idInput2 = document.getElementById('perm-user-id-2');
    if(idInput2) {
        idInput2.value = userId;
        // Ù†ØªØ£ÙƒØ¯ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø§Ù„Ø¹Ù†Ø§ØµØ± Ù‚Ø¨Ù„ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ù„ØªØ¬Ù†Ø¨ Ø§Ù„Ø£Ø®Ø·Ø§Ø¡
        if(document.getElementById('perm-user-name-2')) document.getElementById('perm-user-name-2').textContent = userName;
        
        if(document.getElementById('perm-approve-2')) document.getElementById('perm-approve-2').checked = perms.can_approve === true;
        if(document.getElementById('perm-users-2')) document.getElementById('perm-users-2').checked = perms.can_manage_users === true;
        if(document.getElementById('perm-delete-2')) document.getElementById('perm-delete-2').checked = perms.can_delete === true;
    }
    
    // 3. Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ù†Ø§ÙØ°Ø©
    const modal = document.getElementById('permissions-modal');
    // Ù†Ø¯Ø¹Ù… Ø§Ù„Ø·Ø±Ù‚ Ø§Ù„Ù…Ø®ØªÙ„ÙØ© Ù„Ù„Ø¥Ø¸Ù‡Ø§Ø± Ø­Ø³Ø¨ Ø§Ù„Ù€ CSS Ø¹Ù†Ø¯Ùƒ (classList Ø£Ùˆ style)
    if(modal) {
        modal.classList.add('show'); 
        modal.classList.remove('hidden');
    }
};

        // 3. Ø¥Ø¶Ø§ÙØ© Ù…Ø³ØªØ®Ø¯Ù… Ø¬Ø¯ÙŠØ¯ (ÙŠÙ‚Ø±Ø£ Ù…Ù† new-...)
        async function handleAddUser(e) {
            e.preventDefault();
            const btn = e.target.querySelector('button[type="submit"]');
            const originalText = btn.innerText;
            btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Ø¬Ø§Ø±ÙŠ...';
            btn.disabled = true;

            const email = document.getElementById('new-user-email').value;
            const password = document.getElementById('new-user-password').value;
            const name = document.getElementById('new-user-name').value;
            const dept = document.getElementById('new-user-dept').value;

            // ØªØ¬Ù…ÙŠØ¹ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª Ù…Ù† Ø§Ù„Ù€ Checkboxes Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
            const permissions = {
                can_approve: document.getElementById('new-perm-approve').checked,
                can_manage_users: document.getElementById('new-perm-users').checked,
                can_delete: document.getElementById('new-perm-delete').checked
            };

            const hasAnyPerm = Object.values(permissions).some(val => val === true);
            const role = hasAnyPerm ? 'manager' : 'user';

            try {
                const { data: authData, error: authError } = await supabaseAdmin.auth.admin.createUser({
                    email: email, password: password, email_confirm: true, 
                    user_metadata: { full_name: name, department: dept, role: role, permissions: permissions }
                });

                if (authError) throw authError;

                await supabaseAdmin.from('profiles').upsert({
                    id: authData.user.id, email: email, full_name: name, department: dept, role: role, permissions: permissions
                });

                showNotification(`ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ${name} Ø¨Ù†Ø¬Ø§Ø­!`);
                closeModal('add-user-modal');
                document.getElementById('add-user-form').reset();
                
                // ØªØµÙÙŠØ± Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª
                document.getElementById('new-perm-approve').checked = false;
                document.getElementById('new-perm-users').checked = false;
                document.getElementById('new-perm-delete').checked = false;

                updateAdminUsersList(); 

            } catch (err) {
                console.error(err);
                showNotification('ÙØ´Ù„ Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡: ' + err.message, 'error');
            } finally {
                btn.innerText = originalText;
                btn.disabled = false;
            }
        }

// 4. Ø­ÙØ¸ ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª (Ù…Ø­Ø¯Ø«Ø© Ù„Ø­ÙØ¸ Ø§Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„ ÙˆØ§Ù„ÙˆØ¸ÙŠÙØ©)
        const editInfoForm = document.getElementById('edit-user-info-form');
        if (editInfoForm) {
            editInfoForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                const id = document.getElementById('edit-user-id').value;
                const name = document.getElementById('edit-user-name').value;
                const dept = document.getElementById('edit-user-dept').value;
                // Ø§Ù„Ù‚ÙŠÙ… Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
                const position = document.getElementById('edit-user-position').value;
                const mobile = document.getElementById('edit-user-mobile').value;
                
                const btn = e.target.querySelector('button');
                const originalText = btn.innerHTML;
                btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Ø¬Ø§Ø±ÙŠ...';
                btn.disabled = true;

                try {
                    // ØªØ­Ø¯ÙŠØ« ÙƒÙ„ Ø§Ù„Ø­Ù‚ÙˆÙ„
                    const { error } = await supabase.from('profiles')
                        .update({ 
                            full_name: name, 
                            department: dept,
                            position: position, // âœ…
                            mobile: mobile      // âœ…
                        })
                        .eq('id', id);

                    if (error) throw error;
                    
                    // ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ù„ÙˆØ¬
                    logActivity('ØªØ¹Ø¯ÙŠÙ„ Ø¹Ø¶Ùˆ', `Ù‚Ø§Ù… Ø¨ØªØ¹Ø¯ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ø¶Ùˆ: ${name}`);

                    showNotification('ØªÙ… Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ø¨Ù†Ø¬Ø§Ø­');
                    closeModal('edit-user-info-modal');
                    updateAdminUsersList();
                    
                    // Ù„Ùˆ Ø§Ù„Ù…Ø¯ÙŠØ± Ø¨ÙŠØ¹Ø¯Ù„ Ø¨ÙŠØ§Ù†Ø§ØªÙ‡ Ù‡ÙˆØŒ Ù†Ø­Ø¯Ø« Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© ÙÙˆØ±Ø§Ù‹
                    if (currentUser && id === currentUser.id) {
                        currentUser.full_name = name;
                        currentUser.department = dept;
                        currentUser.position = position;
                        currentUser.mobile = mobile;
                        localStorage.setItem('currentUser', JSON.stringify(currentUser));
                        applyUserPermissions();
                        updateSidebarProfile();
                    }
                } catch (err) {
                    console.error(err);
                    showNotification('Ø®Ø·Ø£: ' + err.message, 'error');
                } finally {
                    btn.innerHTML = originalText;
                    btn.disabled = false;
                }
            });
        }

// ============================================================
        // 5. Ø­ÙØ¸ ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª (Ø§Ù„ØªØ±Ø³) - ğŸ›¡ï¸ Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ù…Ø¯Ø±Ø¹Ø©
        // ============================================================
        const permForm = document.getElementById('permissions-form');
        
        // Ù†Ù‚ÙˆÙ… Ø¨Ø¥Ø²Ø§Ù„Ø© Ø£ÙŠ Ù…Ø³ØªÙ…Ø¹ Ù‚Ø¯ÙŠÙ… Ù„ØªØ¬Ù†Ø¨ Ø§Ù„ØªÙƒØ±Ø§Ø± (Important Trick)
        const newPermForm = permForm.cloneNode(true);
        permForm.parentNode.replaceChild(newPermForm, permForm);

        if(newPermForm) {
            newPermForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                
                const btn = e.target.querySelector('button[type="submit"]');
                const originalText = btn.innerText;
                const userId = document.getElementById('perm-user-id').value;
                
                // Ø¥ÙŠÙ…ÙŠÙ„ Ø§Ù„Ù…Ø¤Ø³Ø³ (ØªØ£ÙƒØ¯ Ø£Ù†Ù‡ Ù…ÙƒØªÙˆØ¨ Ø¨Ø­Ø±ÙˆÙ ØµØºÙŠØ±Ø© ØªÙ…Ø§Ù…Ø§Ù‹)
                const FOUNDER_EMAIL_LOWER = "fekrythug@gmail.com".trim().toLowerCase();

                btn.innerText = 'Ø¬Ø§Ø±ÙŠ Ø§Ù„ÙØ­Øµ...';
                btn.disabled = true;

                // ğŸ›‘ 1. Ø§Ù„Ø­Ù…Ø§ÙŠØ©: ÙØ­Øµ Ø§Ù„Ù‡ÙˆÙŠØ© Ù‚Ø¨Ù„ Ø£ÙŠ Ø´ÙŠØ¡
                try {
                    console.log("ğŸ” Ø¬Ø§Ø±ÙŠ ÙØ­Øµ Ø§Ù„Ø­Ù…Ø§ÙŠØ© Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø±Ù‚Ù…:", userId);

                    const { data: targetUser, error } = await supabase
                        .from('profiles')
                        .select('email')
                        .eq('id', userId)
                        .single();
                    
                    if(error) throw error;

                    if (targetUser) {
                        const targetEmail = targetUser.email.trim().toLowerCase();
                        console.log("ğŸ“§ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ù…Ø³ØªÙ‡Ø¯Ù:", targetEmail);
                        console.log("ğŸ›¡ï¸ Ø¨Ø±ÙŠØ¯ Ø§Ù„Ù…Ø¤Ø³Ø³:", FOUNDER_EMAIL_LOWER);

                        // Ø§Ù„Ù…Ù‚Ø§Ø±Ù†Ø© Ø§Ù„Ø¯Ù‚ÙŠÙ‚Ø©
                        if (targetEmail === FOUNDER_EMAIL_LOWER) {
                            console.warn("â›” ØªÙ… Ù…Ù†Ø¹ Ù…Ø­Ø§ÙˆÙ„Ø© ØªØ¹Ø¯ÙŠÙ„ ØµÙ„Ø§Ø­ÙŠØ§Øª Ø§Ù„Ù…Ø¤Ø³Ø³!");
                            alert("â›” Ø®Ø·Ø£ Ø£Ù…Ù†ÙŠ: Ù„Ø§ ÙŠÙ…ÙƒÙ† ØªØ¹Ø¯ÙŠÙ„ ØµÙ„Ø§Ø­ÙŠØ§Øª Ø§Ù„Ù…Ø¤Ø³Ø³ (Ahmed Fekry) Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹!");
                            
                            // Ø¥ÙŠÙ‚Ø§Ù ÙˆØ¥Ø±Ø¬Ø§Ø¹ Ø§Ù„Ø²Ø±
                            btn.innerText = originalText;
                            btn.disabled = false;
                            return; // ğŸ›‘ Ø®Ø±ÙˆØ¬ Ù†Ù‡Ø§Ø¦ÙŠ
                        }
                    }

                } catch (securityErr) {
                    console.error("Ø®Ø·Ø£ ÙÙŠ ÙØ­Øµ Ø§Ù„Ø£Ù…Ø§Ù†:", securityErr);
                    // ÙÙŠ Ø­Ø§Ù„Ø© Ø§Ù„Ø®Ø·Ø£ØŒ Ù‡Ù„ Ù†ÙˆÙ‚Ù Ø§Ù„Ø¹Ù…Ù„ÙŠØ©ØŸ Ø§Ù„Ø£ÙØ¶Ù„ Ù†Ø¹Ù… Ù„Ù„Ø£Ù…Ø§Ù†
                    alert("Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù‡ÙˆÙŠØ©ØŒ ØªÙ… Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø¹Ù…Ù„ÙŠØ© Ù„Ù„Ø£Ù…Ø§Ù†.");
                    btn.innerText = originalText;
                    btn.disabled = false;
                    return;
                }
                // ğŸ›‘ Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ø­Ù…Ø§ÙŠØ©

                // 2. Ø§Ù„ØªÙ†ÙÙŠØ° (Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† Ø§Ù„Ù…Ø¤Ø³Ø³)
                btn.innerText = 'Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø­ÙØ¸...';
                
                const newPerms = {
                    can_approve: document.getElementById('perm-approve').checked,
                    can_manage_users: document.getElementById('perm-users').checked,
                    can_delete: document.getElementById('perm-delete').checked
                };

                try {
                    const hasAnyPerm = Object.values(newPerms).some(v => v === true);
                    const newRole = hasAnyPerm ? 'manager' : 'user';

                    // Ø§Ù„ØªØ­Ø¯ÙŠØ«
                    const { error } = await supabase.from('profiles')
                        .update({ permissions: newPerms, role: newRole })
                        .eq('id', userId);
                    
                    if(error) throw error;

                    // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…ÙŠØªØ§Ø¯Ø§ØªØ§ (Ø²ÙŠØ§Ø¯Ø© ØªØ£ÙƒÙŠØ¯)
                    if(window.supabaseAdmin) {
                        await window.supabaseAdmin.auth.admin.updateUserById(userId, {
                            user_metadata: { permissions: newPerms, role: newRole }
                        });
                    }

                    showNotification('ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª Ø¨Ù†Ø¬Ø§Ø­ âœ…');
                    closeModal('permissions-modal');
                    
                    if (typeof updateAdminUsersList === 'function') updateAdminUsersList();
                    else if (typeof fetchUsers === 'function') fetchUsers();

                } catch(err) {
                    console.error(err);
                    showNotification('Ø­Ø¯Ø« Ø®Ø·Ø£: ' + err.message, 'error');
                } finally {
                    btn.innerText = originalText;
                    btn.disabled = false;
                }
            });
        }

// 2. Ø§Ù„Ø±ÙØ¶ + Ø¥Ø´Ø¹Ø§Ø± Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
window.rejectMeeting = async function(id) {
    // Ø§Ù„ØªØ¹Ø¯ÙŠÙ„: ØªØºÙŠÙŠØ± Ù†Øµ Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡ Ù„ÙŠÙƒÙˆÙ† Ø£ÙƒØ«Ø± Ø¯Ù‚Ø©
    const confirmed = await showConfirmDialog('Ù‡Ù„ ØªØ±ÙŠØ¯ Ø±ÙØ¶ Ù‡Ø°Ø§ Ø§Ù„Ø·Ù„Ø¨ØŸ\nØ³ÙŠØªÙ… Ø¥Ø´Ø¹Ø§Ø± Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¨Ø§Ù„Ø±ÙØ¶ ÙˆØ¨Ù‚Ø§Ø¡ Ø§Ù„Ø­Ø¬Ø² ÙÙŠ Ø³Ø¬Ù„Ø§ØªÙ‡ ÙƒÙ…Ø±ÙÙˆØ¶.');
    if(!confirmed) return;
    
    document.body.style.cursor = 'wait';
    try {
        // 1. Ø§Ù„Ø§Ø­ØªÙØ§Ø¸ Ø¨Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù‚Ø¨Ù„ Ø§Ù„ØªØ­Ø¯ÙŠØ« Ù„Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„
        const meetingToReject = meetings.find(m => m.id == id);
        
        // 2. ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø­Ø§Ù„Ø© ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¥Ù„Ù‰ 'rejected' Ø¨Ø¯Ù„Ø§Ù‹ Ù…Ù† Ø§Ù„Ø­Ø°Ù Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ
        const { error } = await supabase.from('meetings')
            .update({ status: 'rejected' })
            .eq('id', id);
            
        if(error) throw error;

        // 3. Ø¥Ø±Ø³Ø§Ù„ Ø¥ÙŠÙ…ÙŠÙ„ Ø§Ù„Ø±ÙØ¶ (ÙƒÙ…Ø§ Ù‡Ùˆ ÙÙŠ ÙƒÙˆØ¯Ùƒ)
        if (meetingToReject && meetingToReject.creatorEmail) {
            sendEmailNotification(
                meetingToReject.creatorEmail, 
                meetingToReject.createdBy, 
                "âŒ ØªÙ… Ø±ÙØ¶ Ø·Ù„Ø¨ Ø§Ù„Ø­Ø¬Ø²", 
                `Ø¹ÙÙˆØ§Ù‹ØŒ ØªÙ… Ø±ÙØ¶ Ø·Ù„Ø¨ Ø­Ø¬Ø² Ø§Ù„Ù‚Ø§Ø¹Ø© Ù„Ø§Ø¬ØªÙ…Ø§Ø¹: "${meetingToReject.title}".
                
                ÙŠØ±Ø¬Ù‰ Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯ Ø§Ù„Ù…ØªØ§Ø­Ø© ÙˆØ§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.`
            );
        }

        showNotification('ØªÙ… Ø±ÙØ¶ Ø§Ù„Ø·Ù„Ø¨ ÙˆØªÙ†Ø¨ÙŠÙ‡ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…');
        
        // 4. Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…ØµÙÙˆÙØ© Ø§Ù„Ù…Ø­Ù„ÙŠØ© ÙˆØ§Ù„ÙˆØ§Ø¬Ù‡Ø§Øª ÙÙˆØ±Ø§Ù‹
        await loadMeetings();

    } catch(err) {
        console.error(err);
        showNotification('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø±ÙØ¶', 'error');
    } finally {
        document.body.style.cursor = 'default';
    }
};

// 1. Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø© (ØªÙ… Ø¥ÙŠÙ‚Ø§Ù Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„ Ù„ØªÙˆÙÙŠØ± Ø§Ù„Ø±ØµÙŠØ¯)
window.approveMeeting = async function(id) {
    document.body.style.cursor = 'wait';
    try {
        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø­Ø§Ù„Ø© ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        const { error } = await supabase.from('meetings').update({ status: 'confirmed' }).eq('id', id);
        if(error) throw error;

        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø­Ø§Ù„Ø© Ù…Ø­Ù„ÙŠØ§Ù‹
        const mIndex = meetings.findIndex(m => m.id == id);
        if(mIndex > -1) {
            meetings[mIndex].status = 'confirmed';
            
            // âŒâŒ ØªÙ… Ø¥ÙŠÙ‚Ø§Ù Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„ Ù‡Ù†Ø§ Ù„ØªÙˆÙÙŠØ± Ø§Ù„Ø±ØµÙŠØ¯ âŒâŒ
            /*
            const ownerEmail = meetings[mIndex].creatorEmail;
            const ownerName = meetings[mIndex].createdBy;
            
            if (ownerEmail) {
                sendEmailNotification(
                    ownerEmail, 
                    ownerName, 
                    "âœ… ØªÙ…Øª Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø© Ø¹Ù„Ù‰ Ø­Ø¬Ø²Ùƒ", 
                    `ØªÙ‡Ø§Ù†ÙŠÙ†Ø§! ØªÙ…Øª Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø© Ø¹Ù„Ù‰ Ø­Ø¬Ø² Ø§Ù„Ù‚Ø§Ø¹Ø© Ù„Ø§Ø¬ØªÙ…Ø§Ø¹: "${meetings[mIndex].title}"\nØ§Ù„Ù…ÙˆØ¹Ø¯: ${meetings[mIndex].date} Ø§Ù„Ø³Ø§Ø¹Ø© ${meetings[mIndex].startTime}.`
                );
            }
            */
        }

        // ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
        showNotification('ØªÙ… Ø§Ø¹ØªÙ…Ø§Ø¯ Ø§Ù„Ø­Ø¬Ø² Ø¨Ù†Ø¬Ø§Ø­ âœ…');
        refreshAllViews();

    } catch(err) {
        console.error(err);
        showNotification('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§Ø¹ØªÙ…Ø§Ø¯', 'error');
    } finally {
        document.body.style.cursor = 'default';
    }
};
       
        function showDashboardSkeleton() {
            const container = document.getElementById('ai-suggestions');
            if(!container) return;
            
            container.innerHTML = `
                <div class="bg-gray-100 rounded-lg p-4 border border-gray-200 animate-pulse mb-3">
                    <div class="h-4 bg-gray-300 rounded w-1/3 mb-2"></div>
                    <div class="h-3 bg-gray-200 rounded w-2/3"></div>
                </div>
                <div class="bg-gray-100 rounded-lg p-3 border border-gray-200 animate-pulse">
                    <div class="flex justify-between mb-2">
                        <div class="h-3 bg-gray-300 rounded w-1/4"></div>
                        <div class="h-3 bg-gray-300 rounded w-10"></div>
                    </div>
                    <div class="h-2 bg-gray-200 rounded-full w-full"></div>
                </div>
            `;
        }

// Ø¯Ø§Ù„Ø© ØªØ¹Ø¨Ø¦Ø© Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ (Ù…ØµØ­Ø­Ø© Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù†Ø³Ø¯Ù„Ø©)
function loadProfileTab() {
    if(!currentUser) return;
    
    // 1. ØªØ¹Ø¨Ø¦Ø© Ø§Ù„Ø®Ø§Ù†Ø§Øª Ø§Ù„Ù†ØµÙŠØ© Ø§Ù„Ø¹Ø§Ø¯ÙŠØ©
    const nameInput = document.getElementById('tab-my-name');
    const mobileInput = document.getElementById('tab-my-mobile');
    const emailInput = document.getElementById('tab-my-email');
    const posInput = document.getElementById('tab-my-position');
    
    if(nameInput) nameInput.value = currentUser.full_name || '';
    if(mobileInput) mobileInput.value = currentUser.mobile || '';
    if(emailInput) emailInput.value = currentUser.email || '';
    if(posInput) posInput.value = currentUser.position || '';

    // 2. ØªØ¹Ø¨Ø¦Ø© Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù†Ø³Ø¯Ù„Ø© Ù„Ù„Ù‚Ø³Ù… (Ø§Ù„Ø¬Ø²Ø¡ Ø§Ù„Ù…Ù‡Ù… Ù„Ù„Ø¥ØµÙ„Ø§Ø­)
    const deptInput = document.getElementById('tab-my-dept');
    if(deptInput) {
        const val = currentUser.department || '';
        deptInput.value = val; // ÙˆØ¶Ø¹ Ø§Ù„Ù‚ÙŠÙ…Ø© ÙÙŠ Ø§Ù„Ø­Ù‚Ù„ Ø§Ù„Ù…Ø®ÙÙŠ

        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø´ÙƒÙ„ Ø§Ù„Ø®Ø§Ø±Ø¬ÙŠ (Ø§Ù„Ù†Øµ Ø§Ù„Ø¸Ø§Ù‡Ø±)
        const wrapper = deptInput.closest('.custom-dropdown');
        if(wrapper) {
            const displaySpan = wrapper.querySelector('.custom-dropdown-display span');
            // Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ø®ÙŠØ§Ø± Ø§Ù„Ù…Ø·Ø§Ø¨Ù‚ Ù„Ù„Ù‚ÙŠÙ…Ø© Ù„Ø¬Ù„Ø¨ Ø§Ø³Ù…Ù‡ Ø§Ù„Ø¹Ø±Ø¨ÙŠ
            const matchingOption = wrapper.querySelector(`.custom-option[data-value="${val}"]`);
            
            if(displaySpan) {
                if(matchingOption) {
                    displaySpan.textContent = matchingOption.textContent.trim(); // ÙŠÙƒØªØ¨ "Ù…ÙƒØªØ¨ Ø§Ù„Ø¹Ù…ÙŠØ¯" Ø¨Ø¯Ù„Ø§Ù‹ Ù…Ù† Ø§Ù„ÙƒÙˆØ¯
                    displaySpan.classList.add('text-[#2A3475]', 'font-bold');
                } else {
                    displaySpan.textContent = 'Ø§Ø®ØªØ± Ø§Ù„Ø¬Ù‡Ø©...';
                    displaySpan.classList.remove('text-[#2A3475]', 'font-bold');
                }
            }
        }
    }
}
// Ø¯Ø§Ù„Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ù†Ø´Ø§Ø·Ø§Øª (ØªÙ… ØªØ¹Ø·ÙŠÙ„Ù‡Ø§ Ù„Ø£Ù† Ø§Ù„Ø¬Ø¯ÙˆÙ„ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯)
        async function logActivity(action, details) {
            // Ù„Ù† Ù†Ù‚ÙˆÙ… Ø¨Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ Ù„Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù…Ù†Ø¹ Ø®Ø·Ø£ 404
            // ÙÙ‚Ø· Ø³Ù†Ø·Ø¨Ø¹ ÙÙŠ Ø§Ù„ÙƒÙˆÙ†Ø³ÙˆÙ„ Ù„Ù„Ù…ØªØ§Ø¨Ø¹Ø© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)
            console.log(`[Ø³Ø¬Ù„ Ù…Ø­Ù„ÙŠ] Ù‚Ø§Ù… ${currentUser?.full_name || 'Ù…Ø³ØªØ®Ø¯Ù…'} Ø¨Ù€: ${action} - ${details}`);
            return;
        }

        // Ø§Ø³ØªØ¨Ø¯Ù„ Ø¯Ø§Ù„Ø© setupCustomDropdowns Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø© Ø¨Ù‡Ø°Ù‡ Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ù‚ÙˆÙŠØ©
function setupCustomDropdowns() {
    // 1. Ù…Ø¹Ø§Ù„Ø¬Ø© Ø²Ø± Ø§Ù„ÙØªØ­ ÙˆØ§Ù„Ø¥ØºÙ„Ø§Ù‚ (Display)
    document.querySelectorAll('.custom-dropdown-display').forEach(display => {
        // Ù†Ø³ØªØ®Ø¯Ù… cloneNode Ù„Ø¥Ø²Ø§Ù„Ø© Ø£ÙŠ Event Listeners Ù‚Ø¯ÙŠÙ…Ø© Ø¹Ø´Ø§Ù† Ù…ÙŠØªÙƒØ±Ø±ÙˆØ´
        const newDisplay = display.cloneNode(true);
        display.parentNode.replaceChild(newDisplay, display);

        newDisplay.addEventListener('click', (e) => {
            e.stopPropagation();
            const dropdown = newDisplay.closest('.custom-dropdown');
            const options = dropdown.querySelector('.custom-dropdown-options');

            // Ø¥ØºÙ„Ø§Ù‚ Ø£ÙŠ Ù‚Ø§Ø¦Ù…Ø© Ø£Ø®Ø±Ù‰ Ù…ÙØªÙˆØ­Ø©
            document.querySelectorAll('.custom-dropdown-options').forEach(opt => {
                if(opt !== options) opt.classList.remove('show');
            });

            options.classList.toggle('show');
        });
    });

    // 2. Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø¹Ù†Ø§ØµØ± (Options) - Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Event Delegation (Ø§Ù„Ø­Ù„ Ø§Ù„Ø¬Ø°Ø±ÙŠ)
    // Ù†Ø¶Ø¹ Ø§Ù„Ù€ Listener Ù…Ø±Ø© ÙˆØ§Ø­Ø¯Ø© Ø¹Ù„Ù‰ Ø§Ù„ØµÙØ­Ø© ÙƒÙ„Ù‡Ø§ØŒ ÙÙŠÙ„ØªÙ‚Ø· Ø£ÙŠ Ù†Ù‚Ø±Ø© Ø­ØªÙ‰ Ù„Ù„Ø¹Ù†Ø§ØµØ± Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
    if (!window.dropdownsInitialized) {
        document.addEventListener('click', function(e) {
            
            // Ø£. Ù„Ùˆ Ø§Ù„Ø¶ØºØ· ØªÙ… Ø¹Ù„Ù‰ Ø®ÙŠØ§Ø± Ø¯Ø§Ø®Ù„ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© (Option)
            const option = e.target.closest('.custom-option');
            if (option) {
                const dropdown = option.closest('.custom-dropdown');
                const hiddenSelect = dropdown.querySelector('select'); // Ø§Ù„Ø­Ù‚Ù„ Ø§Ù„Ù…Ø®ÙÙŠ
                const displayText = dropdown.querySelector('.custom-dropdown-display span');
                
                const value = option.dataset.value;
                const text = option.innerText;

                // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø´ÙƒÙ„ Ø§Ù„Ø®Ø§Ø±Ø¬ÙŠ (Ø¹Ø´Ø§Ù† Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙŠØ´ÙˆÙ Ø¥Ù†Ù‡ Ø§Ø®ØªØ§Ø±)
                if (displayText) {
                    displayText.textContent = text;
                    displayText.classList.add('text-[#2A3475]', 'font-bold');
                }

                // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ù…Ø®ÙÙŠØ© (Ø£Ù‡Ù… Ø®Ø·ÙˆØ© Ø¹Ø´Ø§Ù† Ø²Ø± Ø§Ù„Ø­ÙØ¸ ÙŠØ´ØªØºÙ„)
                if (hiddenSelect) {
                    hiddenSelect.value = value;
                    // ØªØ¨Ù„ÙŠØº Ø§Ù„Ù†Ø¸Ø§Ù… Ø¥Ù† Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§ØªØºÙŠØ±Øª
                    hiddenSelect.dispatchEvent(new Event('change'));
                    console.log(`ØªÙ… Ø§Ø®ØªÙŠØ§Ø±: ${text} -> Ø§Ù„Ù‚ÙŠÙ…Ø©: ${value}`); // Ù„Ù„ØªØ£ÙƒØ¯ ÙÙŠ Ø§Ù„ÙƒÙˆÙ†Ø³ÙˆÙ„
                }

                // Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø¨Ø¹Ø¯ Ø§Ù„Ø§Ø®ØªÙŠØ§Ø±
                const options = dropdown.querySelector('.custom-dropdown-options');
                if (options) options.classList.remove('show');
            }

            // Ø¨. Ù„Ùˆ Ø§Ù„Ø¶ØºØ· ØªÙ… ÙÙŠ Ø£ÙŠ Ù…ÙƒØ§Ù† ÙØ§Ø¶ÙŠ Ø®Ø§Ø±Ø¬ Ø§Ù„Ù‚ÙˆØ§Ø¦Ù… (Ù„Ø¥ØºÙ„Ø§Ù‚Ù‡Ø§)
            if (!e.target.closest('.custom-dropdown')) {
                 document.querySelectorAll('.custom-dropdown-options').forEach(opt => opt.classList.remove('show'));
            }
        });
        
        window.dropdownsInitialized = true; // Ø¹Ù„Ø§Ù…Ø© Ù„Ù…Ù†Ø¹ ØªÙƒØ±Ø§Ø± Ø§Ù„ÙƒÙˆØ¯
    }
}

// Ø¯Ø§Ù„Ø© Ù„ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ ÙˆØ§Ù„ÙˆØ§Ø¬Ù‡Ø© Ù…Ø¹Ø§Ù‹ (Ø§Ù„Ø­Ù„ Ù„Ù…Ø´ÙƒÙ„Ø© Ø§Ù„ØªØ¹Ù„ÙŠÙ‚)
        function resetFormUI() {
            // 1. ØªØµÙÙŠØ± Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ø¹Ø§Ø¯ÙŠØ© ÙˆØ§Ù„Ù…Ø®ÙÙŠØ©
            document.getElementById('meeting-form').reset();
            document.getElementById('meeting-id').value = '';
            document.getElementById('department').value = '';
            document.getElementById('meeting-time').value = '';
            
            // 2. Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù†ØµÙˆØµ Ø§Ù„Ø¸Ø§Ù‡Ø±Ø© ÙÙŠ Ø§Ù„Ù‚ÙˆØ§Ø¦Ù… Ø§Ù„Ù…Ù†Ø³Ø¯Ù„Ø© Ù„Ù„ÙˆØ¶Ø¹ Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ
            document.querySelectorAll('.custom-dropdown').forEach(dropdown => {
                const displaySpan = dropdown.querySelector('.custom-dropdown-display span');
                const defaultOption = dropdown.querySelector('.custom-dropdown-options li:first-child');
                
                if (displaySpan && defaultOption) {
                    // ÙŠØ±Ø¬Ø¹ ÙŠÙƒØªØ¨ "Ø§Ø®ØªØ± Ø§Ù„Ø¬Ù‡Ø©..." Ø£Ùˆ "Ø§Ø®ØªØ± Ø§Ù„ÙˆÙ‚Øª..."
                    displaySpan.textContent = defaultOption.innerText;
                    displaySpan.classList.remove('text-[#2A3475]', 'font-bold');
                }
            });
        }

        // Ø¯Ø§Ù„Ø© Ù…Ø³Ø§Ø¹Ø¯Ø© Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù‚ÙˆØ§Ø¦Ù… Ø§Ù„Ù…Ù†Ø³Ø¯Ù„Ø© Ø§Ù„Ù…Ø®ØµØµØ©
function setDropdownValue(selectId, value) {
    const select = document.getElementById(selectId);
    if (!select) return;
    
    // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù‚ÙŠÙ…Ø© ÙÙŠ Ø§Ù„Ø­Ù‚Ù„ Ø§Ù„Ù…Ø®ÙÙŠ
    select.value = value;
    
    // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø´ÙƒÙ„ Ø§Ù„Ø®Ø§Ø±Ø¬ÙŠ (Ø§Ù„Ù†Øµ Ø§Ù„Ø¸Ø§Ù‡Ø± Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…)
    const dropdown = select.closest('.custom-dropdown');
    if(dropdown) {
        const display = dropdown.querySelector('.custom-dropdown-display span');
        // Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ø®ÙŠØ§Ø± Ø§Ù„Ù…Ø·Ø§Ø¨Ù‚ Ù„Ù„Ù‚ÙŠÙ…Ø©
        const option = dropdown.querySelector(`.custom-option[data-value="${value}"]`);
        
        if(display && option) {
            display.textContent = option.textContent; // ÙŠÙƒØªØ¨ Ø§Ù„Ø§Ø³Ù… (Ù…Ø«Ù„Ø§Ù‹: Ù…ÙƒØªØ¨ Ø§Ù„Ø¹Ù…ÙŠØ¯)
            display.classList.add('text-[#2A3475]', 'font-bold'); // ØªÙ„ÙˆÙŠÙ† Ø§Ù„Ù†Øµ
        }
    }
}

// 1. Ø§Ù„Ù…Ø¯ÙŠØ± ÙŠÙˆØ§ÙÙ‚ Ø¹Ù„Ù‰ Ø·Ù„Ø¨ Ø§Ù„Ø­Ø°Ù (ÙŠØ­Ø°Ù Ø§Ù„Ø­Ø¬Ø² Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹)
window.confirmDeleteRequest = async function(id) {
    if(!confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø© Ø¹Ù„Ù‰ Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø­Ø¬Ø²ØŸ')) return;
    
    document.body.style.cursor = 'wait';
    try {
        const { error } = await supabase.from('meetings').delete().eq('id', id);
        if(error) throw error;

        meetings = meetings.filter(m => m.id != id);
        refreshAllViews();
        showNotification('ØªÙ… Ù‚Ø¨ÙˆÙ„ Ø·Ù„Ø¨ Ø§Ù„Ø­Ø°Ù ÙˆØ¥Ø²Ø§Ù„Ø© Ø§Ù„Ø­Ø¬Ø²');
    } catch(err) {
        showNotification('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø¹Ù…Ù„ÙŠØ©', 'error');
    } finally {
        document.body.style.cursor = 'default';
    }
};

// 2. Ø§Ù„Ù…Ø¯ÙŠØ± ÙŠØ±ÙØ¶ Ø·Ù„Ø¨ Ø§Ù„Ø­Ø°Ù (ÙŠØ±Ø¬Ø¹ Ø§Ù„Ø­Ø¬Ø² Ù„Ø­Ø§Ù„Ø© "Ù…Ø¤ÙƒØ¯")
window.rejectDeleteRequest = async function(id) {
    document.body.style.cursor = 'wait';
    try {
        // Ø¥Ø±Ø¬Ø§Ø¹ Ø§Ù„Ø­Ø§Ù„Ø© Ø¥Ù„Ù‰ confirmed
        const { error } = await supabase.from('meetings').update({ status: 'confirmed' }).eq('id', id);
        if(error) throw error;

        const mIndex = meetings.findIndex(m => m.id == id);
        if(mIndex > -1) meetings[mIndex].status = 'confirmed';

        refreshAllViews();
        showNotification('ØªÙ… Ø±ÙØ¶ Ø·Ù„Ø¨ Ø§Ù„Ø­Ø°Ù ÙˆØ§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„Ø­Ø¬Ø²');
    } catch(err) {
        showNotification('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø¹Ù…Ù„ÙŠØ©', 'error');
    } finally {
        document.body.style.cursor = 'default';
    }
};

// 1. Ù‚Ø¨ÙˆÙ„ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ (ØªØµÙ…ÙŠÙ… Ø§Ø­ØªØ±Ø§ÙÙŠ - Ø£Ø®Ø¶Ø±)
window.approveModification = async function(id) {
    const isConfirmed = await showConfirmDialog(
        'Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ø¹ØªÙ…Ø§Ø¯ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© ÙˆØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¬Ø¯ÙˆÙ„ØŸ', 
        {
            title: 'Ø§Ø¹ØªÙ…Ø§Ø¯ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„',          // Ø§Ù„Ø¹Ù†ÙˆØ§Ù†
            confirmText: 'Ù†Ø¹Ù…ØŒ Ø§Ø¹ØªÙ…Ø¯',        // Ù†Øµ Ø§Ù„Ø²Ø±
            color: 'bg-green-600 hover:bg-green-700', // Ù„ÙˆÙ† Ø§Ù„Ø²Ø± Ø£Ø®Ø¶Ø±
            icon: 'fa-check-circle',          // Ø£ÙŠÙ‚ÙˆÙ†Ø© ØµØ­
            iconColor: 'text-green-600',      // Ù„ÙˆÙ† Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø©
            iconBg: 'bg-green-100',           // Ø®Ù„ÙÙŠØ© Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø©
            borderColor: 'border-green-500'   // Ù„ÙˆÙ† Ø§Ù„Ø­Ø¯ÙˆØ¯
        }
    );
    
    if(!isConfirmed) return;
    
    // ... (Ø¨Ø§Ù‚ÙŠ ÙƒÙˆØ¯ Ø§Ù„Ø¯Ø§Ù„Ø© ÙƒÙ…Ø§ Ù‡Ùˆ Ø¨Ø¯ÙˆÙ† ØªØºÙŠÙŠØ±) ...
    document.body.style.cursor = 'wait';
    try {
        const meeting = meetings.find(m => m.id == id);
        if(!meeting || !meeting.pending_changes) return;
        const changes = meeting.pending_changes;
        const { error } = await supabase.from('meetings').update({
            title: changes.title, department: changes.department, date: changes.date,
            start_time: changes.start_time, end_time: changes.end_time,
            description: changes.description, attendees: changes.attendees,
            status: 'confirmed', pending_changes: null    
        }).eq('id', id);
        if(error) throw error;
        if(meeting.creatorEmail) sendEmailNotification(meeting.creatorEmail, meeting.createdBy, "âœ… ØªÙ…Øª Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø© Ø¹Ù„Ù‰ ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø­Ø¬Ø²", `ØªÙ… ØªØ­Ø¯ÙŠØ« Ù…ÙˆØ¹Ø¯ Ø§Ø¬ØªÙ…Ø§Ø¹Ùƒ "${meeting.title}" Ø¨Ù†Ø¬Ø§Ø­.`);
        showNotification('ØªÙ… Ø§Ø¹ØªÙ…Ø§Ø¯ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ ÙˆØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¬Ø¯ÙˆÙ„ âœ…');
        await loadMeetings(); 
    } catch(err) { console.error(err); showNotification('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø¹Ù…Ù„ÙŠØ©', 'error'); } 
    finally { document.body.style.cursor = 'default'; }
};

// 2. Ø±ÙØ¶ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ (Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„ØªÙŠ ØªÙ…ÙŠØ² Ø§Ù„Ø±ÙØ¶ Ø¹Ù† Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø©)
window.rejectModification = async function(id) {
    // Ù†Ø³ØªØ®Ø¯Ù… Ø§Ù„Ù†Ø§ÙØ°Ø© Ø§Ù„Ø§Ø­ØªØ±Ø§ÙÙŠØ©
    const isConfirmed = await showConfirmDialog(
        'Ù‡Ù„ ØªØ±ÙŠØ¯ Ø±ÙØ¶ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª Ø§Ù„Ù…Ù‚ØªØ±Ø­Ø© ÙˆØ¥Ø¨Ù‚Ø§Ø¡ Ø§Ù„Ù…ÙˆØ¹Ø¯ Ø§Ù„Ù‚Ø¯ÙŠÙ… ÙƒÙ…Ø§ Ù‡ÙˆØŸ',
        {
            title: 'Ø±ÙØ¶ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„',
            confirmText: 'Ù†Ø¹Ù…ØŒ Ø§Ø±ÙØ¶',
            color: 'bg-gray-600 hover:bg-gray-700',
            icon: 'fa-times-circle',
            iconColor: 'text-gray-600',
            iconBg: 'bg-gray-100',
            borderColor: 'border-gray-500'
        }
    );

    if(!isConfirmed) return;

    document.body.style.cursor = 'wait';
    try {
        // ğŸ”¥ğŸ”¥ğŸ”¥ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¬ÙˆÙ‡Ø±ÙŠ Ù‡Ù†Ø§ ğŸ”¥ğŸ”¥ğŸ”¥
        // Ø¨Ø¯Ù„Ø§Ù‹ Ù…Ù† Ø­Ø°Ù pending_changesØŒ Ù†Ø¶Ø¹ ÙÙŠÙ‡ Ø¹Ù„Ø§Ù…Ø© Ø£Ù† Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ù…Ø±ÙÙˆØ¶
        const { error } = await supabase.from('meetings').update({ 
            status: 'confirmed', 
            pending_changes: { rejected: true, timestamp: new Date().toISOString() } 
        }).eq('id', id);

        if(error) throw error;

        // Ø¥Ø´Ø¹Ø§Ø± Ø¨Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„
        const meeting = meetings.find(m => m.id == id);
        if(meeting && meeting.creatorEmail) {
            sendEmailNotification(meeting.creatorEmail, meeting.createdBy, "âŒ ØªÙ… Ø±ÙØ¶ ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø­Ø¬Ø²", `ØªÙ… Ø±ÙØ¶ Ø·Ù„Ø¨ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ù„Ù„Ø§Ø¬ØªÙ…Ø§Ø¹ "${meeting.title}". Ø§Ù„Ù…ÙˆØ¹Ø¯ Ø§Ù„Ø£ØµÙ„ÙŠ Ù…Ø§Ø²Ø§Ù„ Ù‚Ø§Ø¦Ù…Ø§Ù‹.`);
        }

        showNotification('ØªÙ… Ø±ÙØ¶ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ ÙˆØ¥Ø¨Ù‚Ø§Ø¡ Ø§Ù„Ø­Ø¬Ø² Ø§Ù„Ø£ØµÙ„ÙŠ');
        await loadMeetings();

    } catch(err) {
        showNotification('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø¹Ù…Ù„ÙŠØ©', 'error');
    } finally {
        document.body.style.cursor = 'default';
    }
};

async function toggleNotifications() {
    const menu = document.getElementById('notif-menu');
    const badge = document.getElementById('notif-badge');
    const badgeMob = document.getElementById('notif-badge-mob');
    
    if (!menu) return;

    const isOpening = menu.classList.contains('hidden');
    
    if (isOpening) {
        // --- Ø£ÙˆÙ„Ø§Ù‹: Ø¹Ù†Ø¯ Ø§Ù„ÙØªØ­ (Ø¶Ø¨Ø· Ø§Ù„Ù…ÙˆØ¶Ø¹ ÙƒÙ…Ø§ Ù‡Ùˆ ÙÙŠ ÙƒÙˆØ¯Ùƒ) ---
        const pcWrapper = document.getElementById('notif-btn-wrapper-pc');
        const mobWrapper = document.getElementById('notif-btn-wrapper');
        let btnWrapper = (pcWrapper && pcWrapper.offsetWidth > 0) ? pcWrapper : mobWrapper;
        
        if (btnWrapper) {
            const rect = btnWrapper.getBoundingClientRect();
            menu.style.position = 'fixed';
            menu.style.top = `${rect.bottom + 10}px`;
            let leftPos = rect.left;
            if (leftPos + 320 > window.innerWidth) leftPos = window.innerWidth - 335;
            if (leftPos < 10) leftPos = 10;
            menu.style.left = `${leftPos}px`;
        }

        // Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø£Ø±Ù‚Ø§Ù… (Badges) Ø¹Ù†Ø¯ Ø§Ù„ÙØªØ­
        if (badge) badge.classList.add('hidden');
        if (badgeMob) badgeMob.classList.add('hidden');

        menu.classList.remove('hidden');

    } else {
        // --- Ø«Ø§Ù†ÙŠØ§Ù‹: Ø¹Ù†Ø¯ Ø§Ù„Ø¥ØºÙ„Ø§Ù‚ (ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª Ø§Ù„Ù…Ø±ÙÙˆØ¶Ø© ÙˆØ§Ù„Ø­Ø°Ù Ù…Ù† Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª) ---
        
        if (typeof meetings !== 'undefined' && meetings.length > 0 && currentUser) {
            
            // 1. ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª Ø§Ù„Ù…Ø±ÙÙˆØ¶Ø© (Rejected) Ø§Ù„Ø®Ø§ØµØ© Ø¨Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø­Ø§Ù„ÙŠ
            const rejectedMeetings = meetings.filter(m => m.status === 'rejected' && m.user_id === currentUser.id);
            const rejectedIds = rejectedMeetings.map(m => m.id);

            // 2. Ø§Ù„Ø­Ø°Ù Ø§Ù„ÙØ¹Ù„ÙŠ Ù„Ø¶Ù…Ø§Ù† Ø§Ø®ØªÙØ§Ø¦Ù‡Ø§ Ù„Ù„Ø£Ø¨Ø¯
            if (rejectedIds.length > 0) {
                try {
                    // Ø§Ù„Ø­Ø°Ù Ù…Ù† Ù‚Ø§Ø¹Ø¯Ø© Ø¨ÙŠØ§Ù†Ø§Øª Supabase
                    await supabase.from('meetings').delete().in('id', rejectedIds);
                    
                    // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…ØµÙÙˆÙØ© Ø§Ù„Ù…Ø­Ù„ÙŠØ© ÙÙˆØ±Ø§Ù‹ (Ø­Ø°Ù Ø§Ù„Ø¹Ù†Ø§ØµØ± Ø§Ù„Ù…Ø±ÙÙˆØ¶Ø© Ù…Ù†Ù‡Ø§)
                    meetings = meetings.filter(m => !rejectedIds.includes(m.id));
                    
                    // ØªØ­Ø¯ÙŠØ« ÙƒÙ„ ÙˆØ§Ø¬Ù‡Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù… (Ø§Ù„Ø¬Ø¯ÙˆÙ„ØŒ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§ØªØŒ Ø¥Ù„Ø®)
                    if (typeof refreshAllViews === 'function') {
                        refreshAllViews();
                    }
                    
                    console.log("ØªÙ… ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ù…Ø±ÙÙˆØ¶Ø© Ù…Ù† Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­.");
                } catch (e) {
                    console.error("Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ù…Ø­Ø§ÙˆÙ„Ø© Ø­Ø°Ù Ø§Ù„Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ù…Ø±ÙÙˆØ¶Ø©:", e);
                }
            }

            // 3. ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù€ LocalStorage Ù„Ù„Ø­Ø¬ÙˆØ²Ø§Øª Ø§Ù„Ø£Ø®Ø±Ù‰ (Ø§Ù„Ù…Ù‚Ø¨ÙˆÙ„Ø©) Ù„ØªØ³Ø¬ÙŠÙ„Ù‡Ø§ ÙƒÙ€ "Ø´ÙˆÙ‡Ø¯Øª"
            let seenIds = JSON.parse(localStorage.getItem('seen_notifications') || '[]');
            meetings.forEach(m => {
                // Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª Ø§Ù„ØªÙŠ Ù„Ø§ ØªØ²Ø§Ù„ Ù‚ÙŠØ¯ Ø§Ù„ØªÙ†ÙÙŠØ° ØªØ¸Ù„ Ø¸Ø§Ù‡Ø±Ø© (Ù„Ø§ ØªØ¶Ø§Ù Ù„Ù€ seenIds)
                const isUnderProcess = m.status === 'pending' || 
                                       m.status === 'modification_requested' || 
                                       m.status === 'cancellation_requested';

                if (!isUnderProcess && !seenIds.includes(m.id)) {
                    seenIds.push(m.id);
                }
            });
            localStorage.setItem('seen_notifications', JSON.stringify(seenIds));
        }
        
        menu.classList.add('hidden');
        
        // ØªØ­Ø¯ÙŠØ« Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª ÙÙˆØ±Ø§Ù‹ Ù„ØªØ¹ÙƒØ³ Ø§Ù„Ø­Ø°Ù ÙˆØ§Ù„ØªØºÙŠÙŠØ±Ø§Øª
        if (typeof checkUserNotifications === 'function') {
            checkUserNotifications();
        }
    }
}

function toggleProfileInfoMenu() {
    const menu = document.getElementById('profile-info-menu');
    const capsule = document.getElementById('mob-profile-capsule');
    
    if (!menu || !capsule) return;

    // Ø¥ØºÙ„Ø§Ù‚ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ù„Ùˆ Ù…ÙØªÙˆØ­Ø©
    const notifMenu = document.getElementById('notif-menu');
    if (notifMenu && !notifMenu.classList.contains('hidden')) notifMenu.classList.add('hidden');

    menu.classList.toggle('hidden');
    
    if (!menu.classList.contains('hidden')) {
        const rect = capsule.getBoundingClientRect();
        menu.style.position = 'fixed';
        menu.style.top = `${rect.bottom + 10}px`;
        
        // Ø§Ù„Ù…Ø­Ø§Ø°Ø§Ø© Ù„Ù„ÙŠØ³Ø§Ø± Ù…Ø¹ Ø§Ù„ÙƒØ¨Ø³ÙˆÙ„Ø©
        menu.style.left = `${rect.left}px`;
        
        // ØªØ¹Ø¨Ø¦Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙƒØ§Ù…Ù„Ø© Ù…Ù† Ø§Ù„Ù€ currentUser
        if (currentUser) {
            const deptName = departments[currentUser.department]?.name || currentUser.department;
            const fullRoleText = `${deptName} - ${currentUser.position || ''}`;
            
            document.getElementById('full-profile-name').textContent = currentUser.full_name || 'Ù…Ø³ØªØ®Ø¯Ù…';
            document.getElementById('full-profile-role').textContent = fullRoleText;
        }
    }
}

function checkUserNotifications() {
    if (typeof currentUser === 'undefined' || !currentUser || typeof meetings === 'undefined' || !meetings) return;

    const list = document.getElementById('notif-list');
    const badge = document.getElementById('notif-badge');
    const badgeMob = document.getElementById('notif-badge-mob');

    if (!list) return;

    // 1. Ø¬Ù„Ø¨ Ø§Ù„Ù…Ø¹Ø±ÙØ§Øª Ø§Ù„ØªÙŠ ØªÙ…Øª Ù…Ø´Ø§Ù‡Ø¯ØªÙ‡Ø§ Ù…Ù† Ø§Ù„Ø°Ø§ÙƒØ±Ø©
    let seenIds = JSON.parse(localStorage.getItem('seen_notifications') || '[]');
    let relevantMeetings = [];

    // 2. ÙÙ„ØªØ±Ø© Ø§Ù„Ø§Ø¬ØªÙ…Ø§Ø¹Ø§Øª Ø­Ø³Ø¨ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª
    if (currentUser.role === 'manager') {
        relevantMeetings = meetings.filter(m => 
            m.user_id === currentUser.id || 
            m.status === 'pending' ||       
            m.status === 'modification_requested' || 
            m.status === 'cancellation_requested'
        );
    } else {
        relevantMeetings = meetings.filter(m => m.user_id === currentUser.id);
    }

    // 3. ÙÙ„ØªØ±Ø© Ø§Ù„Ø§Ø¬ØªÙ…Ø§Ø¹Ø§Øª Ù„Ø¥Ø¸Ù‡Ø§Ø± Ù…Ø§ ÙŠØ­ØªØ§Ø¬ ØªÙ†Ø¨ÙŠÙ‡
    const unreadMeetings = relevantMeetings.filter(m => {
        const isAlreadySeen = seenIds.includes(m.id);
        
        const isUnderProcess = m.status === 'pending' || 
                               m.status === 'modification_requested' || 
                               m.status === 'cancellation_requested' ||
                               m.status === 'rejected' || 
                               (m.pending_changes && m.pending_changes.rejected === true);

        return !isAlreadySeen || isUnderProcess;
    });

    unreadMeetings.sort((a, b) => new Date(b.createdAt || b.date) - new Date(a.createdAt || a.date));

    let notifsHTML = '';
    let pendingCount = unreadMeetings.length;

    // 4. Ø¨Ù†Ø§Ø¡ HTML Ù„Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª
    unreadMeetings.forEach(m => {
        const isRejectedMod = m.pending_changes && m.pending_changes.rejected === true;
        let config = { icon: 'fa-bell', color: 'text-gray-400', bg: 'bg-gray-50', title: 'ØªØ­Ø¯ÙŠØ« ÙÙŠ Ø§Ù„Ø­Ø¬Ø²' };

        if (m.status === 'modification_requested') {
            config = { icon: 'fa-edit', color: 'text-blue-500', bg: 'bg-blue-50', title: 'Ø·Ù„Ø¨ ØªØ¹Ø¯ÙŠÙ„ Ø­Ø¬Ø²' };
        } else if (m.status === 'cancellation_requested') {
            config = { icon: 'fa-trash-alt', color: 'text-red-500', bg: 'bg-red-50', title: 'Ø·Ù„Ø¨ Ø¥Ù„ØºØ§Ø¡ Ø­Ø¬Ø²' };
        } else if (m.status === 'pending') {
            // ğŸ”¥ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨ Ù‡Ù†Ø§: Ù…Ù†Ø·Ù‚ Ø¹Ø±Ø¶ Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø­Ø³Ø¨ Ø§Ù„Ø¯ÙˆØ± ÙˆÙ…Ø§Ù„Ùƒ Ø§Ù„Ø­Ø¬Ø² ğŸ”¥
            const isMyBooking = (m.user_id === currentUser.id);
            const titleText = (currentUser.role === 'manager' && !isMyBooking) ? 'Ø·Ù„Ø¨ Ø­Ø¬Ø² Ø¬Ø¯ÙŠØ¯' : 'Ø­Ø¬Ø² Ù‚ÙŠØ¯ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±';
            
            config = { icon: 'fa-clock', color: 'text-amber-500', bg: 'bg-amber-50', title: titleText };
        } else if (m.status === 'rejected') {
            config = { icon: 'fa-times-circle', color: 'text-red-600', bg: 'bg-red-50', title: 'ØªÙ… Ø±ÙØ¶ Ø·Ù„Ø¨ Ø§Ù„Ø­Ø¬Ø²' };
        } else if (m.status === 'confirmed') {
            if (isRejectedMod) {
                config = { icon: 'fa-times-circle', color: 'text-red-600', bg: 'bg-red-50', title: 'ØªÙ… Ø±ÙØ¶ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„' };
            } else {
                config = { icon: 'fa-check-circle', color: 'text-green-500', bg: 'bg-green-50', title: 'ØªÙ…Øª Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø© / ÙØ¹Ø§Ù„' };
            }
        }

        notifsHTML += `
            <div onclick="handleNotificationClick('${m.id}', '${m.status}')" 
                 class="group p-3 mb-2 rounded-xl cursor-pointer transition-all hover:bg-gray-50 flex items-start gap-3 border-r-2 border-[#F3A628] bg-orange-50/20">
                <div class="w-8 h-8 rounded-full flex-shrink-0 flex items-center justify-center ${config.bg} ${config.color} transition-transform group-hover:scale-110">
                    <i class="fas ${config.icon} text-xs"></i>
                </div>
                <div class="flex-1 min-w-0 text-right">
                    <p class="text-[12px] font-bold text-gray-800 leading-tight">${config.title}</p>
                    <p class="text-[11px] text-gray-500 mt-0.5 truncate">${m.title}</p>
                    <p class="text-[9px] text-gray-400 mt-1 italic">${new Date(m.date).toLocaleDateString('ar-EG')}</p>
                </div>
            </div>`;
    });

    list.innerHTML = notifsHTML || '<div class="p-8 text-center text-gray-400 text-[11px]">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø¬Ø¯ÙŠØ¯Ø© Ø­Ø§Ù„ÙŠØ§Ù‹</div>';

    [badge, badgeMob].forEach(el => {
        if (!el) return;
        if (pendingCount > 0) {
            el.textContent = pendingCount > 9 ? '+9' : pendingCount;
            el.classList.remove('hidden');
            el.classList.add('flex');
        } else {
            el.classList.add('hidden');
        }
    });
}


// --- Ø¯Ø§Ù„Ø© Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ù†Ù‚Ø± Ø¹Ù„Ù‰ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø± (Ø§Ù„ØªÙˆØ¬ÙŠÙ‡ Ø§Ù„Ø°ÙƒÙŠ) ---
window.handleNotificationClick = function(id, status) {
    const meeting = meetings.find(m => String(m.id) === String(id));
    if(!meeting) return;

    // 1. Ø¥ØºÙ„Ø§Ù‚ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª
    const menu = document.getElementById('notif-menu');
    if(menu && !menu.classList.contains('hidden')) toggleNotifications();

    // 2. Ù…Ù†Ø·Ù‚ Ø§Ù„ØªÙˆØ¬ÙŠÙ‡
    const isPendingRequest = status === 'pending' || status === 'modification_requested' || status === 'cancellation_requested';
    const isMyMeeting = meeting.user_id === currentUser.id;

    // --- Ø§Ù„Ø³ÙŠÙ†Ø§Ø±ÙŠÙˆ Ø£: Ø§Ù„Ù…Ø¯ÙŠØ± ÙŠØ¶ØºØ· Ø¹Ù„Ù‰ Ø·Ù„Ø¨ ÙŠØ­ØªØ§Ø¬ Ù…ÙˆØ§ÙÙ‚Ø© (ÙˆÙ„ÙŠØ³ Ø·Ù„Ø¨Ù‡ Ø§Ù„Ø´Ø®ØµÙŠ) ---
    if (currentUser.role === 'manager' && isPendingRequest && !isMyMeeting) {
        
        // ÙØªØ­ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…
        openAdminPanel();
        
        // Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ù„ØªØ¨ÙˆÙŠØ¨ Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª
        switchAdminTab('meetings');
        
        // Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø¹Ø±Ø¶ "Ø§Ù„ÙƒÙ„" Ø£Ùˆ Ø§Ù„ÙÙ„ØªØ± Ø§Ù„Ù…Ù†Ø§Ø³Ø¨
        if(typeof filterAdminMeetings === 'function') filterAdminMeetings('all');

        // Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø± Ù‚Ù„ÙŠÙ„Ø§Ù‹ Ø­ØªÙ‰ ÙŠØªÙ… Ø±Ø³Ù… Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø¯Ø§Ø®Ù„ Ø§Ù„Ù€ Modal
        setTimeout(() => {
            // Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„ØµÙ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… ID Ø§Ù„Ø°ÙŠ Ø£Ø¶ÙÙ†Ø§Ù‡ ÙÙŠ Ø§Ù„Ø®Ø·ÙˆØ© 1
            const row = document.getElementById(`req-row-${id}`);
            if(row) {
                // Ø§Ù„ØªÙ…Ø±ÙŠØ± (Scroll) Ø¥Ù„Ù‰ Ø§Ù„ØµÙ
                row.scrollIntoView({ behavior: 'smooth', block: 'center' });
                
                // ÙˆÙ…ÙŠØ¶ (Highlight) Ù„Ù„ØµÙ Ø¹Ø´Ø§Ù† Ø§Ù„Ù…Ø¯ÙŠØ± ÙŠØ´ÙˆÙÙ‡
                row.classList.remove('bg-white');
                row.classList.add('bg-yellow-100'); 
                
                // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„ÙˆÙ…ÙŠØ¶ Ø¨Ø¹Ø¯ Ø«Ø§Ù†ÙŠØªÙŠÙ†
                setTimeout(() => {
                    row.classList.remove('bg-yellow-100');
                    row.classList.add('bg-white');
                }, 2000);
            } else {
                // Ù„Ùˆ Ø§Ù„ØµÙ Ù…Ø´ Ø¸Ø§Ù‡Ø± (Ù†Ø§Ø¯Ø± Ø§Ù„Ø­Ø¯ÙˆØ«)ØŒ Ù†Ø­Ø§ÙˆÙ„ Ù†Ø­Ø¯Ø« Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©
                updateAdminMeetingsList();
            }
        }, 300); // 300ms ØªØ£Ø®ÙŠØ± Ù„Ø¶Ù…Ø§Ù† ÙØªØ­ Ø§Ù„Ù†Ø§ÙØ°Ø©
    } 
    
    // --- Ø§Ù„Ø³ÙŠÙ†Ø§Ø±ÙŠÙˆ Ø¨: Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø¹Ø§Ø¯ÙŠ (Ø£Ùˆ Ø§Ù„Ù…Ø¯ÙŠØ± ÙŠØ¶ØºØ· Ø¹Ù„Ù‰ Ø­Ø¬Ø² ÙŠØ®ØµÙ‡) ---
    else {
        // ÙØªØ­ Ù†Ø§ÙØ°Ø© ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø§Ø¬ØªÙ…Ø§Ø¹ Ø§Ù„Ø¹Ø§Ø¯ÙŠØ©
        showMeetingDetails(meeting);
    }
};

// --- ÙƒÙˆØ¯ Ø¥ØµÙ„Ø§Ø­ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ (Profile Update Fix) ---
// Ù‡Ø°Ø§ Ø§Ù„ÙƒÙˆØ¯ ÙŠØ±Ø¨Ø· Ø§Ù„ÙÙˆØ±Ù… Ø§Ù„Ù…ÙˆØ¬ÙˆØ¯ ÙØ¹Ù„ÙŠØ§Ù‹ ÙÙŠ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…
const adminProfileForm = document.getElementById('admin-profile-form');

if (adminProfileForm) {
    adminProfileForm.addEventListener('submit', async (e) => {
        e.preventDefault();
        
        const btn = e.target.querySelector('button[type="submit"]');
        const originalText = btn.innerHTML;
        btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø­ÙØ¸...';
        btn.disabled = true;

        // Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„ØµØ­ÙŠØ­Ø© (tab-my-...)
        const newName = document.getElementById('tab-my-name').value;
        const newMobile = document.getElementById('tab-my-mobile').value;
        const newPosition = document.getElementById('tab-my-position').value;
        
        // Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ù‚Ø³Ù… (Ù…Ø¹ Ù…Ø±Ø§Ø¹Ø§Ø© Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù†Ø³Ø¯Ù„Ø©)
        const deptInput = document.getElementById('tab-my-dept');
        const newDept = deptInput ? deptInput.value : currentUser.department;

        const newPass = document.getElementById('tab-my-password').value;
        const newEmail = document.getElementById('tab-my-email').value;

        try {
            let updates = {};
            let hasChanges = false;

            // Ù…Ù‚Ø§Ø±Ù†Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù„ØªØ­Ø¯ÙŠØ¯ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª ÙÙ‚Ø·
            if (newName !== currentUser.full_name) { updates.full_name = newName; hasChanges = true; }
            if (newMobile !== currentUser.mobile) { updates.mobile = newMobile; hasChanges = true; }
            if (newPosition !== currentUser.position) { updates.position = newPosition; hasChanges = true; }
            if (newDept !== currentUser.department) { updates.department = newDept; hasChanges = true; }

            // 1. ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù†ØµÙŠØ© ÙÙŠ Ø§Ù„Ø¬Ø¯ÙˆÙ„
            if (hasChanges) {
                const { error } = await supabase
                    .from('profiles')
                    .update(updates)
                    .eq('id', currentUser.id);
                
                if (error) throw error;

                // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø°Ø§ÙƒØ±Ø© Ø§Ù„Ù…Ø­Ù„ÙŠØ© ÙÙˆØ±Ø§Ù‹
                currentUser = { ...currentUser, ...updates };
                localStorage.setItem('currentUser', JSON.stringify(currentUser));
                
                // ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
                updateSidebarProfile();
                if(typeof applyUserPermissions === 'function') applyUserPermissions();
            }

            // 2. ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨Ø§Ø³ÙˆØ±Ø¯ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)
            if (newPass && newPass.length >= 6) {
                const { error } = await supabase.auth.updateUser({ password: newPass });
                if (error) throw error;
                showNotification('ØªÙ… ØªØ­Ø¯ÙŠØ« ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± âœ…', 'success');
            }

            // 3. ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)
            if (newEmail && newEmail !== currentUser.email) {
                const { error } = await supabase.auth.updateUser({ email: newEmail });
                if (error) throw error;
                showNotification('ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø±Ø§Ø¨Ø· ØªØ£ÙƒÙŠØ¯ Ù„Ù„Ø¥ÙŠÙ…ÙŠÙ„ Ø§Ù„Ø¬Ø¯ÙŠØ¯ ğŸ“§', 'info');
            }

            if (hasChanges) {
                showNotification('ØªÙ… Ø­ÙØ¸ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ Ø¨Ù†Ø¬Ø§Ø­ ğŸ‰', 'success');
            } else if (!newPass && !newEmail) {
                showNotification('Ù„Ù… ÙŠØªÙ… ØªØºÙŠÙŠØ± Ø£ÙŠ Ø¨ÙŠØ§Ù†Ø§Øª', 'info');
            }

        } catch (err) {
            console.error(err);
            showNotification('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø­ÙØ¸: ' + err.message, 'error');
        } finally {
            btn.innerHTML = originalText;
            btn.disabled = false;
        }
    });
}

// Ø¯Ø§Ù„Ø© Ù…Ø³Ø§Ø¹Ø¯Ø© Ù„ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø£Ø±Ù‚Ø§Ù… Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ© Ø¥Ù„Ù‰ Ø¹Ø±Ø¨ÙŠØ©
function toArabicNum(str) {
    // 1. Ø§Ù„Ø­Ù…Ø§ÙŠØ©: Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø§Ù„Ù‚ÙŠÙ…Ø© null Ø£Ùˆ undefined ÙØ¹Ù„Ø§Ù‹ØŒ Ø§Ø±Ø¬Ø¹ Ù†Øµ ÙØ§Ø±Øº
    if (str === null || str === undefined) return '';
    
    // 2. Ø§Ù„ØªØ­ÙˆÙŠÙ„: Ø§Ù„Ø¢Ù† Ø­ØªÙ‰ Ù„Ùˆ Ø§Ù„Ù‚ÙŠÙ…Ø© 0 (Ø±Ù‚Ù…)ØŒ Ø³ÙŠØªÙ… ØªØ­ÙˆÙŠÙ„Ù‡Ø§ Ù„Ù†Øµ Ø«Ù… Ù„Ù€ "Ù "
    return str.toString().replace(/\d/g, d => "Ù Ù¡Ù¢Ù£Ù¤Ù¥Ù¦Ù§Ù¨Ù©"[d]);
}

// ğŸ”¥ Ø¯Ø§Ù„Ø© Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ù„Ø£Ø³Ø¨ÙˆØ¹ Ù…Ø­Ø¯Ø¯
function jumpToWeek(dateISO) {
    // ØªØ­ÙˆÙŠÙ„ Ø§Ù„ØªØ§Ø±ÙŠØ® Ù…Ù† ISO string Ø¥Ù„Ù‰ ÙƒØ§Ø¦Ù† Date
    const newDate = new Date(dateISO);
    
    // Ø­Ø³Ø§Ø¨ Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ Ù„Ù‡Ø°Ø§ Ø§Ù„ØªØ§Ø±ÙŠØ® (Ø§Ù„Ø£Ø­Ø¯)
    const dayOfWeek = newDate.getDay();
    const diff = newDate.getDate() - dayOfWeek + (dayOfWeek === 0 ? -6 : 1);
    
    currentWeekStart = new Date(newDate.setDate(diff));
    
    updateWeekDisplay();
    renderCalendar();
    
    // Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©
    document.getElementById('week-dropdown-options').classList.remove('show');
    document.getElementById('week-arrow').style.transform = 'rotate(0deg)';
}

// ========================================================================
    // ğŸ”¥ Ø§Ù„Ø­Ù…Ø§ÙŠØ© Ø§Ù„Ø´Ø§Ù…Ù„Ø© Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø¤Ø³Ø³ (ÙŠØªÙ… ØªØ·Ø¨ÙŠÙ‚Ù‡ Ø¹Ù„Ù‰ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù†ÙˆØ§ÙØ°) ğŸ”¥
    // ========================================================================
    document.addEventListener('DOMContentLoaded', () => {
        
        // 1. ØªØ¹Ø±ÙŠÙ Ø¥ÙŠÙ…ÙŠÙ„ Ø§Ù„Ù…Ø¤Ø³Ø³ (ØªØ£ÙƒØ¯ Ù…Ù† ÙƒØªØ§Ø¨ØªÙ‡ Ù‡Ù†Ø§ Ø¨Ø¯Ù‚Ø©)
        const FOUNDER_EMAIL_FIXED = "fekrythug@gmail.com".trim().toLowerCase();

        // Ø¯Ø§Ù„Ø© Ù…Ø³Ø§Ø¹Ø¯Ø© Ù„Ù„Ø­Ù…Ø§ÙŠØ© ÙˆØ§Ù„Ø­ÙØ¸ (ØªØ¹Ù…Ù„ Ù…Ø¹ Ø£ÙŠ ÙÙˆØ±Ù…)
        async function attachSecureListener(formId, userIdInputId, isPermForm, isForm2) {
            const originalForm = document.getElementById(formId);
            if (!originalForm) return;

            // Ù‚ØªÙ„ Ø£ÙŠ ÙƒÙˆØ¯ Ù‚Ø¯ÙŠÙ… (Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ù…Ø³ØªÙ…Ø¹ÙŠÙ† Ø§Ù„Ø³Ø§Ø¨Ù‚ÙŠÙ†)
            const secureForm = originalForm.cloneNode(true);
            originalForm.parentNode.replaceChild(secureForm, originalForm);

            secureForm.addEventListener('submit', async function(e) {
                e.preventDefault();
                
                const btn = secureForm.querySelector('button[type="submit"]');
                const originalText = btn.innerHTML;
                
                // Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ ID Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… (Ù…Ø¹ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„ØªÙƒØ±Ø§Ø± ÙÙŠ Form 2)
                let userId = "";
                if(isForm2 && isPermForm) {
                    // ÙÙŠ Ø­Ø§Ù„Ø© ÙÙˆØ±Ù… Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª Ø§Ù„Ø«Ø§Ù†ÙŠ Ø§Ù„Ù…ÙƒØ±Ø±ØŒ Ù†Ø­Ø§ÙˆÙ„ Ø¬Ù„Ø¨Ù‡ Ø¨Ø¯Ù‚Ø©
                    userId = secureForm.querySelector('input[type="hidden"]').value; 
                } else {
                    userId = document.getElementById(userIdInputId).value;
                }

                btn.disabled = true;
                btn.innerHTML = '<i class="fas fa-shield-alt fa-pulse"></i> Ø¬Ø§Ø±ÙŠ Ø§Ù„ÙØ­Øµ...';

                try {
                    // ğŸ›‘ 1. ÙØ­Øµ Ø§Ù„Ø­Ù…Ø§ÙŠØ©: Ù‡Ù„ Ù‡Ø°Ø§ Ù‡Ùˆ Ø§Ù„Ù…Ø¤Ø³Ø³ØŸ
                    const { data: targetUser } = await window.supabase
                        .from('profiles')
                        .select('email')
                        .eq('id', userId)
                        .single();

                    if (targetUser && targetUser.email.trim().toLowerCase() === FOUNDER_EMAIL_FIXED) {
                        alert("â›” ØªÙ†Ø¨ÙŠÙ‡ Ø£Ù…Ù†ÙŠ ØµØ§Ø±Ù…:\nÙ‡Ø°Ø§ Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø¤Ø³Ø³ (Ù…Ø­ØµÙ†)! ÙŠÙÙ…Ù†Ø¹ Ù…Ù†Ø¹Ø§Ù‹ Ø¨Ø§ØªØ§Ù‹ ØªØ¹Ø¯ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§ØªÙ‡ Ø£Ùˆ ØµÙ„Ø§Ø­ÙŠØ§ØªÙ‡.");
                        btn.disabled = false;
                        btn.innerHTML = originalText;
                        return; // ğŸ›‘ Ø¥ÙŠÙ‚Ø§Ù ÙÙˆØ±ÙŠ
                    }

                    // ğŸ›‘ 2. Ø§Ù„ØªÙ†ÙÙŠØ° (Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† Ø§Ù„Ù…Ø¤Ø³Ø³)
                    btn.innerHTML = 'Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø­ÙØ¸...';

                    if (isPermForm) {
                        // --- Ø­ÙØ¸ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª ---
                        // Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ø®ØªÙ„Ø§Ù IDs Ø¨ÙŠÙ† Ø§Ù„ÙÙˆØ±Ù… Ø§Ù„Ø£ÙˆÙ„ ÙˆØ§Ù„Ø«Ø§Ù†ÙŠ
                        const approveId = isForm2 ? 'perm-approve-2' : 'perm-approve';
                        // Ù…Ù„Ø§Ø­Ø¸Ø©: perm-users Ùˆ perm-delete Ù…ÙƒØ±Ø±ÙŠÙ† ÙÙŠ HTMLØŒ Ù†Ø³ØªØ®Ø¯Ù… querySelector Ù„Ù„Ø¨Ø­Ø« Ø¯Ø§Ø®Ù„ Ø§Ù„ÙÙˆØ±Ù… Ø§Ù„Ø­Ø§Ù„ÙŠ ÙÙ‚Ø·
                        const usersPerm = secureForm.querySelector('input[id*="users"]').checked; 
                        const deletePerm = secureForm.querySelector('input[id*="delete"]').checked;
                        const approvePerm = document.getElementById(approveId).checked;

                        const newPerms = {
                            can_approve: approvePerm,
                            can_manage_users: usersPerm,
                            can_delete: deletePerm
                        };
                        
                        const hasAnyPerm = Object.values(newPerms).some(v => v === true);
                        const newRole = hasAnyPerm ? 'manager' : 'user';

                        await window.supabase.from('profiles').update({ permissions: newPerms, role: newRole }).eq('id', userId);
                        
                        // Ù…Ø­Ø§ÙˆÙ„Ø© ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…ÙŠØªØ§Ø¯Ø§ØªØ§
                        if(window.supabaseAdmin) {
                            await window.supabaseAdmin.auth.admin.updateUserById(userId, { user_metadata: { permissions: newPerms, role: newRole } });
                        }
                        showNotification('ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª Ø¨Ù†Ø¬Ø§Ø­');
                        document.getElementById('permissions-modal').classList.remove('show');

                    } else {
                        // --- Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø´Ø®ØµÙŠØ© ---
                        const nameId = isForm2 ? 'edit-user-name-2' : 'edit-user-name';
                        const deptId = isForm2 ? 'edit-user-dept-2' : 'edit-user-dept';
                        // Ø§Ù„ÙÙˆØ±Ù… Ø§Ù„Ø£ÙˆÙ„ ÙÙŠÙ‡ Ø­Ù‚ÙˆÙ„ Ø²ÙŠØ§Ø¯Ø©
                        const posId = 'edit-user-position'; 
                        const mobId = 'edit-user-mobile';

                        const updates = {
                            full_name: document.getElementById(nameId).value,
                            department: document.getElementById(deptId).value
                        };

                        if(!isForm2) {
                            updates.position = document.getElementById(posId).value;
                            updates.mobile = document.getElementById(mobId).value;
                        }

                        await window.supabase.from('profiles').update(updates).eq('id', userId);
                        showNotification('ØªÙ… ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­');
                        
                        // Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù…ÙˆØ¯Ø§Ù„ Ø§Ù„Ù…Ù†Ø§Ø³Ø¨
                        if(isForm2) document.getElementById('edit-user-info-modal').classList.remove('show'); // Ù„Ø§Ø­Ø¸: ÙÙŠ Ù…Ù„ÙÙƒ Ø§Ù„Ù…ÙˆØ¯Ø§Ù„ Ø§Ù„Ø«Ø§Ù†ÙŠ Ù„Ù‡ Ù†ÙØ³ ID Ø§Ù„Ù…ÙˆØ¯Ø§Ù„ Ø§Ù„Ø£ÙˆÙ„ ÙÙŠ Ø§Ù„Ù€ HTML Ø£Ø­ÙŠØ§Ù†Ø§Ù‹ØŒ ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„Ù€ IDs
                        else document.getElementById('edit-user-info-modal').classList.remove('show');
                    }

                    if(typeof updateAdminUsersList === 'function') updateAdminUsersList();

                } catch (err) {
                    console.error(err);
                    alert("Ø­Ø¯Ø« Ø®Ø·Ø£: " + err.message);
                } finally {
                    btn.disabled = false;
                    btn.innerHTML = originalText;
                }
            });
        }

        // ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø­Ù…Ø§ÙŠØ© Ø¹Ù„Ù‰ Ø§Ù„Ù†Ù…Ø§Ø°Ø¬ Ø§Ù„Ø£Ø±Ø¨Ø¹Ø© Ø§Ù„Ù…ÙˆØ¬ÙˆØ¯Ø© ÙÙŠ Ù…Ù„ÙÙƒ
        // 1. ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª (Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ)
        attachSecureListener('edit-user-info-form', 'edit-user-id', false, false);
        
        // 2. ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª (Ø§Ù„Ø¥Ø¶Ø§ÙÙŠ -2)
        attachSecureListener('edit-user-info-form-2', 'edit-user-id-2', false, true);

        // 3. Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª (Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ)
        attachSecureListener('permissions-form', 'perm-user-id', true, false);

        // 4. Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª (Ø§Ù„Ø¥Ø¶Ø§ÙÙŠ -2)
        attachSecureListener('permissions-form-2', 'perm-user-id', true, true);
    });

// ========================================================================
    // ğŸ”¥ Ø§Ù„Ø­Ù…Ø§ÙŠØ© Ø§Ù„Ø´Ø§Ù…Ù„Ø© Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø¤Ø³Ø³ (ÙŠØ³Ù…Ø­ Ù„Ù„Ù…Ø¤Ø³Ø³ Ø¨ØªØ¹Ø¯ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§ØªÙ‡ ÙÙ‚Ø·) ğŸ”¥
    // ========================================================================
    document.addEventListener('DOMContentLoaded', async () => {
        
        const FOUNDER_EMAIL_FIXED = "fekrythug@gmail.com".trim().toLowerCase();

        // Ù†Ø­ØªØ§Ø¬ Ù…Ø¹Ø±ÙØ© Ù…Ù† Ø§Ù„Ø°ÙŠ ÙŠØ³ØªØ®Ø¯Ù… Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ø¢Ù†ØŸ
        let currentAdminEmail = "";
        try {
            const { data: { user } } = await supabase.auth.getUser();
            if(user) currentAdminEmail = user.email.trim().toLowerCase();
        } catch(e) { console.error(e); }

        async function attachSecureListener(formId, userIdInputId, isPermForm, isForm2) {
            const originalForm = document.getElementById(formId);
            if (!originalForm) return;

            const secureForm = originalForm.cloneNode(true);
            originalForm.parentNode.replaceChild(secureForm, originalForm);

            secureForm.addEventListener('submit', async function(e) {
                e.preventDefault();
                
                const btn = secureForm.querySelector('button[type="submit"]');
                const originalText = btn.innerHTML;
                
                let userId = "";
                if(isForm2 && isPermForm) {
                    userId = secureForm.querySelector('input[type="hidden"]').value; 
                } else {
                    userId = document.getElementById(userIdInputId).value;
                }

                btn.disabled = true;
                btn.innerHTML = '<i class="fas fa-shield-alt fa-pulse"></i> Ø¬Ø§Ø±ÙŠ Ø§Ù„ÙØ­Øµ...';

                try {
                    // 1. ÙØ­Øµ Ø§Ù„Ù‡Ø¯Ù: Ù‡Ù„ Ù†Ø­Ø§ÙˆÙ„ ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ø¤Ø³Ø³ØŸ
                    const { data: targetUser } = await window.supabase
                        .from('profiles')
                        .select('email')
                        .eq('id', userId)
                        .single();

                    const isTargetFounder = (targetUser && targetUser.email.trim().toLowerCase() === FOUNDER_EMAIL_FIXED);
                    const amIFounder = (currentAdminEmail === FOUNDER_EMAIL_FIXED);

                    if (isTargetFounder) {
                        // ğŸ›‘ Ø³ÙŠÙ†Ø§Ø±ÙŠÙˆ 1: Ø§Ù„Ù…Ø¤Ø³Ø³ ÙŠØ­Ø§ÙˆÙ„ ØªØ¹Ø¯ÙŠÙ„ Ù†ÙØ³Ù‡
                        if (amIFounder) {
                            if (isPermForm) {
                                // Ù…Ù…Ù†ÙˆØ¹ ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª Ø­ØªÙ‰ Ù„Ù†ÙØ³Ùƒ (Ù„Ù„Ø£Ù…Ø§Ù† Ø¹Ø´Ø§Ù† Ù…ØªØºÙ„Ø·Ø´ ÙˆØªØ´ÙŠÙ„ ØµÙ„Ø§Ø­ÙŠØ§ØªÙƒ)
                                alert("âš ï¸ ØªÙ†Ø¨ÙŠÙ‡:\nÙ„Ù„Ø­ÙØ§Ø¸ Ø¹Ù„Ù‰ Ø£Ù…Ø§Ù† Ø§Ù„Ù†Ø¸Ø§Ù…ØŒ Ù„Ø§ ÙŠÙ…ÙƒÙ†Ùƒ ØªØ¹Ø¯ÙŠÙ„ ØµÙ„Ø§Ø­ÙŠØ§ØªÙƒ Ø¨Ù†ÙØ³Ùƒ Ù…Ù† Ù‡Ù†Ø§.\nØ£Ù†Øª ØªÙ…Ù„Ùƒ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª Ø§Ù„ÙƒØ§Ù…Ù„Ø© Ø¨Ø§Ù„ÙØ¹Ù„.");
                                btn.disabled = false;
                                btn.innerHTML = originalText;
                                return;
                            }
                            // Ù…Ø³Ù…ÙˆØ­ ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø´Ø®ØµÙŠØ© (Ø§Ù„Ø§Ø³Ù… ÙˆØ§Ù„Ù‚Ø³Ù…) âœ…
                            // Ø³ÙŠÙƒÙ…Ù„ Ø§Ù„ÙƒÙˆØ¯ Ù„Ù„Ø£Ø³ÙÙ„ Ø¨Ø´ÙƒÙ„ Ø·Ø¨ÙŠØ¹ÙŠ...
                        } 
                        // ğŸ›‘ Ø³ÙŠÙ†Ø§Ø±ÙŠÙˆ 2: Ø´Ø®Øµ Ø¢Ø®Ø± ÙŠØ­Ø§ÙˆÙ„ ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ø¤Ø³Ø³
                        else {
                            alert("â›” ØªÙ†Ø¨ÙŠÙ‡ Ø£Ù…Ù†ÙŠ ØµØ§Ø±Ù…:\nÙ‡Ø°Ø§ Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø¤Ø³Ø³ (Ù…Ø­ØµÙ†)! Ù„Ø§ ØªÙ…Ù„Ùƒ ØµÙ„Ø§Ø­ÙŠØ© ØªØ¹Ø¯ÙŠÙ„Ù‡.");
                            btn.disabled = false;
                            btn.innerHTML = originalText;
                            return;
                        }
                    }

                    // ... ØªÙ†ÙÙŠØ° Ø§Ù„Ø­ÙØ¸ ...
                    btn.innerHTML = 'Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø­ÙØ¸...';

                    if (isPermForm) {
                        const approveId = isForm2 ? 'perm-approve-2' : 'perm-approve';
                        const usersPerm = secureForm.querySelector('input[id*="users"]').checked; 
                        const deletePerm = secureForm.querySelector('input[id*="delete"]').checked;
                        const approvePerm = document.getElementById(approveId).checked;

                        const newPerms = { can_approve: approvePerm, can_manage_users: usersPerm, can_delete: deletePerm };
                        const hasAnyPerm = Object.values(newPerms).some(v => v === true);
                        const newRole = hasAnyPerm ? 'manager' : 'user';

                        await window.supabase.from('profiles').update({ permissions: newPerms, role: newRole }).eq('id', userId);
                        if(window.supabaseAdmin) {
                            await window.supabaseAdmin.auth.admin.updateUserById(userId, { user_metadata: { permissions: newPerms, role: newRole } });
                        }
                        showNotification('ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª Ø¨Ù†Ø¬Ø§Ø­');
                        document.getElementById('permissions-modal').classList.remove('show');

                    } else {
                        const nameId = isForm2 ? 'edit-user-name-2' : 'edit-user-name';
                        const deptId = isForm2 ? 'edit-user-dept-2' : 'edit-user-dept';
                        const posId = 'edit-user-position'; 
                        const mobId = 'edit-user-mobile';

                        const updates = {
                            full_name: document.getElementById(nameId).value,
                            department: document.getElementById(deptId).value
                        };
                        if(!isForm2) {
                            updates.position = document.getElementById(posId).value;
                            updates.mobile = document.getElementById(mobId).value;
                        }

                        await window.supabase.from('profiles').update(updates).eq('id', userId);
                        showNotification('ØªÙ… ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­');
                        if(isForm2) document.getElementById('edit-user-info-modal').classList.remove('show');
                        else document.getElementById('edit-user-info-modal').classList.remove('show');
                    }

                    if(typeof updateAdminUsersList === 'function') updateAdminUsersList();

                } catch (err) {
                    console.error(err);
                    alert("Ø­Ø¯Ø« Ø®Ø·Ø£: " + err.message);
                } finally {
                    btn.disabled = false;
                    btn.innerHTML = originalText;
                }
            });
        }

        // ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø­Ù…Ø§ÙŠØ©
        attachSecureListener('edit-user-info-form', 'edit-user-id', false, false);
        attachSecureListener('edit-user-info-form-2', 'edit-user-id-2', false, true);
        attachSecureListener('permissions-form', 'perm-user-id', true, false);
        attachSecureListener('permissions-form-2', 'perm-user-id', true, true);
    });

    // Ù…ÙŠØ²Ø© Ø§Ù„Ø¥ØºÙ„Ø§Ù‚ Ø¹Ù†Ø¯ Ø§Ù„Ø¶ØºØ· Ø®Ø§Ø±Ø¬ Ø§Ù„Ø¥Ø·Ø§Ø±
window.addEventListener('click', (e) => {
    const nMenu = document.getElementById('notif-menu');
    const nWrapper = document.getElementById('notif-btn-wrapper');
    const pcWrapper = document.getElementById('notif-btn-wrapper-pc');

    // Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ù…ÙØªÙˆØ­Ø© ÙˆØ§Ù„Ø¯ÙˆØ³Ø© Ø¨Ø±Ù‡ Ø§Ù„Ø¬Ø±Ø³ ÙˆØ¨Ø±Ù‡ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©
    if (nMenu && !nMenu.classList.contains('hidden')) {
        if (!nMenu.contains(e.target) && !nWrapper?.contains(e.target) && !pcWrapper?.contains(e.target)) {
            
            // ØªÙ†ÙÙŠØ° Ø¯Ø§Ù„Ø© Ø§Ù„ØªØ¨Ø¯ÙŠÙ„ Ø¹Ø´Ø§Ù† ØªØ¹Ù…Ù„ "Closing Logic" ÙˆØªØ³Ø¬Ù„Ù‡Ù… ÙƒØ´ÙˆÙ‡Ø¯ÙˆØ§
            toggleNotifications(); 
        }
    }
    
    // ÙƒÙˆØ¯ Ø§Ù„Ø¨Ø±ÙˆÙØ§ÙŠÙ„ ÙŠÙØ¶Ù„ Ø²ÙŠ Ù…Ø§ Ù‡Ùˆ...
    const pMenu = document.getElementById('profile-info-menu');
    const pCapsule = document.getElementById('mob-profile-capsule');
    if (pMenu && !pMenu.classList.contains('hidden')) {
        if (!pMenu.contains(e.target) && !pCapsule?.contains(e.target)) {
            pMenu.classList.add('hidden');
        }
    }
});

function toggleMobileMenu() {
    const menu = document.getElementById('mobile-menu');
    const content = document.getElementById('mobile-menu-content');
    
    if (!menu || !content) return;

    if (menu.classList.contains('hidden')) {
        menu.classList.remove('hidden');
        // ØªØ£Ø®ÙŠØ± 10ms Ù„Ù„Ø³Ù…Ø§Ø­ Ù„Ù„Ù…ØªØµÙØ­ Ø¨Ø±Ø³Ù… Ø§Ù„Ø¹Ù†ØµØ± Ù‚Ø¨Ù„ ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø£Ù†ÙŠÙ…ÙŠØ´Ù†
        setTimeout(() => {
            content.classList.remove('translate-x-full');
        }, 10);
    } else {
        content.classList.add('translate-x-full');
        // Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„Ø£Ù†ÙŠÙ…ÙŠØ´Ù† (300ms) Ù‚Ø¨Ù„ Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø­Ø§ÙˆÙŠØ© Ø¨Ø§Ù„ÙƒØ§Ù…Ù„
        setTimeout(() => {
            menu.classList.add('hidden');
        }, 300);
    }
}

if ('serviceWorker' in navigator) {
    navigator.serviceWorker.register('sw.js');
  }
  
    </script>
</body>
</html>