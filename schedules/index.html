<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ø°ÙƒÙŠ Ù„Ø¥Ø¯Ø§Ø±Ø© Ø¬Ø¯Ø§ÙˆÙ„ Ø§Ù„Ù‚Ø§Ø¹Ø§Øª Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠØ©</title>
    <meta name="description" content="Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ø°ÙƒÙŠ Ø§Ù„Ù…ÙˆØ­Ø¯ Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£ØµÙˆÙ„ Ø§Ù„ØªØ¹Ù„ÙŠÙ…ÙŠØ© ÙˆÙ…Ø±ÙƒØ² Ø§ØªØ®Ø§Ø° Ø§Ù„Ù‚Ø±Ø§Ø± Ø¨ÙƒÙ„ÙŠØ© Ø§Ù„Ù†Ù‚Ù„ Ø§Ù„Ø¯ÙˆÙ„ÙŠ ÙˆØ§Ù„Ù„ÙˆØ¬Ø³ØªÙŠØ§Øª.">
    <meta name="keywords" content="CITL, ÙƒÙ„ÙŠØ© Ø§Ù„Ù†Ù‚Ù„ Ø§Ù„Ø¯ÙˆÙ„ÙŠ ÙˆØ§Ù„Ù„ÙˆØ¬Ø³ØªÙŠØ§Øª, Ø§Ø¯Ø§Ø±Ø© Ø§Ù„Ù‚Ø§Ø¹Ø§Øª, Ø¬Ø¯Ø§ÙˆÙ„ Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø§Øª, Ù…Ø±ÙƒØ² Ø§ØªØ®Ø§Ø° Ø§Ù„Ù‚Ø±Ø§Ø±, Ø§Ù„Ø£ÙƒØ§Ø¯ÙŠÙ…ÙŠØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©">
    <meta name="language" content="Arabic">
    <meta name="theme-color" content="#2A3475">
    <meta property="og:title" content="ÙƒÙ„ÙŠØ© Ø§Ù„Ù†Ù‚Ù„ Ø§Ù„Ø¯ÙˆÙ„ÙŠ ÙˆØ§Ù„Ù„ÙˆØ¬Ø³ØªÙŠØ§Øª">
    <meta property="og:description" content="Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ø°ÙƒÙŠ Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£ØµÙˆÙ„ Ø§Ù„ØªØ¹Ù„ÙŠÙ…ÙŠØ© ÙˆÙ…Ø±ÙƒØ² Ø§ØªØ®Ø§Ø° Ø§Ù„Ù‚Ø±Ø§Ø±">
    <meta property="og:image" content="https://aastcitl.me/CITL_Banner.png">
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="630">
    <meta property="og:url" content="https://aastcitl.me/">
    <meta property="og:type" content="website">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content="https://aastcitl.me/CITL_Banner.png">
    <link rel="manifest" href="manifest.json">
    <link rel="shortcut icon" type="image/png" href="CITL_Logo-32.png">
    <link rel="icon" type="image/png" sizes="192x192" href="CITL_Logo-192.png">
    <link rel="apple-touch-icon" href="CITL_Logo-192.png">
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@200..1000&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://cdn.jsdelivr.net/npm/fuse.js@6.6.2"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <style>
        /* Ø¥Ø¶Ø§ÙØ§Øª Ù„ØªØµÙ…ÙŠÙ… Ø§Ù„Ù…ÙˆØ¯Ø§Ù„ Ø§Ù„Ø¬Ø¯ÙŠØ¯ */
        .bg-navy { background-color: #2A3475; }
        .text-navy { color: #2A3475; }
        .text-gold { color: #F3A628; }
        .bg-gold { background-color: #F3A628; }
        
        /* ØªØ£Ø«ÙŠØ±Ø§Øª Ø§Ù„Ø­Ø±ÙƒØ© Ù„Ù„Ù…ÙˆØ¯Ø§Ù„ */
        .modal-enter { animation: modalPop 0.3s ease-out forwards; }
        @keyframes modalPop {
            from { opacity: 0; transform: scale(0.95); }
            to { opacity: 1; transform: scale(1); }
        }

body {
    box-sizing: border-box;
    font-family: 'Cairo', sans-serif;
    background-color: #f9fafb;
}

/* Ù„Ø¶Ù…Ø§Ù† ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø®Ø· Ø¹Ù„Ù‰ Ø§Ù„Ø¹Ù†Ø§ÙˆÙŠÙ† Ø£ÙŠØ¶Ø§Ù‹ */
h1, h2, h3, h4, h5, h6, input, select, button, textarea {
    font-family: 'Cairo', sans-serif;
}
.bg-navy { background-color: #2A3475; }
.text-navy { color: #2A3475; }
.text-gold { color: #F3A628; }
.border-gold { border-color: #F3A628; }

        
        /* ØªØ£Ø«ÙŠØ±Ø§Øª Ø­Ø±ÙƒÙŠØ© */
        .card-hover:hover { transform: translateY(-5px); box-shadow: 0 15px 30px rgba(42, 52, 117, 0.1); }
        .ai-pulse { animation: pulse-gold 2s infinite; }
        @keyframes pulse-gold {
            0% { box-shadow: 0 0 0 0 rgba(243, 166, 40, 0.4); }
            70% { box-shadow: 0 0 0 10px rgba(243, 166, 40, 0); }
            100% { box-shadow: 0 0 0 0 rgba(243, 166, 40, 0); }
        }
        
        /* ØªØ®ØµÙŠØµ Ø§Ù„Ø³ÙƒØ±ÙˆÙ„ Ø¨Ø§Ø± */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; }
        ::-webkit-scrollbar-thumb { background: #2A3475; border-radius: 4px; }
        
        /* Ø¹Ù†Ø§ØµØ± Ø§Ù„ØªØ­ÙƒÙ… - Ù…Ø®ÙÙŠØ© Ø§ÙØªØ±Ø§Ø¶ÙŠØ§Ù‹ */
        .admin-controls-panel { display: none; }
        .admin-card-btns { display: none !important; }

        /* ØªØ¸Ù‡Ø± ÙÙ‚Ø· Ø¹Ù†Ø¯ ØªÙØ¹ÙŠÙ„ ÙƒÙ„Ø§Ø³ Ø§Ù„Ø£Ø¯Ù…Ù† */
        .admin-mode-active .admin-controls-panel { display: flex; }
        .admin-mode-active .admin-card-btns { display: flex !important; }

        /* Ø£Ù†Ù…ÙŠØ´Ù† Ù„Ø®Ø·Ø£ Ø§Ù„Ø¨Ø§Ø³ÙˆØ±Ø¯ */
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); }
            20%, 40%, 60%, 80% { transform: translateX(5px); }
        }
        .input-error {
            animation: shake 0.5s;
            border-color: #ef4444 !important; /* Ù„ÙˆÙ† Ø£Ø­Ù…Ø± */
            background-color: #fef2f2 !important;
        }

        /* ØªØµÙ…ÙŠÙ… Ø§Ù„Ù‚ÙˆØ§Ø¦Ù… Ø§Ù„Ø§Ø­ØªØ±Ø§ÙÙŠØ© */
        .custom-dropdown { position: relative; width: 100%; }
        .custom-dropdown-display { 
            width: 100%; padding: 10px 16px; background-color: white; 
            border: 1px solid #e5e7eb; border-radius: 0.75rem; /* rounded-xl */
            display: flex; justify-content: space-between; align-items: center; 
            cursor: pointer; transition: all 0.2s; 
        }
        .custom-dropdown-display:hover { border-color: #2A3475; }
        .custom-dropdown-options { 
            position: absolute; top: 100%; left: 0; width: 100%; 
            background-color: white; border: 1px solid #e5e7eb; border-radius: 0.5rem; 
            margin-top: 4px; max-height: 250px; overflow-y: auto; 
            z-index: 50; display: none; box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1); 
        }
        .custom-dropdown-options.show { display: block; }
        .custom-option { 
            padding: 10px 16px; cursor: pointer; font-size: 0.875rem; 
            color: #374151; border-bottom: 1px solid #f3f4f6; transition: background-color 0.2s; 
        }
        .custom-option:hover { background-color: #f0fdf4; color: #2A3475; font-weight: bold; }

.table-scroll thead th {
    position: sticky;
    top: 0;
    background: #ffffff;
    z-index: 20;
}

/* --- Ø£Ù†Ù…Ø§Ø· Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª (ØªÙ… Ø¥ØµÙ„Ø§Ø­ Ù…Ø´ÙƒÙ„Ø© Ù…Ù†Ø¹ Ø§Ù„Ù„Ù…Ø³) --- */
.notification-toast {
    position: fixed; 
    bottom: 20px; 
    left: 50%; 
    transform: translateX(-50%) translateY(100px);
    background: white; 
    padding: 12px 24px; 
    border-radius: 50px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.2); 
    display: flex; 
    align-items: center; 
    gap: 12px;
    transition: all 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55); 
    z-index: 9999; 
    opacity: 0;
    font-weight: bold;
    border: 1px solid #f3f4f6;
    
    /* ğŸ”¥ Ù‡Ø°Ø§ Ø§Ù„Ø³Ø·Ø± Ù‡Ùˆ Ø§Ù„Ø­Ù„: ÙŠÙ…Ù†Ø¹ Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ù…Ø®ÙÙŠØ© Ù…Ù† Ø§Ø¹ØªØ±Ø§Ø¶ Ø§Ù„Ù„Ù…Ø³ ğŸ”¥ */
    pointer-events: none; 
}

.notification-toast.show { 
    transform: translateX(-50%) translateY(0); 
    opacity: 1; 
    
    /* ğŸ”¥ Ù„Ù…Ø§ ØªØ¸Ù‡Ø± Ø¨Ø³ØŒ ØªØ³ØªÙ‚Ø¨Ù„ Ø§Ù„Ù„Ù…Ø³ ğŸ”¥ */
    pointer-events: auto; 
}

.notification-icon-box { 
    width: 24px; 
    height: 24px; 
    border-radius: 50%; 
    display: flex; 
    align-items: center; 
    justify-content: center; 
    color: white; 
    font-size: 12px;
}

.bg-success { background-color: #10B981; } /* Ù„ÙˆÙ† Ø£Ø®Ø¶Ø± Ù„Ù„Ù†Ø¬Ø§Ø­ */
.bg-error { background-color: #EF4444; }   /* Ù„ÙˆÙ† Ø£Ø­Ù…Ø± Ù„Ù„Ø®Ø·Ø£ */

/* Ø¹Ù†Ø¯ ØªÙØ¹ÙŠÙ„ ÙˆØ¶Ø¹ Ø§Ù„Ø£Ø¯Ù…Ù†ØŒ Ø§Ù„ÙƒØ±ÙˆØª ØªØµØ¨Ø­ Ù‚Ø§Ø¨Ù„Ø© Ù„Ù„Ø¶ØºØ· */
.admin-mode-active .schedule-card {
    cursor: pointer !important;
    transition: all 0.3s ease;
}

.admin-mode-active .schedule-card:hover {
    border-color: #F3A628 !important;
    transform: translateY(-5px);
    box-shadow: 0 10px 25px -5px rgba(243, 166, 40, 0.3);
}

/* Ø¥Ø¶Ø§ÙØ© Ø£ÙŠÙ‚ÙˆÙ†Ø© ØªØ¹Ø¯ÙŠÙ„ ØµØºÙŠØ±Ø© Ø¹Ø§Ø¦Ù…Ø© ØªØ¸Ù‡Ø± ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ ÙÙŠ ÙˆØ¶Ø¹ Ø§Ù„Ø£Ø¯Ù…Ù† */
.admin-mode-active .schedule-card::after {
    content: '\f044'; /* ÙƒÙˆØ¯ Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø§Ù„Ù‚Ù„Ù… FontAwesome */
    font-family: "Font Awesome 6 Free";
    font-weight: 900;
    position: absolute;
    top: 10px;
    left: 10px;
    background: #F3A628;
    color: #2A3475;
    width: 30px;
    height: 30px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 14px;
    z-index: 20;
    box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    animation: popIn 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
}

@keyframes popIn {
    from { transform: scale(0); }
    to { transform: scale(1); }
}

/* ğŸ”¥ Ø£Ù†ÙŠÙ…ÙŠØ´Ù† Ø§Ù„Ù„ÙˆØ¯Ø± Ø§Ù„Ø¬Ø¯ÙŠØ¯ ğŸ”¥ */
@keyframes logo-pulse {
    0% { transform: scale(1); }
    50% { transform: scale(1.05); }
    100% { transform: scale(1); }
}
/* Ù„Ù…Ù†Ø¹ Ø§Ù„Ø³ÙƒØ±ÙˆÙ„ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„ØªØ­Ù…ÙŠÙ„ */
.loading-active { overflow: hidden; }
        /* Ø¥Ø¶Ø§ÙØ§Øª Ù„ØªØµÙ…ÙŠÙ… Ø§Ù„Ù…ÙˆØ¯Ø§Ù„ Ø§Ù„Ø¬Ø¯ÙŠØ¯ */
        .bg-navy { background-color: #2A3475; }
        .text-navy { color: #2A3475; }
        .text-gold { color: #F3A628; }
        .bg-gold { background-color: #F3A628; }
        
        /* ØªØ£Ø«ÙŠØ±Ø§Øª Ø§Ù„Ø­Ø±ÙƒØ© Ù„Ù„Ù…ÙˆØ¯Ø§Ù„ */
        .modal-enter { animation: modalPop 0.3s ease-out forwards; }
        @keyframes modalPop {
            from { opacity: 0; transform: scale(0.95); }
            to { opacity: 1; transform: scale(1); }
        }
       
        /* ØªØ®ØµÙŠØµ Ø§Ù„Ø³ÙƒØ±ÙˆÙ„ Ø¨Ø§Ø± */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; }
        ::-webkit-scrollbar-thumb { background: #2A3475; border-radius: 4px; }
        
        /* Ø¹Ù†Ø§ØµØ± Ø§Ù„ØªØ­ÙƒÙ… - Ù…Ø®ÙÙŠØ© Ø§ÙØªØ±Ø§Ø¶ÙŠØ§Ù‹ */
        .admin-controls-panel { display: none; }
        .admin-card-btns { display: none !important; }

        /* ØªØ¸Ù‡Ø± ÙÙ‚Ø· Ø¹Ù†Ø¯ ØªÙØ¹ÙŠÙ„ ÙƒÙ„Ø§Ø³ Ø§Ù„Ø£Ø¯Ù…Ù† */
        .admin-mode-active .admin-controls-panel { display: flex; }
        .admin-mode-active .admin-card-btns { display: flex !important; }

        /* Ø£Ù†Ù…ÙŠØ´Ù† Ù„Ø®Ø·Ø£ Ø§Ù„Ø¨Ø§Ø³ÙˆØ±Ø¯ */
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); }
            20%, 40%, 60%, 80% { transform: translateX(5px); }
        }
        .input-error {
            animation: shake 0.5s;
            border-color: #ef4444 !important;
            background-color: #fef2f2 !important;
        }

        /* ØªØµÙ…ÙŠÙ… Ø§Ù„Ù‚ÙˆØ§Ø¦Ù… Ø§Ù„Ø§Ø­ØªØ±Ø§ÙÙŠØ© */
        .custom-dropdown { position: relative; width: 100%; }
        .custom-dropdown-display { 
            width: 100%; padding: 10px 16px; background-color: white; 
            border: 1px solid #e5e7eb; border-radius: 0.75rem; 
            display: flex; justify-content: space-between; align-items: center; 
            cursor: pointer; transition: all 0.2s; 
        }
        .custom-dropdown-display:hover { border-color: #2A3475; }
        .custom-dropdown-options { 
            position: absolute; top: 100%; left: 0; width: 100%; 
            background-color: white; border: 1px solid #e5e7eb; border-radius: 0.5rem; 
            margin-top: 4px; max-height: 250px; overflow-y: auto; 
            z-index: 50; display: none; box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1); 
        }
        .custom-dropdown-options.show { display: block; }
        .custom-option { 
            padding: 10px 16px; cursor: pointer; font-size: 0.875rem; 
            color: #374151; border-bottom: 1px solid #f3f4f6; transition: background-color 0.2s; 
        }
        .custom-option:hover { background-color: #f0fdf4; color: #2A3475; font-weight: bold; }

        .table-scroll thead th {
            position: sticky;
            top: 0;
            background: #ffffff;
            z-index: 20;
        }
        
        /* --- Ø£Ù†Ù…Ø§Ø· Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª (Toast) --- */
        .notification-toast {
            position: fixed; 
            bottom: 20px; 
            left: 50%; 
            transform: translateX(-50%) translateY(100px);
            background: white; 
            padding: 12px 24px; 
            border-radius: 50px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2); 
            display: flex; 
            align-items: center; 
            gap: 12px;
            transition: all 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55); 
            z-index: 9999; 
            opacity: 0;
            font-weight: bold;
            border: 1px solid #f3f4f6;
        }

        .notification-toast.show { 
            transform: translateX(-50%) translateY(0); 
            opacity: 1; 
        }

        .notification-icon-box { 
            width: 24px; 
            height: 24px; 
            border-radius: 50%; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            color: white; 
            font-size: 12px;
        }

        .bg-success { background-color: #10B981; } 
        .bg-error { background-color: #EF4444; }   

        /* Ø¹Ù†Ø¯ ØªÙØ¹ÙŠÙ„ ÙˆØ¶Ø¹ Ø§Ù„Ø£Ø¯Ù…Ù†ØŒ Ø§Ù„ÙƒØ±ÙˆØª ØªØµØ¨Ø­ Ù‚Ø§Ø¨Ù„Ø© Ù„Ù„Ø¶ØºØ· */
        .admin-mode-active .schedule-card {
            cursor: pointer !important;
            transition: all 0.3s ease;
        }

        .admin-mode-active .schedule-card:hover {
            border-color: #F3A628 !important;
            transform: translateY(-5px);
            box-shadow: 0 10px 25px -5px rgba(243, 166, 40, 0.3);
        }

        /* Ø¥Ø¶Ø§ÙØ© Ø£ÙŠÙ‚ÙˆÙ†Ø© ØªØ¹Ø¯ÙŠÙ„ ØµØºÙŠØ±Ø© Ø¹Ø§Ø¦Ù…Ø© ØªØ¸Ù‡Ø± ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ ÙÙŠ ÙˆØ¶Ø¹ Ø§Ù„Ø£Ø¯Ù…Ù† */
        .admin-mode-active .schedule-card::after {
            content: '\f044'; 
            font-family: "Font Awesome 6 Free";
            font-weight: 900;
            position: absolute;
            top: 10px;
            left: 10px;
            background: #F3A628;
            color: #2A3475;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            z-index: 20;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            animation: popIn 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        @keyframes popIn {
            from { transform: scale(0); }
            to { transform: scale(1); }
        }
        
/* --- Ù‡ÙˆÙŠØ© Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø¹Ø¯Ù†ÙŠØ© (Ø§Ù„Ù…Ø·ÙˆØ±Ø©) --- */
.metallic-blue-fill {
    background: linear-gradient(to bottom, #2A3475, #1e255a);
    box-shadow: inset 0px 1px 3px rgba(0, 0, 0, 0.5),
                inset 0px 1px 1px rgba(255, 255, 255, 0.15);
}

.random-slanted-lines {
    position: relative;
    overflow: hidden;
}

/* Ø¯ÙŠ Ø£Ù‡Ù… Ø­ØªØ©.. Ù‡ÙŠ Ø§Ù„Ù„ÙŠ Ø¨ØªØ±Ø³Ù… Ø§Ù„Ø®Ø·ÙˆØ· Ø§Ù„Ù…Ø§Ø¦Ù„Ø© */
.random-slanted-lines::before {
    content: ''; 
    position: absolute; 
    top: 0; left: 0; width: 100%; height: 100%; 
    z-index: 0; pointer-events: none;
    background: repeating-linear-gradient(
        -30deg, transparent, transparent 10px, rgba(255, 255, 255, 0.05) 10px, rgba(255, 255, 255, 0.05) 11px
    );
    opacity: 1;
}

/* Ø£Ù†ÙŠÙ…ÙŠØ´Ù† Ø´Ø§Ø´Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„ (Smart Engine) - Ø³ÙŠØ¨Ù‡Ø§ Ø²ÙŠ Ù…Ø§ Ù‡ÙŠ */
@keyframes logo-pulse {
    0% { transform: scale(1); }
    50% { transform: scale(1.05); }
    100% { transform: scale(1); }
}
.loader-logo { 
    animation: logo-pulse 2s infinite ease-in-out; 
}
    </style>
</head>
<body class="flex flex-col min-h-screen text-gray-800">
<div id="global-loader" class="fixed inset-0 z-[99999] hidden items-center justify-center bg-white/60 backdrop-blur-[5px] transition-opacity duration-300 opacity-0">
    <div class="relative bg-white p-6 md:p-10 rounded-[2rem] shadow-2xl flex flex-col items-center justify-center border border-gray-100 transform scale-95 transition-transform duration-300 min-w-[85vw] md:min-w-[400px] gap-0">
        
        <div class="mb-0 -mt-6 md:-mt-10">
            <img src="CITL_Logo.gif" alt="Loading..." class="h-28 md:h-48 w-auto object-contain mix-blend-multiply brightness-110 contrast-110 saturate-110 loader-logo">
        </div>

        <div class="text-center -mt-2 md:-mt-6">
            <h3 class="text-[#2A3475] font-black text-lg md:text-2xl tracking-wide leading-tight">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„</h3>
            <p id="loader-text" class="text-gray-400 text-[11px] md:text-sm font-bold mt-1 md:mt-2">ÙŠØ±Ø¬Ù‰ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø± Ù„Ø­Ø¸Ø§Øª...</p>
        </div>
    </div>
</div>
</div>
<script>
    
        // Ø§Ù„ØªØ­Ù‚Ù‚: Ù‡Ù„ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø³ØªØ®Ø¯Ù… Ø£Ùˆ ØªÙˆÙƒÙ† Ù…Ø­ÙÙˆØ¸ØŸ
        const token = localStorage.getItem('sessionToken');
        const user = localStorage.getItem('currentUser');

        // Ù„Ùˆ Ù…ÙÙŠØ´ Ø¨ÙŠØ§Ù†Ø§ØªØŒ Ù†Ø·Ø±Ø¯Ù‡ Ù„ØµÙØ­Ø© Ø§Ù„Ù„ÙˆØ¬Ù† ÙÙˆØ±Ø§Ù‹
        if (!token || !user) {
            window.location.href = '/';
        }
    </script>
<header class="metallic-blue-fill random-slanted-lines shadow-lg border-b-4 border-[#F3A628] sticky top-0 z-50">
    <div class="absolute top-0 left-0 w-24 h-24 overflow-hidden z-[100] pointer-events-none">

    <div class="absolute top-[15px] left-[-30px] w-[110px] bg-gradient-to-r from-[#F3A628] to-[#d48a1b] text-[#2A3475] text-[9px] md:text-[10px] font-black text-center -rotate-45 py-1 shadow-md border-b-2 border-[#2A3475] tracking-wider">

        Ù†Ø³Ø®Ø© ØªØ¬Ø±ÙŠØ¨ÙŠØ©

    </div>

</div>
    <div class="w-full max-w-[98%] mx-auto px-3 py-5 md:px-6 md:py-5">
        <div class="hidden lg:flex flex-row items-center justify-between gap-3">
            <div class="flex items-center justify-start gap-4 text-right">
                <div class="bg-white p-2 rounded-xl shadow-lg shrink-0 group hover:scale-105 transition-transform duration-300">
                    <img src="CITL_Logo.gif" alt="Logo" class="h-16 w-auto object-contain transform scale-110">
                </div>
                <div class="flex flex-col">
                    <h1 class="text-white font-black text-[24px] leading-tight tracking-wide drop-shadow-md">ÙƒÙ„ÙŠØ© Ø§Ù„Ù†Ù‚Ù„ Ø§Ù„Ø¯ÙˆÙ„ÙŠ ÙˆØ§Ù„Ù„ÙˆØ¬Ø³ØªÙŠØ§Øª</h1>
                    <h2 class="text-[#F3A628] text-xs font-bold tracking-[2px] uppercase font-sans mt-0.5 opacity-90">College of International Transport & Logistics</h2>
                    <p class="text-xs text-blue-100/90 font-bold mt-1 tracking-tighter">Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ø°ÙƒÙŠ Ù„Ø¥Ø¯Ø§Ø±Ø© Ø¬Ø¯Ø§ÙˆÙ„ Ø§Ù„Ù‚Ø§Ø¹Ø§Øª Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠØ©</p>
                </div>
            </div>

            <div class="flex items-center gap-2 h-full">
                <button id="admin-toggle-btn" onclick="toggleAdminMode()" class="bg-white/10 hover:bg-white/20 text-white border border-white/10 px-3 py-1.5 rounded-lg font-bold backdrop-blur-sm transition-all text-[13px] hidden"> 
                    <i class="fas fa-cogs text-base text-[#F3A628] ml-2"></i> ÙˆØ¶Ø¹ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ 
                </button>
                <button onclick="openMyScheduleModal()" class="bg-white/10 hover:bg-white/20 text-white border border-white/10 px-3 py-1.5 rounded-lg font-bold backdrop-blur-sm transition-all text-[13px]"> 
                    <i class="fas fa-chalkboard-user text-base text-[#F3A628] ml-2"></i> Ø¬Ø¯Ø§ÙˆÙ„ÙŠ 
                </button>
                <a href="/smrm/" class="bg-gradient-to-b from-[#F3A628] to-[#d48a1b] text-[#2A3475] px-4 py-2 rounded-lg font-black hover:brightness-110 shadow-lg border border-white/20 text-[13px]"> 
                    <i class="fas fa-home ml-2"></i> Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© 
                </a>

                <div class="w-px h-8 bg-white/20 mx-1"></div>
                
                <div class="flex items-center gap-3 bg-black/20 rounded-full pl-2 pr-5 py-1.5 border border-white/10 shrink-0 backdrop-blur-md self-center shadow-inner">
                    <div class="flex flex-col text-right">
                        <span id="profile-name" class="text-[13px] font-bold text-white leading-tight">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</span>
                        <span id="profile-role" class="text-[11px] text-[#F3A628] leading-tight opacity-90">...</span>
                    </div>
                    <div class="w-10 h-10 rounded-full bg-[#2A3475] flex items-center justify-center text-white font-bold shadow-md border border-white/20 relative">
                        <i class="fas fa-user"></i>
                        <span class="absolute bottom-0 right-0 w-3 h-3 bg-green-500 border-2 border-[#2A3475] rounded-full animate-pulse"></span>
                    </div>
                </div>
                <button onclick="handleLogout()" class="bg-white/5 hover:bg-red-600 text-red-100 hover:text-white border border-white/10 p-2.5 rounded-xl transition-all shadow-sm ml-1">
    <i class="fas fa-sign-out-alt text-lg"></i>
</button>
            </div>
        </div>

<div class="lg:hidden flex flex-row items-center justify-between w-full gap-1">
    <div class="flex items-center gap-1.5 flex-1 min-w-0">
        <div class="relative shrink-0">
<div class="bg-white p-1 rounded-lg shadow-md relative h-11 w-11 flex items-center justify-center border border-white/20">
<div id="mobileEditBtn" onclick="event.stopPropagation(); toggleAdminMode();" class="absolute -top-1.5 -left-1.5 bg-white text-[#2A3475] w-6 h-6 rounded-full flex items-center justify-center text-[10px] border border-gray-200 shadow-md cursor-pointer z-30 transition-all active:scale-125">
    <i class="fas fa-edit"></i>
</div>
    <img src="CITL_Logo.gif" onclick="toggleMobileMenu()" alt="Logo" class="h-8 w-auto object-contain cursor-pointer">
    <div onclick="toggleMobileMenu()" class="absolute -bottom-1 -right-1 bg-[#2A3475] text-[#F3A628] w-5 h-5 rounded-full flex items-center justify-center text-[8px] border border-white shadow-sm cursor-pointer">
        <i class="fas fa-bars"></i>
    </div>
</div>
        </div>

        <div class="flex flex-col text-right leading-tight overflow-hidden flex-1 min-w-0">
            <h1 class="text-white font-black text-[clamp(10.5px,3.5vw,13.5px)] whitespace-nowrap drop-shadow-sm">ÙƒÙ„ÙŠØ© Ø§Ù„Ù†Ù‚Ù„ Ø§Ù„Ø¯ÙˆÙ„ÙŠ ÙˆØ§Ù„Ù„ÙˆØ¬Ø³ØªÙŠØ§Øª</h1>
            <h2 class="text-[#F3A628] text-[clamp(7.25px,2.05vw,8.75px)] font-bold uppercase opacity-90 leading-none mt-0.5 whitespace-nowrap">College of International Transport & Logistics</h2>
            <p class="text-[clamp(8px,2.3vw,9.2px)] text-blue-100/70 font-bold leading-none mt-0.5 whitespace-nowrap">Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ø°ÙƒÙŠ Ù„Ø¥Ø¯Ø§Ø±Ø© Ø¬Ø¯Ø§ÙˆÙ„ Ø§Ù„Ù‚Ø§Ø¹Ø§Øª Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠØ©</p>
        </div>

        <div id="mob-profile-capsule" onclick="toggleProfileInfoMenu()" class="flex flex-col justify-center text-left leading-tight bg-black/20 px-2.5 h-11 rounded-xl border border-white/10 backdrop-blur-md shadow-inner w-[clamp(82px,23.5vw,95px)] overflow-hidden shrink-0 cursor-pointer active:bg-black/40 transition-all ml-1">
            <span id="profile-name-mob" class="text-[10.5px] font-bold text-white truncate block w-full">...</span>
            <span id="profile-role-mob" class="text-[8.5px] text-[#F3A628] font-bold uppercase truncate block w-full">...</span>
        </div>
    </div>
</div>
</header>

<div id="profile-info-menu" class="hidden fixed w-64 bg-white/95 backdrop-blur-md rounded-2xl shadow-[0_20px_50px_rgba(0,0,0,0.15)] border border-gray-100 z-[10001] overflow-hidden transform transition-all duration-300">
    <div class="metallic-blue-fill p-4 border-b border-[#F3A628] relative overflow-hidden">
        <div class="absolute top-0 left-0 w-20 h-20 bg-white/5 rounded-full -ml-10 -mt-10"></div>
        <div class="flex items-center gap-3 relative z-10">
            <div class="w-10 h-10 rounded-full bg-white/10 flex items-center justify-center text-white border border-white/20 shadow-inner">
                <i class="fas fa-user-circle text-xl"></i>
            </div>
            <div class="text-right">
                <p class="text-xs text-blue-200 font-bold">Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø³Ø§Ø¨</p>
                <h4 id="full-profile-name" class="text-white font-black text-sm leading-tight truncate w-40">...</h4>
            </div>
        </div>
    </div>
    <div class="p-4 bg-white">
        <div class="flex items-start gap-3 mb-4">
            <div class="bg-gray-50 p-2 rounded-lg text-[#2A3475]"><i class="fas fa-id-badge text-sm"></i></div>
            <div class="text-right flex-1 min-w-0">
                <p class="text-[10px] text-gray-400 font-bold uppercase tracking-wider">Ø§Ù„Ù…Ø³Ù…Ù‰ Ø§Ù„ÙˆØ¸ÙŠÙÙŠ ÙˆØ§Ù„Ø¬Ù‡Ø©</p>
                <p id="full-profile-role" class="text-xs text-gray-700 font-bold leading-relaxed break-words">...</p>
            </div>
        </div>
        <button id="mob-edit-btn" class="w-full py-2.5 bg-[#2A3475]/5 text-[#2A3475] rounded-xl text-[11px] font-bold border border-[#2A3475]/10 hover:bg-[#2A3475] hover:text-white transition-all transform active:scale-95 flex items-center justify-center gap-2">
            <i class="fas fa-user-edit"></i> ØªØ¹Ø¯ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§ØªÙŠ
        </button>
    </div>
</div>

<div id="mobile-menu" class="hidden fixed inset-0 z-[10002] lg:hidden">
    <div class="absolute inset-0 bg-[#2A3475]/60 backdrop-blur-sm transition-opacity" onclick="toggleMobileMenu()"></div>
    
    <div id="mobile-menu-content" class="absolute right-0 top-0 bottom-0 w-60 bg-white shadow-2xl transform translate-x-full transition-transform duration-300 flex flex-col">
        
        <div class="metallic-blue-fill p-5 relative overflow-hidden shrink-0 border-b-2 border-[#F3A628]">
            <div class="absolute top-0 left-0 w-24 h-24 bg-white/5 rounded-full -ml-10 -mt-10"></div>
            <div class="flex flex-col items-center text-center gap-3 relative z-10">
                <img src="CITL_Logo.gif" class="h-14 w-auto bg-white p-1 rounded-lg shadow-sm" alt="Logo">
                <div class="flex flex-col gap-1">
                    <h1 class="text-white font-black text-[12px] leading-tight drop-shadow-md">ÙƒÙ„ÙŠØ© Ø§Ù„Ù†Ù‚Ù„ Ø§Ù„Ø¯ÙˆÙ„ÙŠ ÙˆØ§Ù„Ù„ÙˆØ¬Ø³ØªÙŠØ§Øª</h1>
                    <h2 class="text-[#F3A628] text-[8px] font-bold uppercase opacity-90">College of International Transport & Logistics</h2>
                    <p class="text-[9px] text-blue-100/90 font-bold leading-tight">Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ø°ÙƒÙŠ Ù„Ø¥Ø¯Ø§Ø±Ø© Ø¬Ø¯Ø§ÙˆÙ„ Ø§Ù„Ù‚Ø§Ø¹Ø§Øª Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠØ©</p>
                </div>
            </div>
        </div>

        <div class="flex-1 py-5 px-4 space-y-3 overflow-y-auto custom-scrollbar">
            
            <a href="/smrm/" class="w-full flex items-center justify-between p-4 rounded-xl bg-orange-50 text-[#d48a1b] font-bold text-sm border border-orange-100 transform active:scale-95 transition-all">
                <div class="flex items-center gap-3">
                    <i class="fas fa-home text-lg"></i>
                    <span>Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</span>
                </div>
                <i class="fas fa-chevron-left text-[10px] opacity-50"></i>
            </a>
            
            <button onclick="openMyScheduleModal(); toggleMobileMenu();" class="w-full flex items-center justify-between p-4 rounded-xl hover:bg-gray-50 text-gray-700 font-bold text-sm transition-colors border border-transparent hover:border-gray-100 text-right">
                <div class="flex items-center gap-3">
                    <i class="fas fa-chalkboard-user text-lg text-[#2A3475]"></i>
                    <span>Ø¬Ø¯Ø§ÙˆÙ„ÙŠ Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠØ©</span>
                </div>
            </button>

            <button id="admin-toggle-mob" onclick="toggleAdminMode(); toggleMobileMenu();" class="w-full flex items-center justify-between p-4 rounded-xl hover:bg-gray-50 text-gray-700 font-bold text-sm transition-colors border border-transparent hover:border-gray-100 text-right hidden">
                <div class="flex items-center gap-3">
                    <i class="fas fa-cogs text-lg text-[#2A3475]"></i>
                    <span>ÙˆØ¶Ø¹ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„</span>
                </div>
            </button>

            <div class="border-t border-gray-100 my-4"></div>
            
            <button onclick="handleLogout()" class="w-full flex items-center gap-3 p-4 rounded-xl text-red-600 font-bold text-sm hover:bg-red-50 transition-colors text-right">
                <i class="fas fa-sign-out-alt text-lg"></i>
                <span>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</span>
            </button>
        </div>
    </div>
</div>

<main class="flex-1 w-full max-w-[96%] mx-auto px-4 py-6"> <section class="bg-white rounded-xl shadow-lg border border-gray-100 mb-8 relative overflow-visible">
    <div class="p-5 md:p-8">
        
        <div class="flex items-center justify-between mb-6 md:mb-8 border-b border-gray-100 pb-4 md:pb-6">
            <div class="flex items-center gap-3 md:gap-4 w-full overflow-hidden">
                <div class="bg-[#2A3475]/5 p-2.5 md:p-3 rounded-xl text-[#2A3475] shrink-0 border border-[#2A3475]/10 shadow-sm">
                    <i class="fas fa-sliders-h text-lg md:text-2xl"></i>
                </div>
                
                <div class="flex-1 min-w-0">
                    <h2 class="text-base md:text-xl font-bold text-[#2A3475] truncate leading-tight">
                        ØªØµÙÙŠØ© ÙˆØ§Ø³ØªØ¹Ø±Ø§Ø¶ Ø§Ù„Ø¬Ø¯Ø§ÙˆÙ„
                    </h2>
                    <p class="text-[10px] md:text-sm text-gray-500 font-bold mt-0.5 md:mt-1 truncate opacity-80">
                        Ø§Ø®ØªØ± Ø§Ù„Ù…Ø¹Ø§ÙŠÙŠØ± Ù„Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø© Ø¨Ø¯Ù‚Ø©
                    </p>
                </div>
            </div>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4 lg:gap-6 mb-6 md:mb-8">
            
            <div class="group">
                <label class="block text-xs md:text-sm font-bold text-gray-700 mb-1.5 md:mb-2">Ø§Ù„ÙŠÙˆÙ…</label>
                <div class="relative custom-dropdown w-full">
                    <div class="custom-dropdown-display w-full px-4 py-3 border border-gray-200 rounded-xl text-xs md:text-sm font-bold text-gray-700 bg-gray-50 flex items-center justify-between cursor-pointer transition-all hover:border-[#2A3475]/50 active:scale-[0.99]">
                        <span class="truncate">ÙƒÙ„ Ø§Ù„Ø£ÙŠØ§Ù…</span>
                        <i class="fas fa-chevron-down text-[10px] md:text-xs text-gray-400 transition-transform duration-200"></i>
                    </div>
                    
                    <ul class="custom-dropdown-options custom-scrollbar">
                        <li class="custom-option" data-value="">ÙƒÙ„ Ø§Ù„Ø£ÙŠØ§Ù…</li>
                        <li class="custom-option" data-value="Saturday">Ø§Ù„Ø³Ø¨Øª</li>
                        <li class="custom-option" data-value="Sunday">Ø§Ù„Ø£Ø­Ø¯</li>
                        <li class="custom-option" data-value="Monday">Ø§Ù„Ø§Ø«Ù†ÙŠÙ†</li>
                        <li class="custom-option" data-value="Tuesday">Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡</li>
                        <li class="custom-option" data-value="Wednesday">Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡</li>
                        <li class="custom-option" data-value="Thursday">Ø§Ù„Ø®Ù…ÙŠØ³</li>
                    </ul>

                    <select id="filter-day" class="hidden" onchange="applyFilters()">
                        <option value="">ÙƒÙ„ Ø§Ù„Ø£ÙŠØ§Ù…</option>
                        <option value="Saturday">Ø§Ù„Ø³Ø¨Øª</option>
                        <option value="Sunday">Ø§Ù„Ø£Ø­Ø¯</option>
                        <option value="Monday">Ø§Ù„Ø§Ø«Ù†ÙŠÙ†</option>
                        <option value="Tuesday">Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡</option>
                        <option value="Wednesday">Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡</option>
                        <option value="Thursday">Ø§Ù„Ø®Ù…ÙŠØ³</option>
                    </select>
                </div>
            </div>

            <div class="group">
                <label class="block text-xs md:text-sm font-bold text-gray-700 mb-1.5 md:mb-2">Ø§Ù„Ù…Ø­Ø§Ø¶Ø±</label>
                <div class="relative custom-dropdown w-full">
                    <div class="custom-dropdown-display w-full px-4 py-3 bg-gray-50 border border-gray-200 rounded-xl text-xs md:text-sm font-bold text-gray-700 flex items-center justify-between cursor-pointer transition-all hover:border-[#2A3475]/50 active:scale-[0.99]">
                        <span class="truncate">ÙƒÙ„ Ø§Ù„Ù…Ø­Ø§Ø¶Ø±ÙŠÙ†</span>
                        <i class="fas fa-chevron-down text-[10px] md:text-xs text-gray-400 transition-transform duration-200"></i>
                    </div>
                    <ul class="custom-dropdown-options custom-scrollbar"></ul>
                    <select id="filter-instructor" class="hidden" onchange="applyFilters()">
                        <option value="">ÙƒÙ„ Ø§Ù„Ù…Ø­Ø§Ø¶Ø±ÙŠÙ†</option>
                    </select>
                </div>
            </div>

            <div class="group">
                <label class="block text-xs md:text-sm font-bold text-gray-700 mb-1.5 md:mb-2">Ø§Ù„Ù…Ø§Ø¯Ø© Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠØ©</label>
                <div class="relative custom-dropdown w-full">
                    <div class="custom-dropdown-display w-full px-4 py-3 bg-gray-50 border border-gray-200 rounded-xl text-xs md:text-sm font-bold text-gray-700 flex items-center justify-between cursor-pointer transition-all hover:border-[#2A3475]/50 active:scale-[0.99]">
                        <span class="truncate">ÙƒÙ„ Ø§Ù„Ù…ÙˆØ§Ø¯</span>
                        <i class="fas fa-chevron-down text-[10px] md:text-xs text-gray-400 transition-transform duration-200"></i>
                    </div>
                    <ul class="custom-dropdown-options custom-scrollbar"></ul>
                    <select id="filter-course" class="hidden" onchange="applyFilters()">
                        <option value="">ÙƒÙ„ Ø§Ù„Ù…ÙˆØ§Ø¯</option>
                    </select>
                </div>
            </div>

            <div class="group">
                <label class="block text-xs md:text-sm font-bold text-gray-700 mb-1.5 md:mb-2">Ø§Ù„Ù‚Ø§Ø¹Ø©</label>
                <div class="relative custom-dropdown w-full">
                    <div class="custom-dropdown-display w-full px-4 py-3 bg-gray-50 border border-gray-200 rounded-xl text-xs md:text-sm font-bold text-gray-700 flex items-center justify-between cursor-pointer transition-all hover:border-[#2A3475]/50 active:scale-[0.99]">
                        <span class="truncate">ÙƒÙ„ Ø§Ù„Ù‚Ø§Ø¹Ø§Øª</span>
                        <i class="fas fa-chevron-down text-[10px] md:text-xs text-gray-400 transition-transform duration-200"></i>
                    </div>
                    <ul class="custom-dropdown-options custom-scrollbar"></ul>
                    <select id="filter-room" class="hidden" onchange="applyFilters()">
                        <option value="">ÙƒÙ„ Ø§Ù„Ù‚Ø§Ø¹Ø§Øª</option>
                    </select>
                </div>
            </div>

            <div class="group">
                <label class="block text-xs md:text-sm font-bold text-gray-700 mb-1.5 md:mb-2">Ø§Ù„ØªÙˆÙ‚ÙŠØª</label>
                <div class="relative custom-dropdown w-full">
                    <div class="custom-dropdown-display w-full px-4 py-3 bg-gray-50 border border-gray-200 rounded-xl text-xs md:text-sm font-bold text-gray-700 flex items-center justify-between cursor-pointer transition-all hover:border-[#2A3475]/50 active:scale-[0.99]">
                        <span class="truncate">ÙƒÙ„ Ø§Ù„Ø£ÙˆÙ‚Ø§Øª</span>
                        <i class="fas fa-chevron-down text-[10px] md:text-xs text-gray-400 transition-transform duration-200"></i>
                    </div>
                    
                    <ul class="custom-dropdown-options custom-scrollbar">
                        <li class="custom-option" data-value="">ÙƒÙ„ Ø§Ù„Ø£ÙˆÙ‚Ø§Øª</li>
                        <li class="custom-option" data-value="08:30">ØµØ¨Ø§Ø­Ø§Ù‹ (Ø¨Ø¹Ø¯ 08:30)</li>
                        <li class="custom-option" data-value="12:30">Ø§Ù„Ø¸Ù‡ÙŠØ±Ø© (Ø¨Ø¹Ø¯ 12:30)</li>
                        <li class="custom-option" data-value="16:30">Ø§Ù„Ù…Ø³Ø§Ø¡ (Ø¨Ø¹Ø¯ 04:30)</li>
                    </ul>
                    
                    <select id="filter-time" class="hidden" onchange="applyFilters()">
                        <option value="">ÙƒÙ„ Ø§Ù„Ø£ÙˆÙ‚Ø§Øª</option>
                        <option value="08:30">ØµØ¨Ø§Ø­Ø§Ù‹ (Ø¨Ø¹Ø¯ 08:30)</option>
                        <option value="12:30">Ø§Ù„Ø¸Ù‡ÙŠØ±Ø© (Ø¨Ø¹Ø¯ 12:30)</option>
                        <option value="16:30">Ø§Ù„Ù…Ø³Ø§Ø¡ (Ø¨Ø¹Ø¯ 04:30)</option>
                    </select>
                </div>
            </div>
        </div>

        <div class="flex flex-col md:flex-row gap-3 md:gap-4 border-t border-gray-100 pt-5 md:pt-6">
            <button onclick="applyFilters()" class="flex-1 bg-[#2A3475] text-white py-3.5 md:py-3 rounded-xl font-bold text-sm md:text-base hover:bg-[#1e255a] transition-all shadow-md hover:shadow-lg flex items-center justify-center gap-3 group active:scale-95">
                <i class="fas fa-search group-hover:scale-110 transition-transform"></i> Ø¹Ø±Ø¶ Ø§Ù„Ù†ØªØ§Ø¦Ø¬
            </button>
            
            <button onclick="resetFilters()" class="w-full md:w-auto px-8 py-3.5 md:py-3 text-gray-600 hover:text-[#2A3475] hover:bg-gray-50 bg-white border-2 border-gray-200 rounded-xl transition-colors font-bold flex items-center justify-center gap-2 active:scale-95" title="Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ†">
                <i class="fas fa-undo"></i> 
                <span>Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ†</span>
            </button>
        </div>

    </div>
</section>

<section class="mb-6 md:mb-10">
    <div class="bg-white rounded-xl shadow-lg border border-gray-100 p-4 md:p-8 min-h-[400px] relative">
        
        <div class="flex justify-between items-center mb-6 md:mb-8 border-b border-gray-100 pb-4">
            <h3 class="text-base md:text-xl font-bold text-[#2A3475] flex items-center gap-2 md:gap-3">
                <div class="bg-[#F3A628]/10 p-1.5 md:p-2 rounded-lg text-[#F3A628]">
                    <i class="fas fa-table text-lg md:text-xl"></i>
                </div>
                Ø§Ù„Ø¬Ø¯Ø§ÙˆÙ„ Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠØ©
            </h3>
            
            <span id="results-count" class="text-[10px] md:text-xs font-bold bg-[#2A3475] text-white px-2.5 py-1 md:px-4 md:py-1.5 rounded-full shadow-sm">
                0 Ù†ØªÙŠØ¬Ø©
            </span>
        </div>

        <div id="loading-spinner" class="hidden flex justify-center py-20">
            <div class="animate-spin rounded-full h-10 w-10 md:h-14 md:w-14 border-4 border-gray-200 border-t-[#2A3475]"></div>
        </div>

        <div id="results-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4 md:gap-6">
            <div class="col-span-full text-center py-16 md:py-24 flex flex-col items-center justify-center text-gray-400">
                <div class="bg-gray-50 p-5 md:p-6 rounded-full mb-4 shadow-inner">
                    <i class="fas fa-layer-group text-3xl md:text-5xl opacity-30 text-[#2A3475]"></i>
                </div>
                <p class="font-bold text-sm md:text-lg text-gray-500">Ù„Ù… ÙŠØªÙ… ØªØ­Ø¯ÙŠØ¯ Ù…Ø¹Ø§ÙŠÙŠØ± Ø§Ù„Ø¹Ø±Ø¶</p>
                <p class="text-[10px] md:text-sm text-gray-400 mt-1 md:mt-2">Ø§Ø³ØªØ®Ø¯Ù… Ø£Ø¯ÙˆØ§Øª Ø§Ù„ØªØµÙÙŠØ© Ø¨Ø§Ù„Ø£Ø¹Ù„Ù‰ Ù„Ù„Ø¨Ø¯Ø¡</p>
            </div>
        </div>

<section class="mt-auto">
    <div class="bg-white rounded-xl shadow-lg border border-gray-100 relative overflow-hidden group hover:shadow-xl transition-all duration-300">
        <div class="absolute top-0 right-0 w-1.5 h-full bg-[#2A3475]"></div>
        
        <div class="p-4 md:p-6">
            
            <div class="flex items-center justify-between mb-4 md:mb-6 border-b border-gray-100 pb-3 md:pb-4">
                <div class="flex items-center space-x-3 space-x-reverse min-w-0">
                    <div class="bg-[#2A3475]/10 p-2 md:p-2.5 rounded-lg text-[#2A3475] shrink-0">
                        <i class="fas fa-robot text-lg md:text-2xl animate-pulse"></i>
                    </div>
                    <div class="min-w-0">
                        <h3 class="text-sm md:text-lg font-bold text-[#2A3475] truncate">Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯ Ø§Ù„Ø°ÙƒÙŠ</h3>
                        <p class="text-[10px] md:text-xs text-gray-500 truncate">Ø§Ø³Ø£Ù„ Ø¹Ù† Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯ ÙˆØ§Ù„Ù‚Ø§Ø¹Ø§Øª (AI)</p>
                    </div>
                </div>
                
                <span class="px-2 py-1 bg-blue-50 text-[#2A3475] text-[9px] md:text-[10px] font-bold rounded border border-blue-100 flex items-center gap-1 shrink-0">
                    <span class="w-1.5 h-1.5 bg-green-500 rounded-full animate-pulse"></span> ONLINE
                </span>
            </div>

            <div class="relative group mb-4">
                <input type="text" id="smart-search" 
                    class="w-full px-4 py-3 md:px-5 md:py-4 pr-10 md:pr-12 rounded-xl bg-gray-50 border border-gray-200 focus:border-[#2A3475] focus:bg-white focus:ring-4 focus:ring-[#2A3475]/10 transition-all outline-none text-xs md:text-base font-bold text-gray-700 placeholder-gray-400 shadow-inner"
                    placeholder="Ø§ÙƒØªØ¨ Ø³Ø¤Ø§Ù„Ùƒ Ù‡Ù†Ø§... (Ù…Ø«Ø§Ù„: ÙÙŠÙ† Ø¯ÙƒØªÙˆØ±Ø© Ù†..ØŸ)">
                <div class="absolute inset-y-0 right-3 md:right-4 flex items-center pointer-events-none">
                    <i class="fas fa-search text-gray-400 text-sm md:text-lg group-focus-within:text-[#2A3475] transition-colors"></i>
                </div>
            </div>

            <div id="ai-response-area" class="hidden">
                <div class="bg-gradient-to-br from-[#2A3475]/5 to-[#F3A628]/5 border border-[#2A3475]/10 rounded-xl p-3 md:p-4 flex items-start gap-3 text-right shadow-sm">
                    <div class="bg-white p-1.5 md:p-2 rounded-full shadow-md text-[#F3A628] shrink-0 border border-gray-100">
                        <i class="fas fa-sparkles text-sm md:text-lg"></i>
                    </div>
                    <div class="flex-1 pt-0.5 min-w-0">
                        <h4 class="font-bold text-[#2A3475] text-[10px] md:text-xs mb-1">Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„Ù…Ù‚ØªØ±Ø­Ø©:</h4>
                        <p id="ai-response-text" class="text-gray-800 font-bold text-xs md:text-sm leading-relaxed"></p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

    </main>

<footer class="metallic-blue-fill random-slanted-lines border-t-4 border-[#F3A628] shadow-[0_-4px_20px_rgba(0,0,0,0.3)] relative z-50">
    <div class="w-full max-w-[98%] mx-auto px-6 py-2 md:py-3">
        <div class="flex flex-col md:flex-row justify-between items-center gap-3 md:gap-4">

            <div class="hidden md:flex items-center gap-4">
                <div class="bg-white p-1 rounded-xl shadow-md shrink-0 flex items-center justify-center border border-white/20">
                    <img src="CITL_Logo.gif" alt="CITL Logo" class="h-10 w-auto object-contain transform scale-110">
                </div>
                <div class="text-right leading-tight">
                    <h3 class="font-black text-white text-xs md:text-sm tracking-wide">ÙƒÙ„ÙŠØ© Ø§Ù„Ù†Ù‚Ù„ Ø§Ù„Ø¯ÙˆÙ„ÙŠ ÙˆØ§Ù„Ù„ÙˆØ¬Ø³ØªÙŠØ§Øª</h3>
                    <p class="text-[#F3A628] text-[9px] md:text-[10px] font-bold font-sans tracking-wider uppercase opacity-90">College of International Transport & Logistics</p>
                </div>
            </div>

            <div class="flex flex-col md:flex-row items-center gap-1 md:gap-4 text-[11px] md:text-xs">
                
                <p class="text-blue-100/90 text-center md:text-right font-medium leading-relaxed">
                    Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø© Ù„ÙƒÙ„ÙŠØ© Ø§Ù„Ù†Ù‚Ù„ Ø§Ù„Ø¯ÙˆÙ„ÙŠ ÙˆØ§Ù„Ù„ÙˆØ¬Ø³ØªÙŠØ§Øª Â© 2025
                    <span class="hidden md:inline mx-1">|</span> <br class="md:hidden"> ØªØ·ÙˆÙŠØ± ÙˆØ¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù†Ø¸Ø§Ù… Ø¨ÙˆØ§Ø³Ø·Ø© Ø£. Ø£Ø­Ù…Ø¯ ÙÙƒØ±ÙŠ ( ÙÙ†ÙŠ Ù…Ø¹Ù…Ù„ Ø§Ù„Ø­Ø§Ø³Ø¨ ).
                </p>

                <div class="hidden md:block w-px h-5 bg-white/20"></div>

                <div class="flex items-center gap-1.5 md:gap-3 bg-black/20 px-3 py-1.5 md:px-4 md:py-1.5 rounded-full border border-white/10 shadow-inner">
                    <a href="https://www.facebook.com/CITLAlexandria" target="_blank" class="text-white hover:text-[#F3A628] transition-all text-[12px] md:text-sm"><i class="fab fa-facebook-f"></i></a>
                    <a href="https://www.linkedin.com/in/CITLAlexandria" target="_blank" class="text-white hover:text-[#F3A628] transition-all text-[12px] md:text-sm"><i class="fab fa-linkedin-in"></i></a>
                    <a href="https://www.instagram.com/CITLAlexandria" target="_blank" class="text-white hover:text-[#F3A628] transition-all text-[12px] md:text-sm"><i class="fab fa-instagram"></i></a>
                    <a href="https://x.com/CITLAlexandria" target="_blank" class="text-white hover:text-[#F3A628] transition-all text-[10px] md:text-[13px]"><i class="fab fa-twitter"></i></a>
                    <a href="https://www.youtube.com/@CITLAlexandria" target="_blank" class="text-white hover:text-[#F3A628] transition-all text-[12px] md:text-sm"><i class="fab fa-youtube"></i></a>
                    <div class="w-px h-3 bg-white/10 mx-0.5"></div>
                    <a href="https://www.aast.edu/en/colleges/citl/alex" target="_blank" class="text-[#F3A628] hover:scale-125 transition-all text-[12px] md:text-sm"><i class="fas fa-globe"></i></a>
                </div>
            </div>
        </div>
    </div>
</footer>

<div id="my-schedule-modal" class="fixed inset-0 z-50 hidden items-center justify-center">
    <div class="absolute inset-0 bg-[#2A3475]/90 backdrop-blur-sm transition-opacity" onclick="closeMyScheduleModal()"></div>

    <div class="bg-white rounded-2xl shadow-2xl w-[95%] md:w-full md:max-w-[80%] h-[90vh] flex flex-col overflow-hidden relative z-10 modal-enter mx-auto">
        
        <div class="metallic-blue-fill random-slanted-lines px-4 py-4 md:px-6 flex justify-between items-center shadow-md shrink-0 z-30">
            <div class="flex items-center gap-3">
                <div class="bg-white/10 p-2 rounded-lg">
                    <i class="fas fa-chalkboard-user text-[#F3A628] text-lg md:text-xl"></i>
                </div>
                <div>
                    <h3 class="text-base md:text-lg font-bold text-white">Ø¥Ø¯Ø§Ø±Ø© Ø¬Ø¯ÙˆÙ„ÙŠ Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠ</h3>
                    <p class="text-[10px] md:text-xs text-blue-200">ØªÙØ¹ÙŠÙ„ ÙˆØ¥Ù„ØºØ§Ø¡ Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø§Øª</p>
                </div>
            </div>
            <button onclick="closeMyScheduleModal()" class="text-white/70 hover:text-white transition-colors"><i class="fas fa-times text-lg md:text-xl"></i></button>
        </div>

        <div class="flex-1 overflow-hidden bg-[#f8fafc] relative flex flex-col w-full">
            
<div id="my-schedule-setup" class="hidden flex-col h-full w-full overflow-hidden bg-white">
    
    <div class="shrink-0 p-4 md:p-6 pb-2 text-center bg-white border-b border-gray-100 shadow-sm z-10">
        <h4 id="setup-welcome-msg" class="text-base md:text-xl font-bold text-gray-800 mb-1 md:mb-2">Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ! ğŸ‘‹</h4>
        <p class="text-gray-500 text-[10px] md:text-sm mb-3 md:mb-4 font-bold">Ù„Ø¥Ø¯Ø§Ø±Ø© Ø¬Ø¯ÙˆÙ„ÙƒØŒ Ø§Ø®ØªØ± Ø§Ø³Ù…Ùƒ (Ø£Ùˆ Ø§Ù„Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„ØªÙŠ ØªÙ†ÙˆØ¨ Ø¹Ù†Ù‡Ø§) Ù…Ù† Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©:</p>
        
        <div class="relative max-w-xl mx-auto w-full">
            <input type="text" id="instructor-search-input" onkeyup="filterInstructorGrid()" placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ø§Ø³Ù…..." class="w-full px-4 py-2.5 md:py-3 pl-10 border-2 border-gray-200 rounded-xl focus:border-[#2A3475] outline-none font-bold text-gray-700 text-xs md:text-sm transition-all shadow-sm">
            <i class="fas fa-search absolute left-3 top-3 md:top-3.5 text-gray-400 text-xs md:text-sm"></i>
        </div>
    </div>

    <div class="flex-1 overflow-y-auto p-3 md:p-6 custom-scrollbar bg-[#f8fafc]">
        <div id="instructor-selection-grid" class="grid grid-cols-4 lg:grid-cols-6 gap-1.5 md:gap-2 pb-10"></div>
    </div>

    <div class="shrink-0 p-4 bg-white border-t border-gray-200 flex flex-col md:flex-row gap-3 justify-between items-center shadow-[0_-4px_10px_rgba(0,0,0,0.1)] relative z-[100]">
        <span id="selection-count-badge" class="w-full md:w-auto text-center px-4 py-2 bg-gray-50 text-gray-600 rounded-lg text-xs font-bold border border-gray-100">
            ØªÙ… Ø§Ø®ØªÙŠØ§Ø±: 0
        </span>
        
        <button onclick="saveInstructorSelection()" class="w-full md:w-auto px-8 py-2.5 bg-[#2A3475] text-white rounded-xl font-bold hover:bg-[#1f2658] shadow-lg transform active:scale-95 transition-all flex items-center justify-center gap-2 relative z-[101] cursor-pointer">
            <i class="fas fa-check"></i> Ø­ÙØ¸ ÙˆØ¨Ø¯Ø¡ Ø§Ù„Ø¹Ù…Ù„
        </button>
    </div>
</div>

            <div id="my-schedule-content" class="hidden flex-col h-full overflow-hidden bg-[#f8fafc]">
                
                <div class="shrink-0 bg-white p-4 border-b border-gray-200 shadow-sm z-20">
                    <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4">
                        <div class="flex flex-col gap-2 w-full md:flex-1 min-w-0">
                            <div class="flex items-center gap-2">
                                <i class="fas fa-users-cog text-[#2A3475] text-sm"></i>
                                <span class="text-xs font-bold text-gray-500">Ø§Ù„Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„ØªÙŠ ØªØ¯ÙŠØ± Ø¬Ø¯ÙˆÙ„Ù‡Ø§:</span>
                            </div>
                            <div id="managed-names-chips" class="flex flex-wrap gap-2 max-h-24 overflow-y-auto custom-scrollbar"></div>
                        </div>
                        
                        <button onclick="resetInstructorLink()" class="w-full md:w-auto shrink-0 bg-[#2A3475] text-white px-5 py-2.5 rounded-lg shadow-lg hover:bg-[#1f2658] transition-all flex items-center justify-center text-xs md:text-sm font-bold hover:shadow-xl transform active:scale-95 whitespace-nowrap self-end md:self-auto">
                            <i class="fas fa-edit ml-2"></i> ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©
                        </button>
                    </div>
                </div>

                <div id="mobile-schedule-list" class="md:hidden flex-1 overflow-y-auto p-4 space-y-4 custom-scrollbar pb-20">
                    </div>

                <div class="hidden md:block bg-white border border-gray-200 rounded-xl shadow-sm m-6 overflow-hidden flex-1 relative">
                    <div class="table-scroll h-full overflow-y-auto custom-scrollbar" style="max-height: 680px;">
                        <table class="min-w-full text-sm text-right relative">
                            <thead class="bg-gray-50 text-gray-700 font-bold text-xs uppercase sticky top-0 z-10 shadow-sm">
                                <tr>
                                    <th class="px-6 py-4 whitespace-nowrap bg-gray-50">Ø§Ù„ÙŠÙˆÙ…</th>
                                    <th class="px-6 py-4 whitespace-nowrap bg-gray-50 text-center">Ø§Ù„Ù…ÙˆØ¹Ø¯</th>
                                    <th class="px-6 py-4 whitespace-nowrap bg-gray-50">Ø§Ù„Ù…Ø§Ø¯Ø©</th>
                                    <th class="px-6 py-4 whitespace-nowrap bg-gray-50">Ø§Ù„Ù…Ø­Ø§Ø¶Ø±</th>
                                    <th class="px-6 py-4 whitespace-nowrap bg-gray-50 text-center">Ø§Ù„Ù‚Ø§Ø¹Ø©</th>
                                    <th class="px-6 py-4 whitespace-nowrap bg-gray-50 text-center">Ø§Ù„Ø­Ø§Ù„Ø©</th>
                                    <th class="px-6 py-4 whitespace-nowrap bg-gray-50 text-center">ØªØ­ÙƒÙ…</th>
                                </tr>
                            </thead>
                            <tbody id="my-schedule-rows" class="divide-y divide-gray-100 text-gray-700 bg-white">
                                </tbody>
                        </table>
                    </div>
                </div>

                <div id="empty-schedule-msg" class="hidden absolute inset-0 flex flex-col items-center justify-center text-gray-400 bg-white/50 backdrop-blur-sm z-30 pointer-events-none">
                    <div class="bg-gray-100 p-6 rounded-full mb-4">
                        <i class="fas fa-calendar-times text-4xl opacity-30 text-[#2A3475]"></i>
                    </div>
                    <p class="font-bold text-lg text-[#2A3475]">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø­Ø§Ø¶Ø±Ø§Øª ÙÙŠ Ø¬Ø¯ÙˆÙ„Ùƒ</p>
                </div>
            </div>
        </div>
    </div>
</div>

<div id="custom-confirm-modal" class="fixed inset-0 z-[100] hidden items-center justify-center bg-[#2A3475]/90 backdrop-blur-sm transition-opacity">
    <div class="bg-white rounded-2xl shadow-2xl w-full max-w-sm transform scale-100 transition-all overflow-hidden border-t-4 border-[#F3A628]">
        <div class="p-6 text-center">
            <div class="w-16 h-16 bg-blue-50 rounded-full flex items-center justify-center mx-auto mb-4 shadow-sm">
                <i class="fas fa-question text-3xl text-[#2A3475]"></i>
            </div>
            <h3 class="text-xl font-bold text-gray-800 mb-2">ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡</h3>
            <p id="custom-confirm-message" class="text-sm text-gray-500 leading-relaxed mb-6">Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ØŸ</p>
            <div class="flex gap-3">
                <button id="btn-confirm-yes" class="flex-1 bg-[#2A3475] text-white py-2.5 rounded-xl font-bold hover:bg-[#1f2658] shadow-md transition-all">Ù†Ø¹Ù…ØŒ Ù…ØªØ£ÙƒØ¯</button>
                <button id="btn-confirm-no" class="flex-1 bg-gray-100 text-gray-600 py-2.5 rounded-xl font-bold hover:bg-gray-200 border border-gray-200 transition-all">Ø¥Ù„ØºØ§Ø¡</button>
            </div>
        </div>
    </div>
</div>

<div id="admin-edit-modal" class="fixed inset-0 z-[100] hidden items-center justify-center">
    <div class="absolute inset-0 bg-black/80 backdrop-blur-sm transition-opacity" onclick="closeAdminEditModal()"></div>

<div class="bg-white rounded-2xl shadow-2xl w-full max-w-lg relative z-10 mx-4 overflow-hidden transform scale-100 transition-all">        
        <div class="bg-[#2A3475] px-6 py-4 flex justify-between items-center">
            <h3 class="text-lg font-bold text-white flex items-center gap-2">
                <i class="fas fa-edit text-[#F3A628]"></i> ØªØ¹Ø¯ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø©
            </h3>
            <button onclick="closeAdminEditModal()" class="text-white/70 hover:text-white"><i class="fas fa-times text-xl"></i></button>
        </div>

        <div class="p-6 space-y-4 bg-gray-50">
            <input type="hidden" id="edit-id">

            <div>
                <label class="block text-xs font-bold text-gray-500 mb-1">Ø§Ø³Ù… Ø§Ù„Ù…Ø­Ø§Ø¶Ø±</label>
                <input type="text" id="edit-instructor" class="w-full px-4 py-2 rounded-lg border border-gray-300 focus:border-[#2A3475] font-bold text-gray-700">
            </div>

            <div>
                <label class="block text-xs font-bold text-gray-500 mb-1">Ø§Ù„Ù…Ø§Ø¯Ø© Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠØ©</label>
                <input type="text" id="edit-course" class="w-full px-4 py-2 rounded-lg border border-gray-300 focus:border-[#2A3475] font-bold text-gray-700">
            </div>

            <div class="grid grid-cols-2 gap-4">
                <div>
                    <label class="block text-xs font-bold text-gray-500 mb-1">Ø§Ù„Ù‚Ø§Ø¹Ø©</label>
                    <input type="text" id="edit-room" class="w-full px-4 py-2 rounded-lg border border-gray-300 focus:border-[#2A3475] font-bold text-gray-700">
                </div>
                
                <div>
                    <label class="block text-xs font-bold text-gray-500 mb-1">Ø§Ù„ØªÙˆÙ‚ÙŠØª</label>
                    <input type="text" id="edit-time" class="w-full px-4 py-2 rounded-lg border border-gray-300 focus:border-[#2A3475] font-bold text-gray-700">
                </div>
            </div>

             <div>
                <label class="block text-xs font-bold text-gray-500 mb-1">Ø§Ù„ÙŠÙˆÙ…</label>
                <select id="edit-day" class="w-full px-4 py-2 rounded-lg border border-gray-300 focus:border-[#2A3475] font-bold text-gray-700 bg-white">
                    <option value="Saturday">Ø§Ù„Ø³Ø¨Øª</option>
                    <option value="Sunday">Ø§Ù„Ø£Ø­Ø¯</option>
                    <option value="Monday">Ø§Ù„Ø§Ø«Ù†ÙŠÙ†</option>
                    <option value="Tuesday">Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡</option>
                    <option value="Wednesday">Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡</option>
                    <option value="Thursday">Ø§Ù„Ø®Ù…ÙŠØ³</option>
                </select>
            </div>
        </div>

        <div class="px-6 py-4 bg-white border-t border-gray-100 flex gap-3">
            <button onclick="saveAdminChanges()" class="flex-1 bg-[#2A3475] text-white py-2.5 rounded-xl font-bold hover:bg-[#1e255a] shadow-md transition-all flex items-center justify-center gap-2">
                <i class="fas fa-save"></i> Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª
            </button>
            <button onclick="closeAdminEditModal()" class="px-6 py-2.5 bg-gray-100 text-gray-600 rounded-xl font-bold hover:bg-gray-200 transition-all">
                Ø¥Ù„ØºØ§Ø¡
            </button>
        </div>
    </div>
</div>

<script>
    // =======================================================
    // 1. Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù€ Supabase (Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ù…ÙˆØ­Ø¯Ø© ÙˆØ§Ù„Ø§Ø­ØªØ±Ø§ÙÙŠØ©)
    // =======================================================
    const SUPABASE_URL = 'https://xgqukdbonzukxrpjovmb.supabase.co';
    
    // Ø§Ù„Ù…ÙØªØ§Ø­ Ø§Ù„Ø¹Ø§Ø¯ÙŠ (Public anon key)
    const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InhncXVrZGJvbnp1a3hycGpvdm1iIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjM4OTg4MDMsImV4cCI6MjA3OTQ3NDgwM30.3-70d7uB-zjVF7Jfr8ZjITT7suYPo3EWsYngO-sFVqM';
    
    // Ù…ÙØªØ§Ø­ Ø§Ù„Ø£Ø¯Ù…Ù† (Service Role) - Ø¶Ø±ÙˆØ±ÙŠ Ù„Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ø­Ø°Ù ÙˆØ§Ù„ØªØ¹Ø¯ÙŠÙ„
    const SUPABASE_SERVICE_ROLE = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InhncXVrZGJvbnp1a3hycGpvdm1iIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc2Mzg5ODgwMywiZXhwIjoyMDc5NDc0ODAzfQ.5scdGp3iWsHq45xpO4K92UuvA3cLm13zl6brA1i87C0';

    // Ø­ÙØ¸ factory Ø§Ù„Ø£ØµÙ„ÙŠ
    const supabaseFactory = window.supabase;

    // -------------------------------------------------------
    // Ø£. ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ø¹Ù…ÙŠÙ„ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ (sb) - Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø¹Ø§Ø¯ÙŠ
    // -------------------------------------------------------
    const sb = supabaseFactory.createClient(SUPABASE_URL, SUPABASE_KEY, {
        auth: {
            storageKey: 'sb-main-auth',
            persistSession: true,
            autoRefreshToken: true,
            detectSessionInUrl: true
        }
    });

    // -------------------------------------------------------
    // Ø¨. ØªÙ‡ÙŠØ¦Ø© Ø¹Ù…ÙŠÙ„ Ø§Ù„Ø£Ø¯Ù…Ù† (sbAdmin) - Ù„Ù„Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ø­Ø³Ø§Ø³Ø©
    // -------------------------------------------------------
    const sbAdmin = supabaseFactory.createClient(SUPABASE_URL, SUPABASE_SERVICE_ROLE, {
        auth: {
            persistSession: false, // Ù„Ø§ ÙŠØ­ÙØ¸ Ø§Ù„Ø¬Ù„Ø³Ø© Ù„Ù…Ù†Ø¹ Ø§Ù„ØªØ¶Ø§Ø±Ø¨
            autoRefreshToken: false,
            detectSessionInUrl: false
        }
    });

    // -------------------------------------------------------
    // ğŸ”¥ Ø§Ù„Ø±Ø¨Ø· Ø§Ù„Ø¹Ø§Ù… (Global Exposure) - Ù‡Ø°Ø§ ÙŠØ­Ù„ Ø§Ù„Ù…Ø´ÙƒÙ„Ø© ğŸ”¥
    // -------------------------------------------------------
    window.supabase = sb;
    window.supabaseAdmin = sbAdmin;

    // Ù…ØªØºÙŠØ±Ø§Øª Ø¹Ø§Ù…Ø©
    let currentUser = null;
    let cachedData = []; 
    let searchTimeout;
    let loaderStartTime = 0;

// --- Ø¯ÙˆØ§Ù„ Ø§Ù„ØªØ­ÙƒÙ… ÙÙŠ Ø´Ø§Ø´Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„ (Ù†Ø³Ø®Ø© index Ø§Ù„Ù…ØªØ·ÙˆØ±Ø©) ---
window.showLoader = function(text = "ÙŠØ±Ø¬Ù‰ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø± Ù„Ø­Ø¸Ø§Øª...") {
    const loader = document.getElementById('global-loader');
    const textEl = document.getElementById('loader-text');
    
    if(textEl) textEl.textContent = text;

    if(loader) {
        loader.classList.remove('hidden');
        loader.classList.add('flex');
        
        // ØªÙØ¹ÙŠÙ„ Ø£Ù†ÙŠÙ…ÙŠØ´Ù† Ø§Ù„Ù€ Zoom In
        setTimeout(() => {
            loader.classList.remove('opacity-0');
            const inner = loader.querySelector('.relative');
            if(inner) {
                inner.classList.remove('scale-95');
                inner.classList.add('scale-100');
            }
        }, 10);
    }
};

window.hideLoader = function() {
    const loader = document.getElementById('global-loader');
    if(loader) {
        loader.classList.add('opacity-0');
        const inner = loader.querySelector('.relative');
        if(inner) {
            inner.classList.remove('scale-100');
            inner.classList.add('scale-95');
        }
        
        setTimeout(() => {
            loader.classList.add('hidden');
            loader.classList.remove('flex');
        }, 300);
    }
};
    // Ø¯Ø§Ù„Ø© Ù…Ø³Ø§Ø¹Ø¯Ø©
    window.showLoading = function(show) {
        if (show) { window.showLoader('Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¨Ø­Ø«...'); } 
        else { window.hideLoader(); }
    };

    // --- Ù‚Ø§Ù…ÙˆØ³ Ø§Ù„ØªØ±Ø¬Ù…Ø© Ù„Ù„Ø¨Ø­Ø« ---
    const nameDictionary = {
        "Ù†Ø¯Ù‰": "Nada", "Ø¹Ù…Ø±": "Omar", "Ø¯ÙŠÙ†Ø§": "Dina", "Ù†ÙˆØ±Ù‡Ø§Ù†": "Nourhan", "Ù…Ø±ÙˆØ©": "Marwa", "Ø´Ø±ÙˆÙ‚": "Shrouk", "Ø¨Ø³Ù†Øª": "Passent", "Ù‡Ø§ÙŠØ¯ÙŠ": "Haidy", "Ø´Ù‡Ø¯": "Shahd", "Ø£Ø­Ù…Ø¯": "Ahmed", "Ø­Ø¨ÙŠØ¨Ø©": "Habiba", "Ø´Ù‡Ø§Ø¨": "Chehab", "Ù…Ø­Ù…Ø¯": "Mohamed", "Ø³Ù…Ø±": "Summer", "Ø¢Ù…Ù†Ø©": "Amnh", "Ø´ÙŠØ±ÙŠÙ†": "Sherine", "Ø¬Ù…Ø§Ù„": "Gamal", "Ù†Ø§Ù†Ø³ÙŠ": "Nancy", "Ù…Ù‡Ø§": "Maha", "Ù…ÙŠ": "Mai", "ÙƒÙŠØ±Ù„Ø³": "Kerolous", "Ø³Ù„Ù…Ù‰": "Salma", "Ù„Ø§Ø±Ø§": "Lara", "Ø£Ù†Ø·ÙˆØ§Ù†": "Antoine", "Ø¨Ø§Ù‡Ø±": "Baher", "Ø±ÙˆØ§Ù†": "Rowan", "Ø¥ÙŠÙ…Ø§Ù†": "Iman", "Ø¹Ù…Ø±Ùˆ": "Amr", "Ø¨Ø³Ù…Ø©": "Basma", "ÙŠØ§Ø³Ù…ÙŠÙ†": "Yasmin", "Ø²ÙŠÙ†Ø©": "Zeina", "Ø³ÙŠÙ„ÙÙŠØ§": "Silvia", "Ø­Ø³ÙŠÙ†": "Hussien", "Ø£Ø¨Ø§Ù†ÙˆØ¨": "Abanob", "ØªØ§Ù…Ø±": "Tamer", "ØµØ¨Ø­ÙŠ": "Sobhy", "Ø³Ø§Ù„ÙŠ": "Sally", "Ø¹Ù„Ø§Ø¡": "Alaa", "Ù…ÙŠØ±Ù‡Ø§Ù†": "Merhan", "Ø®Ø§Ù„Ø¯": "Khaled", "Ù…ØµØ·ÙÙ‰": "Moustafa", "Ù‡Ø¨Ø© Ø§Ù„Ù„Ù‡": "Heba-tallah", "Ù„Ø¨Ù†Ù‰": "Lubna", "Ø¥Ø¨Ø±Ø§Ù‡ÙŠÙ…": "Ibrahim", "Ø³Ø§Ø±Ø©": "Sarah", "Ù…ÙŠØ§Ø±": "Mayar", "Ù‡Ø¯ÙŠØ±": "Hadeer", "Ù‡Ø§Ù„Ø©": "Halah", "Ù…Ø­Ù…ÙˆØ¯": "Mahmoud", "ÙŠØ§Ø±Ø§": "Yara", "ÙŠÙ…Ù†Ù‰": "Yomna", "Ø±ÙŠÙ…ÙˆÙ†": "Remon", "Ù‡Ø¨Ø©": "Heba", "Ø£Ù…ÙŠØ±Ø©": "Amira", "Ù…Ø¹ØªØµÙ…": "Moataseem", "Ù†Ø§Ø¯Ø±": "Nader", "Ø¥Ø³Ù„Ø§Ù…": "Islam", "Ø¬ÙŠÙ„Ø§Ù†": "Jilan", "Ø³Ù„Ø³Ø¨ÙŠÙ„": "Salsabil", "Ù…Ù‡Ù†Ø¯": "Mohannad", "Ø¬Ø§Ø³Ø±": "Gasser", "Ø³Ù‡ÙŠÙ„Ø©": "Sohaila", "Ø¬ÙŠÙ‡Ø§Ù†": "Gehan", "Ø¬Ù‡Ø§Ø¯": "Gehad", "Ø£Ù…ÙŠÙ†Ø©": "Amina", "Ø¹Ø¨Ø¯ Ø§Ù„ÙˆÙ‡Ø§Ø¨": "Abd El-Wahab", "Ø±Ø§Ù…ÙŠ": "Ramy", "Ø´ÙŠÙ…Ø§Ø¡": "Shaimaa", "Ø¹Ù„ÙŠ": "Ali", "Ù…Ø¬Ø¯ÙŠ": "Magdy", "Ø¹Ø§Ø¯Ù„": "Adel", "ÙØ§Ø±ÙˆÙ‚": "Farouk", "Ø¯Ø¹Ø§Ø¡": "Doaa", "Ø¯Ø§Ø±ÙŠÙ†": "Dareen", "Ø¯Ø§Ù„ÙŠØ§": "Dalia", "Ø¹Ø¨Ø¯ Ø§Ù„Ø±Ø­Ù…Ù†": "Abdelrahman", "Ø¬Ù†Ù‰": "Jana"
    };

    const daysMapAr = { 'Saturday': 'Ø§Ù„Ø³Ø¨Øª', 'Sunday': 'Ø§Ù„Ø£Ø­Ø¯', 'Monday': 'Ø§Ù„Ø§Ø«Ù†ÙŠÙ†', 'Tuesday': 'Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡', 'Wednesday': 'Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡', 'Thursday': 'Ø§Ù„Ø®Ù…ÙŠØ³', 'Friday': 'Ø§Ù„Ø¬Ù…Ø¹Ø©' };
    const daysMapEn = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];

    // 1. ØªØ¹Ø±ÙŠÙ Ø§Ù„Ø£Ù‚Ø³Ø§Ù…
    const departments = {
        'dean': { name: 'Ù…ÙƒØªØ¨ Ø§Ù„Ø¹Ù…ÙŠØ¯', priority: 1, color: 'dean-priority' },
        'transport-logistics': { name: 'Ù‚Ø³Ù… Ø¥Ø¯Ø§Ø±Ø© Ù„ÙˆØ¬Ø³ØªÙŠØ§Øª Ø§Ù„Ù†Ù‚Ù„', priority: 3, color: 'department-priority' },
        'trade-logistics': { name: 'Ù‚Ø³Ù… Ø¥Ø¯Ø§Ø±Ø© Ù„ÙˆØ¬Ø³ØªÙŠØ§Øª Ø§Ù„ØªØ¬Ø§Ø±Ø© Ø§Ù„Ø¯ÙˆÙ„ÙŠØ©', priority: 3, color: 'department-priority' },
        'supply-chain': { name: 'Ù‚Ø³Ù… Ø¥Ø¯Ø§Ø±Ø© Ù„ÙˆØ¬Ø³ØªÙŠØ§Øª Ø³Ù„Ø§Ø³Ù„ Ø§Ù„Ø¥Ù…Ø¯Ø§Ø¯', priority: 3, color: 'department-priority' },
        'energy-logistics': { name: 'Ù‚Ø³Ù… Ø¥Ø¯Ø§Ø±Ø© Ù„ÙˆØ¬Ø³ØªÙŠØ§Øª Ø§Ù„Ø·Ø§Ù‚Ø© ÙˆØ§Ù„Ø¨ØªØ±ÙˆÙ„', priority: 3, color: 'department-priority' },
        'admin-followup': { name: 'Ù‚Ø³Ù… Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±ÙŠØ©', priority: 3, color: 'department-priority' },
        'training-agency': { name: 'ÙˆÙƒØ§Ù„Ø© Ø´Ø¤ÙˆÙ† Ø§Ù„ØªØ¯Ø±ÙŠØ¨ ÙˆØ®Ø¯Ù…Ø© Ø§Ù„Ù…Ø¬ØªÙ…Ø¹', priority: 2, color: 'vice-dean-priority' },
        'postgrad-agency': { name: 'ÙˆÙƒØ§Ù„Ø© Ø§Ù„Ø¯Ø±Ø§Ø³Ø§Øª Ø§Ù„Ø¹Ù„ÙŠØ§ ÙˆØ§Ù„Ø¨Ø­Ø« Ø§Ù„Ø¹Ù„Ù…ÙŠ', priority: 2, color: 'vice-dean-priority' },
        'education-agency': { name: 'ÙˆÙƒØ§Ù„Ø© Ø´Ø¤ÙˆÙ† Ø§Ù„ØªØ¹Ù„ÙŠÙ…', priority: 2, color: 'vice-dean-priority' },
        'students-agency': { name: 'ÙˆÙƒØ§Ù„Ø© Ø´Ø¤ÙˆÙ† Ø§Ù„Ø·Ù„Ø§Ø¨', priority: 2, color: 'vice-dean-priority' },
        'assistants-office': { name: 'Ù…ÙƒØªØ¨ Ø§Ù„Ù…Ø¹ÙŠØ¯ÙŠÙ†', priority: 4, color: 'assistant-priority' },
        'visitor': { name: 'Ø²Ø§Ø¦Ø± Ø®Ø§Ø±Ø¬ÙŠ', priority: 5, color: 'bg-gray-500 text-white' },
        'computer-lab': { name: 'Ù…Ø¹Ù…Ù„ Ø§Ù„Ø­Ø§Ø³Ø¨', priority: 3, color: 'department-priority' },
    };

// ============================================================
// ğŸ”¥ Ø¯Ø§Ù„Ø© Ø§Ù„ØªØ´ØºÙŠÙ„ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© (ØªØ·Ø§Ø¨Ù‚ smrm.html ØªÙ…Ø§Ù…Ø§Ù‹) ğŸ”¥
// ============================================================
document.addEventListener('DOMContentLoaded', async () => {
    
    if (typeof window.showLoader === 'function') window.showLoader('Ø¬Ø§Ø±ÙŠ ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù†Ø¸Ø§Ù…...');

    try {
        const savedUser = localStorage.getItem('currentUser');
        if (savedUser) {
            const user = JSON.parse(savedUser);
            
            // ğŸ”¥ Ø§Ù„Ø®Ø·ÙˆØ© Ø§Ù„ØªØµØ­ÙŠØ­ÙŠØ©: ØªØ¹Ø±ÙŠÙ Ø§Ù„Ù…ØªØºÙŠØ± Ø§Ù„Ø¹Ø§Ù… ÙˆØªØ´ØºÙŠÙ„ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨Ø±ÙˆÙØ§ÙŠÙ„ Ù„Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„ ÙˆØ§Ù„ÙƒÙ…Ø¨ÙŠÙˆØªØ± ğŸ”¥
            currentUser = user; 
            if (typeof updateSystemProfile === 'function') {
                updateSystemProfile(currentUser);
            }

            const nameEl = document.getElementById('profile-name');
            const roleEl = document.getElementById('profile-role');
            
            // 1. Ø¥Ø¶Ø§ÙØ© "Ù…Ø±Ø­Ø¨Ø§Ù‹ØŒ " Ù‚Ø¨Ù„ Ø§Ù„Ø§Ø³Ù… Ù„ØªØ·Ø§Ø¨Ù‚ smrm
            if (nameEl) nameEl.textContent = `Ù…Ø±Ø­Ø¨Ø§Ù‹ØŒ ${user.full_name}`;

            // 2. ØªØºÙŠÙŠØ± Ø§Ù„ÙØ§ØµÙ„ Ø¥Ù„Ù‰ "-" ÙˆØ­Ø°Ù Ø§Ù„Ù…Ø³Ø§ÙØ§Øª Ø§Ù„Ø²Ø§Ø¦Ø¯Ø© Ù„ØªØ·Ø§Ø¨Ù‚ smrm
            if (roleEl) {
                const deptName = (typeof departments !== 'undefined' && departments[user.department]) 
                                 ? departments[user.department].name 
                                 : (user.department || 'Ù…Ø³ØªØ®Ø¯Ù…');
                const userPos = user.position ? ` - ${user.position}` : '';
                roleEl.textContent = `${deptName}${userPos}`;
            }

            // Ø¥Ø¸Ù‡Ø§Ø± Ø²Ø± Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©
            const adminBtn = document.getElementById('admin-toggle-btn');
            if ((user.role === 'manager' || user.is_admin) && adminBtn) {
                adminBtn.classList.remove('hidden');
            }
        } else {
            window.location.href = '/';
            return;
        }

        // ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø£ØµÙ„ÙŠØ©
        if (typeof loadFilterOptions === 'function') await loadFilterOptions();
        if (typeof refreshCache === 'function') await refreshCache();
        if (typeof setupCustomDropdowns === 'function') setupCustomDropdowns(); 

    } catch (error) {
        console.error("Error initializing:", error);
    } finally {
        if (typeof window.hideLoader === 'function') window.hideLoader();
    }
});

// ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ Ø§Ù„Ù…Ø¨Ø§Ø´Ø± Ø¨Ø¯ÙˆÙ† Ø±Ø³Ø§Ø¦Ù„ ØªØ£ÙƒÙŠØ¯ (Ù…Ø«Ù„ smrm)
function handleLogout() {
    localStorage.removeItem('currentUser');
    window.location.href = '/';
}

        async function refreshCache() {
            const { data } = await supabase.from('academic_schedule').select('*');
            if(data) cachedData = data;
        }
       
        // --- 3. Ø§Ù„Ø¨Ø­Ø« Ø§Ù„Ø°ÙƒÙŠ Ø§Ù„Ù…ØªØ·ÙˆØ± ---
        function normalizeArabic(text) {
            if (!text) return "";
            return text
                .replace(/(Ø¢|Ø¥|Ø£)/g, 'Ø§')
                .replace(/Ø©/g, 'Ù‡')
                .replace(/Ù‰/g, 'ÙŠ')
                .replace(/[\u064B-\u065F\u0640]/g, '')
                .toLowerCase()
                .trim();
        }

        document.getElementById('smart-search').addEventListener('input', (e) => {
            clearTimeout(searchTimeout);
            const query = e.target.value;
            const aiArea = document.getElementById('ai-response-area');
            
            if (query.length < 2) {
                aiArea.classList.add('hidden');
                if(query.length === 0) resetView();
                return;
            }

            document.getElementById('smart-search').parentElement.classList.add('ai-pulse');

            searchTimeout = setTimeout(() => {
                processAIQuery(query);
                document.getElementById('smart-search').parentElement.classList.remove('ai-pulse');
            }, 600);
        });

// ============================================================
// Ø¯Ø§Ù„Ø© processAIQuery Ø§Ù„Ù…ÙØ¹Ø¯Ù‘ÙÙ„Ø© (Ø§Ù„ØªØ£Ø³ÙŠØ³ Ø§Ù„Ø§Ø­ØªØ±Ø§ÙÙŠ Ù„Ø¯Ù‚Ø© Ø§Ù„Ø¨Ø­Ø«)
// ============================================================
async function processAIQuery(query) {
    const aiArea = document.getElementById('ai-response-area');
    const aiText = document.getElementById('ai-response-text');
    
    // 1. Ø§Ù„ØªØ¬Ù‡ÙŠØ² ÙˆØ§Ù„ØªØ±Ø¬Ù…Ø© Ø§Ù„Ù…Ø¨Ø¯Ø¦ÙŠØ©
    let mappedQuery = normalizeArabic(query);
    
    // ğŸ”¥ğŸ”¥ Ø£. Ù…Ù†Ø·Ù‚ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ù‚Ø§Ø¹Ø§Øª ÙˆØ§Ù„Ø£Ø±Ù‚Ø§Ù… ÙˆØ§Ù„Ø§Ø®ØªØµØ§Ø±Ø§Øª ğŸ”¥ğŸ”¥
    // Ù†Ø³ØªØ®Ø¯Ù… ØªØ¹Ø§Ø¨ÙŠØ± Ù…Ù†ØªØ¸Ù…Ø© Ù„Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ø£Ø±Ù‚Ø§Ù… Ø£Ùˆ Ø§Ø®ØªØµØ§Ø±Ø§Øª Ø§Ù„Ù‚Ø§Ø¹Ø§Øª Ø§Ù„ÙƒØ¨ÙŠØ±Ø© (002, LAP, IMO)
    const roomMatch = query.match(/(\d{3})|(\d{1,2})|(\bLAP\b|\bIMO\b)/i);
    
    if (roomMatch) {
        // Ù†Ø£Ø®Ø° Ø§Ù„ØªØ·Ø§Ø¨Ù‚ Ø§Ù„Ø£ÙˆÙ„ ÙˆÙ†Ø­ÙˆÙ„Ù‡ Ù„Ø­Ø±ÙˆÙ ÙƒØ¨ÙŠØ±Ø© Ù„Ø²ÙŠØ§Ø¯Ø© Ø§Ø­ØªÙ…Ø§Ù„ÙŠØ© Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„ÙŠÙ‡ ÙÙŠ room_name
        mappedQuery = roomMatch[0].toUpperCase().replace("Ù‚Ø§Ø¹Ø©", "").trim();
    } else if (mappedQuery.includes("Ù„Ø§Ø¨")) {
        // Ø¥Ø°Ø§ Ø¨Ø­Ø« Ø¨Ø§Ù„Ø¹Ø±Ø¨ÙŠ "Ù„Ø§Ø¨"
        mappedQuery = "LAP";
    }

    // ğŸ”¥ğŸ”¥ Ø¨. Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ù„ØªØ±Ø¬Ù…Ø© (Ù„Ù„Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„Ù‚ØµÙŠØ±Ø© ÙˆØ§Ù„Ø¹Ø±Ø¨ÙŠØ©) ğŸ”¥ğŸ”¥
    for (const [arabicName, englishName] of Object.entries(nameDictionary)) {
        // Ù†Ø³ØªØ®Ø¯Ù… startsWith Ù„Ø²ÙŠØ§Ø¯Ø© Ø§Ø­ØªÙ…Ø§Ù„ÙŠØ© Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ø³Ù… Ù‚ØµÙŠØ± (Ù…Ø«Ù„ Ù†)
        if (mappedQuery.startsWith(arabicName) || mappedQuery.includes(arabicName)) {
            mappedQuery = englishName; 
            break; 
        }
    }
    // --------------------------------------------------

    // 2. Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Fuse.js Ø§Ù„Ø§Ø­ØªØ±Ø§ÙÙŠØ©
    const fuseOptions = {
        // ğŸ”¥ Ø²ÙŠØ§Ø¯Ø© Ø§Ù„Ø£ÙˆØ²Ø§Ù† Ù„Ù„Ø¹Ù†Ø§ØµØ± Ø§Ù„Ù…ÙØªØ§Ø­ÙŠØ© Ù„Ù€ (Ø§Ù„Ù…Ø­Ø§Ø¶Ø± ÙˆØ§Ù„Ù‚Ø§Ø¹Ø©)
        keys: [
            { name: 'instructor', weight: 15 }, // Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ© Ø§Ù„Ù‚ØµÙˆÙ‰
            { name: 'room_name', weight: 10 },   // Ø£ÙˆÙ„ÙˆÙŠØ© Ø¹Ø§Ù„ÙŠØ©
            { name: 'course_name', weight: 0.3 }
        ],
        
        // ğŸ”¥ ØªÙ‚Ù„ÙŠÙ„ Ø­Ø¯ Ø§Ù„ØªØ³Ø§Ù…Ø­ Ù„Ø¯Ù‚Ø© Ø£Ø¹Ù„Ù‰
        threshold: 0.1, 
        shouldSort: true, 
        includeScore: true, 
        ignoreLocation: true, 
        distance: 100, 
        // Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† ÙƒÙ„Ù…Ø§Øª ØªØ¨Ø¯Ø£ Ø¨Ù€ Ø­Ø±ÙÙŠÙ† Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„ (Ù„Ù€ Ù† Ø£Ùˆ 00)
        minMatchCharLength: 2 
    };
    
    // 3. ØªÙ†ÙÙŠØ° Ø§Ù„Ø¨Ø­Ø«
    const fuse = new Fuse(cachedData, fuseOptions);
    const searchResults = fuse.search(mappedQuery); 
    let filteredData = searchResults.map(r => r.item);
    
    // 4. Ø¨Ø­Ø« Ø§Ø­ØªÙŠØ§Ø·ÙŠ ÙÙŠ Ø­Ø§Ù„ ÙØ´Ù„ Fuse (Ù„Ù„ØªØ·Ø§Ø¨Ù‚ Ø§Ù„Ø¹Ø±Ø¨ÙŠ Ø§Ù„Ù…Ø¨Ø§Ø´Ø±)
    if (filteredData.length === 0 && mappedQuery.length > 1) {
        const normQ = normalizeArabic(query);
        filteredData = cachedData.filter(item => 
            normalizeArabic(item.instructor).includes(normQ) ||
            normalizeArabic(item.course_name).includes(normQ) ||
            normalizeArabic(item.room_name).includes(normQ)
        );
    }

    // ğŸ”¥ğŸ”¥ 5. Ø§Ù„ØªØºÙŠÙŠØ± Ø§Ù„Ø¬ÙˆÙ‡Ø±ÙŠ: Ø¥Ø®ÙØ§Ø¡ ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ø±Ø¯ Ø§Ù„Ù„ÙØ¸ÙŠ ÙˆØ§Ù„ØªØ­ÙˆÙ„ Ù„Ù„Ø¨Ø­Ø« Ø§Ù„ÙÙˆØ±ÙŠ ğŸ”¥ğŸ”¥
    // Ù‡Ø°Ø§ ÙŠØ­Ù„ Ù…Ø´ÙƒÙ„Ø© Ø£Ù† Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯ ÙƒØ§Ù† "Ù…Ø´ Ø¹Ù…Ù„ÙŠ"
    aiArea.classList.add('hidden'); 

    if (query.length > 0) {
        // Ø¥Ø°Ø§ ÙƒØ§Ù† Ù‡Ù†Ø§Ùƒ Ø´ÙŠØ¡ Ù…ÙƒØªÙˆØ¨ØŒ Ø§Ø¹Ø±Ø¶ Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ù…ÙÙ„ØªØ±Ø©
        renderResults(filteredData);
    } else {
        // Ø¥Ø°Ø§ ÙƒØ§Ù† Ù…Ø±Ø¨Ø¹ Ø§Ù„Ø¨Ø­Ø« ÙØ§Ø±ØºØ§Ù‹ØŒ Ø¹Ø¯ Ù„Ù„Ø¹Ø±Ø¶ Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ
        resetView(); 
    }
}

        // --- Ø¯ÙˆØ§Ù„ Ù…Ø³Ø§Ø¹Ø¯Ø© Ù„Ù„Ø¹Ø±Ø¶ ---
async function loadFilterOptions() {
            const { data } = await supabase.from('academic_schedule').select('instructor, course_name, room_name');
            if (data) {
                // Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ù‚ÙˆØ§Ø¦Ù… Ø§Ù„ÙØ±ÙŠØ¯Ø©
                const instructors = [...new Set(data.map(i => i.instructor).filter(i => i))].sort();
                const courses = [...new Set(data.map(i => i.course_name).filter(i => i))].sort();
                const rooms = [...new Set(data.map(i => i.room_name).filter(i => i))].sort();
                
                // ØªØ¹Ø¨Ø¦Ø© ÙÙ„Ø§ØªØ± Ø§Ù„Ø¨Ø­Ø« (ÙƒÙ…Ø§ ÙƒØ§Ù† Ø³Ø§Ø¨Ù‚Ø§Ù‹)
                populateSelect('filter-instructor', instructors);
                populateSelect('filter-course', courses);
                populateSelect('filter-room', rooms);

                // === Ø§Ù„Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©: ØªØ¹Ø¨Ø¦Ø© Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù‚Ø§Ø¹Ø§Øª Ø¯Ø§Ø®Ù„ Ø§Ù„Ù…ÙˆØ¯Ø§Ù„ ===
                // populateSelect('input-room', rooms);
            }
        }

function populateSelect(id, items) {
    const select = document.getElementById(id);
    if (!select) return;

    // 1. Ù…Ù„Ø¡ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø®ÙÙŠØ©
    const defaultText = select.options[0].text;
    select.innerHTML = `<option value="">${defaultText}</option>`;
    items.forEach(i => select.innerHTML += `<option value="${i}">${i}</option>`);

    // 2. Ù…Ù„Ø¡ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¸Ø§Ù‡Ø±Ø©
    const dropdown = select.closest('.custom-dropdown');
    if (dropdown) {
        const ul = dropdown.querySelector('.custom-dropdown-options');
        ul.innerHTML = `<li class="custom-option px-4 py-2.5 hover:bg-blue-50 cursor-pointer text-sm text-gray-700 border-b border-gray-50 font-bold" data-value="">${defaultText}</li>`;
        
        items.forEach(i => {
            ul.innerHTML += `<li class="custom-option px-4 py-2.5 hover:bg-blue-50 cursor-pointer text-sm text-gray-700 border-b border-gray-50" data-value="${i}">${i}</li>`;
        });
    }

    // 3. Ø¥Ø¹Ø§Ø¯Ø© ØªØ´ØºÙŠÙ„ Ø§Ù„ØªÙØ§Ø¹Ù„
    if (typeof setupCustomDropdowns === 'function') setupCustomDropdowns();
}

// ============================================================
// Ø§Ù„Ø¯Ø§Ù„Ø© Ø§Ù„Ù…ÙØ¹Ø¯Ù‘ÙÙ„Ø©: applyFilters
// (ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© ÙÙ„ØªØ± timeFilter Ø§Ù„Ø°ÙŠ ÙŠØ¹Ù…Ù„ Ø¨Ø¹Ø¯ Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª)
// ============================================================
async function applyFilters() {
    
    // Ø¯Ø§Ù„Ø© Ù…Ø³Ø§Ø¹Ø¯Ø© Ù„ØªØ­ÙˆÙŠÙ„ Ø§Ù„ÙˆÙ‚Øª Ø¥Ù„Ù‰ Ø¯Ù‚Ø§Ø¦Ù‚ Ù„Ù„Ù…Ù‚Ø§Ø±Ù†Ø©
    const timeToMinutes = (time) => {
        if (!time || typeof time !== 'string' || !time.includes(':')) return 0;
        try {
            const [hours, minutes] = time.split(':').map(Number);
            return hours * 60 + minutes;
        } catch (e) {
            return 0;
        }
    };
    
    // 1. Ø¬Ù„Ø¨ Ø§Ù„Ù‚ÙŠÙ… Ø§Ù„Ø­Ø§Ù„ÙŠØ©
    const day = document.getElementById('filter-day').value;
    const instructor = document.getElementById('filter-instructor').value;
    const course = document.getElementById('filter-course').value;
    const room = document.getElementById('filter-room').value;
    
    // ğŸ”¥ Ø¬Ø¯ÙŠØ¯: Ù‚Ø±Ø§Ø¡Ø© Ù‚ÙŠÙ…Ø© ÙÙ„ØªØ± Ø§Ù„ØªÙˆÙ‚ÙŠØª
    const timeFilter = document.getElementById('filter-time') ? document.getElementById('filter-time').value : '';
    const container = document.getElementById('results-grid');

    // 2. Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø§Ø®ØªÙŠØ§Ø±
    if (!day && !instructor && !course && !room && !timeFilter) { 
        // ... (Ø±Ø³Ø§Ù„Ø© Ø§Ù„ØªØ­Ø°ÙŠØ± - ÙƒÙ…Ø§ Ù‡ÙŠ) ...
        document.getElementById('results-count').innerText = '0 Ù†ØªÙŠØ¬Ø©';
        container.innerHTML = `
            <div class="col-span-full bg-amber-50 border-r-4 border-[#F3A628] p-6 rounded-lg shadow-sm flex items-start gap-4 animate-pulse">
                <div class="bg-white p-2 rounded-full shadow-sm text-[#F3A628]">
                    <i class="fas fa-exclamation-triangle text-2xl"></i>
                </div>
                <div>
                    <h4 class="text-lg font-bold text-[#2A3475] mb-1">Ø¹ÙÙˆØ§Ù‹ØŒ ÙŠØ¬Ø¨ ØªØ­Ø¯ÙŠØ¯ Ù…Ø¹ÙŠØ§Ø± Ù„Ù„Ø¨Ø­Ø«!</h4>
                    <p class="text-gray-600 text-sm">ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± (ÙŠÙˆÙ…ØŒ Ù…Ø­Ø§Ø¶Ø±ØŒ Ù…Ø§Ø¯Ø©ØŒ Ø£Ùˆ Ù‚Ø§Ø¹Ø©) Ù…Ù† Ø§Ù„Ù‚ÙˆØ§Ø¦Ù… Ø£Ø¹Ù„Ø§Ù‡ Ù„Ø¹Ø±Ø¶ Ø§Ù„Ù†ØªØ§Ø¦Ø¬.</p>
                </div>
            </div>
        `;
        return; 
    }

    showLoading(true);

    // 3. Ø¨Ù†Ø§Ø¡ Ø§Ù„Ø§Ø³ØªØ¹Ù„Ø§Ù… Ø¹Ù„Ù‰ Ø§Ù„Ø³ÙŠØ±ÙØ± (Ø¨Ø¯ÙˆÙ† Ø§Ù„ØªÙˆÙ‚ÙŠØª)
    let query = supabase.from('academic_schedule').select('*');
    if(day) query = query.eq('day_of_week', day);
    if(instructor) query = query.eq('instructor', instructor);
    if(course) query = query.eq('course_name', course);
    if(room) query = query.eq('room_name', room);

    query = query.order('period_order', { ascending: true });

    const { data, error } = await query;
    if (error) console.error(error);
    
    let filteredData = data || [];

    // 4. ğŸ”¥ Ø¬Ø¯ÙŠØ¯: ÙÙ„ØªØ±Ø© Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ø¨Ø¹Ø¯ Ø§Ù„Ø¬Ù„Ø¨ Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„ØªÙˆÙ‚ÙŠØª (Ø¨Ø±Ù…Ø¬ÙŠØ§Ù‹)
    if (timeFilter) {
        const filterMinutes = timeToMinutes(timeFilter);
        
        filteredData = filteredData.filter(item => {
            // Ù†Ø£Ø®Ø° ÙˆÙ‚Øª Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø© Ù„Ù„Ù…Ù‚Ø§Ø±Ù†Ø© (Ù…Ù‡Ù… Ø¬Ø¯Ø§Ù‹ Ø§Ø³ØªØ®Ø¯Ø§Ù… split(' - ')[0])
            const lectureStartTime = (item.time_slot || "").split(' - ')[0]; 
            const lectureMinutes = timeToMinutes(lectureStartTime);
            
            // Ø´Ø±Ø· Ø§Ù„ÙÙ„ØªØ±Ø©: ÙˆÙ‚Øª Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø© (Ø¨Ø¯Ø§ÙŠØ©) Ø£ÙƒØ¨Ø± Ù…Ù† Ø£Ùˆ ÙŠØ³Ø§ÙˆÙŠ ÙˆÙ‚Øª Ø§Ù„ÙÙ„ØªØ±
            return lectureMinutes >= filterMinutes;
        });
    }
    // -----------------------------------------------------------------

    renderResults(filteredData);
    showLoading(false);
}
// ============================================================

// ============================================================
// Ø¯Ø§Ù„Ø© Ø¹Ø±Ø¶ Ø§Ù„ÙƒØ±ÙˆØª (Ù…Ø¹ Ø¥Ø¬Ø¨Ø§Ø± Ø§Ù„ØªÙˆÙ‚ÙŠØªØ§Øª Ø§Ù„Ø±Ø³Ù…ÙŠØ© Ø§Ù„Ù…Ø²Ø¯ÙˆØ¬Ø© ğŸ•’) - Ù†Ø³Ø®Ø© Ù…Ø­Ø³Ù†Ø© Ù„Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„
// ============================================================
function renderResults(data) {
    const container = document.getElementById('results-grid');
    document.getElementById('results-count').innerText = `${data.length} Ù†ØªÙŠØ¬Ø©`;
    container.innerHTML = '';

    const getNextDate = (dayNameEn) => {
        const days = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];
        const targetIndex = days.indexOf(dayNameEn);
        if (targetIndex === -1) return '';
        const today = new Date();
        const currentDayIndex = today.getDay();
        let daysUntil = targetIndex - currentDayIndex;
        if (daysUntil < 0) daysUntil += 7;
        const targetDate = new Date(today);
        targetDate.setDate(today.getDate() + daysUntil);
        return targetDate.toLocaleDateString('en-GB', { day: 'numeric', month: 'numeric' });
    };

    // ğŸ”¥ Ø§Ù„Ù…ØªØ±Ø¬Ù… Ø§Ù„Ø°ÙƒÙŠ Ù„Ù„ØªÙˆÙ‚ÙŠØªØ§Øª (ÙŠØ­ÙˆÙ„ Ø§Ù„Ù‚Ø¯ÙŠÙ… Ù„Ù„Ø¬Ø¯ÙŠØ¯ Ø§Ù„Ù…Ø²Ø¯ÙˆØ¬) ğŸ”¥
    const formatTimeDisplay = (time) => {
        if (!time) return "ØºÙŠØ± Ù…Ø­Ø¯Ø¯";
        
        const t = time.trim(); // ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ù…Ø³Ø§ÙØ§Øª

        // 1. Ø§Ù„ÙØªØ±Ø© Ø§Ù„ØµØ¨Ø§Ø­ÙŠØ© Ø§Ù„Ø£ÙˆÙ„Ù‰ (08:30 - 10:20)
        if (t.startsWith("08:30") || t.startsWith("8:30")) return "08:30 - 10:20";

        // 2. Ø§Ù„ÙØªØ±Ø© Ø§Ù„ØµØ¨Ø§Ø­ÙŠØ© Ø§Ù„Ø«Ø§Ù†ÙŠØ© (10:30 - 12:20)
        if (t.startsWith("10:30")) return "10:30 - 12:20";

        // 3. ÙØªØ±Ø© Ø§Ù„Ø¸Ù‡ÙŠØ±Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰ (12:30 - 02:20)
        if (t.startsWith("12:30")) return "12:30 - 02:20";

        // 4. ÙØªØ±Ø© Ø§Ù„Ø¸Ù‡ÙŠØ±Ø© Ø§Ù„Ø«Ø§Ù†ÙŠØ© (02:30 - 04:20)
        if (t.startsWith("02:30") || t.startsWith("14:30")) return "02:30 - 04:20";

        // 5. Ø§Ù„ÙØªØ±Ø© Ø§Ù„Ù…Ø³Ø§Ø¦ÙŠØ© (04:30 - 06:20)
        if (t.startsWith("04:30") || t.startsWith("16:30")) return "04:30 - 06:20";

        // Ù„Ùˆ ÙˆÙ‚Øª Ù…Ø®ØªÙ„Ù Ø¹Ù† Ø¯ÙˆÙ„ØŒ Ø¨Ù†Ø­Ø§ÙˆÙ„ Ù†Ø¸Ø¨Ø·Ù‡ 12 Ø³Ø§Ø¹Ø© Ø¨Ø³
        return t
            .replace("13:", "01:")
            .replace("14:", "02:")
            .replace("15:", "03:")
            .replace("16:", "04:")
            .replace("17:", "05:")
            .replace("18:", "06:");
    };

    if (data.length === 0) {
        container.innerHTML = `<div class="col-span-full text-center py-20 flex flex-col items-center justify-center text-gray-400 bg-white rounded-3xl border-2 border-dashed border-gray-200"><i class="fas fa-search text-6xl mb-4 opacity-20"></i><p class="font-bold text-lg">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬ Ù…Ø·Ø§Ø¨Ù‚Ø© Ù„Ù„Ø¨Ø­Ø«</p></div>`;
        return;
    }

    data.forEach(item => {
        const dateStr = getNextDate(item.day_of_week);
        const displayTime = formatTimeDisplay(item.time_slot);

        // ==========================================================
        // ğŸ”¥ Ù‡Ù†Ø§ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„: HTML Ø§Ù„ÙƒØ§Ø±Øª Ù…ØªØ¬Ø§ÙˆØ¨ Ù„Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„ ÙˆØ§Ù„ÙƒÙ…Ø¨ÙŠÙˆØªØ± ğŸ”¥
        // ==========================================================
        const cardHTML = `
        <div onclick="handleCardClick('${item.id}')" class="schedule-card relative bg-white rounded-xl md:rounded-2xl shadow-sm hover:shadow-xl transition-all duration-300 overflow-hidden group border border-gray-100 cursor-pointer hover:-translate-y-1 h-full flex flex-col">
            
            <div class="absolute top-0 right-0 w-16 h-16 md:w-24 md:h-24 bg-[#F3A628]/10 rounded-bl-[60px] md:rounded-bl-[100px] -mr-4 -mt-4 transition-transform group-hover:scale-150 duration-500 pointer-events-none"></div>
            
            <div class="p-4 md:p-6 relative z-10 pointer-events-none flex flex-col h-full">
                
                <div class="flex justify-between items-start mb-3 md:mb-4 pb-3 border-b border-gray-50">
                    <div class="flex flex-col">
                        <span class="text-[9px] md:text-[11px] text-gray-400 font-bold uppercase tracking-wider mb-0.5 md:mb-1">Ø§Ù„ÙŠÙˆÙ… ÙˆØ§Ù„ØªØ§Ø±ÙŠØ®</span>
                        <div class="flex items-center gap-1.5 md:gap-2">
                            <span class="text-sm md:text-base font-black text-[#2A3475]">
                                ${daysMapAr[item.day_of_week] || item.day_of_week}
                            </span>
                            <span class="text-[10px] md:text-xs font-bold text-[#F3A628] bg-[#F3A628]/10 px-1.5 py-0.5 md:px-2 md:py-0.5 rounded-md">
                                ${dateStr}
                            </span>
                        </div>
                    </div>
                    
                    <div class="bg-gray-50 border border-gray-100 px-2 py-1 md:px-3 md:py-1.5 rounded-lg flex flex-col items-end gap-0.5 shadow-sm group-hover:bg-[#2A3475] group-hover:text-white transition-colors duration-300 min-w-[90px] md:min-w-[100px] text-left">
                        <div class="flex items-center gap-1.5 md:gap-2">
                            <i class="far fa-clock text-[10px] md:text-xs text-[#F3A628]"></i>
                            <span class="text-xs md:text-sm font-bold" dir="ltr">${displayTime}</span>
                        </div>
                    </div>
                </div>
                
                <h3 class="text-sm md:text-lg font-black text-gray-800 leading-snug mb-3 min-h-[2.5rem] md:min-h-[3rem] line-clamp-2 group-hover:text-[#2A3475] transition-colors flex-grow">
                    ${item.course_name}
                </h3>
                
                <div class="h-px w-full bg-gradient-to-r from-transparent via-gray-200 to-transparent mb-3 md:mb-4"></div>

                <div class="space-y-3 md:space-y-4 mt-auto">
                    <div class="flex items-center gap-2 md:gap-3">
                        <div class="w-8 h-8 md:w-10 md:h-10 rounded-full bg-blue-50 flex items-center justify-center text-[#2A3475] shrink-0">
                            <i class="fas fa-chalkboard-teacher text-sm md:text-lg"></i>
                        </div>
                        <div class="flex flex-col min-w-0">
                            <span class="text-[9px] md:text-xs text-gray-500 font-bold">Ø§Ù„Ù…Ø­Ø§Ø¶Ø±</span>
                            <span class="text-xs md:text-base font-bold text-gray-800 truncate max-w-[150px] md:max-w-[200px]">${item.instructor}</span>
                        </div>
                    </div>

                    <div class="flex items-center gap-2 md:gap-3">
                        <div class="w-8 h-8 md:w-10 md:h-10 rounded-full bg-[#F3A628]/20 flex items-center justify-center text-[#d48a1b] shrink-0">
                            <i class="fas fa-map-marker-alt text-sm md:text-lg"></i>
                        </div>
                        <div class="flex flex-col min-w-0">
                            <span class="text-[9px] md:text-xs text-gray-500 font-bold">Ø§Ù„Ù‚Ø§Ø¹Ø©</span>
                            <span class="text-xs md:text-base font-black text-[#2A3475] bg-gray-50 px-2 py-0.5 md:px-3 md:py-0.5 rounded border border-gray-100 w-fit">
                                ${item.room_name}
                            </span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        `;
        container.innerHTML += cardHTML;
    });
}

        function showLoading(show) {
            const spinner = document.getElementById('loading-spinner');
            const grid = document.getElementById('results-grid');
            if(show) {
                spinner.classList.remove('hidden');
                grid.classList.add('opacity-50');
            } else {
                spinner.classList.add('hidden');
                grid.classList.remove('opacity-50');
            }
        }

function resetFilters() {
            // 1. ØªØµÙÙŠØ± Ø§Ù„Ù‚ÙˆØ§Ø¦Ù…
            document.querySelectorAll('select').forEach(s => s.value = '');
            
            // 2. Ø¥Ø±Ø¬Ø§Ø¹ Ø§Ù„Ø´ÙƒÙ„ Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ (Ù†ÙØ³ Ø§Ù„Ø´ÙƒÙ„ Ø¹Ù†Ø¯ ÙØªØ­ Ø§Ù„ØµÙØ­Ø©)
            document.getElementById('results-grid').innerHTML = `
                <div class="col-span-full text-center py-24 flex flex-col items-center justify-center text-gray-400">
                    <div class="bg-gray-50 p-6 rounded-full mb-4 shadow-inner">
                        <i class="fas fa-layer-group text-5xl opacity-30 text-[#2A3475]"></i>
                    </div>
                    <p class="font-bold text-lg text-gray-500">Ù„Ù… ÙŠØªÙ… ØªØ­Ø¯ÙŠØ¯ Ù…Ø¹Ø§ÙŠÙŠØ± Ø§Ù„Ø¹Ø±Ø¶</p>
                    <p class="text-sm text-gray-400 mt-2">Ø§Ø³ØªØ®Ø¯Ù… Ø£Ø¯ÙˆØ§Øª Ø§Ù„ØªØµÙÙŠØ© Ø¨Ø§Ù„Ø£Ø¹Ù„Ù‰ Ù„Ù„Ø¨Ø¯Ø¡</p>
                </div>
            `;

            // 3. ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ø¨Ø­Ø« Ø§Ù„Ø°ÙƒÙŠ
            document.getElementById('ai-response-area').classList.add('hidden');
            document.getElementById('smart-search').value = '';
            
            // 4. ØªØµÙÙŠØ± Ø§Ù„Ø¹Ø¯Ø§Ø¯
            document.getElementById('results-count').innerText = '0 Ù†ØªÙŠØ¬Ø©';
        }

        // Ø¯Ø§Ù„Ø© ØªØ´ØºÙŠÙ„ Ø§Ù„Ù‚ÙˆØ§Ø¦Ù… Ø§Ù„Ù…Ù†Ø³Ø¯Ù„Ø©
        function setupCustomDropdowns() {
            document.querySelectorAll('.custom-dropdown-display').forEach(display => {
                // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ù…Ø³ØªÙ…Ø¹ÙŠÙ† Ø§Ù„Ù‚Ø¯Ø§Ù…Ù‰ (Ù„Ø¶Ù…Ø§Ù† Ø¹Ø¯Ù… Ø§Ù„ØªÙƒØ±Ø§Ø±)
                const newDisplay = display.cloneNode(true);
                display.parentNode.replaceChild(newDisplay, display);

                newDisplay.addEventListener('click', (e) => {
                    e.stopPropagation();
                    const dropdown = newDisplay.closest('.custom-dropdown');
                    const options = dropdown.querySelector('.custom-dropdown-options');
                    document.querySelectorAll('.custom-dropdown-options').forEach(opt => {
                        if(opt !== options) opt.classList.remove('show');
                    });
                    options.classList.toggle('show');
                    
                    // ØªØ¯ÙˆÙŠØ± Ø§Ù„Ø³Ù‡Ù…
                    const arrow = newDisplay.querySelector('.fa-chevron-down');
                    if(arrow) arrow.style.transform = options.classList.contains('show') ? 'rotate(180deg)' : 'rotate(0deg)';
                });
            });

            document.querySelectorAll('.custom-option').forEach(option => {
                option.addEventListener('click', function() {
                    const dropdown = this.closest('.custom-dropdown');
                    const hiddenSelect = dropdown.querySelector('select');
                    const displayText = dropdown.querySelector('.custom-dropdown-display span');
                    
                    // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø´ÙƒÙ„
                    displayText.textContent = this.innerText;
                    
                    // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù‚ÙŠÙ…Ø© ÙˆØªØ´ØºÙŠÙ„ Ø§Ù„ÙÙ„ØªØ±
                    hiddenSelect.value = this.dataset.value;
                    hiddenSelect.dispatchEvent(new Event('change')); // Ù…Ù‡Ù… Ø¬Ø¯Ø§Ù‹ Ø¹Ø´Ø§Ù† applyFilters ØªØ´ØªØºÙ„
                    
                    dropdown.querySelector('.custom-dropdown-options').classList.remove('show');
                });
            });

            document.addEventListener('click', () => {
                document.querySelectorAll('.custom-dropdown-options').forEach(opt => opt.classList.remove('show'));
            });
        }
        
// ============================================================
    // ğŸ”¥ ØªØ¹Ø±ÙŠÙ Ø§Ù„Ù…ØªØºÙŠØ± Ø§Ù„Ø¹Ø§Ù… (Global) Ù„Ù…Ù†Ø¹ Ø§Ù„Ø®Ø·Ø£ ğŸ”¥
    // ============================================================
    let selectedInstructors = new Set(); // ØªÙ… ØªÙˆØ­ÙŠØ¯ Ø§Ù„Ø§Ø³Ù…

    // 1. ÙØªØ­ Ø§Ù„Ù…ÙˆØ¯Ø§Ù„ ÙˆØªÙˆØ¬ÙŠÙ‡ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
    async function openMyScheduleModal() {
        const userStr = localStorage.getItem('currentUser');
        if (!userStr) {
            alert('ÙŠØ±Ø¬Ù‰ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹');
            return;
        }
        const user = JSON.parse(userStr);

        // Ù†Ø­Ø¯Ø« Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…Ù† Ø§Ù„Ø³ÙŠØ±ÙØ± Ù„Ù„ØªØ£ÙƒØ¯
        const { data: profile } = await supabase.from('profiles').select('linked_instructors').eq('id', user.id).single();
        
        const modal = document.getElementById('my-schedule-modal');
        modal.classList.remove('hidden');
        modal.classList.add('flex');

        if (profile && profile.linked_instructors && profile.linked_instructors.length > 0) {
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù„ÙˆÙƒØ§Ù„ Ø³ØªÙˆØ±ÙŠØ¬
            user.linked_instructors = profile.linked_instructors;
            localStorage.setItem('currentUser', JSON.stringify(user));
            
            showMyScheduleView(profile.linked_instructors);
        } else {
            showSetupView();
        }
    }

function closeMyScheduleModal() {
        const modal = document.getElementById('my-schedule-modal');
        modal.classList.add('hidden');
        modal.classList.remove('flex');
    }

// 2. Ø¯Ø§Ù„Ø© Ø¹Ø±Ø¶ Ø´Ø§Ø´Ø© Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯ (Setup)
    async function showSetupView() {
        document.getElementById('my-schedule-setup').classList.remove('hidden');
        document.getElementById('my-schedule-setup').classList.add('flex');
        document.getElementById('my-schedule-content').classList.add('hidden');
        
        const user = JSON.parse(localStorage.getItem('currentUser'));
        const welcomeMsg = document.getElementById('setup-welcome-msg');
        if (welcomeMsg && user) {
            welcomeMsg.textContent = `Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨ÙƒØŒ ${user.full_name || 'ÙŠØ§ Ø¨Ø·Ù„'}! ğŸ‘‹`;
        }

        const grid = document.getElementById('instructor-selection-grid');
        grid.innerHTML = '<div class="col-span-full text-center py-8 text-gray-400"><i class="fas fa-spinner fa-spin"></i> Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div>';

        const { data } = await supabase.from('academic_schedule').select('instructor');
        
        if (data) {
            const uniqueNames = [...new Set(data.map(i => i.instructor).filter(n => n && n.trim() !== ''))].sort();
            grid.innerHTML = '';
            
            // Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù…ØªØºÙŠØ± Ø§Ù„Ù…ÙˆØ­Ø¯
            selectedInstructors.clear(); 
            if(user.linked_instructors) user.linked_instructors.forEach(n => selectedInstructors.add(n));

            uniqueNames.forEach(name => {
                const isSelected = selectedInstructors.has(name);
                
                // Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ÙƒØ§Ø±Øª (Ù†ÙØ³ ØªØµÙ…ÙŠÙ… Ø§Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„ Ø§Ù„ØµØºÙŠØ± Ø§Ù„Ù„ÙŠ Ø§ØªÙÙ‚Ù†Ø§ Ø¹Ù„ÙŠÙ‡)
                const btn = document.createElement('button');
                btn.className = `instructor-card relative w-full rounded-xl border-2 transition-all duration-200 flex flex-col items-center justify-center gap-1.5 md:gap-2 group cursor-pointer h-20 md:h-28 p-2 md:p-3 ${isSelected ? 'border-[#2A3475] bg-[#2A3475]/5' : 'border-gray-100 bg-white hover:border-[#2A3475]/30 shadow-sm'}`;
                
                btn.onclick = () => toggleInstructorSelection(name, btn); // ØªÙ… ØªØµØ­ÙŠØ­ Ø§Ù„Ø§Ø³ØªØ¯Ø¹Ø§Ø¡

                btn.innerHTML = `
                    <div class="selection-check absolute top-1.5 right-1.5 md:top-2 md:right-2 w-4 h-4 md:w-5 md:h-5 rounded-full border-2 ${isSelected ? 'bg-[#2A3475] border-[#2A3475]' : 'border-gray-200'} flex items-center justify-center transition-colors">
                        ${isSelected ? '<i class="fas fa-check text-white text-[8px] md:text-[10px]"></i>' : ''}
                    </div>
                    <div class="w-7 h-7 md:w-10 md:h-10 rounded-full bg-gray-50 flex items-center justify-center text-[#2A3475] transition-transform group-hover:scale-110">
                        <i class="fas fa-user-tie text-xs md:text-lg"></i>
                    </div>
                    <span class="font-bold text-[9px] md:text-xs text-gray-700 text-center leading-tight line-clamp-2 w-full px-1">${name}</span>
                `;
                grid.appendChild(btn);
            });
            updateCountBadge();
        }
    }

// ============================================================
// 1. Ø¯Ø§Ù„Ø© Ø±Ø³Ù… Ø´Ø¨ÙƒØ© Ø§Ù„Ø£Ø³Ù…Ø§Ø¡ (Ù†Ø³Ø®Ø© Ù…Ø¶ØºÙˆØ·Ø© ÙˆØ³Ø±ÙŠØ¹Ø© Ø¬Ø¯Ø§Ù‹) ğŸš€
// ============================================================
function renderInstructorGrid(instructorsList) {
    const grid = document.getElementById('instructor-selection-grid');
    if (!grid) return;
    
    // Ø§Ø³ØªØ®Ø¯Ø§Ù… Fragment Ù„ØªØ³Ø±ÙŠØ¹ Ø§Ù„Ø£Ø¯Ø§Ø¡ ÙˆÙ…Ù†Ø¹ Ø§Ù„ØªÙ‡Ù†ÙŠØ¬
    const fragment = document.createDocumentFragment();
    grid.innerHTML = ''; 

    const uniqueList = [...new Set(instructorsList)].sort();

    uniqueList.forEach(instructor => {
        const isSelected = selectedInstructors.has(instructor);
        const btn = document.createElement('button');
        
        // ÙƒÙ„Ø§Ø³ Ø§Ù„Ø¨Ø­Ø« (Ù…Ù‡Ù… Ø¬Ø¯Ø§Ù‹ Ù„Ù„ÙÙ„ØªØ±)
        btn.classList.add('instructor-card');

        // ØªØµÙ…ÙŠÙ… ØµØºÙŠØ± Ø¬Ø¯Ø§Ù‹ (Compact)
        // h-16 Ù„Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„ØŒ h-20 Ù„Ù„ÙƒÙ…Ø¨ÙŠÙˆØªØ±
        btn.className = `instructor-card relative w-full rounded-lg border transition-all duration-150 flex flex-col items-center justify-center gap-1 cursor-pointer 
            h-16 md:h-20 p-1 
            ${isSelected 
                ? 'border-[#2A3475] bg-[#2A3475]/10' 
                : 'border-gray-100 bg-white hover:border-[#2A3475]/30'}`;
        
        btn.onclick = () => toggleInstructorSelection(instructor, btn);

        btn.innerHTML = `
            <div class="selection-check absolute top-1 right-1 w-3 h-3 md:w-4 md:h-4 rounded-full border ${isSelected ? 'bg-[#2A3475] border-[#2A3475]' : 'border-gray-200'} flex items-center justify-center transition-colors">
                ${isSelected ? '<i class="fas fa-check text-white text-[6px] md:text-[8px]"></i>' : ''}
            </div>
            
            <div class="w-5 h-5 md:w-7 md:h-7 rounded-full bg-gray-50 flex items-center justify-center text-[#2A3475]">
                <i class="fas fa-user-tie text-[10px] md:text-sm"></i>
            </div>
            
            <span class="font-bold text-[8px] md:text-[10px] text-gray-700 text-center leading-tight line-clamp-2 w-full px-0.5">
                ${instructor}
            </span>
        `;

        fragment.appendChild(btn);
    });

    grid.appendChild(fragment);
}

// ============================================================
// 3. Ø¯Ø§Ù„Ø© ØªÙØ¹ÙŠÙ„/Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø§Ø®ØªÙŠØ§Ø± (Ù…ØªÙˆØ§ÙÙ‚Ø© Ù…Ø¹ Ø§Ù„ØªØµÙ…ÙŠÙ… Ø§Ù„Ø®ÙÙŠÙ)
// ============================================================
function toggleInstructorSelection(name, btnElement) {
    const checkDiv = btnElement.querySelector('.selection-check');
    
    if (selectedInstructors.has(name)) {
        // Ø¹Ù…Ù„ÙŠØ© Ø§Ù„Ø¥Ù„ØºØ§Ø¡
        selectedInstructors.delete(name);
        
        // Ø³ØªØ§ÙŠÙ„ ØºÙŠØ± Ù…Ø®ØªØ§Ø±
        btnElement.classList.remove('border-[#2A3475]', 'bg-[#2A3475]/10', 'shadow-inner');
        btnElement.classList.add('border-gray-100', 'bg-white');
        
        checkDiv.classList.remove('bg-[#2A3475]', 'border-[#2A3475]');
        checkDiv.classList.add('border-gray-300');
        checkDiv.innerHTML = '';
        
    } else {
        // Ø¹Ù…Ù„ÙŠØ© Ø§Ù„Ø§Ø®ØªÙŠØ§Ø±
        selectedInstructors.add(name);
        
        // Ø³ØªØ§ÙŠÙ„ Ù…Ø®ØªØ§Ø±
        btnElement.classList.remove('border-gray-100', 'bg-white');
        btnElement.classList.add('border-[#2A3475]', 'bg-[#2A3475]/10', 'shadow-inner');
        
        checkDiv.classList.remove('border-gray-300');
        checkDiv.classList.add('bg-[#2A3475]', 'border-[#2A3475]');
        checkDiv.innerHTML = '<i class="fas fa-check text-white text-[10px]"></i>';
    }
    
    updateCountBadge();
}

function updateCountBadge() {
        document.getElementById('selection-count-badge').innerText = `ØªÙ… Ø§Ø®ØªÙŠØ§Ø±: ${selectedInstructors.size}`;
    }
// ============================================================
// 2. Ø¯Ø§Ù„Ø© Ø§Ù„ÙÙ„ØªØ± (Ø¨Ø­Ø«) - Ø¯ÙŠ Ø§Ù„Ù„ÙŠ ÙƒØ§Ù†Øª Ø¹Ù†Ø¯Ùƒ Ø¨Ø³ Ù…ØªØ¸Ø¨Ø·Ø©
// ============================================================
function filterInstructorGrid() {
    const input = document.getElementById('instructor-search-input');
    if (!input) return;
    
    const query = input.value.toLowerCase();
    const cards = document.querySelectorAll('.instructor-card'); // Ø§Ù„ÙƒÙ„Ø§Ø³ Ø§Ù„Ù„ÙŠ Ø¶ÙÙ†Ø§Ù‡ ÙÙˆÙ‚

    cards.forEach(card => {
        // Ø¨Ù†Ø¨Ø­Ø« Ø¬ÙˆÙ‡ Ø§Ù„Ù†Øµ Ø§Ù„Ù„ÙŠ ÙÙŠ Ø§Ù„ÙƒØ§Ø±Øª
        const text = card.innerText.toLowerCase();
        if (text.includes(query)) {
            card.style.display = 'flex';
        } else {
            card.style.display = 'none';
        }
    });
}

// ============================================================
// 4. Ø¯Ø§Ù„Ø© Ø§Ù„Ø­ÙØ¸ (ØªÙ… Ø§Ù„Ø³Ù…Ø§Ø­ Ø¨ØªØµÙÙŠØ± Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©) âœ…
// ============================================================
async function saveInstructorSelection() {
    const user = JSON.parse(localStorage.getItem('currentUser'));
    const selectedArray = Array.from(selectedInstructors);

    // ØªØºÙŠÙŠØ± Ø§Ù„Ø²Ø± Ù„ÙˆØ¶Ø¹ Ø§Ù„ØªØ­Ù…ÙŠÙ„
    const saveBtn = document.querySelector('button[onclick="saveInstructorSelection()"]');
    let originalText = '';
    if(saveBtn) {
        originalText = saveBtn.innerHTML;
        saveBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø­ÙØ¸...';
        saveBtn.disabled = true;
    }

    try {
        // ØªØ­Ø¯ÙŠØ« Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª (Ù†Ù‚Ø¨Ù„ Ø§Ù„Ù…ØµÙÙˆÙØ© Ø§Ù„ÙØ§Ø±ØºØ© [])
        const { error } = await supabase
            .from('profiles')
            .update({ linked_instructors: selectedArray })
            .eq('id', user.id);

        if (!error) {
            // ØªØ­Ø¯ÙŠØ« Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…Ø­Ù„ÙŠØ§Ù‹
            user.linked_instructors = selectedArray;
            localStorage.setItem('currentUser', JSON.stringify(user));
            
            // Ø§Ù„ØªØ¹Ø§Ù…Ù„ Ù…Ø¹ Ø§Ù„Ø°Ø§ÙƒØ±Ø© Ø§Ù„Ù…Ø¤Ù‚ØªØ©
            if(selectedArray.length > 0) {
                localStorage.setItem('my_linked_instructors', JSON.stringify(selectedArray));
                showNotification('ØªÙ… Ø­ÙØ¸ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø¨Ù†Ø¬Ø§Ø­', 'success');
            } else {
                // ğŸ”¥ Ù‡Ù†Ø§ Ø§Ù„Ø­Ù„: Ù„Ùˆ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© ÙØ§Ø¶ÙŠØ©ØŒ Ù†Ù…Ø³Ø­Ù‡Ø§ Ù…Ù† Ø§Ù„Ø°Ø§ÙƒØ±Ø© ğŸ”¥
                localStorage.removeItem('my_linked_instructors');
                showNotification('ØªÙ… ØªØµÙÙŠØ± Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø¨Ù†Ø¬Ø§Ø­', 'success');
            }

            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ø±Ø¶ ÙÙˆØ±Ø§Ù‹
            await showMyScheduleView(selectedArray);
            
        } else {
            throw error;
        }
    } catch (err) {
        console.error(err);
        showNotification('ÙØ´Ù„ Ø§Ù„Ø­ÙØ¸ØŒ Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰', 'error');
    } finally {
        // Ø¥Ø±Ø¬Ø§Ø¹ Ø§Ù„Ø²Ø± Ù„Ø­Ø§Ù„ØªÙ‡
        if(saveBtn) {
            saveBtn.innerHTML = originalText;
            saveBtn.disabled = false;
        }
    }
}

// 5. Ø¯Ø§Ù„Ø© Ø§Ù„Ø¹Ø±Ø¶ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© (Ø§Ù„ØªÙŠ Ù‚Ù…Ù†Ø§ Ø¨ØªØ¹Ø¯ÙŠÙ„Ù‡Ø§)
    async function showMyScheduleView(names) {
        // ... (Ù†ÙØ³ Ø¯Ø§Ù„Ø© showMyScheduleView Ø§Ù„Ù„ÙŠ Ø¨Ø¹ØªÙ‡Ø§Ù„Ùƒ ÙÙŠ Ø§Ù„Ø±Ø¯ Ø§Ù„Ù„ÙŠ ÙØ§ØªØŒ Ø­Ø·Ù‡Ø§ Ù‡Ù†Ø§) ...
        // Ø§Ø®ØªØµØ§Ø±Ø§Ù‹ Ù„Ù„Ù…Ø³Ø§Ø­Ø© Ù…Ø´ Ù‡ÙƒØ±Ø±Ù‡Ø§ ØªØ§Ù†ÙŠØŒ Ø§Ø³ØªØ®Ø¯Ù… Ø§Ù„Ù„ÙŠ ÙØ§ØªØªØŒ Ù‡ÙŠ Ø³Ù„ÙŠÙ…Ø© 100%
        // Ø£Ù‡Ù… Ø­Ø§Ø¬Ø© Ø¥Ù†Ù‡Ø§ Ø¨ØªÙ†Ø§Ø¯ÙŠ Ø¹Ù„Ù‰ mobileContainer Ùˆ desktopBody
        
        // --- Ø³Ø£Ø¹ÙŠØ¯ ÙƒØªØ§Ø¨Ø© Ø§Ù„Ø¬Ø²Ø¡ Ø§Ù„Ù…Ù‡Ù… Ù„Ù„ØªØ£ÙƒÙŠØ¯ ---
        let targetNames = names;
        if (!targetNames || !Array.isArray(targetNames) || targetNames.length === 0) {
            const saved = localStorage.getItem('my_linked_instructors');
            targetNames = saved ? JSON.parse(saved) : [];
        }
    if (targetNames.length > 0) localStorage.setItem('my_linked_instructors', JSON.stringify(targetNames));

    // 2. Ø§Ù„ØªØ¨Ø¯ÙŠÙ„ Ø¨ÙŠÙ† Ø§Ù„Ø´Ø§Ø´Ø§Øª
    document.getElementById('my-schedule-setup').classList.replace('flex', 'hidden');
    document.getElementById('my-schedule-content').classList.replace('hidden', 'flex');

    // 3. Ø¹Ø±Ø¶ Ø§Ù„Ø£Ø³Ù…Ø§Ø¡ (Chips)
    const chipsContainer = document.getElementById('managed-names-chips');
    if (chipsContainer) {
        chipsContainer.innerHTML = targetNames.length > 0 
            ? targetNames.map(name => `<span class="inline-flex items-center px-3 py-1.5 rounded-lg bg-[#2A3475]/5 text-[#2A3475] text-[11px] font-bold border border-[#2A3475]/10 whitespace-nowrap shadow-sm"><i class="fas fa-user-circle text-xs ml-1.5 opacity-60"></i>${name}</span>`).join('')
            : '<span class="text-xs text-gray-400 font-bold py-1">Ù„Ù… ÙŠØªÙ… Ø§Ø®ØªÙŠØ§Ø± Ø£Ø³Ù…Ø§Ø¡</span>';
    }

    // 4. Ø¥Ù…Ø³Ø§Ùƒ Ø§Ù„Ø­Ø§ÙˆÙŠØ§Øª
    const mobileContainer = document.getElementById('mobile-schedule-list');
    const desktopBody = document.getElementById('my-schedule-rows');
    const emptyMsg = document.getElementById('empty-schedule-msg');

    // Ù„ÙˆØ¯ÙŠÙ†Ø¬
    if (mobileContainer) mobileContainer.innerHTML = '<div class="text-center py-10"><i class="fas fa-spinner fa-spin text-[#2A3475] text-2xl"></i></div>';
    if (desktopBody) desktopBody.innerHTML = '<tr><td colspan="7" class="text-center py-10"><i class="fas fa-spinner fa-spin text-[#2A3475] text-2xl"></i></td></tr>';
    if (emptyMsg) emptyMsg.classList.add('hidden');

    try {
        if (targetNames.length === 0) {
            if (mobileContainer) mobileContainer.innerHTML = '';
            if (desktopBody) desktopBody.innerHTML = '';
            if (emptyMsg) emptyMsg.classList.remove('hidden');
            return;
        }

        const { data, error } = await supabase
            .from('academic_schedule')
            .select('*')
            .in('instructor', targetNames)
            .order('day_of_week', { ascending: true });

        if (error) throw error;

        // ØªÙØ±ÙŠØº Ø§Ù„Ø­Ø§ÙˆÙŠØ§Øª
        if (mobileContainer) mobileContainer.innerHTML = '';
        if (desktopBody) desktopBody.innerHTML = '';

        if (!data || data.length === 0) {
            if (emptyMsg) emptyMsg.classList.remove('hidden');
            return;
        }

        // ØªØ±ØªÙŠØ¨ Ø§Ù„Ø£ÙŠØ§Ù…
        const dayOrder = { "Saturday": 1, "Sunday": 2, "Monday": 3, "Tuesday": 4, "Wednesday": 5, "Thursday": 6, "Friday": 7 };
        data.sort((a, b) => (dayOrder[a.day_of_week] || 8) - (dayOrder[b.day_of_week] || 8));

        data.forEach((item) => {
            const nextDate = (typeof getNextDateForDay === 'function') ? getNextDateForDay(item.day_of_week) : '';
            const isCancelled = item.cancelled_dates && item.cancelled_dates.includes(nextDate);
            const isActive = !isCancelled;
            
            let displayTime = item.time_slot;
            if (typeof formatTimeDisplay === 'function') displayTime = formatTimeDisplay(item.time_slot);

            // ==========================================
            // 1. Ø§Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„ (ÙƒØ±ÙˆØª)
            // ==========================================
            if (mobileContainer) {
                const actionBtn = isActive 
                    ? `<button onclick="toggleLectureStatus('${item.id}', '${item.day_of_week}')" class="w-full mt-3 py-2.5 bg-red-50 text-red-600 border border-red-200 rounded-xl text-xs font-bold hover:bg-red-100 transition-colors flex items-center justify-center gap-2">
                         <i class="fas fa-ban"></i> Ø¥Ù„ØºØ§Ø¡ Ù‡Ø°Ø§ Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹
                       </button>`
                    : `<button onclick="toggleLectureStatus('${item.id}', '${item.day_of_week}')" class="w-full mt-3 py-2.5 bg-green-50 text-green-600 border border-green-200 rounded-xl text-xs font-bold hover:bg-green-100 transition-colors flex items-center justify-center gap-2">
                         <i class="fas fa-check"></i> ØªÙØ¹ÙŠÙ„ Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø©
                       </button>`;

                const statusBadge = isActive 
                    ? '<span class="text-green-700 bg-green-100 px-2 py-0.5 rounded text-[10px] font-bold">Ù†Ø´Ø·</span>' 
                    : '<span class="text-red-700 bg-red-100 px-2 py-0.5 rounded text-[10px] font-bold">Ù…Ù„ØºÙŠ</span>';

                const mobileCard = `
                <div class="bg-white p-4 rounded-xl border border-gray-200 shadow-sm relative">
                    <div class="flex justify-between items-start mb-2">
                        <div class="font-bold text-[#2A3475] text-sm leading-snug w-[75%]">${item.course_name}</div>
                        ${statusBadge}
                    </div>
                    <div class="text-xs text-gray-500 font-bold mb-3 flex items-center gap-1">
                        <i class="fas fa-user-tie text-[10px]"></i> ${item.instructor}
                    </div>
                    <div class="flex flex-wrap gap-2 text-[10px] font-bold">
                        <span class="bg-gray-50 px-2 py-1 rounded border border-gray-100 text-gray-700">${typeof daysMapAr !== 'undefined' ? (daysMapAr[item.day_of_week] || item.day_of_week) : item.day_of_week}</span>
                        <span class="bg-gray-50 px-2 py-1 rounded border border-gray-100 text-gray-700 dir-ltr">${displayTime}</span>
                        <span class="bg-orange-50 px-2 py-1 rounded border border-orange-100 text-orange-700">${item.room_name}</span>
                    </div>
                    ${actionBtn}
                </div>`;
                
                mobileContainer.innerHTML += mobileCard;
            }

            // ==========================================
            // 2. Ø§Ù„ÙƒÙ…Ø¨ÙŠÙˆØªØ± (Ø¬Ø¯ÙˆÙ„) - Ù‡Ù†Ø§ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ ğŸ‘‡
            // ==========================================
            if (desktopBody) {
                // ØªØ¹Ø¯ÙŠÙ„ Ù‡Ù†Ø§: Ø®Ù„ÙŠÙ†Ø§ Ø§Ù„Ù†Øµ "Ø¥Ù„ØºØ§Ø¡ Ù‡Ø°Ø§ Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹" Ø¨Ø¯Ù„Ø§Ù‹ Ù…Ù† "Ø¥Ù„ØºØ§Ø¡" ÙÙ‚Ø·
                const actionBtn = isActive 
                    ? `<button onclick="toggleLectureStatus('${item.id}', '${item.day_of_week}')" class="px-3 py-1.5 bg-red-50 text-red-600 rounded-lg border border-red-200 hover:bg-red-100 text-xs font-bold transition-colors whitespace-nowrap flex items-center justify-center gap-1 mx-auto">
                         <i class="fas fa-ban"></i> Ø¥Ù„ØºØ§Ø¡ Ù‡Ø°Ø§ Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹
                       </button>`
                    : `<button onclick="toggleLectureStatus('${item.id}', '${item.day_of_week}')" class="px-3 py-1.5 bg-green-50 text-green-600 rounded-lg border border-green-200 hover:bg-green-100 text-xs font-bold transition-colors whitespace-nowrap flex items-center justify-center gap-1 mx-auto">
                         <i class="fas fa-check"></i> ØªÙØ¹ÙŠÙ„ Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø©
                       </button>`;

                const statusBadge = isActive 
                    ? '<span class="px-2 py-1 rounded-full bg-green-100 text-green-700 text-[10px] font-bold whitespace-nowrap">Ù†Ø´Ø·</span>'
                    : '<span class="px-2 py-1 rounded-full bg-red-100 text-red-700 text-[10px] font-bold whitespace-nowrap">Ù…Ù„ØºÙŠ</span>';

                const tableRow = `
                <tr class="hover:bg-gray-50 transition-colors border-b border-gray-50 last:border-0 text-sm">
                    <td class="px-6 py-4 font-bold text-[#2A3475] whitespace-nowrap">
                        ${typeof daysMapAr !== 'undefined' ? (daysMapAr[item.day_of_week] || item.day_of_week) : item.day_of_week}
                    </td>
                <td class="px-6 py-4 font-bold text-gray-600 dir-ltr text-center whitespace-nowrap">
                        ${displayTime}
                    </td>
                    <td class="px-6 py-4 font-bold text-gray-800 truncate max-w-[200px]" title="${item.course_name}">
                        ${item.course_name}
                    </td>
                    <td class="px-6 py-4 font-bold text-gray-500 text-xs truncate max-w-[150px]">
                        ${item.instructor}
                    </td>
                    <td class="px-6 py-4 text-center whitespace-nowrap">
                        <span class="text-xs font-bold bg-[#F3A628]/10 text-[#d48a1b] px-2 py-1 rounded border border-[#F3A628]/20">
                            ${item.room_name}
                        </span>
                    </td>
                    <td class="px-6 py-4 text-center whitespace-nowrap">
                        ${statusBadge}
                    </td>
                    <td class="px-6 py-4 text-center whitespace-nowrap">
                        ${actionBtn}
                    </td>
                </tr>`;
                desktopBody.innerHTML += tableRow;
            }
        });

    } catch (err) {
        console.error(err);
        const errorMsg = '<div class="text-center text-red-500 py-10 font-bold">Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</div>';
        if (mobileContainer) mobileContainer.innerHTML = errorMsg;
        if (desktopBody) desktopBody.innerHTML = `<tr><td colspan="7">${errorMsg}</td></tr>`;
    }
}

// 5. ØªØºÙŠÙŠØ± Ø§Ù„Ø­Ø§Ù„Ø© (Ø¥Ù„ØºØ§Ø¡ / ØªÙØ¹ÙŠÙ„) - Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ø°ÙƒÙŠØ© Ø¨Ø§Ù„ØªØ§Ø±ÙŠØ®
async function toggleLectureStatus(id, dayOfWeek) {
    if (!id) return;

    // 1. Ø­Ø³Ø§Ø¨ Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…Ø³ØªÙ‡Ø¯Ù (Ø§Ù„Ù‚Ø§Ø¯Ù…)
    const targetDate = getNextDateForDay(dayOfWeek);
    if (!targetDate) {
        showNotification('ØªØ¹Ø°Ø± ØªØ­Ø¯ÙŠØ¯ ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø©', 'error');
        return;
    }

    document.body.style.cursor = 'wait';

    try {
        // 2. Ø¬Ù„Ø¨ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ© Ù„Ù„ØªÙˆØ§Ø±ÙŠØ® Ø§Ù„Ù…Ù„ØºØ§Ø©
        const { data: currentData, error: fetchError } = await supabase
            .from('academic_schedule')
            .select('cancelled_dates')
            .eq('id', id)
            .single();

        if (fetchError) throw fetchError;

        let datesArray = currentData.cancelled_dates || [];
        let isCurrentlyCancelled = datesArray.includes(targetDate);
        let msg = '';

        // 3. ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…ØµÙÙˆÙØ© (Ø¥Ø¶Ø§ÙØ© Ø£Ùˆ Ø¥Ø²Ø§Ù„Ø© Ø§Ù„ØªØ§Ø±ÙŠØ®)
        if (isCurrentlyCancelled) {
            // Ø¥Ø¹Ø§Ø¯Ø© ØªÙØ¹ÙŠÙ„ (Ø¥Ø²Ø§Ù„Ø© Ø§Ù„ØªØ§Ø±ÙŠØ® Ù…Ù† Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©)
            datesArray = datesArray.filter(d => d !== targetDate);
            msg = 'Ù‡Ù„ ØªØ±ÙŠØ¯ Ø¥Ø¹Ø§Ø¯Ø© ØªÙØ¹ÙŠÙ„ Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø© Ù„Ù‡Ø°Ø§ Ø§Ù„ØªØ§Ø±ÙŠØ®ØŸ';
        } else {
            // Ø¥Ù„ØºØ§Ø¡ (Ø¥Ø¶Ø§ÙØ© Ø§Ù„ØªØ§Ø±ÙŠØ® Ù„Ù„Ù‚Ø§Ø¦Ù…Ø©)
            datesArray.push(targetDate);
            msg = `Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø¥Ù„ØºØ§Ø¡ Ù…Ø­Ø§Ø¶Ø±Ø© ÙŠÙˆÙ… ${targetDate}ØŸ\nØ³ØªØ¹ÙˆØ¯ Ù„Ù„Ø¹Ù…Ù„ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ ÙÙŠ Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ Ø§Ù„ØªØ§Ù„ÙŠ.`;
        }

        // ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
        const isConfirmed = await showCustomConfirm(msg);
        if (!isConfirmed) {
            document.body.style.cursor = 'default';
            return;
        }

        // 4. Ø§Ù„Ø­ÙØ¸ ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        const { error: updateError } = await supabase
            .from('academic_schedule')
            .update({ cancelled_dates: datesArray })
            .eq('id', id);

        if (updateError) throw updateError;

        showNotification(
            isCurrentlyCancelled ? 'ØªÙ… Ø¥Ø¹Ø§Ø¯Ø© ØªÙØ¹ÙŠÙ„ Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø©' : 'ØªÙ… Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø© Ù„Ù‡Ø°Ø§ Ø§Ù„ÙŠÙˆÙ…',
            'success'
        );

        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¬Ø¯ÙˆÙ„
        const user = JSON.parse(localStorage.getItem('currentUser'));
        if (user && user.linked_instructors) {
            await showMyScheduleView(user.linked_instructors);
        }

    } catch (err) {
        console.error('Error:', err);
        showNotification('Ø­Ø¯Ø« Ø®Ø·Ø£: ' + err.message, 'error');
    } finally {
        document.body.style.cursor = 'default';
    }
}
        
        function resetInstructorLink() {
            showSetupView();
        }

// ============================================================
// 4. Ø¯Ø§Ù„Ø© Ø§Ù„ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø§Ø­ØªØ±Ø§ÙÙŠØ© (Ù†Ø³Ø®Ø© Ø§Ù„Ø¥Ø¬Ø¨Ø§Ø± - ØªØ¸Ù‡Ø± ÙÙˆÙ‚ ÙƒÙ„ Ø´ÙŠØ¡)
// ============================================================
function showCustomConfirm(message) {
    return new Promise((resolve) => {
        // 1. ØªÙ†Ø¸ÙŠÙ Ø£ÙŠ Ù†Ø§ÙØ°Ø© Ù‚Ø¯ÙŠÙ…Ø© Ø¹Ø§Ù„Ù‚Ø©
        const oldModal = document.getElementById('custom-confirm-modal');
        if (oldModal) oldModal.remove();

        // 2. Ø¨Ù†Ø§Ø¡ Ø§Ù„Ù†Ø§ÙØ°Ø© Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ§Ù‹ Ù…Ø¹ Z-Index Ø£Ø¹Ù„Ù‰ Ù…Ù† Ù†Ø§ÙØ°Ø© Ø§Ù„ØªØ¹Ø¯ÙŠÙ„
        // Ù„Ø§Ø­Ø¸: z-[2147483648] Ø£Ø¹Ù„Ù‰ Ø¨ÙˆØ§Ø­Ø¯ Ù…Ù† Ù†Ø§ÙØ°Ø© Ø§Ù„ØªØ¹Ø¯ÙŠÙ„
        const modalHTML = `
        <div id="custom-confirm-modal" class="fixed inset-0 z-[2147483648] flex items-center justify-center bg-[#2A3475]/90 backdrop-blur-sm" style="font-family: 'Cairo', sans-serif;">
            <div class="bg-white rounded-2xl shadow-2xl w-full max-w-sm transform scale-100 transition-all overflow-hidden border-t-4 border-[#F3A628] animate-[modalPop_0.3s_ease-out]">
                
                <div class="p-6 text-center">
                    <div class="w-16 h-16 bg-blue-50 rounded-full flex items-center justify-center mx-auto mb-4 shadow-sm animate-bounce">
                        <i class="fas fa-question text-3xl text-[#2A3475]"></i>
                    </div>
                    
                    <h3 class="text-xl font-bold text-gray-800 mb-2">ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡</h3>
                    <p class="text-sm text-gray-600 leading-relaxed mb-6 font-semibold whitespace-pre-line">${message}</p>
                    
                    <div class="flex gap-3">
                        <button id="btn-confirm-yes" class="flex-1 bg-[#2A3475] text-white py-3 rounded-xl font-bold hover:bg-[#1f2658] shadow-lg transition-all transform active:scale-95">
                            Ù†Ø¹Ù…ØŒ Ù…ØªØ£ÙƒØ¯
                        </button>
                        <button id="btn-confirm-no" class="flex-1 bg-white text-gray-500 py-3 rounded-xl font-bold hover:bg-gray-100 border-2 border-gray-200 transition-all">
                            Ø¥Ù„ØºØ§Ø¡
                        </button>
                    </div>
                </div>

            </div>
        </div>
        `;

        // 3. Ø­Ù‚Ù† Ø§Ù„ÙƒÙˆØ¯ ÙÙŠ Ø§Ù„ØµÙØ­Ø©
        document.body.insertAdjacentHTML('beforeend', modalHTML);

        // 4. Ø§Ù„ØªØ¹Ø§Ù…Ù„ Ù…Ø¹ Ø§Ù„Ø£Ø²Ø±Ø§Ø±
        document.getElementById('btn-confirm-yes').onclick = () => {
            document.getElementById('custom-confirm-modal').remove();
            resolve(true); // Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙˆØ§ÙÙ‚
        };

        document.getElementById('btn-confirm-no').onclick = () => {
            document.getElementById('custom-confirm-modal').remove();
            resolve(false); // Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø±ÙØ¶
        };
    });
}

function showNotification(message, type = 'success') {
    let toast = document.getElementById('notification-toast');
    if (!toast) {
        toast = document.createElement('div');
        toast.id = 'notification-toast';
        // !w-max Ø¨ØªØ®Ù„ÙŠ Ø§Ù„Ø¹Ø±Ø¶ Ø¹Ù„Ù‰ Ù‚Ø¯ Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø¨Ø§Ù„Ø¸Ø¨Ø· Ø¹Ø´Ø§Ù† ÙŠÙØ¶Ù„ Ø³Ø·Ø± ÙˆØ§Ø­Ø¯
        toast.className = 'notification-toast !fixed !left-1/2 !-translate-x-1/2 !right-auto !bottom-10 !flex !items-center !gap-2 !w-max !max-w-[95vw] !z-[9999]';
        toast.innerHTML = '<div class="flex items-center gap-2"><div id="notif-icon" class="notification-icon-box shrink-0"><i class="fas"></i></div><span id="notification-message"></span></div>';
        document.body.appendChild(toast);
    }

    const messageEl = document.getElementById('notification-message');
    const iconBox = document.getElementById('notif-icon');
    const icon = iconBox.querySelector('i');

    messageEl.textContent = message;
    
    // Ø¶Ø¨Ø· Ø§Ù„Ø®Ø·: Ø£Ø³ÙˆØ¯ (!text-black) ÙˆØ³Ø·Ø± ÙˆØ§Ø­Ø¯ (!whitespace-nowrap) ÙˆØ­Ø¬Ù… Ø£ØµØºØ± Ù„Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„
    messageEl.className = '!text-black !font-bold !text-[12px] md:!text-[14px] !whitespace-nowrap';
    
    if (type === 'error') {
        iconBox.className = 'notification-icon-box bg-error shrink-0';
        icon.className = 'fas fa-times';
    } else {
        iconBox.className = 'notification-icon-box bg-success shrink-0';
        icon.className = 'fas fa-check';
    }

    toast.classList.add('show');
    setTimeout(() => toast.classList.remove('show'), 3000);
}
// ============================================================
// ğŸ”¥ Ø¯Ø§Ù„Ø© ÙˆØ¶Ø¹ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ø­Ø¯Ø«Ø©: Ø­Ù„ Ù…Ø´ÙƒÙ„Ø© Ø§Ù„Ø§Ø®ØªÙØ§Ø¡ ÙˆØ¶Ø¨Ø· Ø§Ù„Ø£Ù„ÙˆØ§Ù†
// ============================================================
let isAdminMode = false; 

function toggleAdminMode() {
    isAdminMode = !isAdminMode;
    const btn = document.getElementById('admin-toggle-btn');
    const mobBtn = document.getElementById('mobileEditBtn');

    if (isAdminMode) {
        // --- Ø­Ø§Ù„Ø© Ø§Ù„ØªÙØ¹ÙŠÙ„ (Ø§Ù„Ù„ÙˆÙ† Ø§Ù„Ø¨Ø±ØªÙ‚Ø§Ù„ÙŠ) ---
        
        // Ø§Ù„ÙƒÙ…Ø¨ÙŠÙˆØªØ±
        if (btn) {
            btn.classList.remove('bg-white/10', 'text-white', 'border-white/10');
            btn.classList.add('bg-[#F3A628]', 'text-[#2A3475]', 'border-[#F3A628]');
            const icon = btn.querySelector('i');
            if (icon) icon.classList.replace('text-[#F3A628]', 'text-[#2A3475]');
        }

        // Ø§Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„ (ÙŠØªØ­ÙˆÙ„ Ø¨Ø±ØªÙ‚Ø§Ù„ÙŠ ÙˆØ§Ø¶Ø­)
        if (mobBtn) {
            mobBtn.className = "absolute -top-1.5 -left-1.5 bg-[#F3A628] text-white w-6 h-6 rounded-full flex items-center justify-center border border-[#F3A628] shadow-md cursor-pointer z-30 transition-all";
            mobBtn.querySelector('i').className = 'fas fa-check text-[10px]'; // Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø­ÙØ¸/ØµØ­
        }
    } else {
        // --- Ø­Ø§Ù„Ø© Ø§Ù„Ø¥Ù„ØºØ§Ø¡ (ÙŠØ±Ø¬Ø¹ Ø£Ø¨ÙŠØ¶ Ø³Ø§Ø¯Ø© Ø¹Ø´Ø§Ù† Ù… ÙŠØ®ØªÙÙŠØ´) ---
        
        // Ø§Ù„ÙƒÙ…Ø¨ÙŠÙˆØªØ±
        if (btn) {
            btn.classList.add('bg-white/10', 'text-white', 'border-white/10');
            btn.classList.remove('bg-[#F3A628]', 'text-[#2A3475]', 'border-[#F3A628]');
            const icon = btn.querySelector('i');
            if (icon) icon.classList.replace('text-[#2A3475]', 'text-[#F3A628]');
        }

        // Ø§Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„ (ÙŠØ±Ø¬Ø¹ Ø£Ø¨ÙŠØ¶ Ø¨Ø­Ø¯ÙˆØ¯ Ø±Ù…Ø§Ø¯ÙŠØ© Ø®ÙÙŠÙØ© Ø¹Ø´Ø§Ù† ÙŠØ¸Ù‡Ø±)
        if (mobBtn) {
            mobBtn.className = "absolute -top-1.5 -left-1.5 bg-white text-[#2A3475] w-6 h-6 rounded-full flex items-center justify-center border border-gray-200 shadow-md cursor-pointer z-30 transition-all";
            mobBtn.querySelector('i').className = 'fas fa-edit text-[10px]'; // Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø§Ù„Ù‚Ù„Ù…
        }
    }
    
    if (typeof refreshCache === 'function') refreshCache(); 
}

// ============================================================
// 1. Ø¯Ø§Ù„Ø© ØªÙˆÙ„ÙŠØ¯ Ø§Ù„Ù‚ÙˆØ§Ø¦Ù… Ø§Ù„Ù…Ø®ØµØµØ© (Ù†Ø³Ø®Ø© Ø§Ù„Ù‡ÙˆÙŠØ© Ø§Ù„Ø¨ØµØ±ÙŠØ© Ø§Ù„Ù…Ø­Ø³Ù†Ø©)
// ============================================================
function generateCustomDropdownHTML(id, label, optionsArray, selectedValue) {
    let selectedText = label; 
    const selectedOption = optionsArray.find(opt => opt.value === selectedValue);
    if (selectedOption) selectedText = selectedOption.text;

    let listItems = '';
    optionsArray.forEach(opt => {
        const isActive = opt.value === selectedValue ? 'bg-[#2A3475]/10 text-[#2A3475]' : 'text-gray-700';
        // Ø¥Ø¶Ø§ÙØ© style="font-family: 'Cairo'" Ù„ÙƒÙ„ Ø¹Ù†ØµØ± Ù„Ø¶Ù…Ø§Ù† Ø´ÙƒÙ„ Ø§Ù„Ø®Ø·
        listItems += `<li class="custom-option px-4 py-3 hover:bg-[#2A3475] hover:text-white cursor-pointer text-sm font-bold border-b border-gray-50 transition-all last:border-0 ${isActive}" data-value="${opt.value}" style="font-family: 'Cairo', sans-serif;">${opt.text}</li>`;
    });

    return `
    <div class="relative custom-dropdown w-full" style="font-family: 'Cairo', sans-serif;">
        <div class="custom-dropdown-display w-full px-4 py-3 bg-gray-50 border border-gray-200 rounded-xl text-sm font-bold text-gray-700 flex items-center justify-between cursor-pointer transition-all hover:border-[#F3A628] hover:shadow-sm hover:bg-white group">
            <span class="truncate ml-2 pt-1">${selectedText}</span>
            <div class="bg-white w-6 h-6 rounded-full flex items-center justify-center text-gray-400 group-hover:text-[#F3A628] shadow-sm transition-colors">
                <i class="fas fa-chevron-down text-[10px]"></i>
            </div>
        </div>
        
        <ul class="custom-dropdown-options absolute top-[110%] left-0 w-full bg-white border border-gray-100 rounded-xl max-h-52 overflow-y-auto z-[99999] shadow-2xl hidden custom-scrollbar">
            ${listItems}
        </ul>

        <select id="${id}" class="hidden">
            <option value="${selectedValue || ''}">${selectedText}</option>
        </select>
    </div>
    `;
}

// ============================================================
// 2. Ø¯Ø§Ù„Ø© ÙØªØ­ Ù…ÙˆØ¯Ø§Ù„ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ (ØªØ­Ø§ÙØ¸ Ø¹Ù„Ù‰ Ø´ÙƒÙ„ Ø§Ù„ÙƒÙ…Ø¨ÙŠÙˆØªØ± ÙˆØªØ¸Ø¨Ø· Ø§Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„) ğŸ’»ğŸ“±
// ============================================================
function openAdminEditModal(id, instructor, course, room, time, day) {
    const oldModal = document.getElementById('admin-edit-modal');
    if (oldModal) oldModal.remove();

    // --- 1. Ù…Ø¹Ø§Ù„Ø¬Ø© ÙˆØªÙˆØ­ÙŠØ¯ Ø§Ù„ØªÙˆÙ‚ÙŠØª ---
    let formattedTime = time || "";
    if (formattedTime) {
        formattedTime = formattedTime
            .replace("13:", "01:").replace("14:", "02:").replace("15:", "03:")
            .replace("16:", "04:").replace("17:", "05:").replace("18:", "06:");
    }

    // --- 2. Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯ Ø§Ù„Ù…ÙˆØ­Ø¯Ø© ---
    const standardSlots = [
        "08:30 - 10:20", "10:30 - 12:20", "12:30 - 02:20", "02:30 - 04:20", "04:30 - 06:20"
    ];

    if (formattedTime && !standardSlots.includes(formattedTime)) {
        const cleanTime = formattedTime.split('(')[0].trim(); 
        const match = standardSlots.find(s => s.startsWith(cleanTime.split('-')[0].trim()));
        if (match) formattedTime = match; else standardSlots.push(formattedTime);
    }

    const timeOptions = standardSlots.map(t => ({ value: t, text: t }));
    const uniqueRooms = [...new Set(cachedData.map(i => i.room_name).filter(r => r))].sort();
    const roomOptions = uniqueRooms.map(r => ({ value: r, text: r }));

    const dayOptions = [
        { value: 'Saturday', text: 'Ø§Ù„Ø³Ø¨Øª' }, { value: 'Sunday', text: 'Ø§Ù„Ø£Ø­Ø¯' },
        { value: 'Monday', text: 'Ø§Ù„Ø§Ø«Ù†ÙŠÙ†' }, { value: 'Tuesday', text: 'Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡' },
        { value: 'Wednesday', text: 'Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡' }, { value: 'Thursday', text: 'Ø§Ù„Ø®Ù…ÙŠØ³' }
    ];

    // --- 4. ØªÙˆÙ„ÙŠØ¯ Ø§Ù„Ù‚ÙˆØ§Ø¦Ù… ---
    const roomDropdownHTML = generateCustomDropdownHTML('edit-room', 'Ø§Ø®ØªØ± Ø§Ù„Ù‚Ø§Ø¹Ø©...', roomOptions, room);
    const timeDropdownHTML = generateCustomDropdownHTML('edit-time', 'Ø§Ø®ØªØ± Ø§Ù„ØªÙˆÙ‚ÙŠØª...', timeOptions, formattedTime);
    const dayDropdownHTML = generateCustomDropdownHTML('edit-day', 'Ø§Ø®ØªØ± Ø§Ù„ÙŠÙˆÙ…...', dayOptions, day);

    // Ø³ØªØ§ÙŠÙ„ Ù…ÙˆØ­Ø¯ Ù…Ø¹ Ù…Ø±Ø§Ø¹Ø§Ø© Ø­Ø¬Ù… Ø§Ù„Ø®Ø· ÙÙŠ Ø§Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„
    const inputStyle = `
        w-full px-4 py-3 rounded-xl border border-gray-200 
        focus:border-[#F3A628] focus:bg-white focus:ring-4 focus:ring-[#F3A628]/10
        outline-none font-bold text-gray-700 text-right bg-gray-50 
        transition-all duration-300 placeholder-gray-300 text-sm md:text-base
    `;

    // Ø¨Ù†Ø§Ø¡ Ø§Ù„Ù…ÙˆØ¯Ø§Ù„ Ù…Ø¹ Ø¥Ø¶Ø§ÙØ© ÙƒÙ„Ø§Ø³Ø§Øª responsive Ø°ÙƒÙŠØ©
    const modalHTML = `
    <div id="admin-edit-modal" class="fixed inset-0 z-[2147483647] flex items-center justify-center p-2 md:p-0" style="font-family: 'Cairo', sans-serif;">
        <div class="absolute inset-0 bg-[#2A3475]/60 backdrop-blur-md transition-opacity" onclick="closeAdminEditModal()"></div>

        <div class="bg-white rounded-2xl shadow-2xl w-full max-w-lg relative z-10 overflow-hidden flex flex-col max-h-[95vh] md:max-h-none animate-[modalPop_0.4s_cubic-bezier(0.16,1,0.3,1)]">            
            
            <div class="metallic-blue-fill random-slanted-lines px-6 py-5 flex justify-between items-center shrink-0 border-b border-white/10">
                <div class="relative z-10">
                    <h3 class="text-sm md:text-lg font-black text-white flex items-center gap-2">
                        <span class="bg-[#F3A628] text-[#2A3475] w-8 h-8 rounded-lg flex items-center justify-center shadow-lg"><i class="fas fa-pen-fancy text-xs md:text-sm"></i></span>
                        ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠ
                    </h3>
                </div>
                <button onclick="closeAdminEditModal()" class="w-8 h-8 rounded-full bg-white/10 text-white hover:bg-[#F3A628] hover:text-[#2A3475] transition-all flex items-center justify-center backdrop-blur-sm active:scale-90"><i class="fas fa-times"></i></button>
            </div>
            
            <div class="p-6 md:p-8 space-y-4 md:space-y-5 bg-white overflow-y-auto custom-scrollbar">
                <input type="hidden" id="edit-id" value="${id || ''}">

                <div class="group">
                    <label class="flex items-center gap-2 text-[11px] md:text-xs font-black text-[#2A3475] mb-2 mr-1"><i class="fas fa-user-tie text-[#F3A628]"></i> Ø§Ø³Ù… Ø§Ù„Ù…Ø­Ø§Ø¶Ø±</label>
                    <input type="text" id="edit-instructor" value="${instructor || ''}" class="${inputStyle}">
                </div>

                <div class="group">
                    <label class="flex items-center gap-2 text-[11px] md:text-xs font-black text-[#2A3475] mb-2 mr-1"><i class="fas fa-book-open text-[#F3A628]"></i> Ø§Ù„Ù…Ø§Ø¯Ø© Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠØ©</label>
                    <input type="text" id="edit-course" value="${course || ''}" class="${inputStyle}">
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 md:gap-5">
                    <div class="group relative z-30"> 
                        <label class="flex items-center gap-2 text-[11px] md:text-xs font-black text-[#2A3475] mb-2 mr-1"><i class="fas fa-map-marker-alt text-[#F3A628]"></i> Ø§Ù„Ù‚Ø§Ø¹Ø©</label>
                        ${roomDropdownHTML}
                    </div>
                    
                    <div class="group relative z-30">
                        <label class="flex items-center gap-2 text-[11px] md:text-xs font-black text-[#2A3475] mb-2 mr-1"><i class="far fa-clock text-[#F3A628]"></i> Ø§Ù„ØªÙˆÙ‚ÙŠØª</label>
                        ${timeDropdownHTML}
                    </div>
                </div>

                <div class="group relative z-20">
                    <label class="flex items-center gap-2 text-[11px] md:text-xs font-black text-[#2A3475] mb-2 mr-1"><i class="fas fa-calendar-day text-[#F3A628]"></i> Ø§Ù„ÙŠÙˆÙ…</label>
                    ${dayDropdownHTML}
                </div>
            </div>

            <div class="px-6 md:px-8 py-5 bg-gray-50 border-t border-gray-100 flex flex-col-reverse md:flex-row gap-3">
                <div class="flex gap-3 w-full md:w-auto">
                    <button onclick="deleteLecture('${id}')" class="flex-1 md:flex-none px-4 py-3 bg-red-50 text-red-600 border border-red-100 rounded-xl font-bold hover:bg-red-500 hover:text-white transition-all flex items-center justify-center active:scale-95" title="Ø­Ø°Ù Ù†Ù‡Ø§Ø¦ÙŠ"><i class="fas fa-trash-alt"></i></button>
                    <button onclick="closeAdminEditModal()" class="flex-[2] md:hidden px-6 py-3 bg-white text-gray-500 border border-gray-200 rounded-xl font-bold active:scale-95">Ø¥Ù„ØºØ§Ø¡</button>
                </div>
                
                <button onclick="saveAdminChanges()" class="w-full md:flex-1 bg-[#2A3475] text-white py-3 rounded-xl font-black text-sm md:text-base hover:bg-[#1e255a] shadow-lg shadow-blue-900/10 hover:-translate-y-0.5 active:scale-[0.98] transition-all flex items-center justify-center gap-2">
                    <i class="fas fa-check-circle"></i> Ø­ÙØ¸ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª
                </button>
                
                <button onclick="closeAdminEditModal()" class="hidden md:flex px-6 py-3 bg-white text-gray-500 border border-gray-200 rounded-xl font-bold hover:bg-gray-100 transition-all">Ø¥Ù„ØºØ§Ø¡</button>
            </div>
        </div>
    </div>
    `;

    document.body.insertAdjacentHTML('beforeend', modalHTML);
    if (typeof setupCustomDropdowns === 'function') setupCustomDropdowns();
}

// --- 1. Ø¯Ø§Ù„Ø© Ø§Ù„Ø¥ØºÙ„Ø§Ù‚ (Ø§Ù„ØªÙŠ ÙƒØ§Ù†Øª Ù†Ø§Ù‚ØµØ©) ---
function closeAdminEditModal() {
    const modal = document.getElementById('admin-edit-modal');
    if (modal) {
        // ØªØ£Ø«ÙŠØ± Ø­Ø±ÙƒÙŠ Ø¨Ø³ÙŠØ· Ù„Ù„Ø§Ø®ØªÙØ§Ø¡
        modal.style.transition = 'opacity 0.2s ease';
        modal.style.opacity = '0';
        
        // Ù†Ù†ØªØ¸Ø± Ù„Ø­Ø¸Ø© Ø«Ù… Ù†Ø­Ø°ÙÙ‡ Ù…Ù† Ø§Ù„ØµÙØ­Ø© ØªÙ…Ø§Ù…Ø§Ù‹
        setTimeout(() => {
            modal.remove(); 
        }, 200);
    }
}

// ============================================================
// Ø¯Ø§Ù„Ø© Ø¬Ø¯ÙŠØ¯Ø©: ÙØ­Øµ Ø§Ù„ØªØ¹Ø§Ø±Ø¶ (Check Conflict) ğŸ•µï¸â€â™‚ï¸
// ============================================================
function findConflict(currentId, room, time, day) {
    // Ù†Ø¨Ø­Ø« ÙÙŠ ÙƒÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ù…Ù„Ø© Ø¹Ù†Ø¯Ù†Ø§
    return cachedData.find(item => 
        String(item.id) !== String(currentId) && // 1. Ù†ØªØ£ÙƒØ¯ Ø£Ù†Ù‡Ø§ Ù…Ø´ Ù†ÙØ³ Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø© Ø§Ù„Ù„ÙŠ Ø¨Ù†Ø¹Ø¯Ù„Ù‡Ø§
        item.room_name === room &&               // 2. Ù†ÙØ³ Ø§Ù„Ù‚Ø§Ø¹Ø©
        item.day_of_week === day &&              // 3. Ù†ÙØ³ Ø§Ù„ÙŠÙˆÙ…
        item.time_slot === time &&               // 4. Ù†ÙØ³ Ø§Ù„ØªÙˆÙ‚ÙŠØª
        item.status !== 'cancelled'              // 5. Ù†ØªØ¬Ø§Ù‡Ù„ Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø§Øª Ø§Ù„Ù…Ù„ØºØ§Ø©
    );
}

// ============================================================
// Ø¯Ø§Ù„Ø© Ø§Ù„Ø­ÙØ¸ Ø§Ù„Ø°ÙƒÙŠØ© (Ù…Ø¹ Ø­Ù„ Ø§Ù„ØªØ¹Ø§Ø±Ø¶ ÙˆØ§Ù„Ø¥Ø­Ù„Ø§Ù„ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ) ğŸ§ 
// ============================================================
async function saveAdminChanges() {
    // 1. Ø¬Ù„Ø¨ Ø§Ù„Ù‚ÙŠÙ… Ù…Ù† Ø§Ù„Ø®Ø§Ù†Ø§Øª
    const id = document.getElementById('edit-id').value;
    const instructor = document.getElementById('edit-instructor').value;
    const course = document.getElementById('edit-course').value;
    const room = document.getElementById('edit-room').value;
    const time = document.getElementById('edit-time').value;
    const day = document.getElementById('edit-day').value;

    // ---------------------------------------------------------
    // ğŸ”¥ ÙØ­Øµ Ø§Ù„ØªØ¹Ø§Ø±Ø¶ ÙˆØ­Ù„Ù‡ (Ø§Ù„Ù…Ù†Ø·Ù‚ Ø§Ù„Ø¬Ø¯ÙŠØ¯) ğŸ”¥
    // ---------------------------------------------------------
    const conflict = findConflict(id, room, time, day);
    
    if (conflict) {
        // Ø±Ø³Ø§Ù„Ø© ØªÙˆØ¶Ø­ Ø£Ù†Ù†Ø§ Ø³Ù†Ù‚ÙˆÙ… Ø¨Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ù‚Ø¯ÙŠÙ…
        const msg = `â›” ØªÙˆÙ‚Ù! Ø§Ù„Ù‚Ø§Ø¹Ø© Ù…Ø´ØºÙˆÙ„Ø©.\n\nØªÙˆØ¬Ø¯ Ù…Ø­Ø§Ø¶Ø±Ø© Ø£Ø®Ø±Ù‰ Ù†Ø´Ø·Ø©:\nğŸ“˜ Ø§Ù„Ù…Ø§Ø¯Ø©: ${conflict.course_name}\nğŸ‘¨â€ğŸ« Ø§Ù„Ù…Ø­Ø§Ø¶Ø±: ${conflict.instructor}\n\nÙ‡Ù„ ØªØ±ÙŠØ¯ **Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø© Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©** ÙˆØ­ÙØ¸ Ù‡Ø°Ù‡ Ù…ÙƒØ§Ù†Ù‡Ø§ØŸ`;
        
        const userAgreed = await showCustomConfirm(msg);
        
        if (!userAgreed) return; // Ù„Ùˆ Ø±ÙØ¶ØŒ Ù†ÙˆÙ‚Ù ÙƒÙ„ Ø­Ø§Ø¬Ø©

        // Ù„Ùˆ ÙˆØ§ÙÙ‚ØŒ Ù†Ù‚ÙˆÙ… Ø¨Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø© Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø© ÙÙˆØ±Ø§Ù‹ ÙÙŠ Ø§Ù„Ø®Ù„ÙÙŠØ©
        try {
            await supabase
                .from('academic_schedule')
                .update({ status: 'cancelled' }) // Ù†Ø­ÙˆÙ„ Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø© Ù„Ù…Ù„ØºØ§Ø©
                .eq('id', conflict.id);
                
            console.log(`ØªÙ… Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø© Ø§Ù„Ù…ØªØ¹Ø§Ø±Ø¶Ø© Ø±Ù‚Ù… ${conflict.id} Ø¨Ù†Ø¬Ø§Ø­`);
        } catch (e) {
            console.error("ÙØ´Ù„ ÙÙŠ Ø¥Ù„ØºØ§Ø¡ Ø§Ù„ØªØ¹Ø§Ø±Ø¶", e);
            showNotification('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø­Ù„ Ø§Ù„ØªØ¹Ø§Ø±Ø¶', 'error');
            return;
        }
    }
    // ---------------------------------------------------------

    // 2. Ø§Ù„ØªØ­ÙƒÙ… ÙÙŠ Ø§Ù„Ø²Ø± (Ø´ÙƒÙ„ Ø§Ù„ØªØ­Ù…ÙŠÙ„)
    const btn = document.querySelector('#admin-edit-modal button[onclick="saveAdminChanges()"]');
    let originalText = '';
    
    if (btn) {
        originalText = btn.innerHTML;
        btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø­ÙØ¸...';
        btn.disabled = true;
    }

    try {
        // 3. Ø­ÙØ¸ Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ© (ÙˆØªØ£ÙƒÙŠØ¯ Ø£Ù†Ù‡Ø§ Active)
        const { error } = await supabase
            .from('academic_schedule')
            .update({ 
                instructor: instructor,
                course_name: course,
                room_name: room,
                time_slot: time,
                day_of_week: day,
                status: 'active' // Ù…Ù‡Ù…: Ù†ØªØ£ÙƒØ¯ Ø¥Ù† Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø© Ø¯ÙŠ Ù†Ø´Ø·Ø©
            })
            .eq('id', id);

        if (error) throw error;

        // 4. Ù†Ø¬Ø§Ø­
        // Ø±Ø³Ø§Ù„Ø© Ù…Ø®ØªÙ„ÙØ© Ù„Ùˆ ÙƒØ§Ù† ÙÙŠÙ‡ ØªØ¹Ø§Ø±Ø¶ ÙˆØªÙ… Ø­Ù„Ù‡
        const successMsg = conflict ? 'ØªÙ… Ø­Ù„ Ø§Ù„ØªØ¹Ø§Ø±Ø¶ ÙˆØ­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„' : 'ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­';
        showNotification(successMsg, 'success');
        
        closeAdminEditModal();
        
        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        if (typeof refreshCache === 'function') await refreshCache();
        if (typeof applyFilters === 'function') applyFilters(); 

    } catch (err) {
        console.error(err);
        showNotification('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø­ÙØ¸: ' + err.message, 'error');
    } finally {
        // 5. Ø¥Ø±Ø¬Ø§Ø¹ Ø§Ù„Ø²Ø± Ù„Ø­Ø§Ù„ØªÙ‡
        if (btn) {
            btn.innerHTML = originalText || '<i class="fas fa-check-circle"></i> Ø­ÙØ¸ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª';
            btn.disabled = false;
        }
    }
}

// Ø§Ø³ØªØ¨Ø¯Ù„ Ø¯Ø§Ù„Ø© handleCardClick Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø© Ø¨Ù‡Ø°Ù‡ Ø§Ù„Ø¯Ø§Ù„Ø© Ø§Ù„Ù…Ø­Ø³Ù†Ø©
function handleCardClick(id) {
    // Ø§Ù„ØªØ­Ù‚Ù‚: Ù‡Ù„ ÙˆØ¶Ø¹ Ø§Ù„Ø£Ø¯Ù…Ù† Ù…ÙØ¹Ù„ØŸ
    if (typeof isAdminMode !== 'undefined' && isAdminMode) {
        // Ø§Ù„ÙˆØ¶Ø¹ Ù…ÙØ¹Ù„: Ù†ÙØªØ­ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ ÙÙˆØ±Ø§Ù‹
        prepareEdit(id);
    } else {
        // Ø§Ù„ÙˆØ¶Ø¹ Ù…ØºÙ„Ù‚: Ù†Ø¸Ù‡Ø± Ø±Ø³Ø§Ù„Ø© Ø®Ø·Ø£ ÙˆØ§Ø¶Ø­Ø© Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…
        showNotification('ÙŠØ¬Ø¨ ØªÙØ¹ÙŠÙ„ ÙˆØ¶Ø¹ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ø£ÙˆÙ„Ø§Ù‹!.', 'error');
        
        // (Ø§Ø®ØªÙŠØ§Ø±ÙŠ) Ø¹Ù…Ù„ ØªØ£Ø«ÙŠØ± Ù‡Ø² Ù„Ø²Ø± Ø§Ù„ØªØ±Ø³ Ù„Ù„ÙØª Ø§Ù„Ø§Ù†ØªØ¨Ø§Ù‡
        const btn = document.getElementById('admin-toggle-btn');
        if(btn) {
            btn.classList.add('input-error'); // ÙƒÙ„Ø§Ø³ Ø§Ù„Ù‡Ø² Ø§Ù„Ù…ÙˆØ¬ÙˆØ¯ ÙÙŠ Ø§Ù„Ù€ CSS
            setTimeout(() => btn.classList.remove('input-error'), 500);
        }
    }
}

// 2. ØªØ¬Ù‡ÙŠØ² Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª (Ø§Ù„Ø­Ù„ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ Ù„Ù…Ø´Ø§ÙƒÙ„ Ø§Ù„Ù†ØµÙˆØµ)
function prepareEdit(id) {
    // Ø§Ù„Ø¨Ø­Ø« Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… == Ù„Ù„Ù…Ø±ÙˆÙ†Ø© Ø¨ÙŠÙ† Ø§Ù„Ù†ØµÙˆØµ ÙˆØ§Ù„Ø£Ø±Ù‚Ø§Ù…
    const item = cachedData.find(i => i.id == id);
    
    if (!item) {
        console.error("Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø© ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯Ø© ÙÙŠ Ø§Ù„Ø°Ø§ÙƒØ±Ø©:", id);
        return;
    }

    openAdminEditModal(
        item.id,
        item.instructor || "",
        item.course_name || "",
        item.room_name || "",
        item.time_slot || "",
        item.day_of_week || ""
    );
}

// ============================================================
// 3. Ø¯Ø§Ù„Ø© Ø­Ø°Ù Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø© (Ù…Ø­Ø¯Ø«Ø© Ø¨ØµÙ„Ø§Ø­ÙŠØ§Øª Ø§Ù„Ø£Ø¯Ù…Ù†) ğŸ—‘ï¸
// ============================================================
async function deleteLecture(id) {
    console.log("ØªÙ… Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ Ø²Ø± Ø§Ù„Ø­Ø°Ù Ù„Ù„Ù…Ø­Ø§Ø¶Ø±Ø© Ø±Ù‚Ù…:", id);

    // 1. Ø·Ù„Ø¨ ØªØ£ÙƒÙŠØ¯ Ù…Ù† Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
    const confirmed = await showCustomConfirm('ØªØ­Ø°ÙŠØ±!\nÙ‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ù‡ Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø© Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹ØŸ\n(Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù† Ù‡Ø°Ø§ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡)');
    
    if (!confirmed) return; // Ù„Ùˆ Ø¶ØºØ· Ø¥Ù„ØºØ§Ø¡ØŒ Ù†Ø®Ø±Ø¬

    // 2. ØªØºÙŠÙŠØ± Ø´ÙƒÙ„ Ø§Ù„Ø²Ø± Ù„Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„ØªØ­Ù…ÙŠÙ„
    const deleteBtn = document.querySelector('#admin-edit-modal button[onclick*="deleteLecture"]');
    let originalIcon = '';
    
    if (deleteBtn) {
        originalIcon = deleteBtn.innerHTML;
        deleteBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i>'; // Ø£ÙŠÙ‚ÙˆÙ†Ø© ØªØ­Ù…ÙŠÙ„
        deleteBtn.disabled = true; // ØªØ¹Ø·ÙŠÙ„ Ø§Ù„Ø²Ø± Ù„Ù…Ù†Ø¹ Ø§Ù„ØªÙƒØ±Ø§Ø±
    }

    try {
        // 3. Ø§Ù„Ø­Ø°Ù Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù…ÙØªØ§Ø­ Ø§Ù„Ø£Ø¯Ù…Ù† (Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¬Ø¯ÙŠØ¯ Ù‡Ù†Ø§) ğŸ”¥
        // Ù†Ø³ØªØ®Ø¯Ù… window.supabaseAdmin Ø¨Ø¯Ù„Ø§Ù‹ Ù…Ù† supabase Ø§Ù„Ø¹Ø§Ø¯ÙŠ
        const { error } = await window.supabaseAdmin
            .from('academic_schedule')
            .delete()
            .eq('id', id);

        if (error) throw error;

        // 4. Ù†Ø¬Ø§Ø­ Ø§Ù„Ø¹Ù…Ù„ÙŠØ©
        showNotification('ØªÙ… Ø­Ø°Ù Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø© Ø¨Ù†Ø¬Ø§Ø­', 'success');
        
        // Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù…ÙˆØ¯Ø§Ù„
        closeAdminEditModal();
        
        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ Ø§Ù„ØµÙØ­Ø©
        if (typeof refreshCache === 'function') await refreshCache();
        if (typeof applyFilters === 'function') applyFilters();

    } catch (err) {
        console.error('Error deleting:', err);
        showNotification('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø­Ø°Ù: ' + err.message, 'error');
        
        // Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø²Ø± Ù„Ø­Ø§Ù„ØªÙ‡ Ø§Ù„Ø£ØµÙ„ÙŠØ© Ø¹Ù†Ø¯ Ø§Ù„Ø®Ø·Ø£
        if (deleteBtn) {
            deleteBtn.innerHTML = originalIcon || '<i class="fas fa-trash-alt"></i>';
            deleteBtn.disabled = false;
        }
    }
}

// Ø¯Ø§Ù„Ø© Ù„Ø­Ø³Ø§Ø¨ ØªØ§Ø±ÙŠØ® ÙŠÙˆÙ… Ù…Ø¹ÙŠÙ† ÙÙŠ Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ Ø§Ù„Ø­Ø§Ù„ÙŠ/Ø§Ù„Ù‚Ø§Ø¯Ù… (YYYY-MM-DD)
function getNextDateForDay(dayNameEn) {
    const days = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];
    const targetIndex = days.indexOf(dayNameEn);
    if (targetIndex === -1) return null;
    
    const today = new Date();
    const currentDayIndex = today.getDay();
    
    let daysUntil = targetIndex - currentDayIndex;
    // Ù„Ùˆ Ø§Ù„ÙŠÙˆÙ… Ø¹Ø¯Ù‰ØŒ Ù‡Ø§Øª ØªØ§Ø±ÙŠØ® Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ Ø§Ù„Ø¬Ø§ÙŠ (Ø£Ùˆ Ù„Ùˆ Ø¹Ø§ÙŠØ² Ù†ÙØ³ Ø§Ù„ÙŠÙˆÙ… ØªØ¹Ø±Ø¶Ù‡ØŒ Ø´ÙŠÙ„ Ø§Ù„Ø³Ø·Ø± Ø¯Ù‡ Ø­Ø³Ø¨ Ø§Ù„Ù…Ù†Ø·Ù‚)
    // Ù‡Ù†Ø§ Ø¨Ù†ÙØªØ±Ø¶ Ø¥Ù†Ù†Ø§ Ø¨Ù†Ø¹Ø±Ø¶ Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù‚Ø§Ø¯Ù…
    if (daysUntil < 0) daysUntil += 7; 
    
    const targetDate = new Date(today);
    targetDate.setDate(today.getDate() + daysUntil);
    
    // Ø¥Ø±Ø¬Ø§Ø¹ Ø§Ù„ØªØ§Ø±ÙŠØ® Ø¨ØµÙŠØºØ© YYYY-MM-DD Ù„Ù„Ù…Ù‚Ø§Ø±Ù†Ø©
    return targetDate.toLocaleDateString('en-CA'); // en-CA ØªØ¹Ø·ÙŠ YYYY-MM-DD Ø¯Ø§Ø¦Ù…Ø§Ù‹
}

// Ø¯Ø§Ù„Ø© Ù„Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø¹Ø±Ø¶ Ù„Ù„ÙˆØ¶Ø¹ Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ Ø¹Ù†Ø¯ Ù…Ø³Ø­ Ù…Ø±Ø¨Ø¹ Ø§Ù„Ø¨Ø­Ø«
function resetView() {
    // Ù†Ø¹ØªÙ…Ø¯ Ø¹Ù„Ù‰ Ø¯Ø§Ù„Ø© resetFilters Ù„Ø£Ù†Ù‡Ø§ ØªÙ†Ø¸Ù ÙƒÙ„ Ø´ÙŠØ¡ ÙˆØªØ¹ÙŠØ¯ Ø±Ø³Ø§Ù„Ø© "Ù„Ù… ÙŠØªÙ… ØªØ­Ø¯ÙŠØ¯ Ù…Ø¹Ø§ÙŠÙŠØ±"
    if (typeof resetFilters === 'function') {
        resetFilters();
    } else {
        // ÙƒÙˆØ¯ Ø§Ø­ØªÙŠØ§Ø·ÙŠ ÙÙŠ Ø­Ø§Ù„Ø© Ø¹Ø¯Ù… ÙˆØ¬ÙˆØ¯ resetFilters
        document.getElementById('results-grid').innerHTML = `
            <div class="col-span-full text-center py-24 flex flex-col items-center justify-center text-gray-400">
                <div class="bg-gray-50 p-6 rounded-full mb-4 shadow-inner">
                    <i class="fas fa-layer-group text-5xl opacity-30 text-[#2A3475]"></i>
                </div>
                <p class="font-bold text-lg text-gray-500">Ù„Ù… ÙŠØªÙ… ØªØ­Ø¯ÙŠØ¯ Ù…Ø¹Ø§ÙŠÙŠØ± Ø§Ù„Ø¹Ø±Ø¶</p>
                <p class="text-sm text-gray-400 mt-2">Ø§Ø³ØªØ®Ø¯Ù… Ø£Ø¯ÙˆØ§Øª Ø§Ù„ØªØµÙÙŠØ© Ø¨Ø§Ù„Ø£Ø¹Ù„Ù‰ Ù„Ù„Ø¨Ø¯Ø¡</p>
            </div>
        `;
        document.getElementById('results-count').innerText = '0 Ù†ØªÙŠØ¬Ø©';
    }
}

// ============================================================
// Ø¯Ø§Ù„Ø©: Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„ØªØ±Ø³ Ù„Ù„Ø¥Ø¯Ø§Ø±ÙŠÙŠÙ† ÙÙ‚Ø·
// ============================================================
function applyAdminVisibility(user) {
    const adminButton = document.getElementById('admin-toggle-btn');
    
    // ğŸ”¥ Ø§Ù„Ø´Ø±Ø·: Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ø²Ø± Ù…ÙˆØ¬ÙˆØ¯Ø§Ù‹ AND Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…ÙˆØ¬ÙˆØ¯Ø§Ù‹ AND Ø¯ÙˆØ±Ù‡ Ù‡Ùˆ 'manager'
    if (adminButton && user && user.role === 'manager') {
        // Ø¥Ø°Ø§ ØªØ­Ù‚Ù‚ Ø§Ù„Ø´Ø±Ø·ØŒ Ù†Ø²ÙŠÙ„ ÙƒÙ„Ø§Ø³ Ø§Ù„Ø¥Ø®ÙØ§Ø¡
        adminButton.classList.remove('hidden');
    }
}

// Ø¯Ø§Ù„Ø© ÙØªØ­/Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ© Ø¨Ù†Ù…Ø· smrm
function toggleMobileMenu() {
    const menu = document.getElementById('mobile-menu');
    const content = document.getElementById('mobile-menu-content');
    if (menu.classList.contains('hidden')) {
        menu.classList.remove('hidden');
        setTimeout(() => content.classList.remove('translate-x-full'), 10);
    } else {
        content.classList.add('translate-x-full');
        setTimeout(() => menu.classList.add('hidden'), 300);
    }
}

// 1. Ø¯Ø§Ù„Ø© ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª (Ù„Ø¶Ù…Ø§Ù† Ø¸Ù‡ÙˆØ± Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ© ÙˆØ§Ù„ÙˆØ¸ÙŠÙØ©)
// Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ Ù„Ø¸Ù‡ÙˆØ± (Ø§Ù„Ø¬Ù‡Ø© - Ø§Ù„Ù…Ø³Ù…Ù‰ Ø§Ù„ÙˆØ¸ÙŠÙÙŠ) ÙÙŠ Ø§Ù„Ø®Ø§Ø±Ø¬ ÙˆØ§Ù„Ø¯Ø§Ø®Ù„
function updateSystemProfile(user) {
    if (!user) return;
    
    const fullName = user.full_name || 'Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ù†Ø¸Ø§Ù…';
    
    // 1. Ø¬Ù„Ø¨ Ø§Ø³Ù… Ø§Ù„Ù‚Ø³Ù… (Ù…Ø«Ù„: Ù…Ø¹Ù…Ù„ Ø§Ù„Ø­Ø§Ø³Ø¨)
    const userDeptKey = user.department || 'computer-lab';
    const deptName = (typeof departments !== 'undefined' && departments[userDeptKey]) 
                     ? departments[userDeptKey].name 
                     : (user.department || 'Ø§Ù„ÙƒÙ„ÙŠØ©');
                     
    // 2. Ø¬Ù„Ø¨ Ø§Ù„Ù…Ø³Ù…Ù‰ Ø§Ù„ÙˆØ¸ÙŠÙÙŠ (Ù…Ø«Ù„: ÙÙ†ÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø¨ÙŠØ§Ù†Ø§Øª)
    const jobTitle = user.job_title || user.position || 'Ù…ÙˆØ¸Ù Ù…Ø®ØªØµ';
    
    // 3. ØµÙŠØ§ØºØ© Ø§Ù„Ù‡ÙˆÙŠØ© Ø§Ù„ÙƒØ§Ù…Ù„Ø© (Ø§Ù„Ø¬Ù‡Ø© - Ø§Ù„ÙˆØ¸ÙŠÙØ©)
    const fullIdentity = `${deptName} - ${jobTitle}`;

    // --- ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙƒÙ…Ø¨ÙŠÙˆØªØ± ---
    if (document.getElementById('profile-name')) document.getElementById('profile-name').innerText = `Ù…Ø±Ø­Ø¨Ø§Ù‹ØŒ ${fullName}`;
    if (document.getElementById('profile-role')) document.getElementById('profile-role').innerText = fullIdentity;

    // --- ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„ (Ø§Ù„ÙƒØ¨Ø³ÙˆÙ„Ø© Ø§Ù„Ø®Ø§Ø±Ø¬ÙŠØ©) - ØªÙ… Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ù„ÙŠØ¸Ù‡Ø± Ø§Ù„Ù…Ø³Ù…Ù‰ ÙˆØ§Ù„Ø¬Ù‡Ø© Ù…Ø¹Ø§Ù‹ ğŸ”¥ ---
    const mobName = document.getElementById('profile-name-mob');
    const mobRole = document.getElementById('profile-role-mob');
    if (mobName) mobName.innerText = fullName;
    if (mobRole) {
        // Ø³ÙŠØ¸Ù‡Ø± Ø§Ù„Ø¢Ù† "Ù…Ø¹Ù…Ù„ Ø§Ù„Ø­Ø§Ø³Ø¨ - ÙÙ†ÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø¨ÙŠØ§Ù†Ø§Øª" ÙÙŠ Ø§Ù„ÙƒØ¨Ø³ÙˆÙ„Ø© Ù…Ù† Ø§Ù„Ø®Ø§Ø±Ø¬
        mobRole.innerText = fullIdentity; 
    }

    // --- ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø© (Popup) ---
    if (document.getElementById('full-profile-name')) document.getElementById('full-profile-name').innerText = fullName;
    if (document.getElementById('full-profile-role')) document.getElementById('full-profile-role').innerText = fullIdentity;

    // Ø±Ø¨Ø· Ø²Ø± Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ (ÙƒÙ…Ø§ Ù‡Ùˆ)
    const mobEditBtn = document.getElementById('mob-edit-btn');
    if (mobEditBtn) {
        mobEditBtn.onclick = () => {
            if(typeof toggleProfileInfoMenu === 'function') toggleProfileInfoMenu();
            if (user.role === 'manager' || user.is_admin) {
                if (typeof toggleAdminPanel === 'function') toggleAdminPanel();
            } else {
                if (typeof openEditUserInfoModal === 'function') openEditUserInfoModal();
            }
        };
    }
}

// 2. Ø¯Ø§Ù„Ø© ÙØªØ­ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¨Ø±ÙˆÙØ§ÙŠÙ„ Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø© ÙˆØªØ­Ø¯ÙŠØ¯ Ù…ÙˆÙ‚Ø¹Ù‡Ø§ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ (Ù…Ø«Ù„ smrm)
function toggleProfileInfoMenu() {
    const menu = document.getElementById('profile-info-menu');
    const capsule = document.getElementById('mob-profile-capsule');
    if (!menu || !capsule) return;

    if (menu.classList.contains('hidden')) {
        const rect = capsule.getBoundingClientRect();
        // Ø§Ù„ØªÙ…ÙˆØ¶Ø¹ ÙƒÙ…Ø§ ÙÙŠ smrm Ø¨Ø§Ù„Ù…Ù„ÙŠ
        menu.style.top = (rect.bottom + 10) + 'px'; 
        menu.style.left = '20px'; // Ø¯ÙŠ Ø§Ù„Ù„ÙŠ Ù‡ØªØ¸Ø¨Ø· Ø§Ù„ØªØ±Ø­Ù„ Ø§Ù„Ø´Ù…Ø§Ù„
        menu.classList.remove('hidden');
    } else {
        menu.classList.add('hidden');
    }
}
document.addEventListener('click', (e) => {
    const pMenu = document.getElementById('profile-info-menu');
    const pCapsule = document.getElementById('mob-profile-capsule');
    
    if (pMenu && !pMenu.classList.contains('hidden')) {
        // Ù„Ùˆ Ø§Ù„Ø¶ØºØ·Ø© Ù…Ø´ Ø¬ÙˆÙ‡ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© ÙˆÙ…Ø´ Ø¬ÙˆÙ‡ Ø§Ù„Ø¨Ø±ÙˆÙØ§ÙŠÙ„.. Ø§Ù‚ÙÙ„Ù‡Ø§
        if (!pMenu.contains(e.target) && !pCapsule.contains(e.target)) {
            pMenu.classList.add('hidden');
        }
    }
});

if ('serviceWorker' in navigator) {
    window.addEventListener('load', () => {
      navigator.serviceWorker.register('sw.js')
        .then(reg => console.log('Ø§Ù„Ø³ÙŠØ³ØªÙ… Ø¬Ø§Ù‡Ø² Ù„Ù„Ø¹Ù…Ù„ Ø£ÙˆÙÙ„Ø§ÙŠÙ†'))
        .catch(err => console.log('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ³Ø¬ÙŠÙ„: ', err));
    });
  }
  
    </script>
</body>
</html>