<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø´Ø§Ø´Ø© Ø¹Ø±Ø¶ Ø§Ù„Ø¬Ø¯Ø§ÙˆÙ„ - CITL</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700;900&family=Roboto:wght@400;700;900&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    
    <style>
        body { font-family: 'Cairo', sans-serif; background: #0f172a; color: white; overflow: hidden; }
        .font-english { font-family: 'Roboto', sans-serif; }
        .bg-navy { background-color: #1e293b; }
        .text-navy { color: #2A3475; }
        .text-gold { color: #F3A628; }
        .border-gold { border-color: #F3A628; }
        
        /* Ø®Ù„ÙÙŠØ© Ù…ØªØ­Ø±ÙƒØ© */
        .bg-animated {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1;
            background: linear-gradient(125deg, #0f172a 0%, #1e293b 50%, #0f172a 100%);
            background-size: 400% 400%; animation: gradientBG 15s ease infinite;
        }
        @keyframes gradientBG { 0% { background-position: 0% 50%; } 50% { background-position: 100% 50%; } 100% { background-position: 0% 50%; } }

        /* Ø§Ù„ÙƒØ§Ø±Øª Ø§Ù„Ø²Ø¬Ø§Ø¬ÙŠ */
        .glass-panel {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
        }

        /* Ø£Ù†ÙŠÙ…ÙŠØ´Ù† */
        .fade-in-up { animation: fadeInUp 0.8s cubic-bezier(0.2, 0.8, 0.2, 1) forwards; opacity: 0; transform: translateY(30px); }
        @keyframes fadeInUp { to { opacity: 1; transform: translateY(0); } }
        .stagger-row { opacity: 0; animation: slideInRight 0.5s ease-out forwards; }
        @keyframes slideInRight { from { opacity: 0; transform: translateX(-20px); } to { opacity: 1; transform: translateX(0); } }

        /* Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ‚Ø¯Ù… */
        .progress-container { position: absolute; bottom: 0; left: 0; width: 100%; height: 6px; background: rgba(255,255,255,0.1); }
        .progress-bar { height: 100%; background: linear-gradient(90deg, #F3A628, #fbbf24); width: 0%; transition: width 0.1s linear; }
        
        /* Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ© */
        .status-live { animation: pulse-border 2s infinite; }
        @keyframes pulse-border { 0% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.4); } 70% { box-shadow: 0 0 0 15px rgba(239, 68, 68, 0); } 100% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0); } }

        /* ØªÙ†Ø³ÙŠÙ‚Ø§Øª Ø®Ø§ØµØ© Ù„Ù„Ø¥Ù„ØºØ§Ø¡ */
        .row-cancelled { background-color: #fef2f2 !important; border-left: 4px solid #ef4444; }
        .text-cancelled { text-decoration: line-through; color: #9ca3af !important; }
        .badge-cancelled { background-color: #ef4444; color: white; padding: 4px 12px; border-radius: 99px; font-size: 0.75rem; font-weight: bold; display: inline-flex; align-items: center; gap: 4px; }

        /* Ø§Ù„Ù…ÙˆØ¯Ø§Ù„ (Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…) */
        .settings-modal {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.8); backdrop-filter: blur(5px);
            z-index: 100; display: none; align-items: center; justify-content: center;
        }
        .settings-modal.show { display: flex; animation: fadeIn 0.3s ease-out; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        
        /* ØªØ®ØµÙŠØµ Ø§Ù„Ù€ Checkbox */
        .room-checkbox:checked + div { background-color: #2A3475; border-color: #2A3475; color: white; }
        .room-checkbox:checked + div:hover { background-color: #1e293b; border-color: #1e293b; } 
    </style>
</head>
<body class="flex flex-col h-screen">

    <div class="bg-animated"></div>
    <div class="absolute inset-0 bg-[url('https://www.transparenttextures.com/patterns/cubes.png')] opacity-5 z-0"></div>

<header class="relative z-10 px-8 py-5 flex justify-between items-center border-b border-white/10 bg-black/20 backdrop-blur-md">
        <div class="flex items-center gap-6">
            <div onclick="openSettings()" class="bg-white p-1 rounded-xl shadow-lg h-20 w-20 flex items-center justify-center transform hover:scale-105 hover:rotate-3 transition-all duration-300 cursor-pointer group relative overflow-hidden" title="Ø§Ø¶ØºØ· Ù„Ø¶Ø¨Ø· Ø§Ù„Ù‚Ø§Ø¹Ø§Øª">
                <img src="CITL_Logo.gif" alt="Logo" class="h-full w-full object-contain transform scale-125">
                <div class="absolute inset-0 bg-black/10 rounded-xl opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center z-10">
                    <i class="fas fa-cog text-navy text-2xl animate-spin"></i>
                </div>
            </div>
                        <div>
                <h1 class="text-3xl font-black tracking-wide text-white drop-shadow-md">Ø§Ù„Ø¬Ø¯Ø§ÙˆÙ„ Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠØ© Ø§Ù„ÙŠÙˆÙ…ÙŠØ©</h1>
                <p class="text-gold text-lg font-medium tracking-widest mt-1 font-english uppercase">COLLEGE OF INTERNATIONAL TRANSPORT & LOGISTICS</p>
            </div>
        </div>
        <div class="text-left">
            <div id="current-time" class="text-5xl font-black text-white font-english tracking-wider drop-shadow-lg">00:00</div>
            <div id="current-date" class="text-xl text-blue-200 font-bold mt-1 text-right opacity-90">...</div>
        </div>
    </header>

    <main class="flex-1 relative flex overflow-hidden p-6 z-10">
        <div id="content-container" class="w-full h-full flex flex-col justify-center">
            <div class="flex flex-col items-center justify-center space-y-6 animate-pulse">
                <div class="w-20 h-20 border-4 border-gold border-t-transparent rounded-full animate-spin"></div>
                <p class="text-lg text-gray-300">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù‚Ø§Ø¹Ø§Øª...</p>
            </div>
        </div>
    </main>

<footer class="relative z-10 bg-black/80 backdrop-blur-md border-t border-white/10 text-white py-2 overflow-hidden">
    <div class="progress-container top-0 absolute">
        <div id="slide-progress" class="progress-bar"></div>
    </div>
    <div class="container mx-auto px-8 flex justify-between items-center h-full pt-1">
        <div class="flex items-center gap-3 text-sm text-gray-400">
            <span class="w-2 h-2 bg-green-500 rounded-full animate-pulse"></span>
            <span class="font-bold">ØªØ­Ø¯ÙŠØ« ØªÙ„Ù‚Ø§Ø¦ÙŠ Ù…Ø¨Ø§Ø´Ø±</span>
        </div>
        <div class="text-sm font-medium text-gray-300 flex items-center gap-2">
            <span>Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø© Ù„ÙƒÙ„ÙŠØ© Ø§Ù„Ù†Ù‚Ù„ Ø§Ù„Ø¯ÙˆÙ„ÙŠ ÙˆØ§Ù„Ù„ÙˆØ¬Ø³ØªÙŠØ§Øª Â© 2025</span>
            <span class="text-gold mx-2">|</span>
            <span>ØªØ·ÙˆÙŠØ± ÙˆØ¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù†Ø¸Ø§Ù… Ø¨ÙˆØ§Ø³Ø·Ø© Ø£. Ø£Ø­Ù…Ø¯ ÙÙƒØ±ÙŠ ( ÙÙ†ÙŠ Ù…Ø¹Ù…Ù„ Ø§Ù„Ø­Ø§Ø³Ø¨ ).</span>
        </div>
    </div>
</footer>


    <div id="settings-modal" class="settings-modal">
        <div class="bg-white rounded-2xl shadow-2xl w-full max-w-5xl h-[85vh] flex flex-col overflow-hidden animate-fade-in-up">
            <div class="bg-[#2A3475] p-5 flex justify-between items-center border-b-4 border-gold">
                <h3 class="text-2xl font-bold text-white"><i class="fas fa-desktop ml-2"></i> Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù‚Ø§Ø¹Ø§Øª Ù„Ù„Ø¹Ø±Ø¶</h3>
                <button onclick="closeSettings()" class="text-white/70 hover:text-white transition-colors"><i class="fas fa-times text-2xl"></i></button>
            </div>
            
            <div class="p-6 flex-1 overflow-y-auto bg-gray-50">
                <p class="text-gray-600 mb-4 text-sm font-bold">Ø­Ø¯Ø¯ Ø§Ù„Ù‚Ø§Ø¹Ø§Øª Ø§Ù„ØªÙŠ ØªØ±ÙŠØ¯ Ø£Ù† ØªØ¸Ù‡Ø± ÙÙŠ Ø´Ø§Ø´Ø© Ø§Ù„Ø¹Ø±Ø¶ Ø§Ù„Ø¯ÙˆØ§Ø±Ø©:</p>
                
                <div class="flex gap-3 mb-6">
                    <button onclick="toggleAll(true)" class="px-4 py-2 bg-blue-100 text-blue-700 rounded-lg text-sm font-bold hover:bg-blue-200 transition-colors">ØªØ­Ø¯ÙŠØ¯ Ø§Ù„ÙƒÙ„</button>
                    <button onclick="toggleAll(false)" class="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg text-sm font-bold hover:bg-gray-300 transition-colors">Ø¥Ù„ØºØ§Ø¡ Ø§Ù„ØªØ­Ø¯ÙŠØ¯</button>
                </div>

                <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3" id="rooms-selection-grid"></div>
            </div>

            <div class="p-5 bg-white border-t border-gray-200 flex justify-end gap-3">
                <button onclick="closeSettings()" class="px-6 py-2.5 border border-gray-300 rounded-xl text-gray-600 font-bold hover:bg-gray-50">Ø¥Ù„ØºØ§Ø¡</button>
                <button onclick="saveSettings()" class="px-8 py-2.5 bg-[#2A3475] text-white rounded-xl font-bold hover:bg-blue-900 shadow-lg transform active:scale-95 transition-all">Ø­ÙØ¸ ÙˆØªØ´ØºÙŠÙ„</button>
            </div>
        </div>
    </div>

<script>
        // =======================================================
        // 1. Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù€ Supabase (Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ù…ÙˆØ­Ø¯Ø© Ù„Ù„Ø´Ø§Ø´Ø§Øª)
        // =======================================================
        const SUPABASE_URL = 'https://xgqukdbonzukxrpjovmb.supabase.co';
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InhncXVrZGJvbnp1a3hycGpvdm1iIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjM4OTg4MDMsImV4cCI6MjA3OTQ3NDgwM30.3-70d7uB-zjVF7Jfr8ZjITT7suYPo3EWsYngO-sFVqM';

        const supabaseFactory = window.supabase;

        // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ø¹Ù…ÙŠÙ„ (Ø¨Ø¯ÙˆÙ† ØªØ®Ø²ÙŠÙ† Ø¬Ù„Ø³Ø© Ù„ØªØ®ÙÙŠÙ Ø§Ù„Ø­Ù…Ù„ Ø¹Ù„Ù‰ Ø§Ù„Ø´Ø§Ø´Ø©)
        const sb = supabaseFactory.createClient(SUPABASE_URL, SUPABASE_KEY, {
            auth: {
                persistSession: false, 
                autoRefreshToken: false,
                detectSessionInUrl: false
            }
        });

        // Ø§Ù„Ø±Ø¨Ø· Ø§Ù„Ø¹Ø§Ù… (Ù‡Ø°Ø§ ÙŠØ­Ù„ Ù…Ø­Ù„ const supabase = ...)
        window.supabase = sb;

        // =======================================================
        // Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø¹Ø±Ø¶
        // =======================================================
        const SLIDE_DURATION = 10000; 
        const REFRESH_INTERVAL = 2 * 60 * 1000; // ØªØ­Ø¯ÙŠØ« Ø§Ø­ØªÙŠØ§Ø·ÙŠ ÙƒÙ„ Ø¯Ù‚ÙŠÙ‚ØªÙŠÙ†

        const MASTER_ROOMS_LIST = [
            "G004", "H 001 Hall", "H 002 Lab", "H 101 L", "H 104", 
            "H 106 L", "H 107", "H 108", "H 109", "H 205", 
            "H 207 L", "H 208", "H 209", "H 210", "H 211",
            "IMO 001", "IMO 002", "IMO 003", "IMO 004", "IMO 005", "IMO 006",
            "M 124", "M 128", "M 130", "M 132", "M 135", "M 136",
            "PH 201", "PH 401", "PH 404", "PH 501"
        ];

        let activeRooms = [];
        let roomsData = {};
        let currentRoomIndex = 0;
        let progressInterval;
        const daysMap = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];
        
        // --- Ø§Ù„Ø³Ø§Ø¹Ø© ---
        function updateClock() {
            const now = new Date();
            document.getElementById('current-time').textContent = now.toLocaleTimeString('en-US', { hour12: true, hour: '2-digit', minute: '2-digit' });
            document.getElementById('current-date').textContent = now.toLocaleDateString('ar-EG', { weekday: 'long', day: 'numeric', month: 'long', year: 'numeric' });
        }
        setInterval(updateClock, 1000); updateClock();

        // --- Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª ---
        function loadSettings() {
            const saved = localStorage.getItem('tv_display_rooms');
            if (saved) {
                activeRooms = JSON.parse(saved);
            } else {
                activeRooms = [...MASTER_ROOMS_LIST];
            }
            renderSettingsGrid();
        }

        function renderSettingsGrid() {
            const grid = document.getElementById('rooms-selection-grid');
            grid.innerHTML = '';
            MASTER_ROOMS_LIST.forEach(room => {
                const isChecked = activeRooms.includes(room);
                
                const cardClass = isChecked 
                    ? "border-2 rounded-xl p-3 flex items-center justify-between transition-all bg-[#2A3475] text-white border-[#2A3475]" 
                    : "border-2 rounded-xl p-3 flex items-center justify-between transition-all bg-white text-gray-700 border-gray-200 hover:border-navy/50";
                
                const iconHtml = isChecked ? '<i class="fas fa-check text-[10px]"></i>' : '';

                grid.innerHTML += `
                    <label class="cursor-pointer group relative">
                        <input type="checkbox" class="room-checkbox absolute opacity-0 w-0 h-0" value="${room}" ${isChecked ? 'checked' : ''} onchange="updateRoomCard(this)">
                        <div class="${cardClass}">
                            <span class="font-bold text-sm font-english">${room}</span>
                            <div class="w-5 h-5 rounded-full border-2 border-gray-300 flex items-center justify-center check-circle">
                                ${iconHtml}
                            </div>
                        </div>
                    </label>
                `;
            });
        }

        window.updateRoomCard = function(checkbox) {
            const card = checkbox.nextElementSibling;
            const circle = card.querySelector('.check-circle');
            
            if (checkbox.checked) {
                card.className = "border-2 rounded-xl p-3 flex items-center justify-between transition-all bg-[#2A3475] text-white border-[#2A3475]";
                circle.innerHTML = '<i class="fas fa-check text-[10px]"></i>';
            } else {
                card.className = "border-2 rounded-xl p-3 flex items-center justify-between transition-all bg-white text-gray-700 border-gray-200 hover:border-navy/50";
                circle.innerHTML = '';
            }
        }

        function toggleAll(state) {
            const checkboxes = document.querySelectorAll('.room-checkbox');
            checkboxes.forEach(cb => {
                cb.checked = state;
                updateRoomCard(cb);
            });
        }

        function openSettings() {
            loadSettings();
            document.getElementById('settings-modal').classList.add('show');
        }

        function closeSettings() {
            document.getElementById('settings-modal').classList.remove('show');
        }

        function saveSettings() {
            const checked = document.querySelectorAll('.room-checkbox:checked');
            activeRooms = Array.from(checked).map(cb => cb.value);
            
            if (activeRooms.length === 0) {
                alert("ÙŠØ¬Ø¨ Ø§Ø®ØªÙŠØ§Ø± Ù‚Ø§Ø¹Ø© ÙˆØ§Ø­Ø¯Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„!");
                return;
            }

            localStorage.setItem('tv_display_rooms', JSON.stringify(activeRooms));
            closeSettings();
            
            currentRoomIndex = 0;
            fetchData();
        }

        // --- Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª (ÙˆØ§Ù„ØªØ­Ø¯ÙŠØ«) ---
        async function fetchData() {
            if (activeRooms.length === 0) loadSettings();

            const todayNameEn = daysMap[new Date().getDay()];
            
            const { data, error } = await supabase
                .from('academic_schedule')
                .select('*')
                .eq('day_of_week', todayNameEn);

            if (error) { console.error(error); return; }

            roomsData = {};
            activeRooms.forEach(room => roomsData[room] = []);

            if (data) {
                data.forEach(item => {
                    if (roomsData[item.room_name] !== undefined) {
                        roomsData[item.room_name].push(item);
                    }
                });
            }

            for (let room in roomsData) {
                roomsData[room].sort((a, b) => a.period_order - b.period_order);
            }
            
            if(!document.querySelector('.room-card')) {
                showRoom(0);
                startSlideshow();
            } else {
                const currentRoomName = activeRooms[currentRoomIndex];
                if (currentRoomName) {
                    showRoom(currentRoomIndex);
                }
            }
        }

        // --- Ø¹Ø±Ø¶ Ø§Ù„ØºØ±ÙØ© ---
// --- Ø¹Ø±Ø¶ Ø§Ù„ØºØ±ÙØ© (Ù…Ø¹Ø¯Ù„Ø© Ù„ØªÙˆØ­ÙŠØ¯ Ø§Ù„ØªÙˆÙ‚ÙŠØªØ§Øª Ù…Ø¹ Ø§Ù„ÙƒØ±ÙˆØª) ---
function showRoom(index) {
    const container = document.getElementById('content-container');
    
    if (activeRooms.length === 0) {
        container.innerHTML = '<div class="text-white text-2xl text-center">Ù„Ù… ÙŠØªÙ… Ø§Ø®ØªÙŠØ§Ø± Ù‚Ø§Ø¹Ø§Øª Ù„Ù„Ø¹Ø±Ø¶</div>';
        return;
    }

    const roomName = activeRooms[index];
    const schedule = roomsData[roomName] || [];
    
    const now = new Date();
    const currentMinutes = now.getHours() * 60 + now.getMinutes();
    
    // Ø­Ø³Ø§Ø¨ ØªØ§Ø±ÙŠØ® Ø§Ù„ÙŠÙˆÙ…
    const todayStr = now.toLocaleDateString('en-CA'); 

    // ğŸ”¥ Ø¯Ø§Ù„Ø© ØªÙˆØ­ÙŠØ¯ Ø§Ù„ØªÙˆÙ‚ÙŠØª (Ù†ÙØ³ Ø§Ù„Ù…Ù†Ø·Ù‚ Ø§Ù„Ù…ÙˆØ¬ÙˆØ¯ ÙÙŠ Ø§Ù„ÙƒØ±ÙˆØª) ğŸ”¥
    const formatTimeDisplay = (time) => {
        if (!time) return "00:00 - 00:00";
        const t = time.trim();

        // ØªÙˆØ­ÙŠØ¯ Ø§Ù„ÙØªØ±Ø§Øª Ø§Ù„Ø®Ù…Ø³ Ø§Ù„Ø±Ø³Ù…ÙŠØ©
        if (t.startsWith("08:30") || t.startsWith("8:30")) return "08:30 - 10:20";
        if (t.startsWith("10:30")) return "10:30 - 12:20";
        if (t.startsWith("12:30")) return "12:30 - 02:20";
        if (t.startsWith("02:30") || t.startsWith("14:30")) return "02:30 - 04:20";
        if (t.startsWith("04:30") || t.startsWith("16:30")) return "04:30 - 06:20";

        return t; // Ù„Ùˆ ÙˆÙ‚Øª Ù…Ø®ØªÙ„Ù Ù†Ø±Ø¬Ø¹Ù‡ Ø²ÙŠ Ù…Ø§ Ù‡Ùˆ
    };

    let rowsHTML = '';
    let currentStatus = '<div class="flex items-center gap-2 bg-green-100 text-green-700 px-4 py-2 rounded-xl font-bold"><span class="relative flex h-3 w-3"><span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-green-400 opacity-75"></span><span class="relative inline-flex rounded-full h-3 w-3 bg-green-500"></span></span> Ø§Ù„Ù‚Ø§Ø¹Ø© ÙØ§Ø±ØºØ© Ø­Ø§Ù„ÙŠØ§Ù‹</div>';

    if (schedule.length > 0) {
        schedule.forEach((item, i) => {
            // 1. ØªØ­ÙˆÙŠÙ„ Ø§Ù„ØªÙˆÙ‚ÙŠØª Ø§Ù„Ø®Ø§Ù… Ø¥Ù„Ù‰ Ø§Ù„ØªÙˆÙ‚ÙŠØª Ø§Ù„Ø±Ø³Ù…ÙŠ Ø§Ù„Ù…ÙˆØ­Ø¯
            const displayTime = formatTimeDisplay(item.time_slot);
            
            // 2. Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„ØªÙˆÙ‚ÙŠØª Ø§Ù„Ù…ÙˆØ­Ø¯ ÙÙŠ Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª (Ø¹Ø´Ø§Ù† ÙƒÙ„Ù…Ø© "Ø§Ù„Ø¢Ù†" ØªØ¸Ù‡Ø± ØµØ­)
            const times = displayTime.split('-');
            let isCurrent = false;
            
            // ÙØ­Øµ Ø§Ù„Ø¥Ù„ØºØ§Ø¡
            const isCancelled = (item.status === 'cancelled') || 
                                (item.cancelled_dates && item.cancelled_dates.includes(todayStr));

            if (times.length === 2 && !isCancelled) {
                const startParts = times[0].trim().split(':');
                const endParts = times[1].trim().split(':');
                
                // ØªØ­ÙˆÙŠÙ„ Ù„Ù€ 24 Ø³Ø§Ø¹Ø© Ù„Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„ØµØ­ÙŠØ­ (Ø®ØµÙˆØµØ§Ù‹ Ù„ÙØªØ±Ø§Øª Ø¨Ø¹Ø¯ Ø§Ù„Ø¸Ù‡Ø±)
                let startH = parseInt(startParts[0]);
                let endH = parseInt(endParts[0]);
                
                // ØªØµØ­ÙŠØ­ Ø§Ù„ØªÙˆÙ‚ÙŠØª Ø§Ù„Ù…Ø³Ø§Ø¦ÙŠ (Ø§Ù„Ù†Ø¸Ø§Ù… 12 Ø³Ø§Ø¹Ø© ÙÙŠ Ø§Ù„Ø¹Ø±Ø¶ØŒ Ø¨Ø³ Ù„Ø§Ø²Ù… Ù†Ø­Ø³Ø¨Ù‡ 24)
                // Ø£ÙŠ ÙˆÙ‚Øª ÙŠØ¨Ø¯Ø£ 01, 02, 03, 04 ÙˆØ±Ù‚Ù… Ø§Ù„ÙØªØ±Ø© Ù…Ø´ 08, 10, 12 ÙŠØ¨Ù‚Ù‰ Ù…Ø³Ø§Ø¡Ù‹
                if (startH < 7) startH += 12; 
                if (endH < 7) endH += 12;
                // Ø­Ø§Ù„Ø© Ø®Ø§ØµØ©: 12 Ø¸Ù‡Ø±Ø§Ù‹ Ø¨ØªÙØ¶Ù„ 12ØŒ Ù…Ø´ Ø¨Ù†Ø²ÙˆØ¯ Ø¹Ù„ÙŠÙ‡Ø§
                if (startH === 24) startH = 12; 
                if (endH === 24) endH = 12;

                const startMins = startH * 60 + parseInt(startParts[1]);
                const endMins = endH * 60 + parseInt(endParts[1]);
                
                if (currentMinutes >= startMins && currentMinutes < endMins) {
                    isCurrent = true;
                    currentStatus = `<div class="flex items-center gap-2 bg-red-100 text-red-700 px-4 py-2 rounded-xl font-bold status-live"><span class="relative flex h-3 w-3"><span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-red-400 opacity-75"></span><span class="relative inline-flex rounded-full h-3 w-3 bg-red-500"></span></span> Ù…Ø´ØºÙˆÙ„Ø©: ${item.course_name}</div>`;
                }
            }

            const delay = i * 100; 
            
            const rowClass = isCancelled ? 'row-cancelled' : 'bg-white border-b border-gray-50';
            const titleClass = isCancelled ? 'text-cancelled' : 'text-gray-800';
            const instructorClass = isCancelled ? 'opacity-50' : 'text-gray-700';
            
            let statusBadge = '';
            if (isCancelled) {
                statusBadge = '<span class="badge-cancelled"><i class="fas fa-ban"></i> Ù…Ù„ØºØ§Ø©</span>';
            } else if (isCurrent) {
                statusBadge = '<span class="text-xs bg-red-600 text-white px-3 py-1 rounded-full font-bold shadow-sm">Ø§Ù„Ø¢Ù†</span>';
            } else {
                statusBadge = '<span class="text-gray-300"><i class="fas fa-clock"></i></span>';
            }

            rowsHTML += `
                <tr class="${rowClass} transition-colors stagger-row" style="animation-delay: ${delay}ms">
                    <td class="py-5 px-6 font-black text-[#2A3475] text-2xl font-english text-left w-1/4 ${isCancelled ? 'opacity-50' : ''}" dir="ltr">${displayTime}</td>
                    <td class="py-5 px-6 w-1/2">
                        <div class="font-extrabold ${titleClass} text-2xl mb-1">${item.course_name}</div>
                        <div class="text-sm text-gray-500 font-english tracking-wider opacity-70">${item.course_code || ''}</div>
                    </td>
                    <td class="py-5 px-6 w-1/4">
                        <div class="flex items-center gap-4 ${isCancelled ? 'opacity-50' : ''}">
                            <div class="w-12 h-12 rounded-full bg-blue-50 flex items-center justify-center text-[#2A3475] font-bold text-xl shadow-sm">
                                <i class="fas fa-chalkboard-teacher"></i>
                            </div>
                            <span class="font-bold text-xl truncate ${instructorClass}">${item.instructor}</span>
                        </div>
                    </td>
                    <td class="py-5 px-4 text-center">
                        ${statusBadge}
                    </td>
                </tr>
            `;
        });
    } else {
        rowsHTML = `
            <tr class="bg-white">
                <td colspan="4" class="py-20 text-center text-gray-400">
                    <i class="fas fa-calendar-check text-6xl mb-4 opacity-20"></i>
                    <p class="text-xl font-bold">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø­Ø§Ø¶Ø±Ø§Øª Ù…Ø¬Ø¯ÙˆÙ„Ø© ÙÙŠ Ù‡Ø°Ù‡ Ø§Ù„Ù‚Ø§Ø¹Ø© Ø§Ù„ÙŠÙˆÙ…</p>
                </td>
            </tr>
        `;
    }

    const html = `
        <div class="glass-panel rounded-3xl overflow-hidden flex flex-col w-full max-w-6xl mx-auto h-[85vh] fade-in-up room-card">
            <div class="bg-white border-b border-gray-100 p-8 flex justify-between items-center">
                <div class="flex items-center gap-6">
                    <div class="bg-[#2A3475] p-4 rounded-2xl shadow-lg text-white">
                        <i class="fas fa-door-open text-4xl text-gold"></i>
                    </div>
                    <div>
                        <h2 class="text-6xl font-black tracking-tighter text-navy font-english">${roomName}</h2>
                        <p class="text-gray-400 text-xl font-medium mt-1">Ø¬Ø¯ÙˆÙ„ Ù…Ø­Ø§Ø¶Ø±Ø§Øª Ø§Ù„ÙŠÙˆÙ…</p>
                    </div>
                </div>
                <div class="transform scale-110 origin-left">
                    ${currentStatus}
                </div>
            </div>
            <div class="flex-1 overflow-y-auto p-2 bg-white">
                <table class="w-full text-right border-collapse">
                    <thead class="sticky top-0 bg-white z-10 shadow-sm">
                        <tr class="text-gray-400 text-sm uppercase tracking-wider border-b border-gray-100">
                            <th class="py-4 px-6 font-bold text-left">Time</th>
                            <th class="py-4 px-6 font-bold">Subject</th>
                            <th class="py-4 px-6 font-bold">Instructor</th>
                            <th class="py-4 px-4">Status</th>
                        </tr>
                    </thead>
                    <tbody class="text-gray-700">
                        ${rowsHTML}
                    </tbody>
                </table>
            </div>
        </div>
    `;

    container.innerHTML = html;
}

        function startSlideshow() {
            const bar = document.getElementById('slide-progress');
            let width = 0;
            clearInterval(progressInterval);
            
            progressInterval = setInterval(() => {
                width += 100 / (SLIDE_DURATION / 50); 
                bar.style.width = width + '%';
                
                if (width >= 100) {
                    width = 0;
                    const card = document.querySelector('.room-card');
                    if(card) {
                        card.style.opacity = '0';
                        card.style.transform = 'translateY(-20px)';
                    }
                    setTimeout(() => {
                        currentRoomIndex = (currentRoomIndex + 1) % activeRooms.length;
                        showRoom(currentRoomIndex);
                    }, 400);
                }
            }, 50);
        }

        // --- ÙƒÙˆØ¯ Ø§Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù„Ø­Ø¸ÙŠ Ø§Ù„Ø³Ø­Ø±ÙŠ (Realtime) ---
        // Ø¯Ù‡ Ø¨ÙŠØ®Ù„ÙŠ Ø§Ù„Ø´Ø§Ø´Ø© ØªØ­Ø³ Ø¨Ø£ÙŠ ØªØºÙŠÙŠØ± ÙŠØ­ØµÙ„ ÙÙŠ Ø§Ù„Ø¯Ø§ØªØ§Ø¨ÙŠØ² ÙˆØªØ­Ø¯Ø« Ù†ÙØ³Ù‡Ø§ ÙÙˆØ±Ø§Ù‹
        const mySubscription = supabase
            .channel('public:academic_schedule')
            .on(
                'postgres_changes', 
                { event: '*', schema: 'public', table: 'academic_schedule' }, 
                (payload) => {
                    console.log('ğŸ”” ØªØºÙŠÙŠØ± ØªÙ… Ø±ØµØ¯Ù‡:', payload);
                    // Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙÙˆØ±Ø§Ù‹ Ù„ÙƒÙŠ ÙŠØ¸Ù‡Ø± Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ (Ø¥Ù„ØºØ§Ø¡/ØªÙØ¹ÙŠÙ„)
                    fetchData(); 
                }
            )
            .subscribe();

        // Ø§Ù„ØªØ´ØºÙŠÙ„ Ø§Ù„Ù…Ø¨Ø¯Ø¦ÙŠ ÙˆØ§Ù„Ù…Ø¤Ù‚Øª Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠ
        fetchData();
        setInterval(fetchData, REFRESH_INTERVAL);

    </script>
</body>
</html>